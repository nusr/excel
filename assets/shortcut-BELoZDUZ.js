import{ad as R,H as E,y as x,a7 as y,a5 as K,af as M,F as N,i as z,L as U,M as _,ag as h,E as v}from"./index-C8wO7Npz.js";import{B as L,c as H,E as O}from"./style-BzKcKm9k.js";const B={value:"",displayValue:"",row:0,col:0,left:R,top:R,width:0,height:0,defineName:"",rowCount:1,colCount:1},G=new L(B),$=new L([]),k=200;function I(e){e.batchUpdate(()=>(g(e),e.setNextActiveCell("right"),A(e),!0))}function b(e){e.batchUpdate(()=>(g(e),e.setNextActiveCell("down"),A(e),!0))}function V(e,t,o){const n=e.getScroll();let{row:s,col:a}=n;if(n.top!==o){s=0;let i=o;for(;i>0;){const r=e.getRowHeight(s).len;if(r>i)break;i-=r,s++}}if(n.left!==t){a=0;let i=t;for(;i>0;){const r=e.getColWidth(a).len;if(r>i)break;i-=r,a++}}return{row:s,col:a}}function q(e){const t=`div[data-testid="${M}${e}"]`,o=document.querySelector(t);o&&typeof o.scrollIntoView=="function"&&o.scrollIntoView()}function X(e,t){e.batchUpdate(()=>{const o=t.sheetId||e.getCurrentSheetId();o!==e.getCurrentSheetId()&&e.setCurrentSheetId(o);const n=e.getSheetInfo(o);if(!n||t.row<0||t.col<0||t.row>=n.rowCount||t.col>=n.colCount)return!0;const s=e.getScroll(o),a=e.computeCellPosition({row:s.row,col:s.col,colCount:1,rowCount:1,sheetId:o}),i=E.get(),r=x.get(),{top:l,left:c}=e.computeCellPosition(t),u=a.top,w=a.left,S=a.top+i.height-r.height,p=a.left+i.width-r.width;if(l>=u&&l<S&&c>=w&&c<=p)return e.setActiveRange(t),!0;const f=e.computeCellPosition(e.getActiveRange().range);return C(e,c-f.left,l-f.top),e.setActiveRange(t),!0})}function T(e,t){const o=parseInt(K.scrollBarContent,10),n=E.get(),s=y.get(),a=s.height-n.height+k,i=s.width-n.width+k,r=n.height-o,l=n.width-o,c=Math.floor(t*r/a),u=Math.floor(e*l/i);return{maxHeight:a,maxWidth:i,maxScrollHeight:r,maxScrollWidth:l,scrollTop:c,scrollLeft:u}}function C(e,t,o){const n=e.getScroll(),{maxHeight:s,maxWidth:a,maxScrollHeight:i,maxScrollWidth:r}=T(n.left,n.top);let l=n.top+Math.ceil(o);l<0?l=0:l>s&&(l=s);let c=n.left+Math.ceil(t);c<0?c=0:c>a&&(c=a);const{row:u,col:w}=V(e,c,l),S=Math.floor(l*i/s),p=Math.floor(c*r/a),f={row:u,col:w,top:l,left:c,scrollTop:S,scrollLeft:p};e.setScroll(f)}function A(e){const t=e.getActiveRange().range,o={row:t.row,col:t.col,colCount:1,rowCount:1,sheetId:""},n=e.computeCellPosition(o),s=e.getCellSize(o),a=E.get(),i=e.getScroll(),r=e.getSheetInfo(e.getCurrentSheetId()),l=x.get(),c=5,{maxHeight:u,maxWidth:w,maxScrollHeight:S,maxScrollWidth:p}=T(i.left,i.top);if(n.left+s.width+c>a.width&&i.col<=r.colCount-2){const f=i.left+e.getColWidth(i.col).len,m=Math.floor(f*p/w);e.setScroll({...i,col:i.col+1,left:f,scrollLeft:m})}if(n.left-l.width<a.left+c&&i.col>=1){const f=i.left-e.getColWidth(i.col).len,m=Math.floor(f*p/w);e.setScroll({...i,col:i.col-1,left:f,scrollLeft:m})}if(n.top+s.height+c>a.height&&i.row<=r.rowCount-2){const f=i.top+e.getRowHeight(i.row).len,m=Math.floor(f*S/u);e.setScroll({...i,row:i.row+1,top:f,scrollTop:m})}if(n.top-l.height<a.top+c&&i.row>=1){const f=i.top-e.getRowHeight(i.row).len,m=Math.floor(f*S/u);e.setScroll({...i,row:i.row-1,top:f,scrollTop:m})}}function d(){const e=document.activeElement;return!(!e||e.getAttribute("data-role")!==N)}function W(e){const t=document.activeElement,{range:o,isMerged:n}=e.getActiveRange(),s=e.getCell(o);let a=t.value;typeof(s==null?void 0:s.value)=="string"&&z(n,s==null?void 0:s.value)&&(a=a.replaceAll(U,_)),e.setCellValue(a,o),t.value="",t.blur(),H.setState({editorStatus:O.NONE})}function g(e){d()&&W(e)}const j=[{key:"Enter",modifierKey:[],handler:b},{key:"Tab",modifierKey:[],handler:I},{key:"ArrowDown",modifierKey:[h()?"meta":"ctrl"],handler:e=>{d()||e.batchUpdate(()=>{g(e);const t=y.get();return C(e,0,t.height),!0})}},{key:"ArrowUp",modifierKey:[h()?"meta":"ctrl"],handler:e=>{d()||e.batchUpdate(()=>{g(e);const t=y.get();return C(e,0,-t.height),!0})}},{key:"ArrowRight",modifierKey:[h()?"meta":"ctrl"],handler:e=>{d()||e.batchUpdate(()=>{g(e);const t=y.get();return C(e,t.width,0),!0})}},{key:"ArrowLeft",modifierKey:[h()?"meta":"ctrl"],handler:e=>{d()||e.batchUpdate(()=>{g(e);const t=y.get();return C(e,-t.width,0),!0})}},{key:"ArrowDown",modifierKey:[],handler:e=>{d()||b(e)}},{key:"ArrowUp",modifierKey:[],handler:e=>{d()||e.batchUpdate(()=>(g(e),e.setNextActiveCell("up"),A(e),!0))}},{key:"ArrowRight",modifierKey:[],handler:e=>{d()||I(e)}},{key:"ArrowLeft",modifierKey:[],handler:e=>{d()||e.batchUpdate(()=>(g(e),e.setNextActiveCell("left"),A(e),!0))}},{key:"b",modifierKey:[h()?"meta":"ctrl"],handler:e=>{var o;if(d())return;const t=e.getCell(e.getActiveRange().range);e.updateCellStyle({isBold:!((o=t==null?void 0:t.style)!=null&&o.isBold)},e.getActiveRange().range)}},{key:"i",modifierKey:[h()?"meta":"ctrl"],handler:e=>{var o;if(d())return;const t=e.getCell(e.getActiveRange().range);e.updateCellStyle({isItalic:!((o=t==null?void 0:t.style)!=null&&o.isItalic)},e.getActiveRange().range)}},{key:"5",modifierKey:[h()?"meta":"ctrl"],handler:e=>{var o;if(d())return;const t=e.getCell(e.getActiveRange().range);e.updateCellStyle({isStrike:!((o=t==null?void 0:t.style)!=null&&o.isStrike)},e.getActiveRange().range)}},{key:"u",modifierKey:[h()?"meta":"ctrl"],handler:e=>{var s;if(d())return;const t=e.getCell(e.getActiveRange().range),o=(s=t==null?void 0:t.style)==null?void 0:s.underline;let n=v.NONE;o===void 0||o===v.NONE?n=v.SINGLE:n=v.NONE,e.updateCellStyle({underline:n},e.getActiveRange().range)}},{key:"z",modifierKey:[h()?"meta":"ctrl"],handler:e=>{e.undo()}},{key:"y",modifierKey:[h()?"meta":"ctrl"],handler:e=>{e.redo()}}];export{G as a,C as b,T as c,$ as d,V as e,q as f,d as g,W as h,j as k,X as s};
//# sourceMappingURL=shortcut-BELoZDUZ.js.map
