import{r as s,V as D,j as t,B as l,$ as i,W as H,X as L,u as O,C as X,ad as k,I as g,ai as F,c as R,a as V,a8 as $,af as K}from"./index-C8wO7Npz.js";import{s as v}from"./sheetList-B6QCIhlH.js";import{c as N}from"./style-BzKcKm9k.js";const U="_active_1d9ea_30",n={"sheet-bar-wrapper":"_sheet-bar-wrapper_1d9ea_1","sheet-bar-list":"_sheet-bar-list_1d9ea_11","sheet-bar-item":"_sheet-bar-item_1d9ea_22",active:U,"sheet-bar-item-text":"_sheet-bar-item-text_1d9ea_35","sheet-bar-item-color":"_sheet-bar-item-color_1d9ea_39","sheet-bar-context-menu":"_sheet-bar-context-menu_1d9ea_48","sheet-bar-input":"_sheet-bar-input_1d9ea_63","show-block":"_show-block_1d9ea_75","sheet-bar-unhide":"_sheet-bar-unhide_1d9ea_79","add-button":"_add-button_1d9ea_83","menu-button":"_menu-button_1d9ea_90","select-popup":"_select-popup_1d9ea_98","unhide-select":"_unhide-select_1d9ea_103"},y=s.memo(({controller:o,position:c,sheetList:h,currentSheetId:x,hideMenu:r,editSheetName:_})=>{const u=D(r),C=s.useMemo(()=>{var a;return((a=h.find(m=>m.sheetId===x))==null?void 0:a.tabColor)||""},[h,x]),b=s.useMemo(()=>h.filter(a=>a.isHide).map(a=>({value:String(a.sheetId),label:a.name,disabled:!1})),[h]),S=()=>{var m;let a=String((m=b[0])==null?void 0:m.value)||"";H({visible:!0,title:i("unhide-sheet"),testId:"sheet-bar-context-menu-unhide-dialog",children:t.jsx(O,{data:b,onChange:f=>{a=String(f)},className:n["unhide-select"],defaultValue:a,testId:"sheet-bar-context-menu-unhide-dialog-select"}),onCancel:r,onOk(){if(!a)return L.error(i("sheet-id-can-not-be-empty"));o.unhideSheet(a),r()}})},p=a=>{o.updateSheetInfo({tabColor:a}),r()};return t.jsxs("div",{className:n["sheet-bar-context-menu"],style:{left:c},ref:u,"data-testid":"sheet-bar-context-menu",children:[t.jsx(l,{testId:"sheet-bar-context-menu-insert",onClick:()=>{r(),o.addSheet()},children:i("insert")}),t.jsx(l,{testId:"sheet-bar-context-menu-delete",onClick:()=>{r(),o.deleteSheet()},children:i("delete")}),t.jsx(l,{testId:"sheet-bar-context-menu-rename",onClick:()=>{r(),_()},children:i("rename")}),t.jsx(l,{testId:"sheet-bar-context-menu-hide",onClick:()=>{r(),o.hideSheet()},children:i("hide")}),t.jsx(l,{testId:"sheet-bar-context-menu-unhide",className:n["sheet-bar-unhide"],disabled:b.length===0,onClick:S,children:i("unhide")}),t.jsx(X,{color:C,onChange:p,position:"top",testId:"sheet-bar-context-menu-tab-color",children:t.jsx(l,{className:n["sheet-bar-unhide"],testId:"sheet-bar-context-menu-tab-color",children:i("tab-color")})})]})});y.displayName="SheetBarContextMenu";const G=s.memo(({controller:o})=>{const c=s.useSyncExternalStore(v.subscribe,v.getSnapshot),h=s.useMemo(()=>c.filter(e=>!e.isHide),[c]),x=s.useMemo(()=>c.filter(e=>!e.isHide).map(e=>({value:e.sheetId,label:e.name,disabled:!1})),[c]),[r,_]=s.useState(!1),{currentSheetId:u}=s.useSyncExternalStore(N.subscribe,N.getSnapshot),[C,b]=s.useState(k),[S,p]=s.useState(!1),a=s.useCallback(e=>{e.preventDefault();const d=e.clientX-30;return b(d),!1},[]),m=s.useCallback(e=>{if(e.stopPropagation(),e.key==="Enter"){const d=e.currentTarget.value;if(p(!1),!d)return;o.renameSheet(d)}},[]),f=s.useCallback(e=>{_(!1),o.setCurrentSheetId(e)},[]),E=s.useCallback(()=>{o.addSheet()},[]),P=s.useCallback(()=>{b(k)},[]),T=s.useCallback(()=>{p(!0)},[]),w=s.useCallback(()=>{_(e=>!e)},[]);return t.jsxs("div",{className:n["sheet-bar-wrapper"],"data-testid":"sheet-bar",children:[t.jsxs("div",{children:[t.jsx(l,{onClick:w,className:n["menu-button"],testId:"sheet-bar-select-sheet",children:t.jsx(g,{name:"menu"})}),r&&t.jsx(F,{data:x,onChange:f,active:!0,position:"top",value:u,testId:"sheet-bar-select-sheet-popup",className:n["select-popup"]})]}),t.jsx("div",{className:n["sheet-bar-list"],"data-testid":"sheet-bar-list",children:h.map(e=>{const d=u===e.sheetId,A=d&&S,I=e.tabColor||"",B=R(n["sheet-bar-item"],{[n.active]:d});let j;!d&&!S&&I&&(j={backgroundColor:I});const M=d?"sheet-bar-active-item":void 0;return t.jsx("div",{"data-testid":`${K}${e.sheetId}`,className:B,style:j,onContextMenu:a,onClick:()=>{u!==e.sheetId&&(p(!1),o.setCurrentSheetId(e.sheetId))},children:A?t.jsx("input",{className:n["sheet-bar-input"],defaultValue:e.name,onKeyDown:m,type:"text",spellCheck:!0,maxLength:V,"data-testid":"sheet-bar-rename-input"}):t.jsxs($.Fragment,{children:[d&&I&&t.jsx("span",{className:n["sheet-bar-item-color"],style:{backgroundColor:I},"data-testid":"sheet-bar-tab-color-item"}),t.jsx("span",{className:n["sheet-bar-item-text"],"data-testid":M,children:e.name})]})},e.sheetId)})}),t.jsx(l,{onClick:E,type:"circle",className:n["add-button"],testId:"sheet-bar-add-sheet",children:t.jsx(g,{name:"plus"})}),C>=0&&t.jsx(y,{controller:o,position:C,sheetList:c,currentSheetId:u,hideMenu:P,editSheetName:T})]})});G.displayName="SheetBarContainer";export{G as SheetBarContainer,G as default};
//# sourceMappingURL=index-CA_crYMO.js.map
