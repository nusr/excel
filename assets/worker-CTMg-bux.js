var Wn=Object.defineProperty;var zn=(fe,ue,Se)=>ue in fe?Wn(fe,ue,{enumerable:!0,configurable:!0,writable:!0,value:Se}):fe[ue]=Se;var x=(fe,ue,Se)=>zn(fe,typeof ue!="symbol"?ue+"":ue,Se);(function(){"use strict";/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const fe=Symbol("Comlink.proxy"),ue=Symbol("Comlink.endpoint"),Se=Symbol("Comlink.releaseProxy"),Ze=Symbol("Comlink.finalizer"),Ue=Symbol("Comlink.thrown"),Et=t=>typeof t=="object"&&t!==null||typeof t=="function",Er={canHandle:t=>Et(t)&&t[fe],serialize(t){const{port1:e,port2:r}=new MessageChannel;return Je(t,e),[r,[r]]},deserialize(t){return t.start(),pr(t)}},gr={canHandle:t=>Et(t)&&Ue in t,serialize({value:t}){let e;return t instanceof Error?e={isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:e={isError:!1,value:t},[e,[]]},deserialize(t){throw t.isError?Object.assign(new Error(t.value.message),t.value):t.value}},gt=new Map([["proxy",Er],["throw",gr]]);function Cr(t,e){for(const r of t)if(e===r||r==="*"||r instanceof RegExp&&r.test(e))return!0;return!1}function Je(t,e=globalThis,r=["*"]){e.addEventListener("message",function n(s){if(!s||!s.data)return;if(!Cr(r,s.origin)){console.warn(`Invalid origin '${s.origin}' for comlink proxy`);return}const{id:c,type:d,path:g}=Object.assign({path:[]},s.data),p=(s.data.argumentList||[]).map(me);let E;try{const C=g.slice(0,-1).reduce((N,O)=>N[O],t),M=g.reduce((N,O)=>N[O],t);switch(d){case"GET":E=M;break;case"SET":C[g.slice(-1)[0]]=me(s.data.value),E=!0;break;case"APPLY":E=M.apply(C,p);break;case"CONSTRUCT":{const N=new M(...p);E=Mr(N)}break;case"ENDPOINT":{const{port1:N,port2:O}=new MessageChannel;Je(t,O),E=Sr(N,[N])}break;case"RELEASE":E=void 0;break;default:return}}catch(C){E={value:C,[Ue]:0}}Promise.resolve(E).catch(C=>({value:C,[Ue]:0})).then(C=>{const[M,N]=Be(C);e.postMessage(Object.assign(Object.assign({},M),{id:c}),N),d==="RELEASE"&&(e.removeEventListener("message",n),Ct(e),Ze in t&&typeof t[Ze]=="function"&&t[Ze]())}).catch(C=>{const[M,N]=Be({value:new TypeError("Unserializable return value"),[Ue]:0});e.postMessage(Object.assign(Object.assign({},M),{id:c}),N)})}),e.start&&e.start()}function Ar(t){return t.constructor.name==="MessagePort"}function Ct(t){Ar(t)&&t.close()}function pr(t,e){const r=new Map;return t.addEventListener("message",function(s){const{data:c}=s;if(!c||!c.id)return;const d=r.get(c.id);if(d)try{d(c)}finally{r.delete(c.id)}}),qe(t,r,[],e)}function ke(t){if(t)throw new Error("Proxy has been released and is not useable")}function At(t){return Me(t,new Map,{type:"RELEASE"}).then(()=>{Ct(t)})}const Pe=new WeakMap,$e="FinalizationRegistry"in globalThis&&new FinalizationRegistry(t=>{const e=(Pe.get(t)||0)-1;Pe.set(t,e),e===0&&At(t)});function mr(t,e){const r=(Pe.get(e)||0)+1;Pe.set(e,r),$e&&$e.register(t,e,t)}function wr(t){$e&&$e.unregister(t)}function qe(t,e,r=[],n=function(){}){let s=!1;const c=new Proxy(n,{get(d,g){if(ke(s),g===Se)return()=>{wr(c),At(t),e.clear(),s=!0};if(g==="then"){if(r.length===0)return{then:()=>c};const p=Me(t,e,{type:"GET",path:r.map(E=>E.toString())}).then(me);return p.then.bind(p)}return qe(t,e,[...r,g])},set(d,g,p){ke(s);const[E,C]=Be(p);return Me(t,e,{type:"SET",path:[...r,g].map(M=>M.toString()),value:E},C).then(me)},apply(d,g,p){ke(s);const E=r[r.length-1];if(E===ue)return Me(t,e,{type:"ENDPOINT"}).then(me);if(E==="bind")return qe(t,e,r.slice(0,-1));const[C,M]=pt(p);return Me(t,e,{type:"APPLY",path:r.map(N=>N.toString()),argumentList:C},M).then(me)},construct(d,g){ke(s);const[p,E]=pt(g);return Me(t,e,{type:"CONSTRUCT",path:r.map(C=>C.toString()),argumentList:p},E).then(me)}});return mr(c,t),c}function Rr(t){return Array.prototype.concat.apply([],t)}function pt(t){const e=t.map(Be);return[e.map(r=>r[0]),Rr(e.map(r=>r[1]))]}const mt=new WeakMap;function Sr(t,e){return mt.set(t,e),t}function Mr(t){return Object.assign(t,{[fe]:!0})}function Be(t){for(const[e,r]of gt)if(r.canHandle(t)){const[n,s]=r.serialize(t);return[{type:"HANDLER",name:e,value:n},s]}return[{type:"RAW",value:t},mt.get(t)||[]]}function me(t){switch(t.type){case"HANDLER":return gt.get(t.name).deserialize(t.value);case"RAW":return t.value}}function Me(t,e,r,n){return new Promise(s=>{const c=Ir();e.set(c,s),t.start&&t.start(),t.postMessage(Object.assign({id:c},r),n)})}function Ir(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}var He=(t=>(t[t.TOP=0]="TOP",t[t.MIDDLE=1]="MIDDLE",t[t.BOTTOM=2]="BOTTOM",t))(He||{}),Ge=(t=>(t[t.LEFT=0]="LEFT",t[t.CENTER=1]="CENTER",t[t.RIGHT=2]="RIGHT",t))(Ge||{}),wt=(t=>(t[t.NONE=0]="NONE",t[t.SINGLE=1]="SINGLE",t[t.DOUBLE=2]="DOUBLE",t))(wt||{}),A=(t=>(t[t.EQUAL=0]="EQUAL",t[t.NOT_EQUAL=1]="NOT_EQUAL",t[t.PLUS=2]="PLUS",t[t.MINUS=3]="MINUS",t[t.STAR=4]="STAR",t[t.SLASH=5]="SLASH",t[t.EXPONENT=6]="EXPONENT",t[t.GREATER=7]="GREATER",t[t.GREATER_EQUAL=8]="GREATER_EQUAL",t[t.CONCATENATE=9]="CONCATENATE",t[t.COLON=10]="COLON",t[t.COMMA=11]="COMMA",t[t.EMPTY_CHAR=12]="EMPTY_CHAR",t[t.PERCENT=13]="PERCENT",t[t.LESS=14]="LESS",t[t.LESS_EQUAL=15]="LESS_EQUAL",t[t.STRING=16]="STRING",t[t.NUMBER=17]="NUMBER",t[t.BOOL=18]="BOOL",t[t.ERROR=19]="ERROR",t[t.ERROR_REF=20]="ERROR_REF",t[t.LEFT_BRACKET=21]="LEFT_BRACKET",t[t.RIGHT_BRACKET=22]="RIGHT_BRACKET",t[t.lEFT_BRACE=23]="lEFT_BRACE",t[t.RIGHT_BRACE=24]="RIGHT_BRACE",t[t.SEMICOLON=25]="SEMICOLON",t[t.EXCLAMATION=26]="EXCLAMATION",t[t.R1C1=27]="R1C1",t[t.SHEET_NAME=28]="SHEET_NAME",t[t.CELL=29]="CELL",t[t.COLUMN=30]="COLUMN",t[t.ROW=31]="ROW",t[t.DEFINED_NAME=32]="DEFINED_NAME",t[t.EXCEL_FUNCTION=33]="EXCEL_FUNCTION",t[t.REF_FUNCTION=34]="REF_FUNCTION",t[t.REF_FUNCTION_COND=35]="REF_FUNCTION_COND",t[t.EOF=36]="EOF",t))(A||{});class oe{constructor(e,r){x(this,"type");x(this,"value");this.type=e,this.value=r}toString(){return this.value}}const ye=12,Nr="sans-serif",Rt=22,St=76,Mt=0,et="&#10;",It=16384,Nt=1048576,Or=16,Ot="=",tt="_",rt=256,Tt=9,Ve="General",Tr="@",bt=new Set(["#GETTING_DATA","#DIV/0!","#NULL!","#NUM!","#REF!","#VALUE!","#N/A","#NAME?"]),F=1,Dt={thin:F,hair:F,dotted:F,dashed:F,dashDot:F,dashDotDot:F,double:F,medium:F*2,mediumDashed:F*2,mediumDashDot:F*2,mediumDashDotDot:F*2,thick:F*4},Lt=["#35322B","#505050","#606060","#6F6F6F","#8B8B8B","#B2B2B2","#CCCCCC","#E5E5E5","#F5F5F5","#FFFFFF","#9D0000","#B20000","#CD0F0F","#E30909","#F30B0B","#FE4B4B","#FA7979","#FB9D9D","#FDCECE","#FEE7E7","#B24000","#CC4F10","#DF5D00","#F96800","#FB8937","#FF8C51","#FCA669","#FDC49B","#FEE1CD","#FEF0E6","#B19401","#C5A300","#D8B300","#EBC301","#F9D700","#FBE137","#FCE869","#FDF09B","#FEF7CD","#FEFBE6","#58770A","#688C0D","#7AA017","#8BBB11","#A4DC16","#BEEE44","#CEF273","#DEF6A2","#EFFBD0","#F7FDE8","#007676","#008A8A","#009E9E","#00BBBB","#1CD8D8","#2AEAEA","#76EFEF","#A3F5F5","#D1FAFA","#E8FCFC","#001F9C","#0025B7","#012BD2","#133DE3","#2F55EB","#4567ED","#738DF2","#A2B3F6","#D0D9FB","#E8ECFD","#3F0198","#510EB0","#6721CB","#7735D4","#894EDE","#9E6DE3","#AA82E3","#C7ABED","#E3D5F6","#F1EAFA","#8F0550","#A1095C","#C1026B","#D4157E","#E7258F","#F248A6","#F273B9","#F6A2D0","#FBD0E8","#FDE8F3"],br=/^[$]?[A-Za-z]{1,3}[$]?[1-9][0-9]*$/,Dr=/^[$]?[A-Za-z]{1,3}$/,Lr=/^\$[1-9][0-9]*$/,xr=/^[a-zA-Z_][a-zA-Z0-9_.?]*$/,_r=new Set(["ABS","ACCRINT","ACCRINTM","ACOS","ACOSH","ACOT","ACOTH","ADDRESS","AGGREGATE","AMORDEGRC","AMORLINC","AND","ARABIC","AREAS","ARRAYTOTEXT","ASC","ASIN","ASINH","ATAN","ATAN2","ATANH","AVEDEV","AVERAGE","AVERAGEA","AVERAGEIF","AVERAGEIFS","BAHTTEXT","BASE","BESSELI","BESSELJ","BESSELK","BESSELY","BETA.DIST","BETA.INV","BETADIST","BETAINV","BIN2DEC","BIN2HEX","BIN2OCT","BINOM.DIST","BINOM.DIST.RANGE","BINOM.INV","BINOMDIST","BITAND","BITLSHIFT","BITOR","BITRSHIFT","BITXOR","CALL","CEILING","CEILING.MATH","CEILING.PRECISE","CELL","CHAR","CHIDIST","CHIINV","CHISQ.DIST","CHISQ.DIST.RT","CHISQ.INV","CHISQ.INV.RT","CHISQ.TEST","CHITEST","CLEAN","CODE","COLUMN","COLUMNS","COMBIN","COMBINA","COMPLEX","CONCAT","CONCATENATE","CONFIDENCE","CONFIDENCE.NORM","CONFIDENCE.T","CONVERT","CORREL","COS","COSH","COT","COTH","COUNT","COUNTA","COUNTBLANK","COUNTIF","COUNTIFS","COUPDAYBS","COUPDAYS","COUPDAYSNC","COUPNCD","COUPNUM","COUPPCD","COVAR","COVARIANCE.P","COVARIANCE.S","CRITBINOM","CSC","CSCH","CUBEKPIMEMBER","CUBEMEMBER","CUBEMEMBERPROPERTY","CUBERANKEDMEMBER","CUBESET","CUBESETCOUNT","CUBEVALUE","CUMIPMT","CUMPRINC","DATE","DATEDIF","DATEVALUE","DAVERAGE","DAY","DAYS","DAYS360","DB","DBCS","DCOUNT","DCOUNTA","DDB","DEC2BIN","DEC2HEX","DEC2OCT","DECIMAL","DEGREES","DELTA","DEVSQ","DGET","DISC","DMAX","DMIN","DOLLAR","DOLLARDE","DOLLARFR","DPRODUCT","DSTDEV","DSTDEVP","DSUM","DURATION","DVAR","DVARP","EDATE","EFFECT","ENCODEURL","EOMONTH","ERF","ERF.PRECISE","ERFC","ERFC.PRECISE","ERROR.TYPE","EUROCONVERT","EVEN","EXACT","EXP","EXPON.DIST","EXPONDIST","F.DIST","F.DIST.RT","F.INV","F.INV.RT","F.TEST","FACT","FACTDOUBLE","FALSE","FDIST","FILTER","FILTERXML","FIND","FINDB","FINV","FISHER","FISHERINV","FIXED","FLOOR","FLOOR.MATH","FLOOR.PRECISE","FORECAST","FORECAST.ETS","FORECAST.ETS.CONFINT","FORECAST.ETS.SEASONALITY","FORECAST.ETS.STAT","FORECAST.LINEAR","FORMULATEXT","FREQUENCY","FTEST","FV","FVSCHEDULE","GAMMA","GAMMA.DIST","GAMMA.INV","GAMMADIST","GAMMAINV","GAMMALN","GAMMALN.PRECISE","GAUSS","GCD","GEOMEAN","GESTEP","GETPIVOTDATA","GROWTH","HARMEAN","HEX2BIN","HEX2DEC","HEX2OCT","HLOOKUP","HOUR","HYPERLINK","HYPGEOM.DIST","HYPGEOMDIST","IFERROR","IFNA","IFS","IMABS","IMAGINARY","IMARGUMENT","IMCONJUGATE","IMCOS","IMCOSH","IMCOT","IMCSC","IMCSCH","IMDIV","IMEXP","IMLN","IMLOG10","IMLOG2","IMPOWER","IMPRODUCT","IMREAL","IMSEC","IMSECH","IMSIN","IMSINH","IMSQRT","IMSUB","IMSUM","IMTAN","INFO","INT","INTERCEPT","INTRATE","IPMT","IRR","ISBLANK","ISERR","ISERROR","ISEVEN","ISFORMULA","ISLOGICAL","ISNA","ISNONTEXT","ISNUMBER","ISO.CEILING","ISODD","ISOWEEKNUM","ISPMT","ISREF","ISTEXT","JIS","KURT","LARGE","LCM","LEFT","LEFTB","LEN","LENB","LET","LINEST","LN","LOG","LOG10","LOGEST","LOGINV","LOGNORM.DIST","LOGNORM.INV","LOGNORMDIST","LOOKUP","LOWER","MATCH","MAX","MAXA","MAXIFS","MDETERM","MDURATION","MEDIAN","MID","MIDB","MIN","MINA","MINIFS","MINUTE","MINVERSE","MIRR","MMULT","MOD","MODE","MODE.MULT","MODE.SNGL","MONTH","MROUND","MULTINOMIAL","MUNIT","N","NA","NEGBINOM.DIST","NEGBINOMDIST","NETWORKDAYS","NETWORKDAYS.INTL","NOMINAL","NORM.DIST","NORM.INV","NORM.S.DIST","NORM.S.INV","NORMDIST","NORMINV","NORMSDIST","NORMSINV","NOT","NOW","NPER","NPV","NUMBERVALUE","OCT2BIN","OCT2DEC","OCT2HEX","ODD","ODDFPRICE","ODDFYIELD","ODDLPRICE","ODDLYIELD","OR","PDURATION","PEARSON","PERCENTILE","PERCENTILE.EXC","PERCENTILE.INC","PERCENTRANK","PERCENTRANK.EXC","PERCENTRANK.INC","PERMUT","PERMUTATIONA","PHI","PHONETIC","PI","PMT","POISSON","POISSON.DIST","POWER","PPMT","PRICE","PRICEDISC","PRICEMAT","PROB","PRODUCT","PROPER","PV","QUARTILE","QUARTILE.EXC","QUARTILE.INC","QUOTIENT","RADIANS","RAND","RANDARRAY","RANDBETWEEN","RANK","RANK.AVG","RANK.EQ","RATE","RECEIVED","REGISTER.ID","REPLACE","REPLACEB","REPT","RIGHT","RIGHTB","ROMAN","ROUND","ROUNDDOWN","ROUNDUP","ROW","ROWS","RRI","RSQ","RTD","SEARCH","SEARCHB","SEC","SECH","SECOND","SEQUENCE","SERIESSUM","SHEET","SHEETS","SIGN","SIN","SINH","SKEW","SKEW.P","SLN","SLOPE","SMALL","SORT","SORTBY","SQRT","SQRTPI","STANDARDIZE","STDEV","STDEV.P","STDEV.S","STDEVA","STDEVP","STDEVPA","STEYX","SUBSTITUTE","SUBTOTAL","SUM","SUMIF","SUMIFS","SUMPRODUCT","SUMSQ","SUMX2MY2","SUMX2PY2","SUMXMY2","SWITCH","SYD","T","T.DIST","T.DIST.2T","T.DIST.RT","T.INV","T.INV.2T","T.TEST","TAN","TANH","TBILLEQ","TBILLPRICE","TBILLYIELD","TDIST","TEXT","TEXTJOIN","TIME","TIMEVALUE","TINV","TODAY","TRANSPOSE","TREND","TRIM","TRIMMEAN","TRUE","TRUNC","TTEST","TYPE","UNICHAR","UNICODE","UNIQUE","UPPER","VALUE","VALUETOTEXT","VAR","VAR.P","VAR.S","VARA","VARP","VARPA","VDB","VLOOKUP","WEBSERVICE","WEEKDAY","WEEKNUM","WEIBULL","WEIBULL.DIST","WORKDAY","WORKDAY.INTL","XIRR","XLOOKUP","XMATCH","XNPV","XOR","YEAR","YEARFRAC","YIELD","YIELDDISC","YIELDMAT","Z.TEST","ZTEST"]);function Xe(t){if(typeof t=="boolean")return[!0,Number(t)];if(typeof t=="number"&&!isNaN(t))return[!0,t];if(typeof t!="string")return[!1,0];if(t.length>12)return[!1,0];const e=Number(t);return isNaN(e)?[!1,0]:[!0,e]}function xt(t,e){return`${t}${tt}${e}`}function vr(t){const[e,r]=t.split(tt),n=parseInt(e,10),s=parseInt(r,10);return{row:isNaN(n)?-1:n,col:isNaN(s)?-1:s}}function _t(t,e){return`${t}${tt}${e}`}function Fr(t){return!!(typeof t=="string"&&t&&t.startsWith(Ot)&&t.length>1)}function Ur(t,e){return t&&e.includes(et)}class V extends Error{constructor(r){super(r);x(this,"value");this.value=r}}function q(t,e="#VALUE!"){if(!t)throw new V(e)}function nt(t){q(t.length===1);const[e]=t;return e}function Oe(t){const e=nt(t);return q(typeof e=="string"),e}function ee(t){const e=nt(t),[r,n]=Xe(e);return q(r),n}function kr(t){q(t.length===0)}function Pr(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var vt={exports:{}};(function(t){var e={};function r(n){n.version="0.11.3";function s(a){for(var i="",o=a.length-1;o>=0;)i+=a.charAt(o--);return i}function c(a,i){for(var o="";o.length<i;)o+=a;return o}function d(a,i){var o=""+a;return o.length>=i?o:c("0",i-o.length)+o}function g(a,i){var o=""+a;return o.length>=i?o:c(" ",i-o.length)+o}function p(a,i){var o=""+a;return o.length>=i?o:o+c(" ",i-o.length)}function E(a,i){var o=""+Math.round(a);return o.length>=i?o:c("0",i-o.length)+o}function C(a,i){var o=""+a;return o.length>=i?o:c("0",i-o.length)+o}var M=Math.pow(2,32);function N(a,i){if(a>M||a<-M)return E(a,i);var o=Math.round(a);return C(o,i)}function O(a,i){return i=i||0,a.length>=7+i&&(a.charCodeAt(i)|32)===103&&(a.charCodeAt(i+1)|32)===101&&(a.charCodeAt(i+2)|32)===110&&(a.charCodeAt(i+3)|32)===101&&(a.charCodeAt(i+4)|32)===114&&(a.charCodeAt(i+5)|32)===97&&(a.charCodeAt(i+6)|32)===108}var k=[["Sun","Sunday"],["Mon","Monday"],["Tue","Tuesday"],["Wed","Wednesday"],["Thu","Thursday"],["Fri","Friday"],["Sat","Saturday"]],G=[["J","Jan","January"],["F","Feb","February"],["M","Mar","March"],["A","Apr","April"],["M","May","May"],["J","Jun","June"],["J","Jul","July"],["A","Aug","August"],["S","Sep","September"],["O","Oct","October"],["N","Nov","November"],["D","Dec","December"]];function H(a){a[0]="General",a[1]="0",a[2]="0.00",a[3]="#,##0",a[4]="#,##0.00",a[9]="0%",a[10]="0.00%",a[11]="0.00E+00",a[12]="# ?/?",a[13]="# ??/??",a[14]="m/d/yy",a[15]="d-mmm-yy",a[16]="d-mmm",a[17]="mmm-yy",a[18]="h:mm AM/PM",a[19]="h:mm:ss AM/PM",a[20]="h:mm",a[21]="h:mm:ss",a[22]="m/d/yy h:mm",a[37]="#,##0 ;(#,##0)",a[38]="#,##0 ;[Red](#,##0)",a[39]="#,##0.00;(#,##0.00)",a[40]="#,##0.00;[Red](#,##0.00)",a[45]="mm:ss",a[46]="[h]:mm:ss",a[47]="mmss.0",a[48]="##0.0E+0",a[49]="@",a[56]='"上午/下午 "hh"時"mm"分"ss"秒 "'}var X={};H(X);var z=[],D=0;for(D=5;D<=8;++D)z[D]=32+D;for(D=23;D<=26;++D)z[D]=0;for(D=27;D<=31;++D)z[D]=14;for(D=50;D<=58;++D)z[D]=14;for(D=59;D<=62;++D)z[D]=D-58;for(D=67;D<=68;++D)z[D]=D-58;for(D=72;D<=75;++D)z[D]=D-58;for(D=67;D<=68;++D)z[D]=D-57;for(D=76;D<=78;++D)z[D]=D-56;for(D=79;D<=81;++D)z[D]=D-34;var te={5:'"$"#,##0_);\\("$"#,##0\\)',63:'"$"#,##0_);\\("$"#,##0\\)',6:'"$"#,##0_);[Red]\\("$"#,##0\\)',64:'"$"#,##0_);[Red]\\("$"#,##0\\)',7:'"$"#,##0.00_);\\("$"#,##0.00\\)',65:'"$"#,##0.00_);\\("$"#,##0.00\\)',8:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',66:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',41:'_(* #,##0_);_(* \\(#,##0\\);_(* "-"_);_(@_)',42:'_("$"* #,##0_);_("$"* \\(#,##0\\);_("$"* "-"_);_(@_)',43:'_(* #,##0.00_);_(* \\(#,##0.00\\);_(* "-"??_);_(@_)',44:'_("$"* #,##0.00_);_("$"* \\(#,##0.00\\);_("$"* "-"??_);_(@_)'};function le(a,i,o){for(var T=a<0?-1:1,h=a*T,L=0,u=1,I=0,_=1,w=0,U=0,P=Math.floor(h);w<i&&(P=Math.floor(h),I=P*u+L,U=P*w+_,!(h-P<5e-8));)h=1/(h-P),L=u,u=I,_=w,w=U;if(U>i&&(w>i?(U=_,I=L):(U=w,I=u)),!o)return[0,T*I,U];var ae=Math.floor(T*I/U);return[ae,T*I-ae*U,U]}function ne(a){var i=a.toPrecision(16);if(i.indexOf("e")>-1){var o=i.slice(0,i.indexOf("e"));return o=o.indexOf(".")>-1?o.slice(0,o.slice(0,2)=="0."?17:16):o.slice(0,15)+c("0",o.length-15),o+i.slice(i.indexOf("e"))}var T=i.indexOf(".")>-1?i.slice(0,i.slice(0,2)=="0."?17:16):i.slice(0,15)+c("0",i.length-15);return Number(T)}function Y(a,i,o){if(a>2958465||a<0)return null;a=ne(a);var T=a|0,h=Math.floor(86400*(a-T)),L=0,u=[],I={D:T,T:h,u:86400*(a-T)-h,y:0,m:0,d:0,H:0,M:0,S:0,q:0};if(Math.abs(I.u)<1e-6&&(I.u=0),i&&i.date1904&&(T+=1462),I.u>.9999&&(I.u=0,++h==86400&&(I.T=h=0,++T,++I.D)),T===60)u=o?[1317,10,29]:[1900,2,29],L=3;else if(T===0)u=o?[1317,8,29]:[1900,1,0],L=6;else{T>60&&--T;var _=new Date(1900,0,1);_.setDate(_.getDate()+T-1),u=[_.getFullYear(),_.getMonth()+1,_.getDate()],L=_.getDay(),T<60&&(L=(L+6)%7),o&&(L=Vn(_,u))}return I.y=u[0],I.m=u[1],I.d=u[2],I.S=h%60,h=Math.floor(h/60),I.M=h%60,h=Math.floor(h/60),I.H=h,I.q=L,I}n.parse_date_code=Y;var Ae=new Date(1899,11,31,0,0,0),Ke=Ae.getTime(),yn=new Date(1900,2,1,0,0,0);function rr(a,i){var o=a.getTime();return i?o-=1461*24*60*60*1e3:a>=yn&&(o+=24*60*60*1e3),(o-(Ke+(a.getTimezoneOffset()-Ae.getTimezoneOffset())*6e4))/(24*60*60*1e3)}var nr=function(){var i=/(?:\.0*|(\.\d*[1-9])0+)$/;function o(w){return w.indexOf(".")==-1?w:w.replace(i,"$1")}var T=/(?:\.0*|(\.\d*[1-9])0+)[Ee]/,h=/(E[+-])(\d)$/;function L(w){return w.indexOf("E")==-1?w:w.replace(T,"$1E").replace(h,"$10$2")}function u(w){var U=w<0?12:11,P=o(w.toFixed(12));return P.length<=U||(P=w.toPrecision(10),P.length<=U)?P:w.toExponential(5)}function I(w){var U=o(w.toFixed(11));return U.length>(w<0?12:11)||U==="0"||U==="-0"?w.toPrecision(6):U}function _(w){var U=Math.floor(Math.log(Math.abs(w))*Math.LOG10E),P;return U>=-4&&U<=-1?P=w.toPrecision(10+U):Math.abs(U)<=9?P=u(w):U===10?P=w.toFixed(10).substr(0,12):P=I(w),o(L(P.toUpperCase()))}return _}();n._general_num=nr;function Qe(a,i){switch(typeof a){case"string":return a;case"boolean":return a?"TRUE":"FALSE";case"number":return(a|0)===a?a.toString(10):nr(a);case"undefined":return"";case"object":if(a==null)return"";if(a instanceof Date)return dr(14,rr(a,i&&i.date1904),i)}throw new Error("unsupported value in General format: "+a)}n._general=Qe;function Vn(a,i){i[0]-=581;var o=a.getDay();return a<60&&(o=(o+6)%7),o}function Xn(a,i,o,T){var h="",L=0,u=0,I=o.y,_,w=0;switch(a){case 98:I=o.y+543;case 121:switch(i.length){case 1:case 2:_=I%100,w=2;break;default:_=I%1e4,w=4;break}break;case 109:switch(i.length){case 1:case 2:_=o.m,w=i.length;break;case 3:return G[o.m-1][1];case 5:return G[o.m-1][0];default:return G[o.m-1][2]}break;case 100:switch(i.length){case 1:case 2:_=o.d,w=i.length;break;case 3:return k[o.q][0];default:return k[o.q][1]}break;case 104:switch(i.length){case 1:case 2:_=1+(o.H+11)%12,w=i.length;break;default:throw"bad hour format: "+i}break;case 72:switch(i.length){case 1:case 2:_=o.H,w=i.length;break;default:throw"bad hour format: "+i}break;case 77:switch(i.length){case 1:case 2:_=o.M,w=i.length;break;default:throw"bad minute format: "+i}break;case 115:if(i!="s"&&i!="ss"&&i!=".0"&&i!=".00"&&i!=".000")throw"bad second format: "+i;return o.u===0&&(i=="s"||i=="ss")?d(o.S,i.length):(T>=2?u=T===3?1e3:100:u=T===1?10:1,L=Math.round(u*(o.S+o.u)),L>=60*u&&(L=0),i==="s"?L===0?"0":""+L/u:(h=d(L,2+T),i==="ss"?h.substr(0,2):"."+h.substr(2,i.length-1)));case 90:switch(i){case"[h]":case"[hh]":_=o.D*24+o.H;break;case"[m]":case"[mm]":_=(o.D*24+o.H)*60+o.M;break;case"[s]":case"[ss]":_=((o.D*24+o.H)*60+o.M)*60+(T==0?Math.round(o.S+o.u):o.S);break;default:throw"bad abstime format: "+i}w=i.length===3?1:2;break;case 101:_=I,w=1;break}var U=w>0?d(_,w):"";return U}function pe(a){var i=3;if(a.length<=i)return a;for(var o=a.length%i,T=a.substr(0,o);o!=a.length;o+=i)T+=(T.length>0?",":"")+a.substr(o,i);return T}var de=function(){var i=/%/g;function o(m,l,f){var b=l.replace(i,""),S=l.length-b.length;return de(m,b,f*Math.pow(10,2*S))+c("%",S)}function T(m,l,f){for(var b=l.length-1;l.charCodeAt(b-1)===44;)--b;return de(m,l.substr(0,b),f/Math.pow(10,3*(l.length-b)))}function h(m,l){var f,b=m.indexOf("E")-m.indexOf(".")-1;if(m.match(/^#+0.0E\+0$/)){if(l==0)return"0.0E+0";if(l<0)return"-"+h(m,-l);var S=m.indexOf(".");S===-1&&(S=m.indexOf("E"));var R=Math.floor(Math.log(l)*Math.LOG10E)%S;if(R<0&&(R+=S),f=(l/Math.pow(10,R)).toPrecision(b+1+(S+R)%S),f.indexOf("e")===-1){var v=Math.floor(Math.log(l)*Math.LOG10E);for(f.indexOf(".")===-1?f=f.charAt(0)+"."+f.substr(1)+"E+"+(v-f.length+R):f+="E+"+(v-R);f.substr(0,2)==="0.";)f=f.charAt(0)+f.substr(2,S)+"."+f.substr(2+S),f=f.replace(/^0+([1-9])/,"$1").replace(/^0+\./,"0.");f=f.replace(/\+-/,"-")}f=f.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(W,K,Q,B){return K+Q+B.substr(0,(S+R)%S)+"."+B.substr(R)+"E"})}else f=l.toExponential(b);return m.match(/E\+00$/)&&f.match(/e[+-]\d$/)&&(f=f.substr(0,f.length-1)+"0"+f.charAt(f.length-1)),m.match(/E\-/)&&f.match(/e\+/)&&(f=f.replace(/e\+/,"e")),f.replace("e","E")}var L=/# (\?+)( ?)\/( ?)(\d+)/;function u(m,l,f){var b=parseInt(m[4],10),S=Math.round(l*b),R=Math.floor(S/b),v=S-R*b,W=b;return f+(R===0?"":""+R)+" "+(v===0?c(" ",m[1].length+1+m[4].length):g(v,m[1].length)+m[2]+"/"+m[3]+d(W,m[4].length))}function I(m,l,f){return f+(l===0?"":""+l)+c(" ",m[1].length+2+m[4].length)}var _=/^#*0*\.([0#]+)/,w=/\).*[0#]/,U=/\(###\) ###\\?-####/;function P(m){for(var l="",f,b=0;b!=m.length;++b)switch(f=m.charCodeAt(b)){case 35:break;case 63:l+=" ";break;case 48:l+="0";break;default:l+=String.fromCharCode(f)}return l}function ae(m,l){var f=Math.pow(10,l);return""+Math.round(m*f)/f}function Re(m,l){var f=m-Math.floor(m),b=Math.pow(10,l);return l<(""+Math.round(f*b)).length?0:Math.round(f*b)}function dt(m,l){return l<(""+Math.round((m-Math.floor(m))*Math.pow(10,l))).length?1:0}function ce(m){return m<2147483647&&m>-2147483648?""+(m>=0?m|0:m-1|0):""+Math.floor(m)}function y(m,l,f){if(m.charCodeAt(0)===40&&!l.match(w)){var b=l.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return f>=0?y("n",b,f):"("+y("n",b,-f)+")"}if(l.charCodeAt(l.length-1)===44)return T(m,l,f);if(l.indexOf("%")!==-1)return o(m,l,f);if(l.indexOf("E")!==-1)return h(l,f);if(l.charCodeAt(0)===36)return"$"+y(m,l.substr(l.charAt(1)==" "?2:1),f);var S,R,v,W,K=Math.abs(f),Q=f<0?"-":"";if(l.match(/^00+$/))return Q+N(K,l.length);if(l.match(/^[#?]+$/))return S=N(f,0),S==="0"&&(S=""),S.length>l.length?S:P(l.substr(0,l.length-S.length))+S;if(R=l.match(L))return u(R,K,Q);if(l.match(/^#+0+$/))return Q+N(K,l.length-l.indexOf("0"));if(R=l.match(_))return S=ae(f,R[1].length).replace(/^([^\.]+)$/,"$1."+P(R[1])).replace(/\.$/,"."+P(R[1])).replace(/\.(\d*)$/,function(se,Fe){return"."+Fe+c("0",P(R[1]).length-Fe.length)}),l.indexOf("0.")!==-1?S:S.replace(/^0\./,".");if(l=l.replace(/^#+([0.])/,"$1"),R=l.match(/^(0*)\.(#*)$/))return Q+ae(K,R[2].length).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,R[1].length?"0.":".");if(R=l.match(/^#{1,3},##0(\.?)$/))return Q+pe(N(K,0));if(R=l.match(/^#,##0\.([#0]*0)$/))return f<0?"-"+y(m,l,-f):pe(""+(Math.floor(f)+dt(f,R[1].length)))+"."+d(Re(f,R[1].length),R[1].length);if(R=l.match(/^#,#*,#0/))return y(m,l.replace(/^#,#*,/,""),f);if(R=l.match(/^([0#]+)(\\?-([0#]+))+$/))return S=s(y(m,l.replace(/[\\-]/g,""),f)),v=0,s(s(l.replace(/\\/g,"")).replace(/[0#]/g,function(se){return v<S.length?S.charAt(v++):se==="0"?"0":""}));if(l.match(U))return S=y(m,"##########",f),"("+S.substr(0,3)+") "+S.substr(3,3)+"-"+S.substr(6);var B="";if(R=l.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return v=Math.min(R[4].length,7),W=le(K,Math.pow(10,v)-1,!1),S=""+Q,B=de("n",R[1],W[1]),B.charAt(B.length-1)==" "&&(B=B.substr(0,B.length-1)+"0"),S+=B+R[2]+"/"+R[3],B=p(W[2],v),B.length<R[4].length&&(B=P(R[4].substr(R[4].length-B.length))+B),S+=B,S;if(R=l.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return v=Math.min(Math.max(R[1].length,R[4].length),7),W=le(K,Math.pow(10,v)-1,!0),Q+(W[0]||(W[1]?"":"0"))+" "+(W[1]?g(W[1],v)+R[2]+"/"+R[3]+p(W[2],v):c(" ",2*v+1+R[2].length+R[3].length));if(R=l.match(/^[#0?]+$/))return S=N(f,0),l.length<=S.length?S:P(l.substr(0,l.length-S.length))+S;if(R=l.match(/^([#0?]+)\.([#0]+)$/)){S=""+f.toFixed(Math.min(R[2].length,10)).replace(/([^0])0+$/,"$1"),v=S.indexOf(".");var _e=l.indexOf(".")-v,ft=l.length-S.length-_e;return P(l.substr(0,_e)+S+l.substr(l.length-ft))}if(R=l.match(/^00,000\.([#0]*0)$/))return v=Re(f,R[1].length),f<0?"-"+y(m,l,-f):pe(ce(f)).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(se){return"00,"+(se.length<3?d(0,3-se.length):"")+se})+"."+d(v,R[1].length);switch(l){case"###,##0.00":return y(m,"#,##0.00",f);case"###,###":case"##,###":case"#,###":var ve=pe(N(K,0));return ve!=="0"?Q+ve:"";case"###,###.00":return y(m,"###,##0.00",f).replace(/^0\./,".");case"#,###.00":return y(m,"#,##0.00",f).replace(/^0\./,".")}throw new Error("unsupported format |"+l+"|")}function Ne(m,l,f){for(var b=l.length-1;l.charCodeAt(b-1)===44;)--b;return de(m,l.substr(0,b),f/Math.pow(10,3*(l.length-b)))}function je(m,l,f){var b=l.replace(i,""),S=l.length-b.length;return de(m,b,f*Math.pow(10,2*S))+c("%",S)}function re(m,l){var f,b=m.indexOf("E")-m.indexOf(".")-1;if(m.match(/^#+0.0E\+0$/)){if(l==0)return"0.0E+0";if(l<0)return"-"+re(m,-l);var S=m.indexOf(".");S===-1&&(S=m.indexOf("E"));var R=Math.floor(Math.log(l)*Math.LOG10E)%S;if(R<0&&(R+=S),f=(l/Math.pow(10,R)).toPrecision(b+1+(S+R)%S),!f.match(/[Ee]/)){var v=Math.floor(Math.log(l)*Math.LOG10E);f.indexOf(".")===-1?f=f.charAt(0)+"."+f.substr(1)+"E+"+(v-f.length+R):f+="E+"+(v-R),f=f.replace(/\+-/,"-")}f=f.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(W,K,Q,B){return K+Q+B.substr(0,(S+R)%S)+"."+B.substr(R)+"E"})}else f=l.toExponential(b);return m.match(/E\+00$/)&&f.match(/e[+-]\d$/)&&(f=f.substr(0,f.length-1)+"0"+f.charAt(f.length-1)),m.match(/E\-/)&&f.match(/e\+/)&&(f=f.replace(/e\+/,"e")),f.replace("e","E")}function J(m,l,f){if(m.charCodeAt(0)===40&&!l.match(w)){var b=l.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return f>=0?J("n",b,f):"("+J("n",b,-f)+")"}if(l.charCodeAt(l.length-1)===44)return Ne(m,l,f);if(l.indexOf("%")!==-1)return je(m,l,f);if(l.indexOf("E")!==-1)return re(l,f);if(l.charCodeAt(0)===36)return"$"+J(m,l.substr(l.charAt(1)==" "?2:1),f);var S,R,v,W,K=Math.abs(f),Q=f<0?"-":"";if(l.match(/^00+$/))return Q+d(K,l.length);if(l.match(/^[#?]+$/))return S=""+f,f===0&&(S=""),S.length>l.length?S:P(l.substr(0,l.length-S.length))+S;if(R=l.match(L))return I(R,K,Q);if(l.match(/^#+0+$/))return Q+d(K,l.length-l.indexOf("0"));if(R=l.match(_))return S=(""+f).replace(/^([^\.]+)$/,"$1."+P(R[1])).replace(/\.$/,"."+P(R[1])),S=S.replace(/\.(\d*)$/,function(se,Fe){return"."+Fe+c("0",P(R[1]).length-Fe.length)}),l.indexOf("0.")!==-1?S:S.replace(/^0\./,".");if(l=l.replace(/^#+([0.])/,"$1"),R=l.match(/^(0*)\.(#*)$/))return Q+(""+K).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,R[1].length?"0.":".");if(R=l.match(/^#{1,3},##0(\.?)$/))return Q+pe(""+K);if(R=l.match(/^#,##0\.([#0]*0)$/))return f<0?"-"+J(m,l,-f):pe(""+f)+"."+c("0",R[1].length);if(R=l.match(/^#,#*,#0/))return J(m,l.replace(/^#,#*,/,""),f);if(R=l.match(/^([0#]+)(\\?-([0#]+))+$/))return S=s(J(m,l.replace(/[\\-]/g,""),f)),v=0,s(s(l.replace(/\\/g,"")).replace(/[0#]/g,function(se){return v<S.length?S.charAt(v++):se==="0"?"0":""}));if(l.match(U))return S=J(m,"##########",f),"("+S.substr(0,3)+") "+S.substr(3,3)+"-"+S.substr(6);var B="";if(R=l.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return v=Math.min(R[4].length,7),W=le(K,Math.pow(10,v)-1,!1),S=""+Q,B=de("n",R[1],W[1]),B.charAt(B.length-1)==" "&&(B=B.substr(0,B.length-1)+"0"),S+=B+R[2]+"/"+R[3],B=p(W[2],v),B.length<R[4].length&&(B=P(R[4].substr(R[4].length-B.length))+B),S+=B,S;if(R=l.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return v=Math.min(Math.max(R[1].length,R[4].length),7),W=le(K,Math.pow(10,v)-1,!0),Q+(W[0]||(W[1]?"":"0"))+" "+(W[1]?g(W[1],v)+R[2]+"/"+R[3]+p(W[2],v):c(" ",2*v+1+R[2].length+R[3].length));if(R=l.match(/^[#0?]+$/))return S=""+f,l.length<=S.length?S:P(l.substr(0,l.length-S.length))+S;if(R=l.match(/^([#0]+)\.([#0]+)$/)){S=""+f.toFixed(Math.min(R[2].length,10)).replace(/([^0])0+$/,"$1"),v=S.indexOf(".");var _e=l.indexOf(".")-v,ft=l.length-S.length-_e;return P(l.substr(0,_e)+S+l.substr(l.length-ft))}if(R=l.match(/^00,000\.([#0]*0)$/))return f<0?"-"+J(m,l,-f):pe(""+f).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(se){return"00,"+(se.length<3?d(0,3-se.length):"")+se})+"."+d(0,R[1].length);switch(l){case"###,###":case"##,###":case"#,###":var ve=pe(""+K);return ve!=="0"?Q+ve:"";default:if(l.match(/\.[0#?]*$/))return J(m,l.slice(0,l.lastIndexOf(".")),f)+P(l.slice(l.lastIndexOf(".")))}throw new Error("unsupported format |"+l+"|")}return function(l,f,b){return(b|0)===b?J(l,f,b):y(l,f,b)}}();function sr(a){for(var i=[],o=!1,T=0,h=0;T<a.length;++T)switch(a.charCodeAt(T)){case 34:o=!o;break;case 95:case 42:case 92:++T;break;case 59:i[i.length]=a.substr(h,T-h),h=T+1}if(i[i.length]=a.substr(h),o===!0)throw new Error("Format |"+a+"| unterminated string ");return i}n._split=sr;var ir=/\[[HhMmSs\u0E0A\u0E19\u0E17]*\]/;function or(a){for(var i=0,o="",T="";i<a.length;)switch(o=a.charAt(i)){case"G":O(a,i)&&(i+=6),i++;break;case'"':for(;a.charCodeAt(++i)!==34&&i<a.length;);++i;break;case"\\":i+=2;break;case"_":i+=2;break;case"@":++i;break;case"B":case"b":if(a.charAt(i+1)==="1"||a.charAt(i+1)==="2")return!0;case"M":case"D":case"Y":case"H":case"S":case"E":case"m":case"d":case"y":case"h":case"s":case"e":case"g":return!0;case"A":case"a":case"上":if(a.substr(i,3).toUpperCase()==="A/P"||a.substr(i,5).toUpperCase()==="AM/PM"||a.substr(i,5).toUpperCase()==="上午/下午")return!0;++i;break;case"[":for(T=o;a.charAt(i++)!=="]"&&i<a.length;)T+=a.charAt(i);if(T.match(ir))return!0;break;case".":case"0":case"#":for(;i<a.length&&("0#?.,E+-%".indexOf(o=a.charAt(++i))>-1||o=="\\"&&a.charAt(i+1)=="-"&&"0#".indexOf(a.charAt(i+2))>-1););break;case"?":for(;a.charAt(++i)===o;);break;case"*":++i,(a.charAt(i)==" "||a.charAt(i)=="*")&&++i;break;case"(":case")":++i;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(;i<a.length&&"0123456789".indexOf(a.charAt(++i))>-1;);break;case" ":++i;break;default:++i;break}return!1}n.is_date=or;function ar(a,i,o,T){for(var h=[],L="",u=0,I="",_="t",w,U,P,ae="H";u<a.length;)switch(I=a.charAt(u)){case"G":if(!O(a,u))throw new Error("unrecognized character "+I+" in "+a);h[h.length]={t:"G",v:"General"},u+=7;break;case'"':for(L="";(P=a.charCodeAt(++u))!==34&&u<a.length;)L+=String.fromCharCode(P);h[h.length]={t:"t",v:L},++u;break;case"\\":var Re=a.charAt(++u),dt=Re==="("||Re===")"?Re:"t";h[h.length]={t:dt,v:Re},++u;break;case"_":h[h.length]={t:"t",v:" "},u+=2;break;case"@":h[h.length]={t:"T",v:i},++u;break;case"B":case"b":if(a.charAt(u+1)==="1"||a.charAt(u+1)==="2"){if(w==null&&(w=Y(i,o,a.charAt(u+1)==="2"),w==null))return"";h[h.length]={t:"X",v:a.substr(u,2)},_=I,u+=2;break}case"M":case"D":case"Y":case"H":case"S":case"E":I=I.toLowerCase();case"m":case"d":case"y":case"h":case"s":case"e":case"g":if(i<0||w==null&&(w=Y(i,o),w==null))return"";for(L=I;++u<a.length&&a.charAt(u).toLowerCase()===I;)L+=I;I==="m"&&_.toLowerCase()==="h"&&(I="M"),I==="h"&&(I=ae),h[h.length]={t:I,v:L},_=I;break;case"A":case"a":case"上":var ce={t:I,v:I};if(w==null&&(w=Y(i,o)),a.substr(u,3).toUpperCase()==="A/P"?(w!=null&&(ce.v=w.H>=12?a.charAt(u+2):I),ce.t="T",ae="h",u+=3):a.substr(u,5).toUpperCase()==="AM/PM"?(w!=null&&(ce.v=w.H>=12?"PM":"AM"),ce.t="T",u+=5,ae="h"):a.substr(u,5).toUpperCase()==="上午/下午"?(w!=null&&(ce.v=w.H>=12?"下午":"上午"),ce.t="T",u+=5,ae="h"):(ce.t="t",++u),w==null&&ce.t==="T")return"";h[h.length]=ce,_=I;break;case"[":for(L=I;a.charAt(u++)!=="]"&&u<a.length;)L+=a.charAt(u);if(L.slice(-1)!=="]")throw'unterminated "[" block: |'+L+"|";if(L.match(ir)){if(w==null&&(w=Y(i,o),w==null))return"";h[h.length]={t:"Z",v:L.toLowerCase()},_=L.charAt(1)}else L.indexOf("$")>-1&&(L=(L.match(/\$([^-\[\]]*)/)||[])[1]||"$",or(a)||(h[h.length]={t:"t",v:L}));break;case".":if(w!=null){for(L=I;++u<a.length&&(I=a.charAt(u))==="0";)L+=I;h[h.length]={t:"s",v:L};break}case"0":case"#":for(L=I;++u<a.length&&"0#?.,E+-%".indexOf(I=a.charAt(u))>-1;)L+=I;h[h.length]={t:"n",v:L};break;case"?":for(L=I;a.charAt(++u)===I;)L+=I;h[h.length]={t:I,v:L},_=I;break;case"*":++u,(a.charAt(u)==" "||a.charAt(u)=="*")&&++u;break;case"(":case")":h[h.length]={t:T===1?"t":I,v:I},++u;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(L=I;u<a.length&&"0123456789".indexOf(a.charAt(++u))>-1;)L+=a.charAt(u);h[h.length]={t:"D",v:L};break;case" ":h[h.length]={t:I,v:I},++u;break;case"$":h[h.length]={t:"t",v:"$"},++u;break;default:if(",$-+/():!^&'~{}<>=€acfijklopqrtuvwxzP".indexOf(I)===-1)throw new Error("unrecognized character "+I+" in "+a);h[h.length]={t:"t",v:I},++u;break}var y=0,Ne=0,je;for(u=h.length-1,_="t";u>=0;--u)switch(h[u].t){case"h":case"H":h[u].t=ae,_="h",y<1&&(y=1);break;case"s":(je=h[u].v.match(/\.0+$/))&&(Ne=Math.max(Ne,je[0].length-1),y=4),y<3&&(y=3);case"d":case"y":case"e":_=h[u].t;break;case"M":_=h[u].t,y<2&&(y=2);break;case"m":_==="s"&&(h[u].t="M",y<2&&(y=2));break;case"X":break;case"Z":y<1&&h[u].v.match(/[Hh]/)&&(y=1),y<2&&h[u].v.match(/[Mm]/)&&(y=2),y<3&&h[u].v.match(/[Ss]/)&&(y=3)}var re;switch(y){case 0:break;case 1:case 2:case 3:w.u>=.5&&(w.u=0,++w.S),w.S>=60&&(w.S=0,++w.M),w.M>=60&&(w.M=0,++w.H),w.H>=24&&(w.H=0,++w.D,re=Y(w.D),re.u=w.u,re.S=w.S,re.M=w.M,re.H=w.H,w=re);break;case 4:switch(Ne){case 1:w.u=Math.round(w.u*10)/10;break;case 2:w.u=Math.round(w.u*100)/100;break;case 3:w.u=Math.round(w.u*1e3)/1e3;break}w.u>=1&&(w.u=0,++w.S),w.S>=60&&(w.S=0,++w.M),w.M>=60&&(w.M=0,++w.H),w.H>=24&&(w.H=0,++w.D,re=Y(w.D),re.u=w.u,re.S=w.S,re.M=w.M,re.H=w.H,w=re);break}var J="",m;for(u=0;u<h.length;++u)switch(h[u].t){case"t":case"T":case" ":case"D":break;case"X":h[u].v="",h[u].t=";";break;case"d":case"m":case"y":case"h":case"H":case"M":case"s":case"e":case"b":case"Z":h[u].v=Xn(h[u].t.charCodeAt(0),h[u].v,w,Ne),h[u].t="t";break;case"n":case"?":for(m=u+1;h[m]!=null&&((I=h[m].t)==="?"||I==="D"||(I===" "||I==="t")&&h[m+1]!=null&&(h[m+1].t==="?"||h[m+1].t==="t"&&h[m+1].v==="/")||h[u].t==="("&&(I===" "||I==="n"||I===")")||I==="t"&&(h[m].v==="/"||h[m].v===" "&&h[m+1]!=null&&h[m+1].t=="?"));)h[u].v+=h[m].v,h[m]={v:"",t:";"},++m;J+=h[u].v,u=m-1;break;case"G":h[u].t="t",h[u].v=Qe(i,o);break}var l="",f,b;if(J.length>0){J.charCodeAt(0)==40?(f=i<0&&J.charCodeAt(0)===45?-i:i,b=de("n",J,f)):(f=i<0&&T>1?-i:i,b=de("n",J,f),f<0&&h[0]&&h[0].t=="t"&&(b=b.substr(1),h[0].v="-"+h[0].v)),m=b.length-1;var S=h.length;for(u=0;u<h.length;++u)if(h[u]!=null&&h[u].t!="t"&&h[u].v.indexOf(".")>-1){S=u;break}var R=h.length;if(S===h.length&&b.indexOf("E")===-1){for(u=h.length-1;u>=0;--u)h[u]==null||"n?".indexOf(h[u].t)===-1||(m>=h[u].v.length-1?(m-=h[u].v.length,h[u].v=b.substr(m+1,h[u].v.length)):m<0?h[u].v="":(h[u].v=b.substr(0,m+1),m=-1),h[u].t="t",R=u);m>=0&&R<h.length&&(h[R].v=b.substr(0,m+1)+h[R].v)}else if(S!==h.length&&b.indexOf("E")===-1){for(m=b.indexOf(".")-1,u=S;u>=0;--u)if(!(h[u]==null||"n?".indexOf(h[u].t)===-1)){for(U=h[u].v.indexOf(".")>-1&&u===S?h[u].v.indexOf(".")-1:h[u].v.length-1,l=h[u].v.substr(U+1);U>=0;--U)m>=0&&(h[u].v.charAt(U)==="0"||h[u].v.charAt(U)==="#")&&(l=b.charAt(m--)+l);h[u].v=l,h[u].t="t",R=u}for(m>=0&&R<h.length&&(h[R].v=b.substr(0,m+1)+h[R].v),m=b.indexOf(".")+1,u=S;u<h.length;++u)if(!(h[u]==null||"n?(".indexOf(h[u].t)===-1&&u!==S)){for(U=h[u].v.indexOf(".")>-1&&u===S?h[u].v.indexOf(".")+1:0,l=h[u].v.substr(0,U);U<h[u].v.length;++U)m<b.length&&(l+=b.charAt(m++));h[u].v=l,h[u].t="t",R=u}}}for(u=0;u<h.length;++u)h[u]!=null&&"n?".indexOf(h[u].t)>-1&&(f=T>1&&i<0&&u>0&&h[u-1].v==="-"?-i:i,h[u].v=de(h[u].t,h[u].v,f),h[u].t="t");var v="";for(u=0;u!==h.length;++u)h[u]!=null&&(v+=h[u].v);return v}n._eval=ar;var cr=/\[[=<>]/,hr=/\[(=|>[=]?|<[>=]?)(-?\d+(?:\.\d*)?)\]/;function lr(a,i){if(i==null)return!1;var o=parseFloat(i[2]);switch(i[1]){case"=":if(a==o)return!0;break;case">":if(a>o)return!0;break;case"<":if(a<o)return!0;break;case"<>":if(a!=o)return!0;break;case">=":if(a>=o)return!0;break;case"<=":if(a<=o)return!0;break}return!1}function ur(a,i){var o=sr(a),T=o.length,h=o[T-1].indexOf("@");if(T<4&&h>-1&&--T,o.length>4)throw new Error("cannot find right format for |"+o.join("|")+"|");if(typeof i!="number")return[4,o.length===4||h>-1?o[o.length-1]:"@"];switch(o.length){case 1:o=h>-1?["General","General","General",o[0]]:[o[0],o[0],o[0],"@"];break;case 2:o=h>-1?[o[0],o[0],o[0],o[1]]:[o[0],o[1],o[0],"@"];break;case 3:o=h>-1?[o[0],o[1],o[0],o[2]]:[o[0],o[1],o[2],"@"];break}var L=i>0?o[0]:i<0?o[1]:o[2];if(o[0].indexOf("[")===-1&&o[1].indexOf("[")===-1)return[T,L];if(o[0].match(cr)!=null||o[1].match(cr)!=null){var u=o[0].match(hr),I=o[1].match(hr);return lr(i,u)?[T,o[0]]:lr(i,I)?[T,o[1]]:[T,o[u!=null&&I!=null?2:1]]}return[T,L]}function dr(a,i,o){o==null&&(o={});var T="";switch(typeof a){case"string":a=="m/d/yy"&&o.dateNF?T=o.dateNF:T=a;break;case"number":a==14&&o.dateNF?T=o.dateNF:T=(o.table!=null?o.table:X)[a],T==null&&(T=o.table&&o.table[z[a]]||X[z[a]]),T==null&&(T=te[a]||"General");break}if(O(T,0))return Qe(i,o);i instanceof Date&&(i=rr(i,o.date1904));var h=ur(T,i);if(O(h[1]))return Qe(i,o);if(i===!0)i="TRUE";else if(i===!1)i="FALSE";else if(i===""||i==null)return"";return ar(h[1],i,o,h[0])}function fr(a,i){if(typeof i!="number"){i=+i||-1;for(var o=0;o<392;++o){if(X[o]==null){i<0&&(i=o);continue}if(X[o]==a){i=o;break}}i<0&&(i=391)}return X[i]=a,i}n.load=fr,n._table=X,n.get_table=function(){return X},n.load_table=function(i){for(var o=0;o!=392;++o)i[o]!==void 0&&fr(i[o],o)},n.init_table=H,n.format=dr,n.choose_format=ur}r(e),typeof DO_NOT_EXPORT_SSF>"u"&&(t.exports=e)})(vt);var $r=vt.exports,Ft=Pr($r);function Ut(t,e,r={}){return Ft.format(e||Ve,t,r)}function Br(t){return t?Ft.is_date(t):!1}const Hr=(...t)=>{const e=nt(t);return typeof e=="string"?e:""},Gr=(...t)=>Oe(t).toLowerCase(),kt=(...t)=>{const e=ee(t);return String.fromCharCode(e)},Pt=(...t)=>Oe(t).charCodeAt(0),yr=(...t)=>Oe(t).length,Vr=(...t)=>{q(t.length===2);const[e,r]=t;return q(typeof e=="string"),q(typeof r=="string"),e.split(r)},Xr=(...t)=>Oe(t).toUpperCase(),Wr=(...t)=>{q(t.length===2);const[e,r]=t;return q(typeof e=="string"||typeof e=="number"),q(typeof r=="string"),Ut(e,r)},zr=(...t)=>Oe(t).replace(/ +/g," ").trim(),$t=(...t)=>(q(t.length<=rt),t.join("")),Yr={CONCAT:$t,CONCATENATE:$t,SPLIT:Vr,CHAR:kt,CODE:Pt,UNICHAR:kt,UNICODE:Pt,LEN:yr,LOWER:Gr,UPPER:Xr,TRIM:zr,TEXT:Wr,T:Hr};function Bt(t){const e=[];for(let r=0;r<t.length;r++){const[n,s]=Xe(t[r]);n&&e.push(s)}return e}const Kr={ABS:(...t)=>{const e=ee(t);return Math.abs(e)},ACOS:(...t)=>{const e=ee(t);return Math.acos(e)},ACOSH:(...t)=>{const e=ee(t);return Math.log(e+Math.sqrt(e*e-1))},ACOT:(...t)=>{const e=ee(t);return Math.atan(1/e)},ACOTH:(...t)=>{const e=ee(t);return .5*Math.log((e+1)/(e-1))},ASIN:(...t)=>{const e=ee(t);return Math.asin(e)},ASINH:(...t)=>{const e=ee(t);return Math.log(e+Math.sqrt(e*e+1))},ATAN:(...t)=>{const e=ee(t);return Math.atan(e)},ATAN2:(...t)=>{q(t.length===2);const[e,r]=t;return q(typeof e=="number"),q(typeof r=="number"),Math.atan2(e,r)},ATANH:(...t)=>{const e=ee(t);return Math.log((1+e)/(e+1))/2},AVERAGE:(...t)=>{const e=Bt(t);return q(e.length<=rt&&e.length>=1),e.reduce((r,n)=>r+n,0)/e.length},COT:(...t)=>{const e=ee(t);return 1/Math.tan(e)},COS:(...t)=>{const e=ee(t);return Math.cos(e)},EXP:(...t)=>{const e=ee(t);return Math.exp(e)},INT:(...t)=>{const e=ee(t);return Math.floor(e)},PI:(...t)=>(kr(t),Math.PI),SIN:(...t)=>{const e=ee(t);return Math.sin(e)},SUM:(...t)=>{const e=Bt(t);return q(e.length<=rt),e.reduce((r,n)=>r+n,0)}};function Qr(t){const e=String(t),r=/[.](\d*)/.exec(e);if(r&&r[1]){const n=Math.pow(10,Math.min(r[1].length,Tt)),s=e.split("."),c=s[0]+s[1].slice(0,Tt);return Number(c)/n}else return t}const Ht={...Yr,...Kr};function jr(t){const e=t.toUpperCase();let r=0;for(let n=0;n<e.length;n++)r=e.charCodeAt(n)-64+r*26;return r-1}function Zr(t){const e=t+1;let r="",n=Math.floor(Math.abs(e)),s;for(;n>0;)s=(n-1)%26,r=String.fromCharCode(65+s)+r,n=Math.floor((n-s)/26);return r.toUpperCase()}function Jr(t){let e=parseInt(t,10);return isNaN(e)?e=-1:e=Math.max(e-1,-1),e}function Te(t){return be(t)&&De(t)}function be(t){return t.colCount===0}function De(t){return t.rowCount===0}function qr(t,e){if(t.colCount===0&&e.colCount!==0||t.rowCount===0&&e.rowCount!==0)return!1;if(e.colCount===0&&e.row===t.row||e.rowCount===0&&e.col===t.col)return!0;const{row:r,col:n}=t;return r>=e.row&&r<e.row+e.rowCount&&n>=e.col&&n<e.col+e.colCount}class he{constructor(e,r,n,s,c){x(this,"row",0);x(this,"col",0);x(this,"colCount",0);x(this,"rowCount",0);x(this,"sheetId","");this.row=e,this.col=r,this.colCount=s,this.rowCount=n,this.sheetId=c}static makeRange(e){return new he(e.row,e.col,e.rowCount,e.colCount,e.sheetId)}toIRange(){return{row:this.row,col:this.col,rowCount:this.rowCount,colCount:this.colCount,sheetId:this.sheetId}}}function en(t,e,r,n){const{row:s,col:c,rowCount:d,colCount:g}=t;if(Te(t)){for(let C=0;C<e;C++)for(let M=0;M<r;M++)if(n(C,M))return;return}if(be(t)){for(let C=0;C<r;C++)if(n(s,C))return;return}if(De(t)){for(let C=0;C<e;C++)if(n(C,c))return;return}const p=s+d,E=c+g;for(let C=s;C<p;C++)for(let M=c;M<E;M++)if(n(C,M))return}const st=t=>t>="a"&&t<="z"||t>="A"&&t<="Z",Ee=t=>t>="0"&&t<="9";function tn(t){return t}function Gt(t,e){if(!t)return;const r=t.trim();let[n,s=""]=r.split("!");r.includes("!")||(n="",s=r),n&&n[0]==="'"&&n[n.length-1]==="'"&&(n=n.slice(1,-1));let c=0,d="",g="";for(s[c]==="$"&&c++;c<s.length&&st(s[c]);)g+=s[c++];for(s[c]==="$"&&c++;c<s.length&&Ee(s[c]);)d+=s[c++];if(c!==s.length||!d&&!g)return;let p=1,E=1,C=-1,M=-1;return d===""?(p=0,C=0):C=Jr(d),g===""?(E=0,M=0):M=jr(g),C<0||M<0||M>=It||C>=Nt?void 0:new he(C,M,p,E,e(n))}function rn(t,e=tn){const[r,n]=t.split(":"),s=Gt(r,e);if(!s)return;const c=Gt(n,e);return c?(c.sheetId=s.sheetId,yt(s,c)):s}function yt(t,e){if(t.sheetId!==e.sheetId)return;if(t.row===e.row&&t.col===e.col&&t.rowCount===e.rowCount&&t.colCount===e.colCount)return he.makeRange(t);if(t.rowCount===0&&e.rowCount!==0||t.rowCount!==0&&e.rowCount===0||t.colCount===0&&e.colCount!==0||t.colCount!==0&&e.colCount===0)return;const r=Math.abs(t.row-e.row)+1,n=Math.abs(t.col-e.col)+1,s=t.row<e.row?t.row:e.row,c=t.col<e.col?t.col:e.col;return new he(s,c,r,n,t.sheetId)}function Vt(t,e){let r=-1;if(t.startsWith("[")){const n=parseInt(t.slice(1,-1),10);isNaN(n)||(r=e+n)}else{const n=parseInt(t,10);isNaN(n)||(r=n-1)}return isNaN(r)?-1:r}function nn(t,e={row:-1,col:-1}){const r=t.toUpperCase();if(r[0]!=="R")return;const n=r.slice(1).split("C");if(n.length!==2)return;const[s,c]=n;let d=-1,g=-1;return s?d=Vt(s,e.row):d=e.row,c?g=Vt(c,e.col):g=e.col,g>=It||d>=Nt||d<0||g<0?void 0:new he(d,g,1,1,"")}const Xt="";class sn{constructor(e){x(this,"list");x(this,"current",0);x(this,"start",0);x(this,"tokens",[]);this.list=[...e]}scan(){for(;!this.isAtEnd();)this.start=this.current,this.scanToken();return this.tokens.push(new oe(A.EOF,"")),this.tokens.length>0&&this.tokens[0].type===A.EQUAL&&this.tokens.shift(),this.tokens}peek(){return this.isAtEnd()?Xt:this.list[this.current]}match(e){return this.peek()!==e?!1:(this.next(),!0)}next(){return this.isAtEnd()?Xt:this.list[this.current++]}isAtEnd(){return this.current>=this.list.length}addToken(e){const r=this.list.slice(this.start,this.current).join("");this.tokens.push(new oe(e,r))}string(e){for(;!this.isAtEnd()&&this.peek()!==e;)this.next();if(this.peek()!==e)throw new V("#VALUE!");this.next();const r=this.list.slice(this.start+1,this.current-1).join("");if(e==="'"&&this.match("!")){this.tokens.push(new oe(A.SHEET_NAME,r));return}this.tokens.push(new oe(A.STRING,r))}getDigits(){for(;!this.isAtEnd()&&Ee(this.peek());)this.next()}getAlphas(){for(;!this.isAtEnd()&&st(this.peek());)this.next()}matchR1C1(){if(this.match("[")){if(this.match("-"),Ee(this.peek()))this.getDigits();else throw new V("#VALUE!");if(this.peek()!=="]")throw new V("#VALUE!");this.next()}else this.getDigits()}matchScientificCounting(){if(this.match("E")||this.match("e")){if(this.match("+")||this.match("-"))return this.getDigits(),this.addToken(A.NUMBER),!0;if(Ee(this.peek()))return this.getDigits(),this.addToken(A.NUMBER),!0;throw new V("#VALUE!")}return!1}number(){this.getDigits(),!(this.matchScientificCounting()||(this.match(".")&&this.getDigits(),this.matchScientificCounting()))&&this.addToken(A.NUMBER)}addIdentifier(){for(;!this.isAtEnd()&&this.anyChar(this.peek());)this.next();let e=this.list.slice(this.start,this.current).join("");const r=e.toUpperCase();if(_r.has(r)&&this.match("(")){this.tokens.push(new oe(A.EXCEL_FUNCTION,r));return}if(["IF","CHOOSE"].includes(r)&&this.match("(")){this.tokens.push(new oe(A.REF_FUNCTION_COND,r));return}if(["INDEX","OFFSET","INDIRECT"].includes(r)&&this.match("(")){this.tokens.push(new oe(A.REF_FUNCTION,r));return}if(this.match("!")){this.tokens.push(new oe(A.SHEET_NAME,e));return}let n=A.BOOL;if(r==="TRUE"||r==="FALSE")e=r,n=A.BOOL;else if(bt.has(r))e=r,n=r==="#REF!"?A.ERROR_REF:A.ERROR;else if(br.test(r))n=A.CELL;else if(Dr.test(r))n=A.COLUMN;else if(Lr.test(r))n=A.ROW;else if(xr.test(r))n=A.DEFINED_NAME;else throw new V("#NAME?");this.tokens.push(new oe(n,e))}scanToken(){const e=this.next();switch(e){case"$":{st(this.peek())?(this.getAlphas(),this.match("$")?Ee(this.peek())?(this.getDigits(),this.addToken(A.CELL)):this.addIdentifier():Ee(this.peek())?(this.getDigits(),this.addToken(A.CELL)):this.addToken(A.COLUMN)):Ee(this.peek())?(this.getDigits(),this.addToken(A.ROW)):this.addIdentifier();break}case"r":case"R":{if(this.matchR1C1(),this.match("C")||this.match("c")){this.matchR1C1();const r=this.list.slice(this.start,this.current).join("").toUpperCase();this.tokens.push(new oe(A.R1C1,r))}else this.addIdentifier();break}case"(":this.addToken(A.LEFT_BRACKET);break;case")":this.addToken(A.RIGHT_BRACKET);break;case",":this.addToken(A.COMMA);break;case":":this.addToken(A.COLON);break;case Ot:this.addToken(A.EQUAL);break;case"<":this.match(">")?this.addToken(A.NOT_EQUAL):this.match("=")?this.addToken(A.LESS_EQUAL):this.addToken(A.LESS);break;case">":this.match("=")?this.addToken(A.GREATER_EQUAL):this.addToken(A.GREATER);break;case"+":this.addToken(A.PLUS);break;case"-":this.addToken(A.MINUS);break;case"*":this.addToken(A.STAR);break;case"/":this.addToken(A.SLASH);break;case"^":this.addToken(A.EXPONENT);break;case"&":this.addToken(A.CONCATENATE);break;case"%":this.addToken(A.PERCENT);break;case'"':this.string(e);break;case"'":this.string(e);break;case"!":this.addToken(A.EXCLAMATION);break;case";":this.addToken(A.SEMICOLON);break;case"{":this.addToken(A.lEFT_BRACE);break;case"}":this.addToken(A.RIGHT_BRACE);break;case" ":break;case"\r":case"	":case`
`:break;default:Ee(e)?this.number():this.addIdentifier();break}}anyChar(e){return!'(),:=<>+-*/^&%"{}!'.includes(e)&&!this.isWhiteSpace(e)}isWhiteSpace(e){return e===" "||e==="\r"||e===`
`||e==="	"}}class Le{constructor(e,r,n){x(this,"left");x(this,"right");x(this,"operator");this.left=e,this.operator=r,this.right=n}accept(e){return e.visitBinaryExpression(this)}handleConcatenate(e){const r=e.toString();return this.operator.type===A.CONCATENATE&&e instanceof it&&e.value.type===A.STRING?JSON.stringify(r):r}toString(){const e=this.handleConcatenate(this.left),r=this.handleConcatenate(this.right);return`${e}${this.operator.toString()}${r}`}}class on{constructor(e,r){x(this,"right");x(this,"operator");this.operator=e,this.right=r}accept(e){return e.visitUnaryExpression(this)}toString(){return this.operator.toString()+this.right.toString()}}class an{constructor(e,r){x(this,"left");x(this,"operator");this.operator=e,this.left=r}accept(e){return e.visitPostUnaryExpression(this)}toString(){return this.left.toString()+this.operator.toString()}}class it{constructor(e){x(this,"value");this.value=e}accept(e){return e.visitLiteralExpression(this)}toString(){return this.value.toString()}}class xe{constructor(e,r){x(this,"value");x(this,"sheetName");this.value=e,this.sheetName=r}accept(e){return e.visitCellExpression(this)}toString(){const e=this.value.toString().toUpperCase();if(this.sheetName){let r=this.sheetName.toString();return r.includes(" ")&&(r=`'${r}'`),`${r}!${e}`}else return e}}class cn{constructor(e,r){x(this,"name");x(this,"params");this.name=e,this.params=r}accept(e){return e.visitCallExpression(this)}toString(){return`${this.name.toString()}(${this.params.map(e=>e.toString()).join(",")})`}}class hn{constructor(e,r,n){x(this,"right");x(this,"operator");x(this,"left");this.left=e,this.operator=r,this.right=n}accept(e){return e.visitCellRangeExpression(this)}toString(){return this.left.toString()+this.operator.toString()+this.right.toString()}}class ln{constructor(e){x(this,"value");this.value=e}accept(e){return e.visitGroupExpression(this)}toString(){return`(${this.value.toString()})`}}class un{constructor(e){x(this,"value");this.value=e}accept(e){return e.visitArrayExpression(this)}toString(){return`{${this.value.map(r=>r.toString()).join(",")}}`}}class dn{constructor(e){x(this,"tokens");x(this,"current",0);this.tokens=e}parse(){const e=[];for(;!this.isAtEnd();)e.push(this.expression());return e}expression(){return this.comparison()}comparison(){let e=this.concatenate();for(;this.match(A.EQUAL,A.NOT_EQUAL,A.GREATER,A.GREATER_EQUAL,A.LESS,A.LESS_EQUAL);){const r=this.previous(),n=this.concatenate();e=new Le(e,r,n)}return e}concatenate(){let e=this.term();for(;this.match(A.CONCATENATE);){const r=this.previous(),n=this.term();e=new Le(e,r,n)}return e}term(){let e=this.factor();for(;this.match(A.PLUS,A.MINUS);){const r=this.previous(),n=this.factor();e=new Le(e,r,n)}return e}factor(){let e=this.expo();for(;this.match(A.SLASH,A.STAR);){const r=this.previous(),n=this.expo();e=new Le(e,r,n)}return e}expo(){let e=this.unary();for(;this.match(A.EXPONENT);){const r=this.previous(),n=this.unary();e=new Le(e,r,n)}return e}unary(){if(this.match(A.PLUS,A.MINUS)){const e=this.previous(),r=this.unary();return new on(e,r)}return this.postUnary()}postUnary(){let e=this.cellRange();if(this.match(A.PERCENT)){const r=this.previous();e=new an(r,e)}return e}cellRange(){let e=this.sheetRange();for(;this.match(A.COLON);){const r=this.previous(),n=this.sheetRange(),s=this.convertToCellExpression(n),c=this.convertToCellExpression(e);e=new hn(c,r,s)}return e}convertToCellExpression(e){if(e instanceof xe)return e;if(e instanceof it&&e.value.type===A.NUMBER)return new xe(e.value,void 0);throw new V("#NAME?")}sheetRange(){if(this.match(A.SHEET_NAME)){const e=this.previous();let r=this.call();if(r instanceof xe)return new xe(r.value,e);throw new V("#REF!")}return this.call()}call(){for(;this.match(A.EXCEL_FUNCTION,A.REF_FUNCTION,A.REF_FUNCTION_COND);){const e=this.previous(),r=[];if(!this.check(A.RIGHT_BRACKET))do{if(this.peek().type==A.RIGHT_BRACKET)break;r.push(this.expression())}while(this.match(A.COMMA));return this.expect(A.RIGHT_BRACKET),new cn(e,r)}return this.primary()}primary(){if(this.match(A.lEFT_BRACE)){const e=[];do{if(this.peek().type==A.RIGHT_BRACE)break;e.push(this.expression())}while(this.match(A.COMMA));return this.expect(A.RIGHT_BRACE),new un(e)}if(this.match(A.LEFT_BRACKET)){const e=this.expression();return this.expect(A.RIGHT_BRACKET),new ln(e)}if(this.match(A.NUMBER,A.STRING,A.BOOL))return new it(this.previous());if(this.match(A.CELL,A.COLUMN,A.ROW,A.DEFINED_NAME,A.R1C1)){const e=this.previous();return new xe(e,void 0)}throw this.match(A.ERROR,A.ERROR_REF)?new V(this.previous().value):new V("#VALUE!")}match(...e){const{type:r}=this.peek();return e.includes(r)?(this.next(),!0):!1}previous(){return this.tokens[this.current-1]}check(e){return this.peek().type===e}expect(e){if(this.check(e))return this.next(),this.previous();throw new V("#VALUE!")}next(){this.current++}isAtEnd(){return this.peek().type===A.EOF}peek(){return this.current<this.tokens.length?this.tokens[this.current]:new oe(A.EOF,"")}}class fn{constructor(e,r,n){x(this,"expressions");x(this,"cellDataMap");x(this,"currentCoord");this.expressions=e,this.cellDataMap=n,this.currentCoord=r}interpret(){let e=[];for(const r of this.expressions){const n=this.evaluate(r),s=this.getRangeCellValue(n);Array.isArray(s)?e=e.concat(s):e.push(s)}return e}visitBinaryExpression(e){let r=this.evaluate(e.left),n=this.evaluate(e.right);switch(r=this.getOneValue(r),n=this.getOneValue(n),[A.MINUS,A.PLUS,A.SLASH,A.STAR,A.EXPONENT].includes(e.operator.type)&&(r=this.parseNumber(r),n=this.parseNumber(n)),e.operator.type){case A.MINUS:return r-n;case A.PLUS:return r+n;case A.SLASH:{if(n===0)throw new V("#DIV/0!");return r/n}case A.STAR:return r*n;case A.EXPONENT:return Math.pow(r,n);case A.EQUAL:return r===n;case A.NOT_EQUAL:return r!==n;case A.GREATER:return r>n;case A.GREATER_EQUAL:return r>=n;case A.LESS:return r<n;case A.LESS_EQUAL:return r<=n;case A.CONCATENATE:return`${r}${n}`;default:throw new V("#TEXT")}}visitCallExpression(e){const r=this.cellDataMap.getFunction(e.name.value);if(r&&typeof r=="function"){let n=[];for(const s of e.params){const c=this.evaluate(s);if(c instanceof he){const d=this.getCellValue(c,!1);n=n.concat(d)}else n.push(c)}return r(...n)}throw new V("#NAME?")}visitCellExpression(e){let r="";if(e.sheetName){const s=this.cellDataMap.getSheetInfo("",e.sheetName.value);if(!(s!=null&&s.sheetId))throw new V("#REF!");r=s.sheetId}let n;if([A.DEFINED_NAME,A.CELL,A.COLUMN,A.R1C1].includes(e.value.type)&&(n=this.cellDataMap.getDefinedName(e.value.value)),n||(e.value.type===A.R1C1?n=nn(e.value.value,this.currentCoord):n=rn(e.value.value)),!n)throw new V("#REF!");return r&&(n.sheetId=r),n}visitLiteralExpression(e){const{type:r,value:n}=e.value;switch(r){case A.STRING:return n;case A.NUMBER:{const[s,c]=Xe(n);if(s)return c;throw new V("#VALUE!")}case A.BOOL:return n==="TRUE";default:throw new V("#VALUE!")}}visitUnaryExpression(e){const r=this.evaluate(e.right),n=this.parseNumber(this.getOneValue(r));switch(e.operator.type){case A.MINUS:return-n;case A.PLUS:return n;default:throw new V("#VALUE!")}}visitCellRangeExpression(e){switch(e.operator.type){case A.COLON:{const r=this.visitCellExpression(e.left),n=this.visitCellExpression(e.right),s=yt(r,n);if(!s)throw new V("#NAME?");return s}default:throw new V("#NAME?")}}visitGroupExpression(e){return this.evaluate(e.value)}visitArrayExpression(e){const r=[];for(const n of e.value)r.push(this.evaluate(n));return r}visitPostUnaryExpression(e){const r=this.evaluate(e.left),n=this.parseNumber(this.getOneValue(r));switch(e.operator.type){case A.PERCENT:return n*.01;default:throw new V("#VALUE!")}}evaluate(e){return e.accept(this)}getRangeCellValue(e){if(e instanceof he){if(e.colCount===e.rowCount&&e.colCount===1)return this.getCellValue(e,!0);throw new V("#REF!")}return e}getOneValue(e){const r=this.getRangeCellValue(e);return Array.isArray(r)?r[0]:r}parseNumber(e){const[r,n]=Xe(e);if(!r)throw new V("#VALUE!");return n}getCellValue(e,r){let n=[];if(r){const p=this.cellDataMap.getCell(e),E=this.cellDataMap.handleCell(p,{row:e.row,col:e.col});return n=n.concat(E),n}const{row:s,col:c,sheetId:d}=e,g=this.cellDataMap.getSheetInfo(d);if(!g||s>=g.rowCount||c>=g.colCount)throw new V("#REF!");return en(e,g.rowCount,g.colCount,(p,E)=>{const C=this.cellDataMap.getCell({row:p,col:E,rowCount:1,colCount:1,sheetId:d}),M=this.cellDataMap.handleCell(C,{row:p,col:E});return n=n.concat(M),!1}),n}}function En(t){const e=t||{};return[Object,Array].includes(e.constructor)&&!Object.entries(e).length}function Wt(t="normal",e="normal",r=ye,n=""){const s=`${t} ${e} ${r}px `,c=[Nr];return n&&c.unshift(n),s+c.join(",")}let ot;function We(t=typeof devicePixelRatio>"u"?void 0:devicePixelRatio){return typeof ot=="number"?ot:Math.max(Math.floor(t||1),1)}function $(t){return Math.floor(t*We())}function gn(t){ot=Math.max(Math.floor(t||1),1)}const Ie=class Ie{constructor(e){x(this,"namespace");x(this,"init",()=>(this.setColor(),this.log));x(this,"log",(...e)=>{if(!this.enable())return;const{namespace:r}=this,n=Ie.colorMap.get(r),s=[`%c ${r}:`,`color:${n};`,...e];console.log(...s)});x(this,"getRandomColor",()=>{const e=Math.floor(Math.random()*Lt.length);return Lt[e]});this.namespace=e}enable(){return window.localStorage.getItem("debug")==="*"}setColor(){Ie.colorMap.has(this.namespace)||Ie.colorMap.set(this.namespace,this.getRandomColor())}};x(Ie,"colorMap",new Map);let ze=Ie;new ze("model").init(),new ze("react").init();const Cn={smallFont:"10px",font:"12px",largeFont:"14px",padding:"12px",lineHeight:1.5,mediumPadding:"8px",largePadding:"20px",borderRadius:"4px",borderLargeRadius:"8px",tinyPadding:"4px",scrollBarContent:"30px",formulaBarHeight:"25px"},An={lowZIndex:2,middleZIndex:3,highZIndex:4,highestZIndex:9};function pn(t,e,r,n){e=e/100,r=r/100;const s=(1-Math.abs(2*r-1))*e,c=s*(1-Math.abs(t/60%2-1)),d=r-s/2;let g,p,E;if(t>=0&&t<60?(g=s,p=c,E=0):t>=60&&t<120?(g=c,p=s,E=0):t>=120&&t<180?(g=0,p=s,E=c):t>=180&&t<240?(g=0,p=c,E=s):t>=240&&t<300?(g=c,p=0,E=s):(g=s,p=0,E=c),n!==1)return`rgba(${g},${p},${E},${n})`;const C=k=>Math.round(k*255).toString(16).padStart(2,"0"),M=C(g+d),N=C(p+d),O=C(E+d);return`#${M}${N}${O}`}const mn=(t,e,r)=>{const n=t/255,s=e/255,c=r/255,d=Math.min(n,s,c),g=Math.max(n,s,c),p=g-d,E=wn(n,s,c),C=Sn(g,d),M=Rn(p,C);return[E,M*100,C*100]},wn=(t,e,r)=>{const n=Math.max(t,e,r),s=Math.min(t,e,r),c=n-s;let d=0;if(c==0)d=0;else switch(n){case t:{let E=(e-r)/c,C=0;E<0&&(C=360/60),d=E+C;break}case e:{let E=(r-t)/c,C=120/60;d=E+C;break}case r:let g=(t-e)/c,p=240/60;d=g+p;break}return d*60},Rn=(t,e)=>t==0?0:t/(1-Math.abs(2*e-1)),Sn=(t,e)=>(t+e)/2,zt=([t,e,r,n])=>{const[s,c,d]=mn(t,e,r);return pn(s,c*.9,100-d,n)};function Mn(t){t.startsWith("#")&&(t=t.slice(1));let e=parseInt(t.substring(0,2),16),r=parseInt(t.substring(2,4),16),n=parseInt(t.substring(4,6),16),s=parseInt(t.substring(6,8)||"ff",16);return[e,r,n,s/255]}const In=t=>{if(t.startsWith("rgb")){const r=t.replace("rgb","").replace("a","").replace("(","").replace(")","").split(",").map(Number);return r.length<=3&&r.push(1),zt(r)}else return zt(Mn(t))},Yt=Object.freeze({primaryColor:"#217346",buttonActiveColor:"#c6c6c6",selectionColor:"rgba(198,198,198,0.3)",backgroundColor:"#e6e6e6",hoverColor:"rgba(0, 0, 0, 0.04)",scrollbarColor:"rgba(0, 0, 0, 0.1)",scrollbarHoveColor:"rgba(0, 0, 0, 0.2)",dialogBackground:"rgba(0, 0, 0, 0.6)",white:"#ffffff",black:"#000000",triangleFillColor:"#dddddd",contentColor:"#333333",borderColor:"#cccccc",activeBorderColor:"#808080",errorFormulaColor:"#ff0000"}),Nn=Object.freeze(Object.fromEntries(Object.entries(Yt).map(([t,e])=>[t,In(e)]))),at={...Cn,...An},On="data-theme";function Tn(){if(typeof sessionStorage<"u"){const t=sessionStorage.getItem(On);if(t&&(t==="dark"||t==="light"))return t}return typeof matchMedia=="function"&&matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function Z(t,e){return e==="dark"||Tn()==="dark"?Nn[t]:Yt[t]}var bn={copy:"Copy",cut:"Cut",paste:"Paste",delete:"Delete",add:"Add",rows:"Rows",menu:"Menu",insert:"Insert",rename:"Rename",reset:"Reset",hide:"Hide",unhide:"Unhide",cancel:"Cancel","line-chart":"Line Chart","bar-chart":"Bar Chart","pie-chart":"Pie Chart","scatter-chart":"Scatter Chart","radar-chart":"Radar Chart","polar-area-chart":"PolarArea Chart",confirm:"Confirm","tab-color":"Tab Color","unhide-sheet":"Unhide sheet:","wrap-text":"Wrap Text","import-xlsx":"Import XLSX","export-xlsx":"Export XLSX","export-csv":"Export CSV","export-json":"Export JSON","import-csv":"Import CSV","floating-picture":"Floating Picture",chart:"Chart","chart-title":"Chart Title",duplicate:"Duplicate","select-data":"Select Data","change-chart-title":"Change Chart Title","change-chart-type":"Change Chart Type","save-as-picture":"Save as Picture","reset-size":"Reset Size","add-at-the-bottom":"Add at the bottom","row-height":"Row Height","column-width":"Column Width","greater-than-zero":"The value must be greater than or equal to 0","insert-columns":"Insert Columns","delete-columns":"Delete Columns","hide-columns":"Hide Columns","unhide-columns":"Unhide Columns","insert-rows":"Insert Rows","delete-rows":"Delete Rows","hide-rows":"Hide rows","unhide-rows":"Unhide rows","reference-is-empty":"The reference is empty","reference-is-not-valid":"The reference is not valid","the-value-cannot-be-empty":"The value cannot be empty","edit-data-source":"Edit Data Source","sheet-is-not-exist":"The sheet is not exist","sheet-id-is-duplicate":"The sheet id is duplicate","a-workbook-must-contains-at-least-one-visible-worksheet":"A workbook must contains at least one visible worksheet","sheet-name-is-duplicate":"The sheet name is duplicate","uuid-is-duplicate":"The uuid is duplicate","cells-must-contain-data":"The selected cells must contain the data","image-source-is-empty":"The image source is empty","merging-cell-is-duplicate":"The merging cell is duplicate","insert-column-left":"Insert Column Left","insert-column-right":"Insert Column Right","insert-row-above":"Insert Row Above","insert-row-below":"Insert Row Below","get-all-installed-fonts":"Get all the fonts installed locally","unsupported-chart-types":"Unsupported chart types","merge-cell":"Merge","merge-and-center":"Merge and Center","merge-cells":"Merge Cells","merge-content":"Merge Content",none:"none","single-underline":"single underline","double-underline":"double underline",general:"General",number:"Number",currency:"Currency",accounting:"Accounting","short-date":"Short Date","long-date":"Long Date",time:"Time",percentage:"Percentage",fraction:"Fraction",scientific:"Scientific",text:"Text","more-number-formats":"More Number Formats","short-date-format":"m/d/yyyy;@","long-date-format":"[$-409]dddd,mmmm d,yyyy;@","time-format":"h:mm:ss AM/PM","sheet-id-can-not-be-empty":"The sheetId can not be empty","no-border":"No Border","all-borders":"All Borders","outside-borders":"OutSide Borders","thick-box-border":"Thick Box Border","bottom-border":"Bottom Border","top-border":"Top Border","left-border":"Left Border","right-border":"Right Border","line-color":"Line Color","line-style":"Line Style",filter:"Filter","filter-empty":"(empty)","filter-all":"All"},Dn={copy:"复制",cut:"剪切",paste:"粘贴",delete:"删除",add:"添加",rows:"行",menu:"菜单",insert:"插入",rename:"重命名",reset:"重置",hide:"隐藏",unhide:"显示",cancel:"取消","line-chart":"折线图","bar-chart":"柱状图","pie-chart":"饼图","scatter-chart":"散点图","radar-chart":"雷达图","polar-area-chart":"极区图",confirm:"确认","tab-color":"选项卡颜色","unhide-sheet":"显示工作表:","wrap-text":"自动换行","import-xlsx":"导入 XLSX","export-xlsx":"导出 XLSX","export-csv":"导出 CSV","export-json":"导出 JSON","import-csv":"导入 CSV","floating-picture":"浮动图片",chart:"图表","chart-title":"图表标题",duplicate:"复制","select-data":"选择数据","change-chart-title":"更改图表标题","change-chart-type":"更改图表类型","save-as-picture":"保存为图片","reset-size":"重置大小","add-at-the-bottom":"在底部添加","row-height":"行高","column-width":"列宽","greater-than-zero":"值必须大于或等于 0","insert-columns":"插入列","delete-columns":"删除列","hide-columns":"隐藏列","unhide-columns":"取消隐藏列","insert-rows":"插入行","delete-rows":"删除行","hide-rows":"隐藏行","unhide-rows":"取消隐藏行","reference-is-empty":"引用为空","reference-is-not-valid":"引用无效","the-value-cannot-be-empty":"值不能为空","edit-data-source":"编辑数据源","sheet-id-is-duplicate":"工作表 ID 重复","a-workbook-must-contains-at-least-one-visible-worksheet":"工作簿必须至少包含一个可见工作表","sheet-name-is-duplicate":"工作表名称重复","uuid-is-duplicate":"UUID 重复","cells-must-contain-data":"所选单元格必须包含数据","image-source-is-empty":"图像源为空","merging-cell-is-duplicate":"合并单元格重复","insert-column-left":"向左插入列","insert-column-right":"向右插入列","insert-row-above":"在上面插入行","insert-row-below":"在下面插入行","get-all-installed-fonts":"获取本地安装的所有字体","unsupported-chart-types":"不支持的图表类型","merge-cell":"合并单元格","merge-and-center":"合并并且居中","merge-cells":"合并单元格","merge-content":"合并内容",none:"无","single-underline":"单层下划线","double-underline":"双层下划线",general:"常规",number:"数值",currency:"货币",accounting:"会计专用","short-date":"短日期","long-date":"长日期",time:"时间",percentage:"百分比",fraction:"分数",scientific:"科学计数",text:"文本","more-number-formats":"其他数字格式","short-date-format":"yyyy/m/d;@","long-date-format":'yyyy"年"m"月"d"日"',"time-format":"h:mm:ss","sheet-id-can-not-be-empty":"SheetId 不能为空","no-border":"无边框","all-borders":"全边框","outside-borders":"外边框","thick-box-border":"厚框边框","bottom-border":"底边框","top-border":"顶边框","left-border":"左边框","right-border":"右边框","line-color":"线条颜色","line-style":"线条样式",filter:"筛选","filter-empty":"(空)","filter-all":"全部","sheet-is-not-exist":"工作表不存在"};let Ln="language";const Kt=["en","zh"];function xn(){const t="en";if(typeof window>"u")return t;let e=t;const r=localStorage.getItem(Ln);if(r&&Kt.some(n=>n===r))e=r;else{const n=(navigator==null?void 0:navigator.language)||"",s=Kt.find(c=>n.includes(c));s&&(e=s)}return document.documentElement.setAttribute("lang",e),e}function j(t){return xn()==="en"?bn[t]:Dn[t]}j("line-chart"),j("bar-chart"),j("pie-chart"),j("scatter-chart"),j("radar-chart"),j("polar-area-chart");const _n=[{formatCode:Ve,id:0},{formatCode:"0",id:1},{formatCode:"0.00",id:2},{formatCode:"#,##0",id:3},{formatCode:"#,##0.00",id:4},{formatCode:'"$"#,##0.00_);[Red]("$"#,##0.00)',id:8},{formatCode:"0%",id:9},{formatCode:"0.00%",id:10},{formatCode:"0.00E+00",id:11},{formatCode:"# ?/?",id:12},{formatCode:"# ??/??",id:13},{formatCode:"mm-dd-yy",id:14},{formatCode:"d-mmm-yy",id:15},{formatCode:"d-mmm",id:16},{formatCode:"mmm-yy",id:17},{formatCode:"h:mm AM/PM",id:18},{formatCode:"h:mm:ss AM/PM",id:19},{formatCode:"h:mm",id:20},{formatCode:"h:mm:ss",id:21},{formatCode:"m/d/yy h:mm",id:22},{formatCode:'yyyy"年"m"月"',id:27},{formatCode:"#,##0 ;(#,##0)",id:37},{formatCode:"#,##0 ;[Red](#,##0)",id:38},{formatCode:"#,##0.00 ;(#,##0.00)",id:39},{formatCode:"#,##0.00 ;[Red](#,##0.00)",id:40},{formatCode:'_("$"* #,##0.00_);_("$"* (#,##0.00);_("$"* "-"??_);_(@_)',id:44},{formatCode:"mm:ss",id:45},{formatCode:"[h]:mm:ss",id:46},{formatCode:"mmss.0",id:47},{formatCode:"##0.0E+0",id:48},{formatCode:Tr,id:49},{formatCode:'上午/下午 h"时"mm"分"ss"秒"',id:56}],ge=t=>_n.find(e=>e.id===t).formatCode;ge(0),j("general"),ge(2),j("number"),ge(8),j("currency"),ge(44),j("accounting"),j("short-date-format"),j("short-date"),j("long-date-format"),j("long-date"),j("time-format"),j("time"),ge(10),j("percentage"),ge(12),j("fraction"),ge(11),j("scientific"),ge(49),j("text");function Qt(t,e={row:0,col:0},r=new vn,n=new Map){if(n.has(t)){const s=n.get(t);return s.result.length===0?{result:[0]}:s}try{r.handleCell=(E,C)=>E?E.formula?Qt(E.formula,C,r,n).result:[E.value]:[];const s={result:[],expressionStr:""};n.set(t,s);const c=new sn(t).scan(),d=new dn(c).parse(),g=new fn(d,e,r).interpret(),p=[];for(const E of d)p.push(E.toString());s.expressionStr=p.join("");for(const E of g)typeof E=="number"&&!isNaN(E)?s.result.push(Qr(E)):s.result.push(E);return s}catch(s){if(s instanceof V){const c={result:[s.value]};return n.set(t,c),c}throw s}}const ct="_test_";class vn{constructor(){x(this,"map",new Map);x(this,"definedNameMap",new Map);x(this,"currentSheetId",ct);x(this,"sheetList",[{sheetId:ct,name:"_test_",rowCount:200,colCount:30,isHide:!1,sort:1}]);x(this,"getFunction",e=>Ht[e]);x(this,"handleCell",(e,r)=>e?[e.value]:[])}getKey(e,r,n){return`${e}_${r}_${n||ct}`}setSheetList(e){this.sheetList=e}set(e,r){const{row:n,col:s,sheetId:c}=e;for(let d=0;d<r.length;d++)for(let g=0;g<r[d].length;g++){const p=this.getKey(n+d,s+g,c),E=r[d][g];typeof E=="string"&&Fr(E)?this.map.set(p,{formula:E,value:""}):this.map.set(p,{value:E})}}getCell(e){const{row:r,col:n,sheetId:s}=e,c=this.getKey(r,n,s);return this.map.get(c)}getSheetInfo(e,r){if(r)return this.sheetList.find(s=>s.name===r);const n=e||this.currentSheetId;return this.sheetList.find(s=>s.sheetId===n)}setDefinedName(e,r){const n=he.makeRange(r);this.definedNameMap.set(e,n)}getDefinedName(e){return this.definedNameMap.get(e)}}function Fn(t,e){const{currentSheetId:r,worksheets:n,workbook:s,definedNames:c}=t,d=new Map,g=n[r]||{},p={list:[]},E={handleCell:()=>[],getFunction:C=>Ht[C],getCell:C=>{const{row:M,col:N,sheetId:O}=C,G=n[O||r]||{},H=xt(M,N);return G[H]},set:()=>{throw new V("#REF!")},getSheetInfo:(C,M)=>{if(M)return s.find(O=>O.name===M);const N=C||r;return s.find(O=>O.sheetId===N)},setDefinedName:()=>{throw new V("#REF!")},getDefinedName:C=>{const M=c[C];return M&&he.makeRange(M)}};for(const[C,M]of Object.entries(g)){if(!(M!=null&&M.formula))continue;const N=Qt(M==null?void 0:M.formula,vr(C),E,d);if(!N)continue;const O=N.result[0];O!==M.value&&p.list.push({key:C,newValue:O,sheetId:r})}e(p)}function jt(t){return t?typeof Intl>"u"||typeof Intl.Segmenter!="function"?[...t]:[...new Intl.Segmenter([],{granularity:"word"}).segment(t)].map(n=>n.segment):[]}const ht=new Map;function Un(t,e){const r=`${e}__${t.font}`;if(ht.has(r))return ht.get(r);const n=t.measureText(e),{actualBoundingBoxAscent:s,actualBoundingBoxDescent:c}=n,d=s+c,g=n.width,p=Math.ceil(g/We()),E=Math.ceil(d/We()),C={width:p,height:E};return ht.set(r,C),C}function ie(t,e,r,n,s){t.fillRect($(e),$(r),$(n),$(s))}function lt(t,e,r,n,s){t.strokeRect($(e),$(r),$(n),$(s))}function Zt(t,e,r,n,s){t.clearRect($(e),$(r),$(n),$(s))}function ut(t,e,r,n){t.fillText(e,$(r),$(n))}function Ce(t,e){if(e.length!==0){t.beginPath();for(let r=0;r<e.length;r+=2){const n=e[r],s=e[r+1];t.moveTo($(n[0]),$(n[1])),t.lineTo($(s[0]),$(s[1]))}t.stroke()}}function Jt(t,e,r,n){t.beginPath(),t.moveTo($(e[0]),$(e[1])),t.lineTo($(r[0]),$(r[1])),t.lineTo($(n[0]),$(n[1])),t.fill()}function qt(t,e,r){const n=t.slice(),[s,c]=t,d=F*2,g=r?d:0;return e==="bottom"?n.push([s[0]+g,s[1]-d],[c[0]-g,c[1]-d]):e==="top"?n.push([s[0]+g,s[1]+d],[c[0]-g,c[1]+d]):e==="left"?n.push([s[0]+d,s[1]+g],[c[0]+d,c[1]-g]):e==="right"&&n.push([s[0]-d,s[1]+g],[c[0]-d,c[1]-g]),n}function kn(t,e,r){return r?e?t.split(et):jt(t.replaceAll(et,"")):jt(t)}function Pn(t,e,r,n,s){t.setLineDash([$(8),$(6)]);const c=F;lt(t,e+c,r+c,n-c*2,s-c*2),t.setLineDash([])}function $n(t){let e=[];return t==="hair"?e=[F,F]:t==="dotted"||t==="mediumDashed"?e=[F*2,F*2]:t==="dashed"?e=[F*4,F*4]:t==="dashDot"||t==="mediumDashDot"?e=[F*4,F*4,F*8,F*4]:(t==="dashDotDot"||t==="mediumDashDotDot")&&(e=[F*4,F*4,F*8,F*4,F*4,F*4]),e}function Ye(t,e,r,n,s){if(!r)return;const{top:c,left:d,width:g,height:p}=e;let E=[];n==="top"?E=[[d,c],[d+g,c]]:n==="bottom"?E=[[d,c+p],[d+g,c+p]]:n==="left"?E=[[d,c],[d,c+p]]:n==="right"&&(E=[[d+g,c],[d+g,c+p]]);const{type:C,color:M}=r;t.lineWidth=Dt[C],t.strokeStyle=M||Z("black",s);const N=$n(C);C==="double"&&(E=qt(E,n,!0)),N.length>0&&t.setLineDash(N.map(O=>$(O))),Ce(t,E),N.length>0&&t.setLineDash([])}function Bn(t,e,r,n,s,c){const d={height:0,width:0};if(r===""&&En(n))return d;const g=(n==null?void 0:n.numberFormat)||Ve,p=g===Ve&&typeof r=="number",E=Ut(r,g),C=n!=null&&n.fontSize?n.fontSize:ye,M=Wt(n!=null&&n.isItalic?"italic":"normal",n!=null&&n.isBold?"bold":"500",$(C),n==null?void 0:n.fontFamily);n!=null&&n.fillColor&&(t.fillStyle=n==null?void 0:n.fillColor,ie(t,e.left,e.top,e.width,e.height));let N=(n==null?void 0:n.fontColor)||Z("contentColor",c);bt.has(E)&&(N=Z("errorFormulaColor",c)),t.font=M,t.fillStyle=N;const O=n?{...n}:{};let k=O==null?void 0:O.horizontalAlign;(O==null?void 0:O.horizontalAlign)===void 0&&p&&(k=Ge.RIGHT),O.horizontalAlign=k;const X=(!(O!=null&&O.isWrapText)&&Br(g)?[E]:kn(E,n==null?void 0:n.isWrapText,s)).map(le=>{const ne=Un(t,le);return{str:le,width:ne.width,height:ne.height===0?C:ne.height}}),{width:z,height:D,resultList:te}=Hn(X,e,O,Ur(!!s,E));if(z>0&&D>0){const le=Math.ceil(C*(at.lineHeight-1)/2);let ne=[];for(const Y of te){if(ut(t,Y.text,Y.x,Y.y),O!=null&&O.underline){t.strokeStyle=N;const Ae=Y.y+Y.height+le/2,Ke=[[Y.x,Ae],[Y.x+Y.width,Ae]];(O==null?void 0:O.underline)===wt.DOUBLE?ne=ne.concat(qt(Ke,"bottom",!1)):ne=ne.concat(Ke)}if(O!=null&&O.isStrike){t.strokeStyle=N;const Ae=Y.y+Y.height/2+le/2;ne=ne.concat([[Y.x,Ae],[Y.x+Y.width,Ae]])}}Ce(t,ne)}return d.height=Math.ceil(D),d.width=Math.ceil(z),d}function Hn(t,e,r,n){const s=r!=null&&r.fontSize?r.fontSize:ye,c=Math.ceil(s*(at.lineHeight-1)/2),d=(r==null?void 0:r.verticalAlign)??He.MIDDLE,{left:g,top:p,height:E}=e,C=Math.max(e.width,...t.map(k=>k.width)),M=[];let N=0,O=0;if(r!=null&&r.isWrapText&&n){let k=0;for(let G=0;G<t.length;G++){const H=t[G];N=Math.max(N,H.width);const X=H.height+c*2;O+=X,M.push({text:H.str,x:0,y:k,width:H.width,height:H.height}),k+=X}}else if(r!=null&&r.isWrapText){let k=0;for(let G=0;G<t.length;){let H=C,X="",z=0,D=0;for(;G<t.length;){const te=t[G];if(H>=te.width)z+=te.width,D=Math.max(D,te.height),H-=te.width,X+=te.str,G++;else break}if(X){N=Math.max(N,z);const te=D+c*2;O+=te,M.push({text:X,x:0,y:k,width:z,height:D}),k+=te}}}else{let k="",G=C;for(let H=0;H<t.length;H++){const X=t[H];if(G>=X.width)N+=X.width,O=Math.max(O,X.height),k+=X.str,G-=X.width;else break}M.push({text:k,x:0,y:0,width:N,height:O})}if(O=Math.max(O,s*at.lineHeight),N+=c,O+=c,N<=C&&O<=E){let k=g+c,G=p+(E-O)/2+c;d===He.TOP?G=p+c:d===He.BOTTOM&&(G=p+(E-O)+c),(r==null?void 0:r.horizontalAlign)===Ge.CENTER?k=g+(C-N)/2:(r==null?void 0:r.horizontalAlign)===Ge.RIGHT&&(k=g+(C-N)-c);for(const H of M)H.x=H.x+k,H.y=H.y+G}return{width:N,height:O,resultList:M}}function er(t){return{textAlign:"center",textBaseline:"middle",font:Wt(void 0,"500",$(ye)),fillStyle:Z("black",t),lineWidth:F,strokeStyle:Z("borderColor",t)}}const tr=Math.max(...Object.values(Dt));class Gn{constructor(e){x(this,"canvas");x(this,"ctx");x(this,"width",0);x(this,"height",0);x(this,"isRendering",!1);x(this,"rowMap",{});x(this,"colMap",{});x(this,"eventData",{theme:"light",sheetData:{},canvasSize:{top:0,left:0,width:0,height:0},headerSize:{width:0,height:0},currentSheetInfo:{isHide:!1,rowCount:0,colCount:0,name:"",sheetId:"",tabColor:"",sort:1},scroll:{left:0,top:0,row:0,col:0,scrollLeft:0,scrollTop:0},range:{row:0,col:0,rowCount:1,colCount:1,sheetId:""},copyRange:void 0,customHeight:{},customWidth:{},currentMergeCells:[],autoFilter:void 0});this.canvas=e,this.ctx=e.getContext("2d");const r=We();this.ctx.scale(r,r)}render(e){if(e.changeSet.size===0||this.isRendering)return;this.isRendering=!0,this.eventData=e,this.clear();const{ctx:r}=this;r.strokeStyle=Z("primaryColor",e.theme),r.fillStyle=Z("white",e.theme),r.lineWidth=F*2;const{width:n,height:s}=this.eventData.canvasSize,c=this.eventData.headerSize,{endRow:d,contentHeight:g}=this.renderRowsHeader(s),{endCol:p,contentWidth:E}=this.renderColsHeader(n);this.renderGrid(n-c.width,s-c.height),this.renderTriangle(),this.renderMergeCell(),this.ctx.fillStyle=Z("selectionColor",this.eventData.theme);const C=this.renderSelection({endRow:d,endCol:p,contentHeight:g,contentWidth:E});return this.renderAntLine(C),this.renderContent({endRow:d,endCol:p,contentHeight:g,contentWidth:E}),this.ctx.lineWidth=tr,lt(this.ctx,C.left,C.top,C.width,C.height),this.isRendering=!1,{rowMap:{...this.rowMap},colMap:{...this.colMap}}}resize(e){this.width=e.width,this.height=e.height,this.canvas.width=$(e.width),this.canvas.height=$(e.height)}clear(){Zt(this.ctx,0,0,this.width,this.height)}renderRowsHeader(e){const{row:r}=this.eventData.scroll,n=this.eventData.headerSize,{rowCount:s}=this.eventData.currentSheetInfo;this.ctx.save();const c=this.eventData.range;ie(this.ctx,0,n.height,n.width,e),Object.assign(this.ctx,er(this.eventData.theme));const d=[];let g=n.height,p=r;for(;p<s&&g<e;p++){const C=this.getRowHeight(p);let M=g;if(p===r&&(M+=F/2),d.push([0,M],[n.width,M]),C>0){const N=this.isHighlightRow(c,p);this.ctx.fillStyle=N?Z("primaryColor",this.eventData.theme):Z("black",this.eventData.theme),ut(this.ctx,String(p+1),n.width/2,M+C/2)}g+=C}d.push([0,g],[n.width,g]),d.push([0,0],[0,g]),Ce(this.ctx,d),this.ctx.restore();const E=p>=s?g:e;return{endRow:p,contentHeight:Math.floor(E)}}renderColsHeader(e){const{col:r,row:n}=this.eventData.scroll,s=this.eventData.headerSize,{colCount:c}=this.eventData.currentSheetInfo,d=this.eventData.range,g=[];this.ctx.save(),ie(this.ctx,s.width,0,e,s.height),Object.assign(this.ctx,er());let p=s.width,E=r;const C=this.eventData.autoFilter;let M=0;for(let O=n;O<this.eventData.currentSheetInfo.rowCount&&(M=this.getRowHeight(n),M===0);O++);for(;E<c&&p<=e;E++){const O=this.getColWidth(E);let k=p;if(E===r&&(k+=F/2),g.push([k,0],[k,s.height]),O>0){const G=this.isHighlightCol(d,E);this.ctx.fillStyle=G?Z("primaryColor",this.eventData.theme):Z("black",this.eventData.theme),ut(this.ctx,Zr(E),k+O/2,s.height/2)}C&&E>=C.range.col&&E<C.range.col+C.range.colCount&&this.renderFilter(p+O,s.height+M,C.col===E),p+=O}g.push([p,0],[p,s.height]),g.push([0,0],[p,0]),Ce(this.ctx,g),this.ctx.restore();const N=E>=c?p:e;return{endCol:E,contentWidth:Math.floor(N)}}renderFilter(e,r,n){const s=Or,c=F*4,d=e-s-c,g=r-s-c;this.ctx.fillStyle=n?Z("primaryColor",this.eventData.theme):Z("borderColor",this.eventData.theme),this.ctx.strokeStyle=n?Z("primaryColor",this.eventData.theme):Z("borderColor",this.eventData.theme),lt(this.ctx,d,g,s,s),Jt(this.ctx,[d+s/4,g+s*3/8],[d+s*3/4,g+s*3/8],[d+s/2,g+s*5/8])}renderGrid(e,r){const n=this.eventData.headerSize,{row:s,col:c}=this.eventData.scroll,{rowCount:d,colCount:g}=this.eventData.currentSheetInfo;this.ctx.save(),this.ctx.lineWidth=F,this.ctx.strokeStyle=Z("borderColor",this.eventData.theme),this.ctx.translate($(n.width),$(n.height));const p=[];let E=0,C=0;for(let M=s;M<d&&E<=r;M++){for(;M<d&&this.getRowHeight(M)===0;)M++;p.push([0,E],[e,E]);const N=this.getRowHeight(M);E+=N}for(let M=c;M<g&&C<=e;M++){for(;M<g&&this.getColWidth(M)===0;)M++;p.push([C,0],[C,E]);const N=this.getColWidth(M);C+=N}p.push([0,E],[C,E]),p.push([C,0],[C,E]),Ce(this.ctx,p),this.ctx.restore()}renderTriangle(){const e=this.eventData.headerSize;this.ctx.save(),ie(this.ctx,0,0,e.width,e.height),this.ctx.fillStyle=Z("triangleFillColor",this.eventData.theme);const r=2,n=Math.floor(r),s=Math.floor(e.height-r),c=Math.floor(e.width*.4),d=Math.floor(e.width-r);Jt(this.ctx,[d,n],[c,s],[d,s]),this.ctx.restore()}getRowHeight(e){const r=_t(this.eventData.currentSheetInfo.sheetId,e),n=this.eventData.customHeight[r];return n?n.isHide?Mt:n.len:Rt}getColWidth(e){const r=_t(this.eventData.currentSheetInfo.sheetId,e),n=this.eventData.customWidth[r];return n?n.isHide?Mt:n.len:St}isHighlightRow(e,r){return!!(Te(e)||De(e)||r>=e.row&&r<e.row+e.rowCount)}isHighlightCol(e,r){return!!(Te(e)||be(e)||r>=e.col&&r<e.col+e.colCount)}renderAntLine(e){const r=this.eventData.copyRange;!r||r.sheetId!==this.eventData.currentSheetInfo.sheetId||(this.ctx.lineWidth=tr,this.ctx.strokeStyle=Z("primaryColor",this.eventData.theme),Pn(this.ctx,e.left,e.top,e.width,e.height))}renderMergeCell(){const e=this.eventData.currentMergeCells;if(e.length===0)return;const r=this.eventData.range;for(const n of e)r.row===n.row&&r.col===n.col||this.clearRect(n)}getCellSize(e){let{row:r,col:n,colCount:s,rowCount:c}=e,d=r,g=n,p=r+c,E=n+s;const C=this.eventData.currentSheetInfo;Te(e)?(g=0,E=C.colCount,d=0,p=C.rowCount):De(e)?(d=0,p=C.rowCount):be(e)&&(g=0,E=C.colCount);let M=0,N=0;for(;d<p;d++)N+=this.getRowHeight(d);for(;g<E;g++)M+=this.getColWidth(g);return{width:M,height:N}}computeCellPosition(e){const{row:r,col:n}=e,s=this.eventData.headerSize,c=this.eventData.scroll;let d=s.width,g=s.height,p=c.row,E=c.col;if(n>=c.col)for(;E<n;)d+=this.getColWidth(E),E++;else for(d=-s.width;E>n;)d-=this.getColWidth(E),E--;if(r>=c.row)for(;p<r;)g+=this.getRowHeight(p),p++;else for(g=-s.height;p>r;)g-=this.getRowHeight(p),p--;return{top:g,left:d}}getActiveRange(e){const r=e||this.eventData.range,n=this.eventData.currentMergeCells;for(const s of n)if(qr(r,s))return{range:{...s,sheetId:s.sheetId},isMerged:!0};return{range:r,isMerged:!1}}clearRect(e){const r=this.getCellSize(e);if(r.width<=0||r.height<=0)return;const n=this.computeCellPosition(e),s=F;Zt(this.ctx,n.left+s,n.top+s,r.width-s*2,r.height-s*2)}renderContent(e){const{endCol:r,endRow:n,contentHeight:s,contentWidth:c}=e,{ctx:d}=this;d.textAlign="left",d.textBaseline="top",d.lineWidth=F*2;const g=this.eventData.headerSize,{row:p,col:E}=this.eventData.scroll,C=Math.floor(c-g.width),M=Math.floor(s-g.height);d.save(),this.rowMap={},this.colMap={};const N=this.eventData.currentMergeCells;for(let O=p;O<n;O++)for(let k=E;k<r;k++){const G=N.find(H=>H.row===O&&H.col===k);this.renderCell(O,k,G,C,M)}d.restore()}renderCell(e,r,n,s,c){var X,z,D,te;const{ctx:d}=this,g={row:e,col:r,rowCount:1,colCount:1,sheetId:""},p=xt(e,r),E=this.eventData.sheetData[p];if(!E)return;const C=this.getCellSize(n||g);if(C.width<=0||C.height<=0)return;const M=this.computeCellPosition(g);d.lineWidth=F*2;const N=this.eventData.theme,O=Bn(d,{top:M.top,left:M.left,width:Math.min(C.width,s),height:Math.min(C.height,c)},E.value,E.style,!!n,N),k=Math.max(this.rowMap[e]??0,O.height),G=Math.max(this.colMap[r]??0,O.width);k>=Rt&&(this.rowMap[e]=k),G>=St&&(this.colMap[r]=G);const H={top:M.top,left:M.left,height:Math.max(k,C.height),width:Math.max(G,C.width)};Ye(d,H,(X=E.style)==null?void 0:X.borderTop,"top",N),Ye(d,H,(z=E.style)==null?void 0:z.borderBottom,"bottom",N),Ye(d,H,(D=E.style)==null?void 0:D.borderLeft,"left",N),Ye(d,H,(te=E.style)==null?void 0:te.borderRight,"right",N)}renderSelection(e){const r=this.eventData.range;return Te(r)?this.renderSelectAll(e):De(r)?this.renderSelectCol(e):be(r)?this.renderSelectRow(e):this.renderSelectRange()}renderSelectRange(){const e=this.eventData.headerSize,r=this.eventData.range,n=this.computeCellPosition({row:r.row,col:r.col,rowCount:1,colCount:1,sheetId:""}),s=r.row+r.rowCount-1,c=r.col+r.colCount-1,d={row:s,col:c,rowCount:1,colCount:1,sheetId:""},g=this.computeCellPosition(d),p=this.getCellSize(d),E=g.left+p.width-n.left,C=g.top+p.height-n.top;ie(this.ctx,n.left,0,E,e.height),ie(this.ctx,0,n.top,e.width,C);const M=r.rowCount>1||r.colCount>1;M&&ie(this.ctx,n.left,n.top,E,C);const N=[[n.left,e.height],[n.left+E,e.height]];return N.push([e.width,n.top],[e.width,n.top+C]),Ce(this.ctx,N),M&&this.renderActiveCell(),{left:n.left,top:n.top,width:E,height:C}}renderSelectAll(e){const{contentHeight:r,contentWidth:n}=e,s=this.eventData.headerSize;ie(this.ctx,0,0,n,r),this.renderActiveCell();const c=n-s.width,d=r-s.height;return{left:s.width,top:s.height,width:c,height:d}}renderSelectCol({contentHeight:e}){const r=this.eventData.headerSize,n=this.eventData.range,s=this.computeCellPosition(n);let c=0;for(let p=n.col,E=n.col+n.colCount;p<E;p++)c+=this.getColWidth(p);const d=e-r.height;ie(this.ctx,s.left,0,c,e),ie(this.ctx,0,s.top,r.width,d);const g=[[r.width,r.height],[r.width,e]];return Ce(this.ctx,g),this.renderActiveCell(),{left:s.left,top:r.height,width:c,height:d}}renderSelectRow({contentWidth:e}){const r=this.eventData.headerSize,n=this.eventData.range,s=this.computeCellPosition(n);let c=0;for(let p=n.row,E=n.row+n.rowCount;p<E;p++)c+=this.getRowHeight(p);const d=e-r.width-F;ie(this.ctx,s.left,0,d,r.height),ie(this.ctx,0,s.top,e,c);const g=[[s.left,r.height],[e,r.height]];return Ce(this.ctx,g),this.renderActiveCell(),{left:r.width,top:s.top,width:d,height:c}}renderActiveCell(){const e=this.eventData.range,r=this.getActiveRange({row:e.row,col:e.col,rowCount:1,colCount:1,sheetId:e.sheetId}).range;this.clearRect(r)}}let we=null;Je({init(t){we=new Gn(t.canvas),gn(t.dpr)},resize(t){we==null||we.resize(t)},async render(t,e){const r=we==null?void 0:we.render(t);r&&await e(r)},computeFormulas:Fn})})();
//# sourceMappingURL=worker-CTMg-bux.js.map
