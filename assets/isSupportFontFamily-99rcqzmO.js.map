{"version":3,"file":"isSupportFontFamily-99rcqzmO.js","sources":["../../src/util/font.ts","../../src/containers/store/fontFamily.ts","../../src/containers/canvas/isSupportFontFamily.ts"],"sourcesContent":["/**\n * query all installed fonts\n * window.queryLocalFonts()\n */\nexport const QUERY_ALL_LOCAL_FONT = 'QUERY_ALL_LOCAL_FONT';\nexport const LOCAL_FONT_KEY = 'LOCAL_FONT_KEY';\nexport const FONT_FAMILY_LIST = [\n  'PingFang SC',\n  'Microsoft Yahei',\n  'SimSun',\n  'Times New Roman',\n  'Source Code Pro',\n  '等线',\n  '方正舒体',\n  '仿宋',\n  '黑体',\n  '楷体',\n  '隶书',\n  '宋体',\n  '微软雅黑',\n  '新宋体',\n  'Arial',\n  'Calibri',\n];\n","import type { OptionItem } from '@/types';\nimport { BaseStore } from './base';\n\nexport const fontFamilyStore = new BaseStore<OptionItem[]>([]);\n","import {\n  MUST_FONT_FAMILY,\n  FONT_FAMILY_LIST,\n  LOCAL_FONT_KEY,\n  QUERY_ALL_LOCAL_FONT,\n} from '@/util';\nimport { OptionItem } from '@/types';\nimport { $ } from '@/i18n';\n\nfunction createElement(font: string) {\n  const s = document.createElement('span');\n  s.style.fontSize = '72px';\n  s.innerHTML = 'mmmmmmmmmmlli';\n  s.style.fontFamily = font;\n  document.body.appendChild(s);\n  const { offsetWidth, offsetHeight } = s;\n  document.body.removeChild(s);\n  return {\n    offsetHeight,\n    offsetWidth,\n  };\n}\n\nfunction SupportFontFamilyFactory() {\n  const baseFonts = [MUST_FONT_FAMILY, 'serif'];\n  const defaultWidth: Record<string, number> = {};\n  const defaultHeight: Record<string, number> = {};\n  for (const item of baseFonts) {\n    const { offsetWidth, offsetHeight } = createElement(item);\n    defaultWidth[item] = offsetWidth;\n    defaultHeight[item] = offsetHeight;\n  }\n\n  function detect(font: string): boolean {\n    for (const item of baseFonts) {\n      const { offsetWidth, offsetHeight } = createElement(font + ',' + item);\n      if (\n        offsetWidth !== defaultWidth[item] ||\n        offsetHeight !== defaultHeight[item]\n      ) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  return detect;\n}\n\nconst isSupportFontFamily = SupportFontFamilyFactory();\nexport { isSupportFontFamily };\n\nexport function initFontFamilyList(\n  check = isSupportFontFamily,\n  fontList = FONT_FAMILY_LIST,\n): OptionItem[] {\n  const cacheFont = localStorage.getItem(LOCAL_FONT_KEY);\n  if (cacheFont) {\n    const list = JSON.parse(cacheFont) as string[];\n    if (list.length > 0) {\n      return list.map((v) => ({ value: v, label: v, disabled: false }));\n    }\n  }\n  const list: OptionItem[] = [];\n  for (const item of fontList) {\n    if (check(item)) {\n      list.push({\n        label: item,\n        value: item,\n        disabled: false,\n      });\n    }\n  }\n\n  if (typeof window.queryLocalFonts === 'function') {\n    list.push({\n      value: QUERY_ALL_LOCAL_FONT,\n      label: $('get-all-installed-fonts'),\n      disabled: false,\n    });\n  }\n  return list;\n}\n"],"names":["QUERY_ALL_LOCAL_FONT","LOCAL_FONT_KEY","FONT_FAMILY_LIST","fontFamilyStore","BaseStore","createElement","font","s","offsetWidth","offsetHeight","SupportFontFamilyFactory","baseFonts","MUST_FONT_FAMILY","defaultWidth","defaultHeight","item","detect","isSupportFontFamily","initFontFamilyList","check","fontList","cacheFont","list","v","$"],"mappings":"wFAIO,MAAMA,EAAuB,uBACvBC,EAAiB,iBACjBC,EAAmB,CAC9B,cACA,kBACA,SACA,kBACA,kBACA,KACA,OACA,KACA,KACA,KACA,KACA,KACA,OACA,MACA,QACA,SACF,ECpBaC,EAAkB,IAAIC,EAAwB,CAAE,CAAA,ECM7D,SAASC,EAAcC,EAAc,CAC7B,MAAAC,EAAI,SAAS,cAAc,MAAM,EACvCA,EAAE,MAAM,SAAW,OACnBA,EAAE,UAAY,gBACdA,EAAE,MAAM,WAAaD,EACZ,SAAA,KAAK,YAAYC,CAAC,EACrB,KAAA,CAAE,YAAAC,EAAa,aAAAC,CAAA,EAAiBF,EAC7B,gBAAA,KAAK,YAAYA,CAAC,EACpB,CACL,aAAAE,EACA,YAAAD,CACF,CACF,CAEA,SAASE,GAA2B,CAC5B,MAAAC,EAAY,CAACC,EAAkB,OAAO,EACtCC,EAAuC,CAAC,EACxCC,EAAwC,CAAC,EAC/C,UAAWC,KAAQJ,EAAW,CAC5B,KAAM,CAAE,YAAAH,EAAa,aAAAC,GAAiBJ,EAAcU,CAAI,EACxDF,EAAaE,CAAI,EAAIP,EACrBM,EAAcC,CAAI,EAAIN,CAAA,CAGxB,SAASO,EAAOV,EAAuB,CACrC,UAAWS,KAAQJ,EAAW,CAC5B,KAAM,CAAE,YAAAH,EAAa,aAAAC,GAAiBJ,EAAcC,EAAO,IAAMS,CAAI,EACrE,GACEP,IAAgBK,EAAaE,CAAI,GACjCN,IAAiBK,EAAcC,CAAI,EAE5B,MAAA,EACT,CAEK,MAAA,EAAA,CAGF,OAAAC,CACT,CAEA,MAAMC,EAAsBP,EAAyB,EAG9C,SAASQ,EACdC,EAAQF,EACRG,EAAWlB,EACG,CACR,MAAAmB,EAAY,aAAa,QAAQpB,CAAc,EACrD,GAAIoB,EAAW,CACPC,MAAAA,EAAO,KAAK,MAAMD,CAAS,EAC7BC,GAAAA,EAAK,OAAS,EACTA,OAAAA,EAAK,IAAKC,IAAO,CAAE,MAAOA,EAAG,MAAOA,EAAG,SAAU,EAAQ,EAAA,CAClE,CAEF,MAAMD,EAAqB,CAAC,EAC5B,UAAWP,KAAQK,EACbD,EAAMJ,CAAI,GACZO,EAAK,KAAK,CACR,MAAOP,EACP,MAAOA,EACP,SAAU,EAAA,CACX,EAID,OAAA,OAAO,OAAO,iBAAoB,YACpCO,EAAK,KAAK,CACR,MAAOtB,EACP,MAAOwB,EAAE,yBAAyB,EAClC,SAAU,EAAA,CACX,EAEIF,CACT"}