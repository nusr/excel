/* 
MIT License

Copyright (c) 2020 Steve Xu

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.

*/
import{a as q,d as Ie}from"./chunk-EOHQJDWP.js";import{d as ke}from"./chunk-PRJU7QU5.js";import{p as I}from"./chunk-DP2NF2EL.js";import{$ as me,A as Y,B as g,C as le,Ca as we,D as S,Da as pe,E as R,F as Q,G as he,H as V,Ha as Ce,I as de,K as ue,Qa as p,Ra as z,Ua as Z,V as E,aa as ge,b as M,ca as b,f as G,fa as ce,ha as W,i as re,ja as fe,l as se,n as ie,r as ne,v as w,w as X,x as O,z as ae}from"./chunk-JN5Q2OC2.js";var ye="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAB9AMgDASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD5UooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigBadFG80ipEjO7HAVRkmvU/AuiaTqPhW2aeFZ3Exkk3ZGHHAB9sY46c12FvZWdhGTbW9vbIBljGioPxoA8ZTwxew2M13qUT2sCLkbiN2e3HX8OKwpQochN23tu6mu28deI4X1AwaUVdkzuut2/BPaPsv1XrXDsxZizElicknvQAlFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFdT4F8NNrd951ypGnwnLnpvP90f1oAr6d4dN14ZvNXklkjWA4VPL4kHHIOfU/pWDHG8rhIkZ3PAVRkmvetY0hNQ01NPVvIs8gOkYwSo6KPTnH5Vj313o/gyCKG0si11MMRxxrl5O3LH3/wD1UAZ/w5h1uxgFrc6eIrFnMhllO11yOm3qeg9K0PGXh7UfEFzDHDdxW9jGhJUliWfPcDjHTv610WnvcyWMT3kaQ3LLlkU5CH0z3p1jFNDbhbm4NzLklnKBR9AB0H50AeK+IPCmo6FAJ7vyXgLBfMjfIye2Dg9vSsCvX/GVlq+tW/2WC3EdmHDHaQXbGeuSBjvjnpXHS+B7+K5jhZLht+cOkSsvAzyd3H40AcjVi0srm7dVtYJZSzbRtUnn0robbw1HLIYZXu4JlUMQ0WTg/wCyOf8ACut+Gd7Dbx3mjSOouYJ2Ze29ehx7jH60AeY3tnc2MxhvIJIJRztkUg49ar17Z4un0F4fs+sNC0yjKLuHmJnuM15JqUOnRzsLK6nlTPG6ED9c/wBKAM6ilPtSUAFFFFABRRRQAUUUUAFFFFABRRRQAVreFLS3vvEVjbXg3QSPhhuxng4GfrismrFhcvZX1vdRYLwyLIoPcg5oA9u1DQtCEKTXllapFbktkjaoz646/Q1qMYLO1zhIYI16KMBR7AVwVj4mn8W6la6dHYiG3WVZ5yZN2UQg46Dvitjxj4ntdHura0ubYXUcqlpkB5UcY475549qAK93rOqeIoJLbw/ZyW8D5U3lwdnGedv+fwrrPsscn2d7mOKa4hHyyMgyDjkj0zWfoGt6VqcSxaXKg2JnyQu0oOnSrWr6paaTame9mWNedoJ5Y+gHegCxcTrAoLK7EnACKTk/0/GsK61zVk3G28O3Mi9i86KfyGa02hNza/aLOYpPLGrJI4LL04+UnpWDr2s/8IlpVujA3V9cbjuJwpYYycdhzwBQBm6j4n8UW1u876LDbwrwWkyxH6iuZl8e68/CzxRnP8MK/wBc13mnw3fibw/jWoI4VmAePb1I55x27Y/yK53wf4JtruJrzUZGkjEpEKRthXVSRk8Zwce3FAGTdeLfEAhjjuZoR567kZo1UgEkBge3Q8/jVvT/AA7pqxnUte12Es/7wrbSgtk988k8+gqr48s5rvxr9jtowWdI44UHAxtH5DrXbeGvB9vp2i3NpqAjuZLrHnFcgYHQA9eDznigDjL660S7vjFpGj3Wq3LDJlmmkyxHfaDk/pXP6m/lyGKfSYrKXrtxIrD8GY17L4fi0eJZF0OKDYh2PJFg8jsW6muS+K15BOLTT4FEt4r+Y2wZZFxwPxznHtQB569tm1FxC2+MYEgxyhPr7H1qtXY6Po7aTpWoX2uoIIpYDHDBIcPI2QeB1H/1646gAooooAKKKKACiiigAooooAKKKKACpz9n+xjHm/avMOemwJgY985zUFFAHpvwmtLZbK7vD5ou9+05HyCPHY9ck5/75Fcv43vrXUdWu5VaY3KT+UowPL8tRj653Z/Ouk8I+JtO07wsyXLpFPEGRUUEtJ1IOP8AgXWvN2JZiScknJJoA9F+Es9qj3MG5zeSZcgL8oQbcc+uSePau11zw7YaxdWVxeNNIIEYGDOEJJ65HPTH5V4MjtGwZGKsOQQcEVv3XjDWbnT0tGuSsYXazKMO/wBTQB23jLxmmlXlrZaR5cjR4NyTyBg/cH4Yya624stM1T7BemJbhol3xuxyASeoH0A696+fCSSSSSTySasQ395BCYYLq4jiPJRJCFP4UAeleOvF/wBh/wBA0qSNpWQiSRGz5fbA9/5cUvhXxxpVvo1vDqQkge2VIisSbi6jjK+/HevK6KAOvbxNbDx/JrEUTtZu+xfOHzpHgLu44zjP516Zq041ayeLw9Nvgn+T7UxwI1xyRjqe2B+JrxLRYbOfUYk1O5NtaZy7hSx+gx6+tezeGb7SJLVbPQ3MkMI5wrYXPqSOpoA0LbTLTR7N7XQ48RLkx+dwXPqxHevMtf8AGOr2mrXVvbMtuEbb80Kb8989R/8AWxXqtxMlvBJNMdsaDcxrxrUvs+v6xcahcXMdlBLJtAY7yABjPH0oAyvEF6L/AFSWVLm7uYSfka5xvAxyMDgc56VVvhbLdSCxaV7bjYZVAbpznHHXNWdU0+OzI8q5jm5w20n+oH9azqACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACtHSNJudXuBBYhGlxnDOF/nWdXbeD/Emi6ZZpHqGmj7VGSVuI41Zm6+vIPagDS0X4b8l9ZueM8R256/Ukf0rvdNsLTSrJbezjWGBBk+/qSe5rhdR+JEMaFNJsWJznfcHA/IHn865rWvGmrarbmB3jt4WG10gUjf8AUkk0Aehax4m8OyJPZ3k6XEYGXVQWU89AR1P0rlX1XwbGzhdJMiBuCpYkj15x/OuBooA6fxLrGi3kCxaTpC257ysArfkCa5iiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/Z";var N={currentSheetId:"",rangeMap:{2:{row:4,col:4,rowCount:2,colCount:2,sheetId:"2"},3:{row:4,col:4,rowCount:2,colCount:2,sheetId:"3"},8:{row:2,col:2,rowCount:2,colCount:2,sheetId:"8"}},workbook:{1:{sheetId:"1",name:"basic",isHide:!1,colCount:30,rowCount:200,sort:1,tabColor:"#A2B3F6"},2:{sheetId:"2",name:"floating-picture",isHide:!1,colCount:30,rowCount:200,sort:2,tabColor:"#FE4B4B"},3:{sheetId:"3",name:"hide",isHide:!0,colCount:30,rowCount:200,sort:3},4:{sheetId:"4",name:"chart",isHide:!1,colCount:30,rowCount:200,sort:4,tabColor:"#CEF273"},5:{sheetId:"5",name:"defined name",isHide:!1,colCount:30,rowCount:200,sort:5,tabColor:"#76EFEF"},6:{sheetId:"6",name:"unicode",isHide:!1,colCount:30,rowCount:200,sort:6,tabColor:"#9E6DE3"},7:{sheetId:"7",name:"formula",isHide:!1,colCount:30,rowCount:200,sort:7,tabColor:"#E7258F"},8:{sheetId:"8",name:"merge cell",isHide:!1,colCount:30,rowCount:200,sort:8,tabColor:"#C1026B"},9:{sheetId:"9",name:"number format",isHide:!1,colCount:30,rowCount:200,sort:9,tabColor:"#F9D700"},10:{sheetId:"10",name:"border",isHide:!1,colCount:30,rowCount:200,sort:10}},worksheets:{1:{"0_0":{value:"1",style:{fontColor:"#ff0000"}},"0_3":{value:"large text",style:{fontSize:36}},"0_4":{value:"This is a very long text that needs to be wrapped",style:{isWrapText:!0,isStrike:!0,isItalic:!0,underline:2}},"0_5":{value:"10"},"1_0":{formula:"=SUM(F:F)",value:""},"1_5":{value:"5"},"3_0":{value:"",style:{fillColor:"red"}},"3_1":{value:"",style:{fillColor:"red"}},"4_0":{value:"",style:{fillColor:"red"}},"4_1":{value:"",style:{fillColor:"red"}}},2:{"0_0":{value:"",formula:"=basic!A1"}},4:{"6_6":{value:3},"6_7":{value:6},"6_8":{value:29},"7_6":{value:35},"7_7":{value:15},"7_8":{value:34},"8_6":{value:23},"8_7":{value:24},"8_8":{value:15}},5:{"0_0":{value:"1"},"0_2":{value:"",formula:"=foo"}},6:{"0_0":{value:"\u4F60\u597D\uFF0C\u4E16\u754C"},"0_2":{value:"",formula:'=CONCAT("\u{1F60A}", "\u{1F468}\u200D\u{1F468}\u200D\u{1F467}\u200D\u{1F467}", "\u{1F466}\u{1F3FE}")',style:{fontSize:36}},"0_3":{value:"\u{1F337}\u{1F381}\u{1F4A9}\u{1F61C}\u{1F44D}\u{1F3F3}\uFE0F\u200D\u{1F308}"},"1_0":{value:"Hello World"},"2_0":{value:"Bonjour le monde"},"3_0":{value:"Hola mundo"},"4_0":{value:"\u041F\u0440\u0438\u0432\u0435\u0442, \u043C\u0438\u0440"},"5_0":{value:"Hallo Welt"},"6_0":{value:"\u3053\u3093\u306B\u3061\u306F\u3001\u4E16\u754C"},"7_0":{value:"\uC548\uB155 \uC138\uACC4"},"8_0":{value:"\u0939\u0948\u0932\u094B\u0935\u0930\u094D\u0932\u094D\u0921"},"9_0":{value:"Halo Dunia"},"10_0":{value:"Ol\xE1 mundo"},"11_0":{value:"Witaj \u015Bwiecie"}},7:{"0_0":{value:"",formula:"=SUM(1,2)"},"0_1":{value:"test"},"0_2":{value:"",formula:"=CONCATENATE(A1,B1)"},"0_3":{value:"",formula:'=UNICODE("\u6D4B\u8BD5")'},"0_4":{value:"",formula:"='merge cell'!A1"},"1_0":{value:"",formula:"=PI()"},"2_0":{value:"",formula:"=EXP(1)"},"3_0":{value:"",formula:"=EXP(1)*PI()"},"4_0":{value:"",formula:"=SUM(1, SIN(PI()/2),3)"},"5_0":{value:"",formula:"=R1C3"}},8:{"0_0":{value:"",formula:"=SUM(1,2)"},"2_2":{value:1,style:{horizontalAlign:1}},"5_5":{value:[1,"Hello World",!0,"\u6D4B\u8BD5",!1].join(M),style:{isWrapText:!0}}},9:{},10:{}},mergeCells:{"merge cell!$C$3:$D$4":{row:2,col:2,rowCount:2,colCount:2,sheetId:"8"},"merge cell!$F$6:$G$7":{row:5,col:5,rowCount:2,colCount:2,sheetId:"8"}},customHeight:{"1_1":{len:100,isHide:!1}},customWidth:{"6_0":{len:150,isHide:!1},"6_1":{len:150,isHide:!1},"6_2":{len:150,isHide:!1},"6_3":{len:150,isHide:!1}},definedNames:{foo:{row:0,col:0,rowCount:1,colCount:1,sheetId:"5"},doo:{row:3,col:3,rowCount:1,colCount:1,sheetId:"5"}},drawings:{},autoFilter:{1:{range:{col:0,row:0,rowCount:10,colCount:10,sheetId:""},col:0,value:{type:"number",value:[{type:"=",value:1}]}}}};if(!he()){let h=Q();N.drawings[h]={title:"Black Myth: Wukong",type:"floating-picture",uuid:h,imageSrc:ye,width:200,height:125,originHeight:125,originWidth:200,sheetId:"2",fromCol:1,fromRow:1,marginX:0,marginY:0};let e=Q();N.drawings[e]={title:p("chart-title"),type:"chart",uuid:e,width:400,height:250,originHeight:250,originWidth:400,marginX:0,marginY:0,sheetId:"4",fromCol:4,fromRow:4,chartType:"bar",chartRange:{row:6,col:6,colCount:3,rowCount:3,sheetId:"4"}}}for(let h=0;h<Z.length;h++){let e=Z[h],t=g(h,0);N.worksheets[9][t]={value:h+1,style:{numberFormat:String(e.value)}}}var Se=Object.keys(se);for(let h=0;h<Se.length;h++){let e=g(h,h),t={type:Se[h],color:""};N.worksheets[10][e]={value:"",style:{borderLeft:t,borderRight:t,borderTop:t,borderBottom:t}}}var l="__DELETE__";function u(h,e,t){let o=e.type+(e.key?"."+e.key:"");Ne(h,o,t==="undo"?e.oldValue:e.newValue)}function Ne(h,e,t){if(!h||typeof h!="object")return;e.split(".").reduce((s,r,i,n)=>(i===n.length-1?t===l?delete s[r]:s[r]=t:(s[r]===null||s[r]===void 0)&&(s[r]={}),s[r]),h)}var F=class{constructor(e){this.position=-1;this.commandList=[];this.commands=[];this.options={change:O,maxLength:100,redo:O,undo:O};this.clear(!0),this.options.maxLength=e.maxLength||this.options.maxLength,typeof e.change=="function"&&(this.options.change=e.change),typeof e.redo=="function"&&(this.options.redo=e.redo),typeof e.undo=="function"&&(this.options.undo=e.undo)}push(...e){this.commands=this.commands.concat(e)}commit(){if(this.commands.length===0)return;let e=this.commands.filter(t=>t.type!=="scroll"&&t.type!=="antLine");if(e.length===0){this.change([...this.commands],"commit"),this.commands=[];return}this.position++,this.commandList[this.position]=[...e];for(let t=this.position+1;t<this.commandList.length;t++)this.commandList[t]=[];this.position>=this.options.maxLength&&(this.commandList[this.position-this.options.maxLength]=[]);for(let t=0;this.commandList.length>this.options.maxLength&&t<this.position;t++)this.commandList[0].length===0&&(this.commandList.shift(),this.position--);this.change([...this.commands],"commit"),this.commands=[]}redo(){let e=this.findRedoIndex();if(e<0)return;let t=this.commandList[e];this.options.redo([...t]),this.position=e,this.change(t,"redo")}undo(){let e=this.findUndoIndex();if(e<0)return;let t=this.commandList[e];this.options.undo([...t]),this.position=e-1,this.change(t,"undo")}findRedoIndex(){if(this.position>=this.commandList.length-1)return-1;for(let e=this.position+1;e<this.commandList.length;e++)if(this.commandList[e].length>0)return e;return-1}canRedo(){return this.findRedoIndex()>=0}findUndoIndex(){if(this.position<0)return-1;for(let e=this.position;e>=0;e--)if(this.commandList[e].length>0)return e;return-1}canUndo(){return this.findUndoIndex()>=0}clear(e=!1){e&&(this.position=-1,this.commandList=[]),this.commands=[]}change(e,t){this.options.change(e,t)}get(){return[...this.commands]}getLength(){return Math.min(this.commandList.length,this.options.maxLength)}};var H=class{constructor(e){this.currentSheetId="";this.workbook={};this.model=e}validateSheet(e){return!(!e||!e.sheetId||!e.name||typeof e.isHide!="boolean"||typeof e.sort!="number"||typeof e.colCount!="number"||typeof e.rowCount!="number"||e.rowCount>1048576||e.colCount>16384||e.rowCount<=0||e.colCount<=0)}toJSON(){return{workbook:{...this.workbook},currentSheetId:this.currentSheetId}}fromJSON(e){let t=e.workbook||{},o=e.currentSheetId||"",s={...this.workbook};this.workbook={},this.currentSheetId="";for(let i of Object.values(t))this.validateSheet(i)&&(this.workbook[i.sheetId]=i);let r=this.getSheetId()||"";this.workbook[o]&&!this.workbook[o].isHide&&(r=o),this.model.push({type:"workbook",key:"",newValue:this.workbook,oldValue:s}),this.setCurrentSheetId(r)}undo(e){if(e.type==="currentSheetId"){let t=this.getSheetId();E(typeof e.oldValue=="string"),E(typeof e.newValue=="string"),!this.workbook[e.oldValue]||this.workbook[e.oldValue].isHide?t&&(this.currentSheetId=t):this.currentSheetId=e.oldValue;return}else e.type==="workbook"&&u(this,e,"undo")}redo(e){if(e.type==="currentSheetId"){if(E(typeof e.oldValue=="string"),E(typeof e.newValue=="string"),!this.workbook[e.newValue]||this.workbook[e.newValue].isHide){let t=this.getSheetId();t&&(this.currentSheetId=t)}else this.currentSheetId=e.newValue;return}else e.type==="workbook"&&u(this,e,"redo")}updateSheetInfo(e,t){let o=t||this.currentSheetId;if(!this.workbook[o])return;let s=Object.keys(e);for(let r of s){if(r==="sheetId")continue;let i=this.workbook[o][r];i!==e[r]&&(this.workbook[o][r]=e[r],this.model.push({type:"workbook",key:`${o}.${r}`,newValue:e[r],oldValue:i}))}}getSheetList(){let e=Object.values(this.workbook);return e.sort((t,o)=>t.sort-o.sort),e.slice()}addSheet(){let e=this.getSheetList(),o={...ae(e),isHide:!1,colCount:30,rowCount:200};return this.workbook[o.sheetId]=o,this.model.push({type:"workbook",key:o.sheetId,newValue:{...o},oldValue:l}),o}deleteSheet(e){let t=e||this.currentSheetId;if(this.checkSheetSize(e)){let o={...this.workbook[t]};delete this.workbook[t],this.model.push({type:"workbook",key:t,newValue:l,oldValue:o})}}hideSheet(e){this.checkSheetSize(e)&&this.updateSheetInfo({isHide:!0},e)}unhideSheet(e){this.updateSheetInfo({isHide:!1},e)}renameSheet(e,t){if(!e){I.error(p("the-value-cannot-be-empty"));return}let o=t||this.currentSheetId,r=this.getSheetList().find(i=>i.name===e);if(r){if(r.sheetId===o)return;I.error(p("sheet-name-is-duplicate"));return}this.updateSheetInfo({name:e},o)}getSheetInfo(e){let t=e||this.currentSheetId,o=this.workbook[t];if(o)return o&&(o.sheetId=t),{...o}}setCurrentSheetId(e){if(!(!e||!this.workbook[e])&&this.currentSheetId!==e){let t=this.currentSheetId;this.currentSheetId=e,this.model.push({type:"currentSheetId",key:"",newValue:e,oldValue:t})}}getCurrentSheetId(){return this.currentSheetId}getSheetId(){return this.getSheetList().filter(o=>!o.isHide)[0]?.sheetId}deleteAll(){}checkSheetSize(e){let t=e||this.currentSheetId;return this.workbook[t]?this.getSheetList().filter(r=>!r.isHide).length<2?(I.error(p("a-workbook-must-contains-at-least-one-visible-worksheet")),!1):!0:!1}};var K=class{constructor(e){this.rangeMap={};this.model=e}validateRange(e){e.sheetId=e.sheetId||this.model.getCurrentSheetId();let t=this.model.getSheetInfo(e.sheetId);return!(!t||e.row<0||e.col<0||e.colCount<0||e.rowCount<0||e.row>=t.rowCount||e.col>=t.colCount||e.colCount>t.colCount||e.rowCount>t.rowCount||e.row+e.rowCount>t.rowCount||e.col+e.colCount>t.colCount)}toJSON(){return{rangeMap:{...this.rangeMap}}}fromJSON(e){let t=e.rangeMap||{},o={...this.rangeMap};this.rangeMap={};for(let s of Object.values(t))s.sheetId=s.sheetId||this.model.getCurrentSheetId(),this.model.validateRange(s)&&(this.rangeMap[s.sheetId]=s);this.model.push({type:"rangeMap",key:"",newValue:this.rangeMap,oldValue:o})}undo(e){e.type==="rangeMap"&&u(this,e,"undo")}redo(e){e.type==="rangeMap"&&u(this,e,"redo")}getActiveRange(){let e=this.model.getCurrentSheetId(),t=this.rangeMap[e];return t?(t.sheetId=t.sheetId||e,{range:{...t},isMerged:!1}):{range:{row:0,col:0,rowCount:1,colCount:1,sheetId:e},isMerged:!1}}setActiveRange(e){if(e.sheetId=e.sheetId||this.model.getCurrentSheetId(),!this.model.validateRange(e))return;let t=this.rangeMap[e.sheetId]?{...this.rangeMap[e.sheetId]}:void 0;t&&me(t,e)||(this.rangeMap[e.sheetId]=e,this.model.push({type:"rangeMap",key:e.sheetId,newValue:e,oldValue:t||l}))}deleteAll(){}};var T=class{constructor(e){this.drawings={};this.model=e}validateDrawing(e){if(!e||!e.uuid||!this.model.getSheetInfo(e.sheetId))return!1;if(e.type==="floating-picture"){if(!e.imageSrc)return!1}else if(e.chartType===void 0||e.chartRange===void 0||z.findIndex(o=>o.value===e.chartType)<0||!this.model.validateRange(e.chartRange))return!1;return!0}toJSON(){return{drawings:{...this.drawings}}}fromJSON(e){let t=e.drawings||{},o={...this.drawings};this.drawings={};for(let[s,r]of Object.entries(t)){if(!this.validateDrawing(r)||!s)return;this.drawings[s]=r}this.model.push({type:"drawings",key:"",newValue:this.drawings,oldValue:o})}undo(e){e.type==="drawings"&&u(this,e,"undo")}redo(e){e.type==="drawings"&&u(this,e,"redo")}getDrawingList(e){let t=e||this.model.getCurrentSheetId();return Object.values(this.drawings).filter(s=>s.sheetId===t).slice()}addDrawing(e){if(this.drawings[e.uuid])return I.error(p("uuid-is-duplicate"));if(this.validateDrawing(e)){if(e.type==="chart"){let o=e.chartRange,s=!1,r=this.model.getSheetInfo(o.sheetId);if(!r)return I.error(p("sheet-is-not-exist"));if(b(o,r?.rowCount,r?.colCount,(i,n)=>this.model.getCell({row:i,col:n,rowCount:1,colCount:1,sheetId:""})?.value?(s=!0,!0):!1),!s)return I.error(p("cells-must-contain-data"))}else e.type==="floating-picture"&&typeof e.imageAngle!="number"&&(e.imageAngle=0);this.drawings[e.uuid]=e,this.model.push({type:"drawings",key:e.uuid,newValue:e,oldValue:l})}}updateDrawing(e,t){let o=Object.keys(t),s=this.drawings[e];if(!(o.length===0||!s)){for(let r of o)if(s[r]!==t[r]&&r==="chartType"&&z.findIndex(n=>n.value===t.chartType)<0)return I.error(p("unsupported-chart-types"));for(let r of o)if(s[r]!==t[r]){let i=typeof s[r]=="object"&&s[r]?{...s[r]}:s[r];s[r]=t[r],this.model.push({type:"drawings",key:`${e}.${r}`,newValue:s[r],oldValue:i})}}}deleteDrawing(e){let t=this.drawings[e];t&&(delete this.drawings[e],this.model.push({type:"drawings",key:e,newValue:l,oldValue:t}))}addCol(e,t,o=!1){let s=this.model.getSheetInfo().colCount;for(let[r,i]of Object.entries(this.drawings)){let n={},a=o?e+1:e;if(i.fromCol>=a&&(n.fromCol=Math.min(s-1,i.fromCol+t)),i.type==="chart"&&i.chartRange.col>=a){n.chartRange={...i.chartRange};let d=n.chartRange.col;d+t<=s-1?n.chartRange.col+=t:(n.chartRange.col=s-1,n.chartRange.colCount=Math.max(s-1-t-d+n.chartRange.colCount,1))}this.updateDrawing(r,n)}}addRow(e,t,o=!1){if(t<=0)return;let s=this.model.getSheetInfo().rowCount;for(let[r,i]of Object.entries(this.drawings)){let n={},a=o?e:e+1;if(i.fromRow>=a&&(n.fromRow=Math.min(s-1,i.fromRow+t)),i.type==="chart"&&i.chartRange.row>=a){n.chartRange={...i.chartRange};let d=n.chartRange.row;d+t<=s-1?n.chartRange.row+=t:(n.chartRange.row=s-1,n.chartRange.rowCount=Math.max(s-1-t-d+n.chartRange.rowCount,1))}this.updateDrawing(r,n)}}deleteCol(e,t){for(let[o,s]of Object.entries(this.drawings)){let r={};if(s.fromCol>=e&&(r.fromCol=Math.max(s.fromCol-t,0)),s.type==="chart"&&s.chartRange.col>=e){r.chartRange={...s.chartRange};let i=r.chartRange.col;i>=t?r.chartRange.col-=t:(r.chartRange.col=0,r.chartRange.colCount=Math.max(i-t+r.chartRange.colCount,1))}this.updateDrawing(o,r)}}deleteRow(e,t){for(let[o,s]of Object.entries(this.drawings)){let r={};if(s.fromRow>=e&&(r.fromRow=Math.max(s.fromRow-t,0)),s.type==="chart"&&s.chartRange.row>=e){r.chartRange={...s.chartRange};let i=r.chartRange.row;i>=t?r.chartRange.row=i-t:(r.chartRange.row=0,r.chartRange.rowCount=Math.max(i-t+r.chartRange.rowCount,1))}this.updateDrawing(o,r)}}deleteAll(e){let t=e||this.model.getCurrentSheetId();for(let[o,s]of Object.entries(this.drawings))s.sheetId===t&&(delete this.drawings[o],this.model.push({type:"drawings",key:o,newValue:l,oldValue:{...s}}))}};var B=class{constructor(e){this.definedNames={};this.model=e}toJSON(){return{definedNames:{...this.definedNames}}}validateDefinedName(e){if(!e)return!1;let t=ce(e,o=>this.model.getSheetList().find(i=>i.name===o)?.sheetId||"");if(t){let o=this.model.getSheetInfo(t.sheetId);if(o&&t.col<o.colCount&&t.row<o.rowCount)return!1}return!!(ne.test(e)&&e.length<=256)}fromJSON(e){let t=e.definedNames||{},o={...this.definedNames};this.definedNames={};for(let[s,r]of Object.entries(t))!this.model.validateRange(r)||!this.validateDefinedName(s)||(this.definedNames[s]=r);this.model.push({type:"definedNames",key:"",newValue:this.definedNames,oldValue:o})}undo(e){e.type==="definedNames"&&u(this,e,"undo")}redo(e){e.type==="definedNames"&&u(this,e,"redo")}getDefineNameList(){let e=Object.entries(this.definedNames);return e.length===0?[]:e.map(t=>({name:t[0],range:t[1]}))}getDefineName(e){let t=e.sheetId||this.model.getCurrentSheetId();for(let[o,s]of Object.entries(this.definedNames))if(s.row===e.row&&s.col===e.col&&s.sheetId===t)return o;return""}setDefineName(e,t){if(!t)return!1;let o=this.getDefineName(e);if(o===t)return!1;let s={row:e.row,col:e.col,sheetId:e.sheetId||this.model.getCurrentSheetId(),colCount:1,rowCount:1};return this.definedNames[t]=s,o&&delete this.definedNames[o],o?(this.model.push({type:"definedNames",key:t,newValue:s,oldValue:l}),this.model.push({type:"definedNames",key:o,newValue:l,oldValue:s})):this.model.push({type:"definedNames",key:t,newValue:s,oldValue:l}),!0}checkDefineName(e){if(this.definedNames[e])return{...this.definedNames[e]}}deleteAll(e){let t=e||this.model.getCurrentSheetId();for(let[o,s]of Object.entries(this.definedNames))s.sheetId===t&&(delete this.definedNames[o],this.model.push({type:"definedNames",key:o,newValue:l,oldValue:s}))}};var _=class{constructor(e,t){this.worksheets={};this.computeFormulasCallback=e=>{let{list:t}=e,o=!1;for(let s of t){let r=s.sheetId;this.worksheets[r]=this.worksheets[r]||{};let i=this.worksheets[r][s.key].value,n=this.worksheets[r][s.key].formula;n&&s.newValue===ie&&n!==i?(o=!0,this.worksheets[r][s.key].value=n,this.worksheets[r][s.key].formula=""):i!==s.newValue&&(o=!0,this.worksheets[r][s.key].value=s.newValue)}o&&this.model.render(new Set(["cellValue"]))};this.model=e,this.worker=t}toJSON(){return{worksheets:{...this.worksheets}}}fromJSON(e){let t=e.worksheets||{};this.worksheets=this.worksheets||{};let o={...this.worksheets};this.worksheets={};for(let[s,r]of Object.entries(t))this.worksheets[s]={},!w(r)&&(this.worksheets[s]=this.validateSheetData(r));this.model.push({type:"worksheets",key:"",newValue:this.worksheets,oldValue:o})}undo(e){e.type==="worksheets"&&u(this,e,"undo")}redo(e){e.type==="worksheets"&&u(this,e,"redo")}addMergeCell(e,t){let o=e.sheetId||this.model.getCurrentSheetId(),s=t===2,r=[],i=this.model.getSheetInfo(e.sheetId);if(!i||(b(e,i.rowCount,i.colCount,(m,f)=>{let y=this.getCell({row:m,col:f,rowCount:1,colCount:1,sheetId:o});return y&&r.push({value:{...y},row:m,col:f}),!1}),r.length===0))return;let n=[q(r[0].value.value,r[0].value.style?.numberFormat)];for(let m=1;m<r.length;m++){let f=r[m],y=g(f.row,f.col),A={...f.value};s&&n.push(q(A.value,A.style?.numberFormat)),delete this.worksheets[o][y],this.model.push({type:"worksheets",key:`${o}.${y}`,newValue:l,oldValue:A})}r.some(m=>m.value.formula)&&(n=[n[0]]);let a={},d=r[0].value.value;r[0].value.style&&(a={...r[0].value.style}),t===1||t===0?a.horizontalAlign=1:t===2&&(a.isWrapText=!0);let c={row:e.row,col:e.col,rowCount:1,colCount:1,sheetId:o};if(s?d=n.join(M):d=n[0],e.row===r[0].row&&e.col===r[0].col)s&&this.setCellValue(d,c);else{let m=g(r[0].row,r[0].col);delete this.worksheets[o][m],this.model.push({type:"worksheets",key:`${o}.${m}`,newValue:l,oldValue:{...r[0].value}}),this.setCellValue(d,c)}this.updateCellStyle(a,c)}addRow(e,t,o=!1){let s=this.getCoordinateList(),r=this.worksheets[this.model.getCurrentSheetId()],i=o?e:e+1;for(let n=s.length-1;n>=0;n--){let a=s[n];if(a.row<i)continue;let d=g(a.row,a.col),c=g(a.row+t,a.col),m=r[d]?{...r[d]}:{value:""},f=r[c]?{...r[c]}:{value:""};this.updateCell(d,l,m),this.updateCell(c,m,f)}}deleteRow(e,t){let o=this.getCoordinateList(),s=this.worksheets[this.model.getCurrentSheetId()];for(let r of o){if(r.row<e)continue;let i=g(r.row,r.col),n=s[i]?{...s[i]}:{value:""};if(r.row>=e+t){let a=g(r.row-t,r.col),d=s[a]?{...s[a]}:{value:""};this.updateCell(a,n,d)}this.updateCell(i,l,n)}}addCol(e,t,o=!1){let s=this.getCoordinateList(!0),r=this.worksheets[this.model.getCurrentSheetId()],i=o?e+1:e;for(let n=s.length-1;n>=0;n--){let a=s[n];if(a.col<i)continue;let d=g(a.row,a.col),c=g(a.row,a.col+t),m=r[d]?{...r[d]}:{value:""},f=r[c]?{...r[c]}:{value:""};this.updateCell(d,l,m),this.updateCell(c,m,f)}}deleteCol(e,t){let o=this.getCoordinateList(!0),s=this.worksheets[this.model.getCurrentSheetId()];for(let r of o){if(r.col<e)continue;let i=g(r.row,r.col),n=s[i]?{...s[i]}:{value:""};if(r.col>=e+t){let a=g(r.row,r.col-t),d=s[a]?{...s[a]}:{value:""};this.updateCell(a,n,d)}this.updateCell(i,l,n)}}getWorksheet(e){let t=e||this.model.getCurrentSheetId(),o=this.worksheets[t];if(o)return o}setWorksheet(e,t){let o=t||this.model.getCurrentSheetId();if(X(e,this.worksheets[o]))return;let s=this.worksheets[o]?{...this.worksheets[o]}:{};this.worksheets[o]=this.validateSheetData(e),this.model.push({type:"worksheets",key:o,newValue:e,oldValue:s})}getCell(e){let{row:t,col:o,sheetId:s}=e,r=s||this.model.getCurrentSheetId();if(this.model.getRowHeight(t,r).len===0||this.model.getColWidth(o,r).len===0)return;let i=g(t,o);this.worksheets[r]=this.worksheets[r]||{};let a=this.worksheets[r]?.[i];if(!w(a))return{...a}}async setCell(e,t,o){let{row:s,col:r}=o;for(let i=0;i<e.length;i++)for(let n=0;n<e[i].length;n++){let a={row:s+i,col:r+n};t[i]&&t[i][n]&&this.setStyle(t[i][n],a),this.setCellValue(e[i][n],{...o,...a})}}setCellValue(e,t){let o=t.sheetId||this.model.getCurrentSheetId(),s=this.worksheets?.[o]?.[g(t.row,t.col)];typeof e=="string"&&ue(e)&&s?.style?.numberFormat!==re?this.setCellFormula(e,t):(s?.formula&&this.setCellFormula("",t),this.setValue(e,t))}updateCellStyle(e,t){if(w(e))return;let o=this.model.getSheetInfo(t.sheetId);o&&b(t,o.rowCount,o.colCount,(s,r)=>(this.updateStyle(e,{row:s,col:r}),!1))}pasteRange(e,t){let o=this.model.getCurrentSheetId(),s=this.model.getActiveRange().range,{row:r,col:i,rowCount:n,colCount:a,sheetId:d}=e,c=d||o,m=this.getWorksheet(c),f={...s,rowCount:n,colCount:a};if(!m||w(m))return f;this.worksheets[o]=this.worksheets[o]||{};let y=this.worksheets[o],A=this.model.getSheetInfo(e.sheetId);return A&&b(e,A.rowCount,A.colCount,(te,oe)=>{let D=g(te,oe),P=m[D]?{...m[D]}:{value:""},Me=s.row+(te-r),Re=s.col+(oe-i),L=g(Me,Re),be=y[L]?{...y[L]}:{value:""};return y[L]={...P},this.model.push({type:"worksheets",key:`${o}.${L}`,newValue:P,oldValue:be}),t&&(delete m[D],this.model.push({type:"worksheets",key:`${c}.${D}`,newValue:l,oldValue:P})),!1}),f}deleteAll(e){let t=e||this.model.getCurrentSheetId();if(w(this.worksheets[t]))return;let o=this.worksheets[t]?{...this.worksheets[t]}:{};delete this.worksheets[t],this.model.push({type:"worksheets",key:t,newValue:l,oldValue:{...o}})}updateStyle(e,t){let o=this.getCellModel(t);if(o.style=o.style||{},w(e)&&w(o.style))return;let s=Object.keys(e);for(let r of s){let i=o.style?.[r],n=e[r];X(i,n)||(o.style[r]=n,this.model.push({type:"worksheets",key:`${this.model.getCurrentSheetId()}.${g(t.row,t.col)}.style.${r}`,newValue:n===void 0?l:n,oldValue:i===void 0?l:i}))}}setStyle(e,t){let o=this.getCellModel(t),r={...o.style||{}};o.style=e,this.model.push({type:"worksheets",key:`${this.model.getCurrentSheetId()}.${g(t.row,t.col)}.style`,newValue:e,oldValue:w(r)?l:r})}setValue(e,t){let o=this.getCellModel(t),s=o.value;if(s===e)return;let r=Y(e??"");o.value=r,this.model.push({type:"worksheets",key:`${this.model.getCurrentSheetId()}.${g(t.row,t.col)}.value`,newValue:r,oldValue:s===void 0?l:s})}setCellFormula(e,t){let o=this.getCellModel(t),s=o.formula;s!==e&&(o.formula=e,this.model.push({type:"worksheets",key:`${this.model.getCurrentSheetId()}.${g(t.row,t.col)}.formula`,newValue:e,oldValue:s||l}))}validateSheetData(e){let t={};for(let[o,s]of Object.entries(e)){if(w(s))continue;let r=Y(s.value??"");t[o]={value:r},w(s.style)||(t[o].style={...s.style}),s.formula&&(s.formula.startsWith(G)?t[o].formula=s.formula:t[o].formula=G+s.formula)}return t}getCoordinateList(e=!1){let t=this.model.getCurrentSheetId(),o=this.worksheets[t];if(w(o))return[];let s=Array.from(Object.keys(o)).map(r=>le(r));return s.sort((r,i)=>e?r.col-i.col:r.row-i.row),s}updateCell(e,t,o){let s=this.model.getCurrentSheetId();t===l?delete this.worksheets[s][e]:this.worksheets[s][e]={...t},this.model.push({type:"worksheets",key:`${s}.${e}`,newValue:t,oldValue:o})}getCellModel(e){let{row:t,col:o}=e,s=this.model.getCurrentSheetId(),r=g(t,o);return this.worksheets[s]=this.worksheets[s]||{},this.worksheets[s][r]=this.worksheets[s][r]||{},this.worksheets[s][r]}async computeFormulas(){let e=this.model.getCurrentSheetId(),t=this.worksheets[e];if(w(t))return;let o={};for(let r of this.model.getDefineNameList())o[r.name]=r.range;let s={worksheets:this.worksheets,definedNames:o,currentSheetId:this.model.getCurrentSheetId(),workbook:this.model.getSheetList()};this.worker.computeFormulas(s,ke(this.computeFormulasCallback))}};var x=class{constructor(e){this.mergeCells={};this.convertSheetIdToName=e=>this.model.getSheetInfo(e)?.name||"";this.model=e}toJSON(){return{mergeCells:{...this.mergeCells}}}fromJSON(e){let t=e.mergeCells||{},o={...this.mergeCells};this.mergeCells={};for(let s of Object.values(t)){if(s.sheetId=s.sheetId||this.model.getCurrentSheetId(),!this.model.validateRange(s))continue;let r=W(s,"absolute",this.convertSheetIdToName);this.mergeCells[r]=s}this.model.push({type:"mergeCells",key:"",newValue:this.mergeCells,oldValue:o})}undo(e){e.type==="mergeCells"&&u(this,e,"undo")}redo(e){e.type==="mergeCells"&&u(this,e,"redo")}getMergeCellList(e){let t=e||this.model.getCurrentSheetId();return Object.values(this.mergeCells).filter(o=>o.sheetId===t)}addMergeCell(e){let t=W(e,"absolute",this.convertSheetIdToName);if(this.mergeCells[t]){I.error(p("merging-cell-is-duplicate"));return}this.mergeCells[t]=e,this.model.push({type:"mergeCells",key:t,newValue:this.mergeCells[t],oldValue:l})}deleteMergeCell(e){e.sheetId=e.sheetId||this.model.getCurrentSheetId();let t=W(e,"absolute",this.convertSheetIdToName);if(!this.mergeCells[t])return;let o=this.mergeCells[t];delete this.mergeCells[t],this.model.push({type:"mergeCells",key:t,newValue:l,oldValue:o})}deleteAll(e){let t=e||this.model.getCurrentSheetId();for(let[o,s]of Object.entries(this.mergeCells))s.sheetId===t&&(delete this.mergeCells[o],this.model.push({type:"mergeCells",key:o,newValue:l,oldValue:s}))}};var J=class{constructor(e){this.customHeight={};this.model=e}toJSON(){return{customHeight:{...this.customHeight}}}fromJSON(e){let t=e.customHeight||{},o={...this.customHeight};this.customHeight={};for(let[s,r]of Object.entries(t)){let{sheetId:i,rowOrCol:n}=R(s);if(!i||n<0)continue;let a=this.model.getSheetInfo(i);!a||n>=a.rowCount||typeof r.isHide=="boolean"&&typeof r.len=="number"&&(this.customHeight[s]=r)}this.model.push({type:"customHeight",key:"",newValue:this.customHeight,oldValue:o})}undo(e){e.type==="customHeight"&&u(this,e,"undo")}redo(e){e.type==="customHeight"&&u(this,e,"redo")}hideRow(e,t){for(let o=0;o<t;o++){let s=e+o,r=S(this.model.getCurrentSheetId(),s),i=this.getRowHeight(s);if(i.isHide)continue;let n={...i,isHide:!0};this.customHeight[r]=n,this.model.push({type:"customHeight",key:r,newValue:n,oldValue:this.customHeight[r]?i:l})}}getRowHeight(e,t){let o=t||this.model.getCurrentSheetId(),s=S(o,e),r=this.customHeight[s];return r?r.isHide?{isHide:!0,len:0}:{...r}:{len:22,isHide:!1}}setRowHeight(e,t,o){let s=o||this.model.getCurrentSheetId(),r=S(s,e),i=this.getRowHeight(e,o);if(i.len===t)return;let n={...i},a=this.customHeight[r];n.len=t,this.customHeight[r]=n,this.model.push({type:"customHeight",key:r,newValue:n,oldValue:a||l})}deleteAll(e){let t=e||this.model.getCurrentSheetId();for(let[o,s]of Object.entries(this.customHeight)){let{sheetId:r}=R(o);r===t&&(delete this.customHeight[o],this.model.push({type:"customHeight",key:o,newValue:l,oldValue:s}))}}};var U=class{constructor(e){this.customWidth={};this.model=e}toJSON(){return{customWidth:{...this.customWidth}}}fromJSON(e){let t=e.customWidth||{},o={...this.customWidth};this.customWidth={};for(let[s,r]of Object.entries(t)){let{sheetId:i,rowOrCol:n}=R(s);if(!i||n<0)continue;let a=this.model.getSheetInfo(i);!a||n>=a.colCount||typeof r.isHide=="boolean"&&typeof r.len=="number"&&(this.customWidth[s]=r)}this.model.push({type:"customHeight",key:"",newValue:this.customWidth,oldValue:o})}undo(e){e.type==="customWidth"&&u(this,e,"undo")}redo(e){e.type==="customWidth"&&u(this,e,"redo")}hideCol(e,t){let o=this.model.getCurrentSheetId();for(let s=0;s<t;s++){let r=e+s,i=S(o,r),n=this.getColWidth(r);if(n.isHide)continue;let a={...n,isHide:!0};this.customWidth[i]=a,this.model.push({type:"customWidth",key:i,newValue:{...a},oldValue:this.customWidth[i]?n:l})}}getColWidth(e,t){let o=t||this.model.getCurrentSheetId(),s=S(o,e),r=this.customWidth[s];return r?r.isHide?{isHide:!0,len:0}:{...r}:{len:76,isHide:!1}}setColWidth(e,t,o){let s=o||this.model.getCurrentSheetId(),r=S(s,e),i=this.getColWidth(e,o);if(i.len===t)return;let n={...i,len:t},a=this.customWidth[r];this.customWidth[r]=n,this.model.push({type:"customWidth",key:r,newValue:n,oldValue:a||l})}deleteAll(e){let t=e||this.model.getCurrentSheetId();for(let[o,s]of Object.entries(this.customWidth)){let{sheetId:r}=R(o);r===t&&(delete this.customWidth[o],this.model.push({type:"customWidth",key:o,newValue:l,oldValue:s}))}}};var j=class{constructor(e){this.autoFilter={};this.model=e}toJSON(){return{autoFilter:{...this.autoFilter}}}fromJSON(e){let t=e.autoFilter||{},o={...this.autoFilter};this.autoFilter={...t},this.model.push({type:"autoFilter",key:"",newValue:{...t},oldValue:o})}undo(e){e.type==="autoFilter"&&u(this,e,"undo")}redo(e){e.type==="autoFilter"&&u(this,e,"redo")}deleteAll(e){let t=e||this.model.getCurrentSheetId(),o=this.autoFilter[t]?{...this.autoFilter[t]}:void 0;delete this.autoFilter[t],this.model.push({type:"autoFilter",key:t,newValue:l,oldValue:o})}addFilter(e){e.sheetId=e.sheetId||this.model.getCurrentSheetId();let t={range:e};this.autoFilter[e.sheetId]=t,this.model.push({type:"autoFilter",key:e.sheetId,newValue:{...t},oldValue:l})}deleteFilter(e){this.deleteAll(e)}updateFilter(e,t){let o=e||this.model.getCurrentSheetId(),s=Object.keys(t),r=this.autoFilter[o];for(let a of s)if(r[a]!==t[a]){let d=typeof r[a]=="object"&&r[a]?{...r[a]}:r[a];r[a]=t[a],this.model.push({type:"autoFilter",key:`${o}.${a}`,newValue:r[a],oldValue:d})}if(typeof t.col>"u"||!t.value)return;let i=this.model.getSheetInfo(r.range.sheetId);if(!i)return;let{range:n}=r;if(t.value.type==="normal"){let a=new Set(t.value.value);for(let d=n.row,c=n.rowCount===0?i.rowCount:n.row+n.rowCount;d<c;d++){let m=this.model.getCell({row:d,col:t.col,rowCount:1,colCount:1,sheetId:n.sheetId}),f=m?m.value:M;a.has(f)||this.model.setRowHeight(d,0,n.sheetId)}}}getFilter(e){let t=e||this.model.getCurrentSheetId(),o=this.autoFilter[t];return o?{...o}:void 0}};var ve={computeFormulas:Ie},Ae=class{constructor(e=ve){this.historyChange=(e,t)=>{let o=V(e);(t==="undo"||t==="redo")&&o.add(t),(o.has("row")||o.has("col"))&&this.computeViewSize(),this.render(o,e)};this.fromJSON=e=>{this.workbookManager.fromJSON(e),this.rangeMapManager.fromJSON(e),this.drawingsManager.fromJSON(e),this.definedNameManager.fromJSON(e),this.worksheetManager.fromJSON(e),this.mergeCellManager.fromJSON(e),this.rowManager.fromJSON(e),this.colManager.fromJSON(e),this.filterManager.fromJSON(e),this.worksheetManager.computeFormulas()};this.toJSON=()=>({...this.workbookManager.toJSON(),...this.rangeMapManager.toJSON(),...this.drawingsManager.toJSON(),...this.definedNameManager.toJSON(),...this.worksheetManager.toJSON(),...this.mergeCellManager.toJSON(),...this.rowManager.toJSON(),...this.colManager.toJSON(),...this.filterManager.toJSON()});this.getCell=e=>this.worksheetManager.getCell(e);this.historyRedo=e=>{for(let t of e)this.workbookManager.redo(t),this.rangeMapManager.redo(t),this.drawingsManager.redo(t),this.definedNameManager.redo(t),this.worksheetManager.redo(t),this.mergeCellManager.redo(t),this.rowManager.redo(t),this.colManager.redo(t);this.checkComputeFormulas(e)};this.historyUndo=e=>{for(let t of e)this.workbookManager.undo(t),this.rangeMapManager.undo(t),this.drawingsManager.undo(t),this.definedNameManager.undo(t),this.worksheetManager.undo(t),this.mergeCellManager.undo(t),this.rowManager.undo(t),this.colManager.undo(t);this.checkComputeFormulas(e)};if(!de()&&e===ve)throw new Error("worker must be provided in production or development environment");this.history=new F({undo:this.historyUndo,redo:this.historyRedo,change:this.historyChange,maxLength:1e3}),this.workbookManager=new H(this),this.rangeMapManager=new K(this),this.drawingsManager=new T(this),this.definedNameManager=new B(this),this.worksheetManager=new _(this,e),this.mergeCellManager=new x(this),this.rowManager=new J(this),this.colManager=new U(this),this.filterManager=new j(this)}push(...e){this.history.push(...e)}render(e,t=[]){e.size===0||e.size===1&&e.has("noHistory")||(fe(e,t),Ce.emit("modelChange",{changeSet:e,commandList:t}))}checkComputeFormulas(e){let t=V(e);return(t.has("cellValue")||t.has("definedNames")||t.has("currentSheetId"))&&this.worksheetManager.computeFormulas(),t}async emitChange(e){let t=V(this.history.get());for(let o of e.keys())t.add(o);e.has("scroll")&&this.push({type:"scroll",key:"",newValue:"",oldValue:""}),e.has("antLine")&&this.push({type:"antLine",key:"",newValue:"",oldValue:""}),(t.has("cellValue")||t.has("definedNames")||t.has("currentSheetId"))&&this.worksheetManager.computeFormulas(),t.has("noHistory")?((t.has("row")||t.has("col"))&&this.computeViewSize(),this.render(t)):!t.has("undo")&&!t.has("redo")&&this.history.commit(),this.history.clear(!1)}getSheetList(){return this.workbookManager.getSheetList()}getActiveRange(e){let t=e||this.rangeMapManager.getActiveRange().range,o=this.getMergeCellList(t.sheetId);for(let s of o)if(ge(t,s))return{range:{...s,sheetId:s.sheetId||this.getCurrentSheetId()},isMerged:!0};return{range:t,isMerged:!1}}setActiveRange(e){e.sheetId=e.sheetId||this.getCurrentSheetId();let{range:t}=this.getActiveRange(e);this.rangeMapManager.setActiveRange(t)}addSheet(){let e=this.workbookManager.addSheet();return this.worksheetManager.setWorksheet({},e.sheetId),this.workbookManager.setCurrentSheetId(e.sheetId),this.computeViewSize(),e}deleteSheet(e){let t=this.getNextSheetId(e);if(!t)return;let o=this.drawingsManager.getDrawingList(e);for(let s of o)this.drawingsManager.deleteDrawing(s.uuid);this.workbookManager.deleteSheet(e),this.worksheetManager.setWorksheet({},e),this.workbookManager.setCurrentSheetId(t)}updateSheetInfo(e,t){this.workbookManager.updateSheetInfo(e,t)}hideSheet(e){let t=this.getNextSheetId(e);t&&(this.workbookManager.hideSheet(e),this.workbookManager.setCurrentSheetId(t))}unhideSheet(e){e&&(this.workbookManager.unhideSheet(e),this.workbookManager.setCurrentSheetId(e))}renameSheet(e,t){this.workbookManager.renameSheet(e,t)}getSheetInfo(e){return this.workbookManager.getSheetInfo(e)}setCurrentSheetId(e){this.workbookManager.setCurrentSheetId(e)}getCurrentSheetId(){return this.workbookManager.getCurrentSheetId()}setCell(e,t,o){return this.worksheetManager.setCell(e,t,o)}setCellValue(e,t){return this.worksheetManager.setCellValue(e,t)}updateCellStyle(e,t){return this.worksheetManager.updateCellStyle(e,t)}getWorksheet(e){return this.worksheetManager.getWorksheet(e)}setWorksheet(e,t){this.worksheetManager.setWorksheet(e,t)}addCol(e,t,o=!1){if(t<=0)return;let s=this.getSheetInfo();if(s.colCount>=16384)return;let r=this.getCurrentSheetId(),i=s.colCount+t;this.workbookManager.updateSheetInfo({colCount:i},r),this.drawingsManager.addCol(e,t,o),this.worksheetManager.addCol(e,t,o)}deleteCol(e,t){if(t<=0)return;let o=this.getSheetInfo(),s=this.getCurrentSheetId(),r=o.colCount-t;this.workbookManager.updateSheetInfo({colCount:r},s),this.drawingsManager.deleteCol(e,t),this.worksheetManager.deleteCol(e,t)}hideCol(e,t){this.colManager.hideCol(e,t)}getColWidth(e,t){return this.colManager.getColWidth(e,t)}setColWidth(e,t,o){this.colManager.setColWidth(e,t,o)}addRow(e,t,o=!1){if(t<=0)return;let s=this.getSheetInfo();if(s.rowCount>=1048576)return;let r=s.rowCount+t;this.workbookManager.updateSheetInfo({rowCount:r}),this.drawingsManager.addRow(e,t,o),this.worksheetManager.addRow(e,t,o)}deleteRow(e,t){if(t<=0)return;let s=this.getSheetInfo().rowCount-t;this.workbookManager.updateSheetInfo({rowCount:s}),this.drawingsManager.deleteRow(e,t),this.worksheetManager.deleteRow(e,t)}hideRow(e,t){this.rowManager.hideRow(e,t)}getRowHeight(e,t){return this.rowManager.getRowHeight(e,t)}setRowHeight(e,t,o){this.rowManager.setRowHeight(e,t,o)}canRedo(){return this.history.canRedo()}canUndo(){return this.history.canUndo()}undo(){this.history.undo()}redo(){this.history.redo()}applyCommandList(e){let{commandList:t=[],changeSet:o}=e;t.length!==0&&(o.has("undo")?this.historyUndo(t):this.historyRedo(t))}pasteRange(e,t){return this.worksheetManager.pasteRange(e,t)}deleteAll(e){this.rowManager.deleteAll(e),this.colManager.deleteAll(e),this.worksheetManager.deleteAll(e),this.mergeCellManager.deleteAll(e),this.drawingsManager.deleteAll(e),this.definedNameManager.deleteAll(e)}getDefineNameList(){return this.definedNameManager.getDefineNameList()}getDefineName(e){return this.definedNameManager.getDefineName(e)}setDefineName(e,t){return this.definedNameManager.setDefineName(e,t)}checkDefineName(e){return this.definedNameManager.checkDefineName(e)}getDrawingList(e){return this.drawingsManager.getDrawingList(e)}addDrawing(...e){for(let t of e)this.drawingsManager.addDrawing(t)}updateDrawing(e,t){this.drawingsManager.updateDrawing(e,t)}deleteDrawing(e){this.drawingsManager.deleteDrawing(e)}getMergeCellList(e){return this.mergeCellManager.getMergeCellList(e)}addMergeCell(e,t=0){e.colCount===1&&e.rowCount===1||(e.sheetId=e.sheetId||this.getCurrentSheetId(),this.mergeCellManager.addMergeCell(e),this.worksheetManager.addMergeCell(e,t))}deleteMergeCell(e){this.mergeCellManager.deleteMergeCell(e)}validateRange(e){return this.rangeMapManager.validateRange(e)}validateDrawing(e){return this.drawingsManager.validateDrawing(e)}validateDefinedName(e){return this.definedNameManager.validateDefinedName(e)}getFilter(e){return this.filterManager.getFilter(e)}addFilter(e){this.filterManager.addFilter(e)}deleteFilter(e){this.filterManager.deleteFilter(e)}updateFilter(e,t){this.filterManager.updateFilter(e,t)}computeViewSize(){let e=pe.get(),t=this.getSheetInfo();if(!t)return;let{width:o,height:s}=e;for(let r=0;r<t.colCount;r++)o+=this.getColWidth(r).len;for(let r=0;r<t.rowCount;r++)s+=this.getRowHeight(r).len;we.set({width:o,height:s})}getNextSheetId(e){let t=e||this.getCurrentSheetId(),o=this.getSheetList(),s=o.findIndex(n=>n.sheetId===t);if(s<0)return"";let r=s===o.length-1,i=r?(s-1+o.length)%o.length:(s+1)%o.length;for(;i!==s&&o[i].isHide;)i=r?(i-1+o.length)%o.length:(i+1)%o.length;return o[i].sheetId}};export{Ae as a,N as b};
//# sourceMappingURL=chunk-UCTA4TDE.js.map
