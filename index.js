/* 
MIT License

Copyright (c) 2020 Steve Xu

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
 
*/(function (global, factory) {
            typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :
            typeof define === 'function' && define.amd ? define(['exports'], factory) :
              (global = global || self, factory(global.excel = {}));
       })(this, (function (exports) { 'use strict';
"use strict";var __export__=(()=>{var at=Object.defineProperty;var Jo=Object.getOwnPropertyDescriptor;var Xo=Object.getOwnPropertyNames;var qo=Object.prototype.hasOwnProperty;var Zo=(o,e)=>{for(var t in e)at(o,t,{get:e[t],enumerable:!0})},Qo=(o,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Xo(e))!qo.call(o,n)&&n!==t&&at(o,n,{get:()=>e[n],enumerable:!(r=Jo(e,n))||r.enumerable});return o};var er=o=>Qo(at({},"__esModule",{value:!0}),o);var In={};Zo(In,{initExcel:()=>En});function R(o=window.devicePixelRatio){return Math.max(Math.floor(o||1),1)}function S(o){return Math.floor(o*R())}function re(){return 1}function j(){return navigator.userAgent.indexOf("Mac OS X")>-1}var Y=11,W="#333333",Mt="#ff0000";var de="sans-serif",At=[6,8,9,10,Y,12,14,16,18,20,22,24,26,28,36,48,72];function ue(o="normal",e="normal",t=12,r=""){let n=`${o} ${e} ${t}px `;return r?`${n}${r},${de}`:n+de}var Ie=ue(void 0,"500",S(Y));function Ot(o){let e="";return o.fontColor&&(e+=`color:${o.fontColor};`),o.fillColor&&(e+=`background-color:${o.fillColor};`),o.fontSize&&(e+=`font-size:${o.fontSize}pt;`),o.fontFamily&&(e+=`font-family:${o.fontFamily};`),o.isItalic&&(e+="font-style:italic;"),o.isBold&&(e+="font-weight:700;"),o.isWrapText&&(e+="white-space:normal;"),o.underline&&(e+="text-decoration:underline;",o.underline===2?e+="text-decoration-style: double;":e+="text-decoration-style: single;"),e}function tr(o,e){let{color:t,backgroundColor:r,fontSize:n,fontFamily:i,fontStyle:s,fontWeight:a,whiteSpace:l,textDecoration:c}=o,d={};if(t&&(d.fontColor=t),r&&(d.fillColor=r),n){let g=parseInt(n,10);isNaN(g)||(d.fontSize=g)}return i&&(d.fontFamily=i),s==="italic"&&(d.isItalic=!0),a&&["700","800","900","bold"].includes(a)&&(d.isBold=!0),l&&["normal","pre-wrap","pre-line","break-spaces","revert","unset"].includes(l)&&(d.isWrapText=!0),c==="underline"&&(d.underline=1,e.includes("text-underline-style:double")&&(d.underline=2)),d}function lt(o,e){for(let t of o){if(!t.sheet?.cssRules)continue;let r=t.textContent||"";for(let n of t.sheet?.cssRules)if(n instanceof CSSStyleRule&&n.selectorText===e){let i=r.indexOf(e),s=i;for(;r[s]!=="}"&&s<r.length;)s++;let a="";return i>=0&&(a=r.slice(i+e.length,s).replace(/\s/g,"")),tr(n.style,a)}}return{}}function z(o,e="assert error",t="production"){if(!o){if(t!=="test"&&window.alert(e),t==="production"){console.error(e);return}throw new Error(e)}}var Ft="Sheet",q=200,Z=30;var ne=30,ct=200,ke=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],Te=256,Dt=new Set(["#ERROR!","#DIV/0!","#NULL!","#NUM!","#REF!","#VALUE!","#N/A","#NAME?"]),Ht={sheetList:[],currentSheetId:"",isCellEditing:!1,activeCell:{value:"",style:{},row:0,col:0,left:-999,top:-999,width:0,height:0},fontFamilyList:[],contextMenuPosition:void 0,sheetBarContextMenuLeft:void 0,isSheetNameEditing:!1};function Ne(o){if(typeof o=="number"&&!window.isNaN(o))return!0;if(typeof o!="string")return!1;let e=parseFloat(o);return!window.isNaN(e)}function or(o){return Ne(o)?Number(o):0}function Pt(o){let e=[];for(let t=0;t<o.length;t++){let r=or(o[t]);window.isNaN(r)||e.push(r)}return e}function rr(o=[]){let e=o.map(t=>Ne(t)?parseInt(t,10):0).filter(t=>!isNaN(t));return Math.max(Math.max(...e),0)}function Vt(o=[]){let e=rr(o.map(t=>t.sheetId))+1;return{name:`${Ft}${e}`,sheetId:String(e)}}function Ut(){return!1}function zt(o=""){let e=o.toUpperCase(),t=0;for(let r=0;r<e.length;r++)t=e.charCodeAt(r)-64+t*26;return t-1}function Re(o){let e=o+1,t="",r=Math.floor(Math.abs(e)),n;for(;r>0;)n=(r-1)%26,t=String.fromCharCode(65+n)+t,r=Math.floor((r-n)/26);return t.toUpperCase()}function _t(o){let e=parseInt(o,10);return window.isNaN(e)?e=-1:e=Math.max(e-1,-1),e}function D(...o){let e="";for(let t of o)if(typeof t=="string"&&t&&(e+=`${t} `),typeof t=="object")for(let r of Object.keys(t))t[r]&&(e+=`${r} `);return e.trim()}function Bt(o){return ht(o)&&dt(o)}function ht(o){return o.col===o.rowCount&&o.rowCount===0}function dt(o){return o.row===o.colCount&&o.colCount===0}function Wt(o,e){return!o||!e?!1:o.col===e.col&&o.row===e.row&&o.colCount===e.colCount&&o.rowCount===e.rowCount&&o.sheetId===e.sheetId}var H=class o{row=0;col=0;colCount=0;rowCount=0;sheetId="";constructor(e,t,r,n,i){this.row=e,this.col=t,this.colCount=n,this.rowCount=r,this.sheetId=i}isValid(){return this.row>=0&&this.col>=0&&this.colCount>=0&&this.rowCount>=0}static makeRange(e){return new o(e.row,e.col,e.rowCount,e.colCount,e.sheetId)}};var nr=o=>o>="a"&&o<="z"||o>="A"&&o<="Z",ir=o=>o>="0"&&o<="9";function sr(o){return o}function $t(o,e=sr){if(typeof o!="string"||!o)return null;let t=o.trim(),[r,n=""]=t.split("!");t.includes("!")||(r="",n=t);let i=0,s="",a="";for(n[i]==="$"&&i++;nr(n[i]);)a+=n[i++];for(n[i]==="$"&&i++;ir(n[i]);)s+=n[i++];if(i!==n.length||!s&&!a)return null;let l=1,c=1,d=0,g=0;return s===""?(c=0,l=q):d=_t(s),a===""?(c=Z,l=0):g=zt(a),d===-1||g===-1?null:new H(d,g,l,c,e(r))}function Kt(o,e){if(o.sheetId!==e.sheetId)return null;let t=Math.abs(o.row-e.row)+1,r=Math.abs(o.col-e.col)+1,n=o.row<e.row?o.row:e.row,i=o.col<e.col?o.col:e.col;return new H(n,i,t,r,o.sheetId)}var ie=class o{namespace;static colorMap=new Map;static enableMap=new Map([]);constructor(e){this.namespace=e}init=()=>(this.setColor(),this.log);log=(...e)=>{if(!this.enable())return;let{namespace:t}=this,r=o.colorMap.get(t),n=[`%c ${t}:`,`color:${r};`,...e];console.log(...n)};getRandomColor=()=>{let e=Math.floor(Math.random()*ke.length);return z(e>=0&&e<ke.length,String(e)),ke[e]};enable(){return this.checkEnable()&&o.enableMap.get(this.namespace)!==!1}checkEnable(e=window.localStorage){return e.getItem("debug")==="*"}setColor(){o.colorMap.has(this.namespace)||o.colorMap.set(this.namespace,this.getRandomColor())}},Le=new ie("react").init(),Me=new ie("controller").init(),si=new ie("canvas").init(),Gt=new ie("model").init();function ar(o=document.body){let e="monospace",t="serif",r=document.createElement("span");r.innerHTML="\u6D4B\u8BD5a11",r.style.cssText=["position:absolute","width:auto","font-size:128px","left:-99999px"].join(" !important;");let n=function(c){r.style.fontFamily=c,o.appendChild(r);let d=r.clientWidth;return o.removeChild(r),d},i=n(e),s=n(t),a=n(de);return function(c){return i!==n(`${c},${e}`)||a!==n(`${c},${de}`)||s!==n(`${c},${t}`)}}var Ae=ar();var M="text/plain",_="text/html";function lr(o){let e=o.hasAttribute("readonly");return e||o.setAttribute("readonly",""),o.select(),o.setSelectionRange(0,o.value.length),e||o.removeAttribute("readonly"),o.value}function cr(o){let e=document.documentElement.getAttribute("dir")==="rtl",t=document.createElement("textarea");t.style.fontSize="12pt",t.style.border="0",t.style.padding="0",t.style.margin="0",t.style.position="absolute",t.style[e?"right":"left"]="-9999px";let r=window.pageYOffset||document.documentElement.scrollTop;return t.style.top=`${r}px`,t.setAttribute("readonly",""),t.value=o,t}function jt(o){let e={},t=Object.keys(o);for(let n of t)e[n]=new Blob([o[n]],{type:n});let r=[new ClipboardItem(e)];return navigator.clipboard.write(r)}async function hr(){let o={[_]:"",[M]:""},e=await navigator.clipboard.read();for(let t of e){if(t.types.includes(M)){let r=await t.getType(M);o[M]=await r.text()}if(t.types.includes(_)){let r=await t.getType(_);o[_]=await r.text()}}return o}var Yt=(o,e,t)=>{let r=cr(o);e.appendChild(r);let n=lr(r);return document.execCommand(t),r.remove(),n};async function Jt(o){try{return await jt(o),o[M]}catch(e){return console.error(e),Yt(o[M],document.body,"copy")}}async function Xt(o){try{return await jt(o),o[M]}catch(e){return console.error(e),Yt(o[M],document.body,"cut")}}async function qt(){try{return hr()}catch(o){console.error(o);let e=await navigator.clipboard.readText();return{[_]:"",[M]:e}}}function Zt(o,e){return`<html
  xmlns:v="urn:schemas-microsoft-com:vml"
  xmlns:o="urn:schemas-microsoft-com:office:office"
  xmlns:x="urn:schemas-microsoft-com:office:excel"
  xmlns="http://www.w3.org/TR/REC-html40"
>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="ProgId" content="Excel.Sheet" />
    <meta name="Generator" content="Microsoft Excel 15" />
    <style>
       {
        mso-displayed-decimal-separator: '.';
        mso-displayed-thousand-separator: ',';
      }
      @page {
        margin: 0.75in 0.7in 0.75in 0.7in;
        mso-header-margin: 0.3in;
        mso-footer-margin: 0.3in;
      }
      .font5 {
        color: windowtext;
        font-size: 9pt;
        font-weight: 400;
        font-style: normal;
        text-decoration: none;
        font-family: \u7B49\u7EBF;
        mso-generic-font-family: auto;
        mso-font-charset: 134;
      }
      tr {
        mso-height-source: auto;
        mso-ruby-visibility: none;
      }
      col {
        mso-width-source: auto;
        mso-ruby-visibility: none;
      }
      br {
        mso-data-placement: same-cell;
      }
      td {
        padding-top: 1px;
        padding-right: 1px;
        padding-left: 1px;
        mso-ignore: padding;
        color: black;
        font-size: 11pt;
        font-weight: 400;
        font-style: normal;
        text-decoration: none;
        font-family: \u7B49\u7EBF;
        mso-generic-font-family: auto;
        mso-font-charset: 134;
        mso-number-format: General;
        text-align: general;
        vertical-align: middle;
        border: none;
        mso-background-source: auto;
        mso-pattern: auto;
        mso-protection: locked visible;
        white-space: nowrap;
        mso-rotate: 0;
      }
      ${o}
      ruby {
        ruby-align: left;
      }
      rt {
        color: windowtext;
        font-size: 9pt;
        font-weight: 400;
        font-style: normal;
        text-decoration: none;
        font-family: \u7B49\u7EBF;
        mso-generic-font-family: auto;
        mso-font-charset: 134;
        mso-char-type: none;
        display: none;
      }
    </style>
  </head>

  <body link="#0563C1" vlink="#954F72">
    <table
      border="0"
      cellpadding="0"
      cellspacing="0"
      width="103"
      style="border-collapse: collapse; width: 77pt"
    >
      <col
        width="103"
        style="mso-width-source: userset; mso-width-alt: 3515; width: 77pt"
      />
      ${e}
    </table>
  </body>
</html>`}var Qt=o=>{let e;return(...t)=>{cancelAnimationFrame(e),e=requestAnimationFrame(()=>{o(...t)})}};function se(o,e,t){let r=o==null?void 0:e.replace(/\[/g,".").replace(/\]/g,"").split(".").reduce((n,i)=>n==null?n:n[i],o);return r===void 0?t:r}function A(o){let e=o||{};return[Object,Array].includes(e.constructor)&&!Object.entries(e).length}function ae(o,e,t){return o==null||typeof o!="object"||e.replace(/\[/g,".").replace(/\]/g,"").split(".").reduce((r,n,i,s)=>(i===s.length-1?r[n]=t:r[n]==null&&(r[n]={}),r[n]),o),o}var dr={smallFont:"10px",font:"12px",largeFont:"14px",padding:"12px",lineHeight:"1.5",mediumPadding:"8px",borderRadius:"4px",tinyPadding:"4px"},eo=dr;var ur={primaryColor:"#217346",buttonActiveColor:"rgb(198,198,198)",selectionColor:"rgba(198,198,198,0.3)",backgroundColor:"#e6e6e6",white:"#ffffff",black:"#000000",gridStrokeColor:"#d4d4d4",triangleFillColor:"#b4b4b4",contentColor:W,borderColor:"#cccccc",activeBorderColor:"#808080",disabledColor:"#ccc"},to=ur;var k={...eo,...to};var Oe="QUERY_ALL_LOCAL_FONT",Fe="LOCAL_FONT_KEY",oo=["\u7B49\u7EBF","\u7B49\u7EBF Light","\u65B9\u6B63\u8212\u4F53","\u65B9\u6B63\u59DA\u4F53","\u4EFF\u5B8B","\u9ED1\u4F53","\u534E\u6587\u5F69\u4E91","\u534E\u6587\u4EFF\u5B8B","\u534E\u6587\u7425\u73C0","\u534E\u6587\u6977\u4F53","\u534E\u6587\u96B6\u4E66","\u534E\u6587\u5B8B\u4F53","\u534E\u6587\u7EC6\u9ED1","\u534E\u6587\u65B0\u9B4F","\u534E\u6587\u884C\u6977","\u534E\u6587\u4E2D\u5B8B","\u6977\u4F53","\u96B6\u4E66","\u5B8B\u4F53","\u5FAE\u8F6F\u96C5\u9ED1","\u5FAE\u8F6F\u96C5\u9ED1 Light","\u65B0\u5B8B\u4F53","\u5E7C\u5706","Arial","Arial Narrow","Cascadia Code","Cascadia Code ExtraLight","Cascadia Code Light","Cascadia Code PL","Cascadia Code PL ExtraLight","Cascadia Code PL Light","Cascadia Code PL SemiBold","Cascadia Code SemiBold","Cascadia Mono","Cascadia Mono ExtraLight","Cascadia Mono Light","Cascadia Mono PL","Cascadia Mono PL ExtraLight","Cascadia Mono PL Light","Cascadia Mono PL SemiBold","Cascadia Mono SemiBold","Microsoft JhengHei","Microsoft JhengHei Light","Microsoft JhengHei UI","Microsoft JhengHei UI Light","Microsoft New Tai Lue","Microsoft PhagsPa","Microsoft Sans Serif","Microsoft Tai Le","Microsoft Yahei UI","Microsoft YaHei UI Light","Microsoft Yi Baiti","SimSun-ExtB","Times New Roman","Yu Gothic Light","Yu Gothic Medium","Yu Gothic Regular","Yu Gothic UI Light","Yu Gothic UI Regular","Yu Gothic UI Semibold"];function De(o,e){let t=e.getDomRect(),r=e.getScroll(),n=e.getSheetInfo(e.getCurrentSheetId()),i=e.getHeaderSize(),{pageX:s,pageY:a}=o,l=s-t.left,c=a-t.top,d=i.width,g=i.height,h=r.row,p=r.col;for(;d+e.getColWidth(p)<=l;)d+=e.getColWidth(p),p++;for(;g+e.getRowHeight(h)<=c;)g+=e.getRowHeight(h),h++;return h>=n.rowCount||p>=n.colCount?null:{...e.getCellSize(h,p),row:h,col:p,pageY:a,pageX:s,x:l,y:c}}function pr(o,e){return Le("createElement"),document.createElement(o,e)}function mr(o,e,t){return Le("createElementNS"),document.createElementNS(o,e,t)}function fr(o){return Le("createTextNode"),document.createTextNode(o)}function gr(o,e,t){o.insertBefore(e,t)}function Cr(o,e){o.removeChild(e)}function yr(o,e){o.appendChild(e)}function xr(o){return o.parentNode}function br(o){return o.nextSibling}function Sr(o,e){o.textContent=e}function vr(o){return o.nodeType===1}var He={createElement:pr,createElementNS:mr,createTextNode:fr,insertBefore:gr,removeChild:Cr,appendChild:yr,parentNode:xr,nextSibling:br,setTextContent:Sr,isElement:vr};var wr="http://www.w3.org/2000/svg";function ro(o){if(o.data.ns=wr,o.data?.props?(o.data.attrs=Object.assign(o.data.props||{},o.data?.attrs||{}),o.data.props=void 0):o.data.attrs={},o.data.attrs.class=o.data.className||"",o.data.className=void 0,o.children)for(let e of o.children)e&&ro(e)}function x(o,e,...t){let r=e.key===void 0?void 0:e.key,n={hook:e.hook,style:e.style,key:e.key,className:e.className},i=[],s=[],a=t||[];for(let d of a)if(typeof d=="string"||typeof d=="number"){let g=String(d);g&&s.push(g)}else d&&typeof d=="object"&&i.push(d);let l=Object.keys(e);for(let d of l){if(["className","style","key","ns","is"].includes(d))continue;let g=e[d];d.startsWith("data-")?(n.dataset||(n.dataset={}),n.dataset[d.slice(5)]=g):d.startsWith("on")?(n.on||(n.on={}),n.on[d.slice(2)]=g):(n.props||(n.props={}),n.props[d]=g)}let c={sel:o,data:n,key:r,elm:void 0,children:[],text:void 0};if(s.length>0&&i.length>0)throw new Error("error node");return s.length>0&&(c.text=s.join(" ")),i.length>0&&(c.children=i),c.sel==="svg"&&ro(c),c}function no(o){return o===void 0}function V(o){return o!==void 0}var io=x("",{});function pe(o,e){let t=o.key===e.key,r=o.data?.is===e.data?.is,n=o.sel===e.sel,i=!o.sel&&o.sel===e.sel?typeof o.text==typeof e.text:!0;return n&&t&&r&&i}function Er(o,e){return o.isElement(e)}function Ir(o,e,t){let r={};for(let n=e;n<=t;++n){let i=o[n]?.key;i!==void 0&&(r[i]=n)}return r}var kr=["create","update","remove","destroy","pre","post"];function so(o,e){let t={create:[],update:[],remove:[],destroy:[],pre:[],post:[]},r=e!==void 0?e:He;for(let h of kr)for(let p of o){let m=p[h];m!==void 0&&t[h].push(m)}function n(h,p){return function(){if(--p===0){let u=r.parentNode(h);r.removeChild(u,h)}}}function i(h,p){let m,u=h.data;if(u!==void 0){let C=u.hook?.init;C&&(C(h),u=h.data)}let f=h.children,y=h.sel;if(y!==void 0){let C=h.elm=V(u)&&V(m=u.ns)?r.createElementNS(m,y,u):r.createElement(y,u);for(m=0;m<t.create.length;++m)t.create[m](io,h);if(Array.isArray(f)&&f.length>0)for(m=0;m<f.length;++m){let w=f[m];w!=null&&r.appendChild(C,i(w,p))}else(typeof h.text=="string"||typeof h.text=="number")&&r.appendChild(C,r.createTextNode(h.text));let b=h.data.hook;V(b)&&(b.create?.(io,h),b.insert&&p.push(h))}else h.elm=r.createTextNode(h.text);return h.elm}function s(h,p,m,u,f,y){for(;u<=f;++u){let C=m[u];C!=null&&r.insertBefore(h,i(C,y),p)}}function a(h){let p=h.data;if(p!==void 0){p?.hook?.destroy?.(h);for(let m=0;m<t.destroy.length;++m)t.destroy[m](h);if(h.children!==void 0)for(let m=0;m<h.children.length;++m){let u=h.children[m];u!=null&&typeof u!="string"&&a(u)}}}function l(h,p,m,u){for(;m<=u;++m){let f,y,C=p[m];if(C!=null)if(V(C.sel)){a(C),f=t.remove.length+1,y=n(C.elm,f);for(let w=0;w<t.remove.length;++w)t.remove[w](C,y);let b=C?.data?.hook?.remove;V(b)?b(C,y):y()}else C.children?(a(C),l(h,C.children,0,C.children.length-1)):r.removeChild(h,C.elm)}}function c(h,p,m,u){let f=0,y=0,C=p.length-1,b=p[0],w=p[C],I=m.length-1,E=m[0],O=m[I],F,G,we,Lt;for(;f<=C&&y<=I;)b==null?b=p[++f]:w==null?w=p[--C]:E==null?E=m[++y]:O==null?O=m[--I]:pe(b,E)?(d(b,E,u),b=p[++f],E=m[++y]):pe(w,O)?(d(w,O,u),w=p[--C],O=m[--I]):pe(b,O)?(d(b,O,u),r.insertBefore(h,b.elm,r.nextSibling(w.elm)),b=p[++f],O=m[--I]):pe(w,E)?(d(w,E,u),r.insertBefore(h,w.elm,b.elm),w=p[--C],E=m[++y]):(F===void 0&&(F=Ir(p,f,C)),G=F[E.key],no(G)?r.insertBefore(h,i(E,u),b.elm):(we=p[G],we.sel!==E.sel?r.insertBefore(h,i(E,u),b.elm):(d(we,E,u),p[G]=void 0,r.insertBefore(h,we.elm,b.elm))),E=m[++y]);y<=I&&(Lt=m[I+1]==null?null:m[I+1].elm,s(h,Lt,m,y,I,u)),f<=C&&l(h,p,f,C)}function d(h,p,m){let u=p.data?.hook;u?.prePatch?.(h,p);let f=p.elm=h.elm;if(h===p)return;if(p.data!==void 0||V(p.text)&&p.text!==h.text){p.data??={},h.data??={};for(let b=0;b<t.update.length;++b)t.update[b](h,p);p.data?.hook?.update?.(h,p)}let y=h.children,C=p.children;no(p.text)?V(y)&&V(C)?y!==C&&c(f,y,C,m):V(C)?(V(h.text)&&r.setTextContent(f,""),s(f,null,C,0,C.length-1,m)):V(y)?l(f,y,0,y.length-1):V(h.text)&&r.setTextContent(f,""):h.text!==p.text&&(V(y)&&l(f,y,0,y.length-1),r.setTextContent(f,p.text)),u?.postPatch?.(h,p),u?.ref&&u?.ref(p.elm)}function g(h,p){let m,u,f,y=[];for(m=0;m<t.pre.length;++m)t.pre[m]();if(Er(r,h))return i(p,y),r.appendChild(h,p.elm),p;for(pe(h,p)?d(h,p,y):(u=h.elm,f=r.parentNode(u),i(p,y),f!==null&&(r.insertBefore(f,p.elm,r.nextSibling(u)),l(f,[h],0,0))),m=0;m<y.length;++m)y[m].data.hook.insert(y[m]);for(m=0;m<t.post.length;++m)t.post[m]();return p}return g}var Tr="http://www.w3.org/1999/xlink",Nr="http://www.w3.org/XML/1998/namespace",ao=58,Rr=120;function lo(o,e){let t,r=e.elm,n=o.data.attrs,i=e.data.attrs;if(!(!n&&!i)&&n!==i){n=n||{},i=i||{};for(t in i){let s=i[t];n[t]!==s&&(s===!0?r.setAttribute(t,""):s===!1?r.removeAttribute(t):t.charCodeAt(0)!==Rr?r.setAttribute(t,s):t.charCodeAt(3)===ao?r.setAttributeNS(Nr,t,s):t.charCodeAt(5)===ao?r.setAttributeNS(Tr,t,s):r.setAttribute(t,s))}for(t in n)t in i||r.removeAttribute(t)}}var co={create:lo,update:lo};function ho(o,e){let t=e.elm,r=o.data.className,n=e.data.className;r!==n&&(t.className=n||"")}var uo={create:ho,update:ho};var Pe=/[A-Z]/g;function po(o,e){let t=e.elm,r=o.data.dataset,n=e.data.dataset,i;if(!r&&!n||r===n)return;r=r||{},n=n||{};let s=t.dataset;for(i in r)n[i]||(s?i in s&&delete s[i]:t.removeAttribute("data-"+i.replace(Pe,"-$&").toLowerCase()));for(i in n)r[i]!==n[i]&&(s?s[i]=n[i]:t.setAttribute("data-"+i.replace(Pe,"-$&").toLowerCase(),n[i]))}var mo={create:po,update:po};function fo(o,e,t){if(typeof o=="function"){let r=t||{};o.call(e,r,e)}else if(typeof o=="object")for(let r=0;r<o.length;r++)fo(o[r],e,t)}function Lr(o,e){let t=o.type,r=e.data?.on;r&&r[t]&&fo(r[t],e,o)}function Mr(){return function o(e){Lr(e,o.vNode)}}function ut(o,e){let t=o.data?.on,r=o.listener,n=o.elm,i=e?.data?.on,s=e&&e.elm,a;if(t!==i){if(t&&r)if(i)for(a in t)i[a]||n.removeEventListener(a,r,!1);else for(a in t)n.removeEventListener(a,r,!1);if(i){let l=e.listener=o.listener||Mr();if(l.vNode=e,t)for(a in i)t[a]||s.addEventListener(a,l,!1);else for(a in i)s.addEventListener(a,l,!1)}}}var go={create:ut,update:ut,destroy:ut};function Co(o,e){let t,r,n,i=e.elm,s=o.data.props,a=e.data.props;if(!(!s&&!a)&&s!==a){s=s||{},a=a||{};for(t in a)r=a[t],n=s[t],n!==r&&(t!=="value"||i[t]!==r)&&(i[t]=r)}}var yo={create:Co,update:Co};var xo=o=>o.replace(Pe,"-$&").toLowerCase();function bo(o,e){let t,r=e.elm,n=o.data.style,i=e.data.style;if(!(!n&&!i)&&n!==i){n=n||{},i=i||{};for(t in n)i[t]||(t.slice(0,2)==="--"?r.style.removeProperty(t):r.style[xo(t)]="");for(t in i)if(i[t]!==n[t])if(t.slice(0,2)==="--")r.style.setProperty(t,i[t]);else{let s=xo(t),a=i[t];typeof a=="number"?r.style[s]=a+"px":r.style[s]=a}}}var So={create:bo,update:bo};var vo=so([co,uo,mo,go,yo,So],He);function wo(o,e){let t=o,r;return t.vDom?r=vo(t.vDom,e):r=vo(t,e),t.vDom=r,r}var Eo=new Map;function Ar(o,e){let t=`${e}__${o.font}`,r=Eo.get(t);if(!r){let{actualBoundingBoxDescent:n,actualBoundingBoxAscent:i,width:s}=o.measureText(e),a={width:Math.ceil(s/R()),height:Math.ceil((n+i)/R())};Eo.set(t,a),r=a}return r}function L(o,e,t,r,n){o.fillRect(S(e),S(t),S(r),S(n))}function le(o,e,t,r,n){o.strokeRect(S(e),S(t),S(r),S(n))}function ko(o,e,t,r,n){o.clearRect(S(e),S(t),S(r),S(n))}function me(o,e,t,r){o.fillText(e,S(t),S(r))}function Or(o){let e=String(o);return typeof o=="boolean"||["TRUE","FALSE"].includes(e.toUpperCase())?e=e.toUpperCase():o==null&&(e=""),e}function Ve(o,e){let{style:t,value:r,left:n,top:i,width:s,height:a}=e,l=Ne(r),c=Ie,d=W;if(!A(t)){let f=t?.fontSize?t.fontSize:Y;c=ue(t?.isItalic?"italic":"normal",t?.isBold?"bold":"500",S(f),t?.fontFamily),d=t?.fontColor||W,t?.fillColor&&(o.fillStyle=t?.fillColor,L(o,n,i,s,a))}let g=Or(r);Dt.has(g)&&(d=Mt);let h={},p=[...g];if(p.length===0)return h;o.textAlign=l?"right":"left",o.font=c,o.fillStyle=d,o.textBaseline="middle";let m=[];for(let f of p)if(f){let y=Ar(o,f);m.push({...y,char:f})}if(m.length===0)return h;let u=n+(l?s:0);if(t?.underline&&(o.strokeStyle=d),t?.isWrapText){let f=i,y=4;for(let C=0;C<m.length;){let b=s,w=C;for(;C<m.length&&m[C].width<b;)b-=m[C].width,C++;if(w!==C){let I=0,E=[];for(let F=w;F<C;F++)m[F].height>I&&(I=m[F].height),E.push(m[F].char);h.fontSizeHeight=Math.max(h.fontSizeHeight||0,I),f=f+Math.floor(I/2)+y;let O=E.join("");if(me(o,O,u,f),t?.underline){let F=Math.floor(f+I/2),G=[];l?G=[[n,F],[n+s,F]]:G=[[u,F],[u+s,F]],Io(o,G,t?.underline)}f=f+Math.floor(I/2)}}f+=y,h.wrapHeight=f-i}else{let f=Math.max(...m.map(E=>E.height),0);h.fontSizeHeight=f;let y=Math.max(0,Math.floor(a-f)/2),C=Math.floor(i+f/2+y),b=0,w=[],I=s;for(let E=0;E<m.length;E++)m[E].width<I&&(I-=m[E].width,w.push(m[E].char),b+=m[E].width);if(me(o,w.join(""),u,C),t?.underline){let E=Math.floor(C+f/2),O=[];l?O=[[n,E],[n+b,E]]:O=[[u,E],[u+b,E]],Io(o,O,t?.underline)}}return h}function $(o,e){z(e.length>0),o.beginPath();for(let t=0;t<e.length;t+=2){let r=e[t],n=e[t+1];o.moveTo(S(r[0]),S(r[1])),o.lineTo(S(n[0]),S(n[1]))}o.stroke()}function To(o,e,t,r){o.beginPath(),o.moveTo(S(e[0]),S(e[1])),o.lineTo(S(t[0]),S(t[1])),o.lineTo(S(r[0]),S(r[1])),o.fill()}function No(o,e,t,r,n){let i=o.getLineDash();o.setLineDash([S(8),S(6)]);let s=R()/2;le(o,e+s,t+s,r-s*2,n-s*2),o.setLineDash(i)}function Io(o,e,t){let[r,n]=e,i=R(),s=[[r[0],r[1]-i],[n[0],n[1]-i]];if(t===2){let a=i*2;s.push([r[0],r[1]-a],[n[0],n[1]-a])}$(o,s)}function Ue(o,e,t){o.style.width=e+"px",o.style.height=t+"px";let r=S(e),n=S(t);o.width=r,o.height=n}var fe=class{ctx;content;canvas;controller;constructor(e,t){let r=e.getMainDom().canvas;this.canvas=r,this.controller=e,this.ctx=r.getContext("2d"),this.content=t;let n=R();this.ctx.scale(n,n)}resize(){let{width:e,height:t}=this.controller.getDomRect();Ue(this.canvas,e,t),this.content.resize()}clear(){let{width:e,height:t}=this.controller.getDomRect();this.ctx.clearRect(0,0,S(e),S(t))}render=e=>{if(e.changeSet.size===0)return;this.content.render(e),this.clear(),this.ctx.drawImage(this.content.getCanvas(),0,0);let t=this.renderSelection();this.renderAntLine(t)};renderAntLine(e){let{controller:t}=this,r=t.getCopyRanges();if(r.length===0)return;let[n]=r;n.sheetId===t.getCurrentSheetId()&&(this.ctx.strokeStyle=k.primaryColor,this.ctx.lineWidth=R(),No(this.ctx,e.left,e.top,e.width,e.height))}renderSelection(){let{controller:e}=this,t=e.getActiveCell();return Bt(t)?this.renderSelectAll():dt(t)?this.renderSelectCol():ht(t)?this.renderSelectRow():this.renderSelectRange()}renderActiveCell(){let{controller:e}=this,t=e.getCell(e.getActiveCell()),r=e.computeCellPosition(t.row,t.col);ko(this.ctx,r.left,r.top,r.width,r.height),Ve(this.ctx,{...t,...r})}renderSelectRange(){let{controller:e}=this,t=e.getHeaderSize(),r=e.getActiveCell(),n=e.computeCellPosition(r.row,r.col),i=r.row+r.rowCount-1,s=r.col+r.colCount-1,a=e.computeCellPosition(i,s),l=a.left+a.width-n.left,c=a.top+a.height-n.top;this.ctx.fillStyle=k.selectionColor,L(this.ctx,n.left,0,l,t.height),L(this.ctx,0,n.top,t.width,c);let d=r.rowCount>1||r.colCount>1;d&&L(this.ctx,n.left,n.top,l,c),this.ctx.strokeStyle=k.primaryColor,this.ctx.lineWidth=R();let g=[[n.left,t.height],[n.left+l,t.height]];return g.push([t.width,n.top],[t.width,n.top+c]),$(this.ctx,g),d&&this.renderActiveCell(),le(this.ctx,n.left,n.top,l,c),{left:n.left,top:n.top,width:l,height:c}}renderSelectAll(){let{controller:e}=this,{width:t,height:r}=this.controller.getDomRect();this.ctx.fillStyle=k.selectionColor,L(this.ctx,0,0,t,r);let n=e.getHeaderSize();return this.ctx.strokeStyle=k.primaryColor,this.ctx.lineWidth=R(),this.renderActiveCell(),le(this.ctx,n.width,n.height,t-n.width,r-n.height),{left:n.width,top:n.height,width:t-n.width,height:r-n.height}}renderSelectCol(){let{controller:e}=this,t=e.getHeaderSize(),r=e.getActiveCell(),{height:n}=e.getDomRect();this.ctx.fillStyle=k.selectionColor;let i=e.computeCellPosition(r.row,r.col);L(this.ctx,i.left,0,i.width,t.height),L(this.ctx,0,i.top,t.width,n),L(this.ctx,i.left,i.top+i.height,i.width,n-i.height),this.ctx.strokeStyle=k.primaryColor,this.ctx.lineWidth=R();let s=[[t.width,t.height],[t.width,n-t.height]];return $(this.ctx,s),le(this.ctx,i.left,i.top,i.width,n),{left:i.left,top:i.top,width:i.width,height:n}}renderSelectRow(){let{controller:e}=this,t=e.getHeaderSize(),r=e.getActiveCell(),{width:n}=e.getDomRect();this.ctx.fillStyle=k.selectionColor;let i=e.computeCellPosition(r.row,r.col);L(this.ctx,i.left,0,n,t.height),L(this.ctx,0,i.top,t.width,i.height),L(this.ctx,i.left+i.width,i.top,n-i.width,i.height),this.ctx.strokeStyle=k.primaryColor,this.ctx.lineWidth=R();let s=[[i.left,t.height],[n-t.width,t.height]];return $(this.ctx,s),le(this.ctx,i.left,i.top,n,i.height),{left:i.left,top:i.top,width:n,height:i.height}}};function _e(o,e,t){let r=o.getScroll(),{row:n,col:i}=r;if(r.top!==t){n=0;let s=t;for(;s>0;){let a=o.getRowHeight(n);if(a>s)break;s-=a,n++}}if(r.left!==e){i=0;let s=e;for(;s>0;){let a=o.getColWidth(i);if(a>s)break;s-=a,i++}}return{row:n,col:i}}function ge(o,e,t){let r=o.getHeaderSize(),n=o.getDomRect(),i=o.getViewSize(),s=i.height-n.height+ct,a=i.width-n.width+ct,l=n.height-r.height-ne*1.5,c=n.width-r.width-ne*1.5,d=Math.floor(t*l/s),g=Math.floor(e*c/a);return{maxHeight:s,maxWidth:a,maxScrollHeight:l,maxScrollWidth:c,scrollTop:d,scrollLeft:g}}function ce(o,e,t){let r=o.getScroll(),{maxHeight:n,maxWidth:i,maxScrollHeight:s,maxScrollWidth:a}=ge(o,r.left,r.top),l=r.top+Math.ceil(t);l<0?l=0:l>n&&(l=n);let c=r.left+Math.ceil(e);c<0?c=0:c>i&&(c=i);let{row:d,col:g}=_e(o,c,l),h=Math.floor(l*s/n),p=Math.floor(c*a/i);o.setScroll({row:d,col:g,top:l,left:c,scrollTop:h,scrollLeft:p})}function ze(o){let e=o.getActiveCell(),t=o.computeCellPosition(e.row,e.col),r=o.getDomRect(),n=o.getScroll(),i=o.getSheetInfo(o.getCurrentSheetId()),s=o.getHeaderSize(),a=5,{maxHeight:l,maxWidth:c,maxScrollHeight:d,maxScrollWidth:g}=ge(o,n.left,n.top);if(t.left+t.width+a>r.width&&n.col<=i.colCount-2){let h=n.col+1,p=n.left+o.getColWidth(n.col),m=Math.floor(p*g/c);o.setScroll({...n,col:h,left:p,scrollLeft:m})}if(t.left-s.width<r.left+a&&n.col>=1){let h=n.col-1,p=n.left-o.getColWidth(n.col),m=Math.floor(p*g/c);o.setScroll({...n,col:h,left:p,scrollLeft:m})}if(t.top+t.height+a>r.height&&n.row<=i.rowCount-2){let h=n.row+1,p=n.top+o.getRowHeight(n.row),m=Math.floor(p*d/l);o.setScroll({...n,row:h,top:p,scrollTop:m})}if(t.top-s.height<r.top+a&&n.row>=1){let h=n.row-1,p=n.top-o.getRowHeight(n.row),m=Math.floor(p*d/l);o.setScroll({...n,row:h,top:p,scrollTop:m})}}function B(o){let e=o.getMainDom().input;document.activeElement===e&&(o.setCellValues([[e.value]],[],[o.getActiveCell()]),e.value="",e.blur())}var Ro=[{key:"Enter",modifierKey:[],handler:o=>{B(o);let e=o.getActiveCell();o.setActiveCell({row:e.row+1,col:e.col,rowCount:1,colCount:1,sheetId:""})}},{key:"Tab",modifierKey:[],handler:o=>{B(o);let e=o.getActiveCell();o.setActiveCell({row:e.row,col:e.col+1,rowCount:1,colCount:1,sheetId:""})}},{key:"ArrowDown",modifierKey:[j()?"meta":"ctrl"],handler:o=>{B(o);let e=o.getViewSize();ce(o,0,e.height)}},{key:"ArrowUp",modifierKey:[j()?"meta":"ctrl"],handler:o=>{B(o);let e=o.getViewSize();ce(o,0,-e.height)}},{key:"ArrowRight",modifierKey:[j()?"meta":"ctrl"],handler:o=>{B(o);let e=o.getViewSize();ce(o,e.width,0)}},{key:"ArrowLeft",modifierKey:[j()?"meta":"ctrl"],handler:o=>{B(o);let e=o.getViewSize();ce(o,-e.width,0)}},{key:"ArrowDown",modifierKey:[],handler:o=>{B(o);let e=o.getActiveCell();o.setActiveCell({row:e.row+1,col:e.col,rowCount:1,colCount:1,sheetId:""}),ze(o)}},{key:"ArrowUp",modifierKey:[],handler:o=>{B(o);let e=o.getActiveCell();o.setActiveCell({row:e.row-1,col:e.col,rowCount:1,colCount:1,sheetId:""}),ze(o)}},{key:"ArrowRight",modifierKey:[],handler:o=>{B(o);let e=o.getActiveCell();o.setActiveCell({row:e.row,col:e.col+1,rowCount:1,colCount:1,sheetId:""}),ze(o)}},{key:"ArrowLeft",modifierKey:[],handler:o=>{B(o);let e=o.getActiveCell();o.setActiveCell({row:e.row,col:e.col-1,rowCount:1,colCount:1,sheetId:""}),ze(o)}},{key:"b",modifierKey:[j()?"meta":"ctrl"],handler:o=>{let t=o.getCell(o.getActiveCell()).style||{};t.isBold=!t.isBold,o.setCellStyle(t,[o.getActiveCell()])}},{key:"i",modifierKey:[j()?"meta":"ctrl"],handler:o=>{let t=o.getCell(o.getActiveCell()).style||{};t.isItalic=!t.isItalic,o.setCellStyle(t,[o.getActiveCell()])}},{key:"u",modifierKey:[j()?"meta":"ctrl"],handler:o=>{let t=o.getCell(o.getActiveCell()).style||{};t.underline===void 0||t.underline===0?t.underline=1:t.underline=0,o.setCellStyle(t,[o.getActiveCell()])}}];function Be(o){let e=(o?.target?.tagName||"").toLowerCase();return e==="input"||e==="textarea"}var Lo={},Ce=(o,e)=>{Lo[o]=e};function pt(o,e,t){function r(c){let d=Ro.filter(h=>h.key===c.key);d.sort((h,p)=>p.modifierKey.length-h.modifierKey.length);let g=null;for(let h of d)if(h.modifierKey.length>0){if(h.modifierKey.some(p=>c[`${p}Key`])){g=h;break}}else{g=h;break}if(g){c.preventDefault(),g.handler(e);return}if(c.metaKey||c.ctrlKey){console.log(c.key);return}Be(c)||(o.isCellEditing=!0,e.getMainDom().input.focus())}let n=Qt(function(c){c.target===e.getMainDom().canvas&&ce(e,c.deltaX,c.deltaY)});function i(c){Be(c)||(c.preventDefault(),e.paste(c))}function s(c){Be(c)||(c.preventDefault(),e.copy(c))}function a(c){Be(c)||(c.preventDefault(),e.cut(c))}function l(c){if(!c.target)return;let d=Object.values(Lo);for(let g of d)g.dom.contains(c.target)||g.callback(o)}return window.addEventListener("resize",t),window.addEventListener("keydown",r),window.addEventListener("wheel",n),window.addEventListener("mousedown",l),document.body.addEventListener("paste",i),document.body.addEventListener("copy",s),document.body.addEventListener("cut",a),()=>{window.removeEventListener("resize",t),window.removeEventListener("keydown",r),window.removeEventListener("wheel",n),window.removeEventListener("mousedown",l),document.body.removeEventListener("paste",i),document.body.removeEventListener("copy",s),document.body.removeEventListener("cut",a)}}var mt={textAlign:"center",textBaseline:"middle",font:Ie,fillStyle:k.black,lineWidth:re(),strokeStyle:k.gridStrokeColor};var ye=class{canvas;ctx;controller;constructor(e,t){this.controller=e,this.canvas=t;let r=this.canvas.getContext("2d");this.ctx=r;let n=R();this.ctx.scale(n,n)}getCanvas(){return this.canvas}resize(){let{width:e,height:t}=this.controller.getDomRect();Ue(this.canvas,e,t)}clear(){let{width:e,height:t}=this.controller.getDomRect();this.ctx.clearRect(0,0,S(e),S(t))}render({changeSet:e}){if(e.size===0||!e.has("content"))return;let{width:t,height:r}=this.controller.getDomRect(),n=this.controller.getHeaderSize();this.clear();let i=t-n.width,s=r-n.height;this.renderGrid(i,s),this.renderRowsHeader(s),this.renderColsHeader(i),this.renderTriangle(),this.renderContent()}renderContent(){let{controller:e,ctx:t}=this,{width:r,height:n}=e.getDomRect(),i=e.getHeaderSize(),s=e.getCurrentSheetId(),{row:a,col:l}=e.getScroll(),c=i.width,d=l,g=i.height,h=a;for(;;){let u=e.getColWidth(d);if(c+u<r)c+=u,d++;else break}for(;;){let u=e.getRowHeight(h);if(g+u<n)g+=u,h++;else break}let p=h,m=d;t.save(),g=i.height;for(let u=a;u<p;u++){c=i.width;for(let f=l;f<m;f++){let y=e.getCell(new H(u,f,1,1,s));if(A(y.value)&&A(y.style)){c+=e.getColWidth(f);continue}let C=e.getCellSize(u,f),{wrapHeight:b=0,fontSizeHeight:w=0}=Ve(t,{...y,...C,top:g,left:c}),I=Math.max(b,w);I>C.height&&e.setRowHeight(u,I),c+=e.getColWidth(f)}g+=e.getRowHeight(u)}t.restore()}renderTriangle(){if(Ut())return;let e=this.controller.getHeaderSize();this.ctx.save(),this.ctx.fillStyle=k.backgroundColor,L(this.ctx,0,0,e.width,e.height),this.ctx.fillStyle=k.triangleFillColor;let t=2;To(this.ctx,[e.width/2-t,e.height-t],[e.width-t,e.height-t],[e.width-t,t]),this.ctx.restore()}renderGrid(e,t){let{controller:r}=this,n=r.getHeaderSize(),{row:i,col:s}=r.getScroll(),{rowCount:a,colCount:l}=this.controller.getSheetInfo(this.controller.getCurrentSheetId()),c=re();this.ctx.save(),this.ctx.fillStyle=k.white,this.ctx.lineWidth=c,this.ctx.strokeStyle=k.gridStrokeColor,this.ctx.translate(S(n.width),S(n.height));let d=[],g=0,h=0,p=0;for(let u=s;u<l&&(p+=r.getColWidth(u),!(p>e));u++);let m=Math.min(p,e);for(let u=i;u<a&&(d.push([0,g],[m,g]),g+=r.getRowHeight(u),!(g>t));u++);for(let u=s;u<l&&(d.push([h,0],[h,g]),h+=r.getColWidth(u),!(h>m));u++);d.push([0,g],[h,g]),d.push([h,0],[h,g]),$(this.ctx,d),this.ctx.restore()}fillRowText(e,t,r){this.ctx.fillStyle=k.black,me(this.ctx,String(e),t/2,r)}fillColText(e,t,r){this.ctx.fillStyle=k.black,me(this.ctx,e,t,r/2+R())}renderRowsHeader(e){let{controller:t}=this,{row:r}=t.getScroll(),n=t.getHeaderSize(),{rowCount:i}=t.getSheetInfo(t.getCurrentSheetId());this.ctx.save(),this.ctx.fillStyle=k.backgroundColor,L(this.ctx,0,n.height,n.width,e),Object.assign(this.ctx,mt);let s=[],a=n.height,l=r;for(;l<i;l++){let c=t.getRowHeight(l),d=a;if(l===r&&(d+=re()/2),s.push([0,d],[n.width,d]),this.fillRowText(l+1,n.width,d+c/2),a+=c,a>e)break}s.push([0,a],[n.width,a]),s.push([0,0],[0,a]),$(this.ctx,s),this.ctx.restore()}renderColsHeader(e){let{controller:t}=this,{col:r}=t.getScroll(),n=t.getHeaderSize(),{colCount:i}=t.getSheetInfo(t.getCurrentSheetId()),s=[];this.ctx.save(),this.ctx.fillStyle=k.backgroundColor,L(this.ctx,n.width,0,e,n.height),Object.assign(this.ctx,mt);let a=n.width,l=r;for(;l<i;l++){let c=t.getColWidth(l),d=a;if(l===r&&(d+=re()/2),s.push([d,0],[d,n.height]),this.fillColText(Re(l),d+c/2,n.height),a+=c,a>e)break}s.push([a,0],[a,n.height]),s.push([0,0],[a,0]),$(this.ctx,s),this.ctx.restore()}};var Fr=300;function Mo(o,e,t){let r=o.getScroll(),{maxHeight:n,maxScrollHeight:i,maxScrollWidth:s,maxWidth:a}=ge(o,r.left,r.top),l=r.scrollTop+Math.ceil(t),c=r.scrollLeft+Math.ceil(e);l<0?l=0:l>i&&(l=i),c<0?c=0:c>s&&(c=s);let d=Math.floor(n*l/i),g=Math.floor(a*c/s),{row:h,col:p}=_e(o,g,d);o.setScroll({top:d,left:g,row:h,col:p,scrollLeft:c,scrollTop:l})}var We=0,$e=0,Q=0,Ao=0,ft=(o,e)=>{let t=e.getHeaderSize(),r=e.getScroll();function n(l){l.stopPropagation(),Q===1?(We&&Mo(e,0,l.pageY-We),We=l.pageY):Q===2&&($e&&Mo(e,l.pageX-$e,0),$e=l.pageX)}function i(){Q=0,We=0,$e=0,s()}function s(){document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",i)}function a(){document.addEventListener("mousemove",n),document.addEventListener("mouseup",i)}return x("div",{className:"relative canvas-container"},x("canvas",{className:"full canvas-content",hook:{ref(l){let c=l;e.setMainDom({canvas:c})}},oncontextmenu(l){return l.preventDefault(),o.contextMenuPosition={top:l.clientY,left:l.clientX,width:100,height:100},!1},onmousemove(l){let c=e.getHeaderSize(),d=e.getDomRect(),{clientX:g,clientY:h}=l,p=g-d.left,m=h-d.top;if(l.buttons===1&&p>c.width&&m>c.height){let u=De(l,e);if(!u)return;let f=e.getActiveCell();if(f.row===u.row&&f.col===u.col)return;let y=Math.abs(u.col-f.col)+1,C=Math.abs(u.row-f.row)+1;e.setActiveCell({row:Math.min(u.row,f.row),col:Math.min(u.col,f.col),rowCount:C,colCount:y,sheetId:""})}},onmousedown(l){let c=e.getHeaderSize(),d=e.getDomRect(),{timeStamp:g,clientX:h,clientY:p}=l,m=h-d.left,u=p-d.top,f=De(l,e);if(!f)return;if(c.width>m&&c.height>u){e.setActiveCell({row:0,col:0,colCount:0,rowCount:0,sheetId:""});return}if(c.width>m&&c.height<=u){let b=e.getSheetInfo(e.getCurrentSheetId());e.setActiveCell({row:f.row,col:f.col,rowCount:0,colCount:b.colCount,sheetId:""});return}if(c.width<=m&&c.height>u){let b=e.getSheetInfo(e.getCurrentSheetId());e.setActiveCell({row:f.row,col:f.col,rowCount:b.rowCount,colCount:0,sheetId:""});return}let y=e.getActiveCell();if(y.row>=0&&y.row===f.row&&y.col===f.col)g-Ao<Fr&&(o.isCellEditing=!0);else{let b=e.getMainDom().input;if(document.activeElement===b){let I=b.value;e.setCellValues([[I]],[],[e.getActiveCell()]),o.isCellEditing=!1,b.value=""}e.setActiveCell({row:f.row,col:f.col,rowCount:1,colCount:1,sheetId:""})}Ao=g}}),x("div",{className:"vertical-scroll-bar",style:{top:t.height},onmouseleave(){i()},onmousedown(){Q||(Q=1,a())}},x("div",{className:"vertical-scroll-bar-content",style:{height:ne,transform:`translateY(${r.scrollTop}px)`}})),x("div",{className:"horizontal-scroll-bar",style:{left:t.width},onmouseleave(){i()},onmousedown(){Q||(Q=2,a())}},x("div",{className:"horizontal-scroll-bar-content",style:{width:ne,transform:`translateX(${r.scrollLeft}px)`}})))};ft.displayName="CanvasContainer";var T=(o,...e)=>{let{className:t="",onClick:r,disabled:n=!1,active:i=!1,type:s="normal",style:a={},testId:l=void 0,title:c,dataType:d,buttonType:g}=o,h={className:D("button-wrapper",t,{disabled:n,active:i,circle:s==="circle"}),style:a,title:c,"data-testId":l,"data-type":d,type:g};return r&&(h.onclick=r),x("button",h,...e)};T.displayName="Button";var Oo={"transform-origin":"130px 106px"},gt=()=>x("a",{href:"https://github.com/nusr/excel","aria-label":"View source on Github",target:"_blank",rel:"noreferrer",title:"github link"},x("svg",{className:"github-wrapper",viewBox:"0 0 250 250","aria-hidden":!0},x("path",{d:"M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"}),x("path",{d:"M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2",fill:"currentColor",style:Oo}),x("path",{style:Oo,fill:"currentColor",d:"M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"})));gt.displayName="Github";var Dr={alignCenter:["M142.2 227.6h739.6v56.9H142.2zM142.2 568.9h739.6v56.9H142.2zM256 398.2h512v56.9H256zM256 739.6h512v56.9H256z"],alignLeft:["M627.712 788.48c11.305 0 20.48-9.155 20.48-20.48s-9.175-20.48-20.48-20.48H218.46c-11.305 0-20.48 9.155-20.48 20.48s9.175 20.48 20.48 20.48h409.252zM832.86 583.68h-614.4c-11.305 0-20.48 9.155-20.48 20.48s9.175 20.48 20.48 20.48h614.4c11.305 0 20.48-9.155 20.48-20.48s-9.175-20.48-20.48-20.48zM832.86 256h-614.4c-11.305 0-20.48 9.155-20.48 20.48s9.175 20.48 20.48 20.48h614.4c11.305 0 20.48-9.155 20.48-20.48S844.165 256 832.86 256zM218.46 460.8h409.252c11.305 0 20.48-9.155 20.48-20.48s-9.175-20.48-20.48-20.48H218.46c-11.305 0-20.48 9.155-20.48 20.48s9.155 20.48 20.48 20.48z"],alignRight:["M832.86 747.52H423.588a20.48 20.48 0 1 0 0 40.96H832.84a20.48 20.48 0 0 0 0.02-40.96z m20.48-143.36a20.48 20.48 0 0 0-20.48-20.48h-614.4a20.48 20.48 0 1 0 0 40.96h614.4a20.48 20.48 0 0 0 20.48-20.48zM832.86 256h-614.4a20.48 20.48 0 1 0 0 40.96h614.4a20.48 20.48 0 1 0 0-40.96z m0 163.84H423.588a20.48 20.48 0 1 0 0 40.96H832.84a20.48 20.48 0 0 0 0.02-40.96z"],bold:["M724.342857 477.028571c38.4-40 61.942857-94.057143 61.942857-153.485714v-11.657143C786.285714 188.914286 685.6 89.142857 561.485714 89.142857H223.314286c-17.257143 0-31.314286 14.057143-31.314286 31.314286v776.114286c0 18.628571 15.085714 33.714286 33.714286 33.714285h364.228571c133.714286 0 242.057143-107.657143 242.057143-240.571428v-12.571429c0-83.428571-42.742857-156.914286-107.657143-200.114286zM301.714286 198.857143h256.8c65.257143 0 118.057143 50.742857 118.057143 113.485714v10.857143c0 62.628571-52.914286 113.485714-118.057143 113.485714H301.714286V198.857143z m418.971428 490.742857c0 71.885714-59.085714 130.171429-132 130.171429H301.714286V547.085714h286.971428c72.914286 0 132 58.285714 132 130.171429v12.342857z"],fontColor:["M650.496 597.333333H373.504l-68.266667 170.666667H213.333333l256-640h85.333334l256 640h-91.904l-68.266667-170.666667z m-34.133333-85.333333L512 251.093333 407.637333 512h208.725334zM128 853.333333h768v85.333334H128v-85.333334z"],italic:["M219.428571 949.714286l9.714286-48.571429q3.428571-1.142857 46.571429-12.285714t63.714286-21.428571q16-20 23.428571-57.714286 0.571429-4 35.428571-165.142857t65.142857-310.571429 29.714286-169.428571l0-14.285714q-13.714286-7.428571-31.142857-10.571429t-39.714286-4.571429-33.142857-3.142857l10.857143-58.857143q18.857143 1.142857 68.571429 3.714286t85.428571 4 68.857143 1.428571q27.428571 0 56.285714-1.428571t69.142857-4 56.285714-3.714286q-2.857143 22.285714-10.857143 50.857143-17.142857 5.714286-58 16.285714t-62 19.142857q-4.571429 10.857143-8 24.285714t-5.142857 22.857143-4.285714 26-3.714286 24q-15.428571 84.571429-50 239.714286t-44.285714 203.142857q-1.142857 5.142857-7.428571 33.142857t-11.428571 51.428571-9.142857 47.714286-3.428571 32.857143l0.571429 10.285714q9.714286 2.285714 105.714286 17.714286-1.714286 25.142857-9.142857 56.571429-6.285714 0-18.571429 0.857143t-18.571429 0.857143q-16.571429 0-49.714286-5.714286t-49.142857-5.714286q-78.857143-1.142857-117.714286-1.142857-29.142857 0-81.714286 5.142857t-69.142857 6.285714z"],middleAlign:["M740.43392 788.48c11.30496 0 20.48-9.15456 20.48-20.48s-9.17504-20.48-20.48-20.48L331.18208 747.52c-11.30496 0-20.48 9.15456-20.48 20.48s9.17504 20.48 20.48 20.48L740.43392 788.48zM863.49824 604.16c0-11.32544-9.17504-20.48-20.48-20.48l-614.4 0c-11.30496 0-20.48 9.15456-20.48 20.48s9.17504 20.48 20.48 20.48l614.4 0C854.3232 624.64 863.49824 615.48544 863.49824 604.16zM208.13824 276.48c0 11.32544 9.17504 20.48 20.48 20.48l614.4 0c11.30496 0 20.48-9.15456 20.48-20.48s-9.17504-20.48-20.48-20.48l-614.4 0C217.2928 256 208.13824 265.15456 208.13824 276.48zM740.43392 460.8c11.30496 0 20.48-9.15456 20.48-20.48s-9.17504-20.48-20.48-20.48L331.18208 419.84c-11.30496 0-20.48 9.15456-20.48 20.48s9.17504 20.48 20.48 20.48L740.43392 460.8z"],plus:["M896 468.571429H555.428571V100.571429h-86.857142v368H128c-5.028571 0-9.142857 4.114286-9.142857 9.142857v68.571428c0 5.028571 4.114286 9.142857 9.142857 9.142857h340.571429v368h86.857142V555.428571h340.571429c5.028571 0 9.142857-4.114286 9.142857-9.142857v-68.571428c0-5.028571-4.114286-9.142857-9.142857-9.142857z"],redo:["M611.783111 569.344L549.622519 644.740741h284.444444l-65.498074-265.481482-59.922963 72.666074c-35.422815-28.48237-108.278519-68.342519-238.667852-68.342518-202.827852 0-280.651852 206.01363-280.651852 206.013629s116.318815-132.778667 246.215111-132.778666c97.204148-0.037926 153.865481 74.827852 176.241778 112.526222z"],underline:["M512 725.333333c166.4 0 298.666667-132.266667 298.666667-298.666666V128c0-25.6-17.066667-42.666667-42.666667-42.666667s-42.666667 17.066667-42.666667 42.666667v298.666667c0 119.466667-93.866667 213.333333-213.333333 213.333333s-213.333333-93.866667-213.333333-213.333333V128c0-25.6-17.066667-42.666667-42.666667-42.666667s-42.666667 17.066667-42.666667 42.666667v298.666667c0 166.4 132.266667 298.666667 298.666667 298.666666zM853.333333 853.333333H170.666667c-25.6 0-42.666667 17.066667-42.666667 42.666667s17.066667 42.666667 42.666667 42.666667h682.666666c25.6 0 42.666667-17.066667 42.666667-42.666667s-17.066667-42.666667-42.666667-42.666667z"],undo:["M489.244444 568.888889l60.681482 75.851852H265.481481l64.474075-265.481482 60.681481 72.05926c34.133333-30.340741 109.985185-68.266667 238.933333-68.266667 201.007407 0 280.651852 204.8 280.651852 204.8S792.651852 455.111111 663.703704 455.111111c-98.607407 0-155.496296 75.851852-174.45926 113.777778z"]},Fo=Dr;var xe=({className:o="",paths:e=[]})=>x("svg",{className:D("base-icon",o),viewBox:"0 0 1137 1024","aria-hidden":!0},...e.map(t=>x("path",t)));xe.displayName="BaseIcon";var Ke=()=>xe({paths:[{d:"M0 0h1024v1024H0z","fill-opacity":".01"},{d:"M496.512 32a128 128 0 0 1 127.84 121.6l0.16 6.4-0.032 113.504 264.256 264.256a32 32 0 0 1-8.16 51.2l-144.064 72.96-269.12 269.12a64 64 0 0 1-90.496 0l-294.144-294.176a64 64 0 0 1 0-90.496l286.016-286.08-0.192-2.048-0.064-2.08V160a128 128 0 0 1 128-128z m-6.464 197.568L128 591.616l294.144 294.144 276.32-276.32 113.792-57.632-187.776-187.776V416a32 32 0 0 1-28.256 31.776l-3.712 0.224a32 32 0 0 1-31.808-28.256L560.512 416l-0.032-115.968-70.432-70.464z m402.016 395.936l1.792 2.24 5.472 8.416c30.112 46.752 45.184 80.032 45.184 99.84a64 64 0 1 1-128 0c0-20.96 16.864-57.024 50.624-108.224a16 16 0 0 1 24.928-2.24zM496.512 96a64 64 0 0 0-63.84 59.2l-0.16 4.8-0.032 36.576 34.944-34.88a32 32 0 0 1 45.248 0l47.808 47.808V160a64 64 0 0 0-59.2-63.84L496.48 96z"}]});Ke.displayName="FillColorIcon";var K=({name:o,className:e=""})=>{let t=Fo[o].map(r=>({d:r}));return xe({className:e,paths:t})};K.displayName="Icon";var ee=o=>{let{data:e,value:t,style:r={},onChange:n,getItemStyle:i=()=>({}),title:s}=o;return x("select",{onchange:l=>{let{value:c}=l.target;n(c)},value:t,style:r,name:"select",className:"select-list",title:s},...e.map(l=>{let c=typeof l=="object"?l.value:l,d=typeof l=="object"?l.label:l,g=typeof l=="object"?l.disabled:!1,h=i(c);return x("option",{key:c,value:c,style:h,disabled:!!g,className:D("select-item",{disabled:g})},d)}))};ee.displayName="Select";var be="No Fill",Hr=["#4D4D4D","#999999","#FFFFFF","#F44E3B","#FE9200","#FCDC00","#DBDF00","#A4DD00","#68CCCA","#73D8FF","#AEA1FF","#FDA1FF","#333333","#808080","#cccccc","#D33115","#E27300","#FCC400","#B0BC00","#68BC00","#16A5A5","#009CE0","#7B64FF","#FA28FF","#000000","#666666","#B3B3B3","#9F0500","#C45100","#FB9E00","#808900","#194D33","#0C797D","#0062B1","#653294","#AB149E",be],Do="color-picker-wrapper",Ge=(o,...e)=>{let{color:t,style:r={},onChange:n,key:i}=o,s,a=l=>{let c=Do;l&&(c=c+" show"),s.className=c};return x("div",{className:"relative color-picker",key:i,style:r},x("div",{className:"color-picker-trigger",style:{color:t},onclick:()=>{a(!0)}},...e),x("div",{className:Do,hook:{ref:l=>{s=l}},onmouseleave(){a(!1)}},x("div",{className:"color-picker-list"},...Hr.map(l=>x("div",{key:l,className:D("color-picker-item",{"no-fill":l===be}),style:{backgroundColor:l},onclick:()=>{a(!1),n(l===be?"":l)}},l===be?be:"")))))};Ge.displayName="ColorPicker";var je=(o,...e)=>{let{dialogContent:t,title:r,dialogStyle:n,onCancel:i,onOk:s}=o,a;return x("div",{className:"dialog-container"},x("dialog",{className:"dialog-element",style:n,hook:{ref(l){a=l}}},x("form",{method:"dialog"},x("div",{className:"dialog-title"},r),x("div",{className:"dialog-content"},t),x("div",{className:"dialog-button"},T({onClick(){i&&i()},buttonType:"submit"},"Cancel"),T({onClick(){s&&s()},buttonType:"submit",className:"ml16"},"Confirm")))),x("div",{onclick(){z(typeof a.showModal=="function","Sorry, the <dialog> API is not supported by this browser."),a.showModal()}},...e))};je.displayName="Dialog";var Pr={display:"none"};function Vr(o,e){switch(o){case"addCol":e.addCol(e.getActiveCell().col,1);break;case"deleteCol":e.deleteCol(e.getActiveCell().col,1);break;case"addRow":e.addRow(e.getActiveCell().row,1);break;case"deleteRow":e.deleteRow(e.getActiveCell().row,1);break;case"copy":case"cut":case"paste":e[o]();break;default:throw new Error(`context menu unknown data type: ${o}`)}}var Ct=(o,e)=>{let{contextMenuPosition:t}=o,r=t===void 0?Pr:{top:t.top,left:t.left},n=()=>{o.contextMenuPosition=void 0};return x("div",{className:"context-menu",style:r,hook:{ref(i){Ce("canvas-context-menu",{dom:i,callback(s){s.contextMenuPosition!==void 0&&(s.contextMenuPosition=void 0)}})}},onclick(i){if(!i.target)return;let a=i.target.dataset.type;a&&(n(),Vr(a,e))}},T({dataType:"addCol"},"add a column"),T({dataType:"deleteCol"},"delete a column"),T({dataType:"addRow"},"add a row"),T({dataType:"deleteRow"},"delete a row"),T({dataType:"copy"},"copy"),T({dataType:"cut"},"cut"),T({dataType:"paste"},"paste"))};Ct.displayName="ContextMenuContainer";function Ur(o){let{style:e}=o,t={top:o.top,left:o.left,width:o.width,height:o.height};if(A(e))return t;let r=ue(e?.isItalic?"italic":"normal",e?.isBold?"bold":"500",e?.fontSize||Y,e?.fontFamily);return{...t,backgroundColor:e?.fillColor||"inherit",color:e?.fontColor||W,font:r}}var yt=(o,e)=>{let{activeCell:t,isCellEditing:r}=o,n=t.formula||String(t.value||""),i,s=a=>{i=a,e.setMainDom({input:i})};return x("input",{className:"base-editor",value:n,type:"text",style:r?Ur(t):void 0,hook:{ref:s},onfocus:()=>{r&&(o.isCellEditing=!0)},onkeydown:a=>{r&&(i.nextSibling.textContent=a.currentTarget.value)}})};yt.displayName="FormulaEditor";var xt=(o,e)=>{let{activeCell:t}=o;return x("div",{className:"formula-bar-wrapper"},x("div",{className:"formula-bar-name"},`${Re(t.col)}${t.row+1}`),x("div",{className:"formula-bar-editor-wrapper"},yt(o,e),x("div",{className:D("formula-bar-value",{show:o.isCellEditing})},t.formula||String(t.value||""))))};xt.displayName="FormulaBarContainer";var zr=[{value:0,label:"none"},{value:1,label:"single underline"},{value:2,label:"double underline"}],bt=(o,e)=>{let t=u=>({"font-family":String(u),"font-size":"16px"}),r=u=>{let y=e.getCell(e.getActiveCell()).style||{};e.setCellStyle(Object.assign(y,u),[e.getActiveCell()])},{activeCell:n,fontFamilyList:i}=o,{style:s={}}=n,{isBold:a=!1,isItalic:l=!1,fontSize:c=Y,fontColor:d=W,fillColor:g="",isWrapText:h=!1,underline:p=0,fontFamily:m=""}=s;return x("div",{className:"toolbar-wrapper"},T({disabled:!e.canUndo(),onClick(){e.undo()},testId:"toolbar-undo"},K({name:"undo"})),T({disabled:!e.canRedo(),onClick(){e.redo()},testId:"toolbar-redo"},K({name:"redo"})),ee({data:i,value:m,style:{width:"140px"},getItemStyle:t,onChange:u=>{String(u)===Oe?window.queryLocalFonts().then(y=>{let C=y.map(b=>b.fullName);C=Array.from(new Set(C)).filter(b=>Ae(b)),C.sort((b,w)=>b.localeCompare(w)),localStorage.setItem(Fe,JSON.stringify(C)),o.fontFamilyList=C.map(b=>({label:b,value:b,disabled:!1}))}):r({fontFamily:String(u)})}}),ee({data:At,value:c,onChange:u=>{r({fontSize:Number(u)})}}),T({active:a,onClick:()=>{r({isBold:!a})},testId:"toolbar-bold",title:"Bold"},K({name:"bold"})),T({active:l,onClick:()=>{r({isItalic:!l})},testId:"toolbar-italic",title:"Italic"},K({name:"italic"})),ee({data:zr,value:p,style:{width:"130px"},title:"Underline",onChange:u=>{r({underline:Number(u)})}}),Ge({key:"fill-color",color:g,onChange:u=>{r({fillColor:u})}},Ke({})),Ge({color:d,onChange:u=>{r({fontColor:u})},key:"font-color"},K({name:"fontColor"})),T({onClick:()=>{r({isWrapText:!h})},active:h,testId:"toolbar-wrap-text"},"Wrap Text"),gt({}))};bt.displayName="ToolbarContainer";var _r={display:"none"};function Br(o,e,t){switch(o){case"addSheet":case"deleteSheet":case"hideSheet":e[o]();break;case"unhideSheet":break;case"renameSheet":t.isSheetNameEditing=!0;break;default:throw new Error(`sheet bar context menu unknown data type: ${o}`)}}var St=(o,e)=>{let t=o.sheetBarContextMenuLeft===void 0?_r:{left:`${o.sheetBarContextMenuLeft}px`},n=e.getSheetList().filter(a=>a.isHide).map(a=>({value:a.sheetId,label:a.name,disabled:!1})),i=String(n?.[0]?.value||""),s=()=>{o.sheetBarContextMenuLeft=void 0};return x("div",{className:"sheet-bar-context-menu",style:t,hook:{ref(a){Ce("sheet-bar-context-menu",{dom:a,callback(l){l.sheetBarContextMenuLeft!==void 0&&(l.sheetBarContextMenuLeft=void 0)}})}},onclick(a){if(!a.target)return;let c=a.target.dataset.type;c&&c!=="unhideSheet"&&(s(),Br(c,e,o))}},T({dataType:"addSheet"},"Insert"),T({dataType:"deleteSheet"},"Delete"),T({dataType:"renameSheet"},"Rename"),T({dataType:"hideSheet"},"Hide"),je({dialogContent:ee({data:n,onChange(a){i=String(a)},style:{width:"300px"},value:void 0}),title:"Unhide sheet:",onOk(){e.unhideSheet(i),s(),i=""},onCancel:s},T({dataType:"unhideSheet",className:"width100 bgWhite",disabled:n.length===0},"Unhide")))};St.displayName="SheetBarContextMenu";var vt=(o,e)=>{let t=r=>{e.renameSheet(r),o.isSheetNameEditing=!1};return x("div",{className:"sheet-bar-wrapper"},x("div",{className:"sheet-bar-list"},...o.sheetList.map(r=>{let n=o.currentSheetId===r.value,i=n&&o.isSheetNameEditing;return x("div",{key:r.value,className:D("sheet-bar-item",{active:n}),onclick:()=>{e.setCurrentSheetId(String(r.value))},oncontextmenu(s){return s.preventDefault(),o.sheetBarContextMenuLeft=(s.clientX||0)-30,!1}},x("input",{value:r.label,className:D("sheet-bar-input",{show:i}),onblur(s){s.currentTarget},onkeydown(s){if(s.key==="Enter"){if(s.stopPropagation(),!s.currentTarget)return;t(s.currentTarget.value)}}}),x("span",{className:D("sheet-bar-item-text",{show:!i})},r.label))})),x("div",{className:"sheet-bar-add"},T({onClick:e.addSheet,type:"circle",style:{backgroundColor:k.buttonActiveColor}},K({name:"plus"}))),St(o,e))};vt.displayName="SheetBarContainer";var wt=(o,e)=>x("div",{className:"app-container"},bt(o,e),xt(o,e),ft(o,e),vt(o,e),Ct(o,e));wt.displayName="App";var Et=19,It=34,Wr={top:0,left:0,row:0,col:0,scrollLeft:0,scrollTop:0},Se=class{scrollValue={};model;changeSet=new Set;copyRanges=[];cutRanges=[];hooks={modelChange(){},async cut(){return""},async copy(){return""},async paste(){return{[_]:"",[M]:""}}};viewSize={width:0,height:0};headerSize={width:It,height:Et};mainDom={};constructor(e){this.model=e}getCurrentSheetId(){return this.model.getCurrentSheetId()}getSheetList(){return this.model.getSheetList()}getSheetInfo(e){return this.model.getSheetInfo(e)}setHooks(e){this.hooks=e}emitChange(){Me("emitChange",this.changeSet),this.hooks.modelChange(this.changeSet),this.changeSet=new Set,this.model.record()}getActiveCell(){let e=this.model.getCurrentSheetId(),{activeCell:t}=this.getSheetInfo(e);return{...t,sheetId:t.sheetId||e}}setSheetCell(e){let t=e.sheetId||this.model.getCurrentSheetId();e.sheetId=t,this.model.setActiveCell(e)}setActiveCell(e){this.setSheetCell(e),this.changeSet.add("selection"),this.emitChange()}setCurrentSheetId(e){if(e===this.getCurrentSheetId())return;this.model.setCurrentSheetId(e);let t=this.getActiveCell();this.setSheetCell(t),this.computeViewSize(),this.setScroll(this.getScroll())}addSheet=()=>{this.model.addSheet(),this.setSheetCell({row:0,col:0,rowCount:1,colCount:1,sheetId:""}),this.computeViewSize(),this.setScroll({top:0,left:0,row:0,col:0,scrollLeft:0,scrollTop:0})};deleteSheet=e=>{this.model.deleteSheet(e),this.changeSet.add("content"),this.emitChange()};hideSheet(e){this.model.hideSheet(e),this.changeSet.add("content"),this.emitChange()}unhideSheet(e){this.model.unhideSheet(e),this.changeSet.add("content"),this.emitChange()}renameSheet(e,t){this.model.renameSheet(e,t),this.changeSet.add("content"),this.emitChange()}fromJSON(e){Me("loadJSON",e),this.model.fromJSON(e);let t=this.getActiveCell();this.setSheetCell(t),this.computeViewSize(),this.changeSet.add("content"),this.emitChange()}toJSON(){return this.model.toJSON()}setCellValues(e,t,r){Me("setCellValue",e),this.model.setCellValues(e,t,r),this.changeSet.add("content"),this.emitChange()}setCellStyle(e,t){A(e)||(this.model.setCellStyle(e,t),this.changeSet.add("content"),this.emitChange())}getCell=e=>this.model.getCell(e);canRedo(){return this.model.canRedo()}canUndo(){return this.model.canUndo()}undo(){this.model.undo(),this.changeSet.add("content"),this.emitChange()}redo(){this.model.redo(),this.changeSet.add("content"),this.emitChange()}getColWidth(e){return this.model.getColWidth(e)}setColWidth(e,t){this.model.setColWidth(e,t),this.computeViewSize(),this.changeSet.add("content")}getRowHeight(e){return this.model.getRowHeight(e)}setRowHeight(e,t){this.model.setRowHeight(e,t),this.computeViewSize(),this.changeSet.add("content")}computeViewSize(){let e=this.getHeaderSize(),t=this.model.getSheetInfo(this.model.getCurrentSheetId()),r=e.width,n=e.height;for(let i=0;i<t.colCount;i++)r+=this.getColWidth(i);for(let i=0;i<t.rowCount;i++)n+=this.getRowHeight(i);this.viewSize={width:r,height:n}}getViewSize(){return{...this.viewSize}}getCellSize(e,t){return{width:this.getColWidth(t),height:this.getRowHeight(e)}}getHeaderSize(){return{...this.headerSize}}computeCellPosition(e,t){let r=this.getHeaderSize(),n=this.getScroll(),i=r.width,s=r.height,a=n.row,l=n.col;for(;l<t;)i+=this.getColWidth(l),l++;for(;a<e;)s+=this.getRowHeight(a),a++;return{...this.getCellSize(e,t),top:s,left:i}}addRow(e,t){this.model.addRow(e,t),this.changeSet.add("content"),this.emitChange()}addCol(e,t){this.model.addCol(e,t),this.changeSet.add("content"),this.emitChange()}deleteCol(e,t){this.model.deleteCol(e,t),this.changeSet.add("content"),this.emitChange()}deleteRow(e,t){this.model.deleteRow(e,t),this.changeSet.add("content"),this.emitChange()}getChangeSet(){let e=this.changeSet;return this.changeSet=new Set,e}getScroll(){let e=this.model.getCurrentSheetId();return this.scrollValue[e]||Wr}setScroll(e){let t=this.model.getCurrentSheetId();this.scrollValue[t]={...e},e.row>9999?this.headerSize={width:Math.floor(It*2),height:Et}:this.headerSize={width:It,height:Et},this.changeSet.add("content"),this.emitChange()}parseText(e){let t;if(e.indexOf(`\r
`)>-1?t=e.split(`\r
`).map(a=>a).map(a=>a.split("	")):t=e.split(`
`).map(a=>a).map(a=>a.split("	")),t[0].length!==t[t.length-1].length){let a=t[t.length-1];a.length===1&&!a[0]&&t.pop()}let r=t.length,n=0;for(let a of t)a.length>n&&(n=a.length);if(t.length===0)return;let s={...this.getActiveCell(),rowCount:r,colCount:n};this.model.setCellValues(t,[],[s]),this.changeSet.add("content"),this.setActiveCell(s)}parseHTML(e){let t=new DOMParser,r=e.replace(`<style>\r
<!--table`,"<style>").replace(`-->\r
</style>`,"</style>"),n=t.parseFromString(r,"text/html"),i=n.querySelectorAll("tr"),s=n.querySelectorAll("style"),a=[],l=[],c=i.length,d=0;for(let p of i){let m=p.querySelectorAll("td"),u=[],f=[];for(let y of m){let C={};y.className?C=lt(s,"."+y.className):C=lt(s,y.tagName.toLowerCase()),f.push(C),u.push(y.textContent||"")}a.push(u),l.push(f),u.length>d&&(d=u.length)}if(a.length===0)return;let h={...this.getActiveCell(),rowCount:c,colCount:d};this.model.setCellValues(a,l,[h]),this.changeSet.add("content"),this.setActiveCell(h)}async paste(e){if(this.copyRanges=[],this.cutRanges.length>0){let[n]=this.cutRanges,i=[];for(let s=0;s<n.rowCount;s++)i.push(new Array(n.colCount).fill(""));this.model.setCellValues(i,[],this.cutRanges)}let t="",r="";if(e)t=e.clipboardData?.getData(_)||"",r=e.clipboardData?.getData(M)||"";else{let n=await this.hooks.paste();t=n[_],r=n[M]}t?this.parseHTML(t):this.parseText(r),this.cutRanges.length&&(this.cutRanges=[],this.hooks.copy({[M]:"",[_]:""}))}getCopyData(){let{row:e,col:t,rowCount:r,colCount:n}=this.getActiveCell(),i=[],s=[],a=1,l=[],c=this.model.getCurrentSheetId();for(let h=e,p=e+r;h<p;h++){let m=[],u=[];for(let f=t,y=t+n;f<y;f++){let C=this.model.getCell(new H(h,f,1,1,c)),b=String(C.value||"");if(m.push(b),C.style){let w=Ot(C.style);b||(w+="mso-pattern:black none;");let I=`xl${a++}`;l.push(`.${I}{${w}}`),u.push(`<td class="${I}"> ${b} </td>`)}else u.push(`<td> ${b} </td>`)}i.push(m),s.push(u)}let d=Zt(l.join(`
`),s.map(h=>`<tr>${h.join(`
`)}</tr>`).join(`
`)),g=i.map(h=>h.join("	")).join(`\r
`)+`\r
`;return{[M]:g,[_]:d}}copy(e){this.copyRanges=[this.getActiveCell()];let t=this.getCopyData();if(e){let r=Object.keys(t);for(let n of r)e.clipboardData?.setData(n,t[n])}else this.hooks.copy(t);this.changeSet.add("selection"),this.emitChange()}cut(e){this.cutRanges=[this.getActiveCell()],this.copy(e)}getCopyRanges(){return this.copyRanges.slice()}getDomRect(){let e=this.getMainDom().canvas;if(!e)return{top:0,left:0,width:0,height:0};let t=e.parentElement.getBoundingClientRect();return{top:t.top,left:t.left,width:t.width,height:t.height}}setMainDom(e){this.mainDom=Object.assign(this.mainDom,e)}getMainDom(){return this.mainDom}};var U=class{type;value;constructor(e,t){this.type=e,this.value=t}error(){return`type:${this.type},value:${this.value}`}toString(){return this.value}};var v=class extends Error{value;constructor(e){super(e),this.value=e}},Ol=new v("#VALUE!"),Fl=new v("#NUM!");function P(o,e="#VALUE!"){if(!o)throw new v(e)}function Ye(o){P(o.length===1);let[e]=o;return e}function he(o){let e=Ye(o);return P(typeof e=="string"),e}function N(o){let e=Ye(o);return P(typeof e=="number"&&!isNaN(e)),e}function kt(o){P(o.length===0)}var $r=(...o)=>{let e=Ye(o);return typeof e=="string"?e:""},Kr=(...o)=>he(o).toLowerCase(),Ho=(...o)=>{let e=N(o);return String.fromCharCode(e)},Po=(...o)=>he(o).charCodeAt(0),Gr=(...o)=>he(o).length,jr=(...o)=>{P(o.length===2);let[e,t]=o;return P(typeof e=="string"),P(typeof t=="string"),e.split(t)},Yr=(...o)=>he(o).toUpperCase(),Jr=(...o)=>he(o).replace(/ +/g," ").trim(),Vo=(...o)=>(P(o.length<=Te),o.join("")),Xr={CONCAT:Vo,CONCATENATE:Vo,SPLIT:jr,CHAR:Ho,CODE:Po,UNICHAR:Ho,UNICODE:Po,LEN:Gr,LOWER:Kr,UPPER:Yr,TRIM:Jr,T:$r},Uo=Xr;var qr=(...o)=>{let e=N(o);return Math.abs(e)},Zr=(...o)=>{let e=N(o);return Math.acos(e)},Qr=(...o)=>{let e=N(o);return Math.log(e+Math.sqrt(e*e-1))},en=(...o)=>{let e=N(o);return Math.atan(1/e)},tn=(...o)=>{let e=N(o);return .5*Math.log((e+1)/(e-1))},on=(...o)=>{let e=N(o);return Math.asin(e)},rn=(...o)=>{let e=N(o);return Math.log(e+Math.sqrt(e*e+1))},nn=(...o)=>{let e=N(o);return Math.atan(e)},sn=(...o)=>{P(o.length===2);let[e,t]=o;return P(typeof e=="number"),P(typeof t=="number"),Math.atan2(e,t)},an=(...o)=>{let e=N(o);return Math.log((1+e)/(e+1))/2},ln=(...o)=>{let e=N(o);return Math.cos(e)},cn=(...o)=>{let e=N(o);return 1/Math.tan(e)};var hn=(...o)=>{let e=N(o);return Math.exp(e)},dn=(...o)=>{let e=N(o);return Math.floor(e)};var un=(...o)=>(kt(o),Math.PI),pn=(...o)=>(kt(o),Math.E),mn=(...o)=>{let e=N(o);return Math.sin(e)},fn=(...o)=>{let e=Pt(o);return P(e.length<=Te),e.reduce((t,r)=>t+r,0)},gn={ABS:qr,ACOS:Zr,ACOSH:Qr,ACOT:en,ACOTH:tn,ASIN:on,ASINH:rn,ATAN:nn,ATAN2:sn,ATANH:an,COT:cn,COS:ln,EXP:hn,INT:dn,PI:un,E:pn,SIN:mn,SUM:fn},zo=gn;var Cn={...Uo,...zo},_o=Cn;var Bo="",yn=new Map([["TRUE",19],["FALSE",20]]),Je=class{list;current=0;start=0;tokens=[];constructor(e){this.list=[...e]}scan(){for(;!this.isAtEnd();)this.start=this.current,this.scanToken();return this.tokens.push(new U(27,"")),this.tokens.length>0&&this.tokens[0].type===0&&this.tokens.shift(),this.tokens}peek(){return this.isAtEnd()?Bo:this.list[this.current]}match(e){return this.peek()!==e?!1:(this.next(),!0)}next(){return this.isAtEnd()?Bo:this.list[this.current++]}isAtEnd(){return this.current>=this.list.length}addToken(e){let t=this.list.slice(this.start,this.current).join("");this.tokens.push(new U(e,t))}string(e){for(;!this.isAtEnd()&&this.peek()!==e;)this.next();if(this.peek()!==e)throw new v("#VALUE!");this.next();let t=this.list.slice(this.start+1,this.current-1).join("");this.tokens.push(new U(17,t))}allDigit(){for(;!this.isAtEnd()&&this.isDigit(this.peek());)this.next()}number(){if(this.allDigit(),this.match("E")){if(this.match("+")||this.match("-")){this.allDigit(),this.addToken(18);return}throw new v("#VALUE!")}if(this.match(".")&&this.allDigit(),this.match("E")){if(this.match("+")||this.match("-")){this.allDigit(),this.addToken(18);return}throw new v("#VALUE!")}this.addToken(18)}isDigit(e){return e>="0"&&e<="9"}identifier(){for(;!this.isAtEnd()&&this.anyChar(this.peek());)this.next();let e=this.list.slice(this.start,this.current).join(""),t=yn.get(e.toUpperCase()),r=16;t&&(e=e.toUpperCase(),r=t),this.tokens.push(new U(r,e))}scanToken(){let e=this.next();switch(e){case"(":this.addToken(21);break;case")":this.addToken(22);break;case",":this.addToken(11);break;case":":this.addToken(10);break;case"=":this.addToken(0);break;case"<":this.match(">")?this.addToken(1):this.match("=")?this.addToken(15):this.addToken(14);break;case">":this.match("=")?this.addToken(8):this.addToken(7);break;case"+":this.addToken(2);break;case"-":this.addToken(3);break;case"*":this.addToken(4);break;case"/":this.addToken(5);break;case"^":this.addToken(6);break;case"&":this.addToken(9);break;case"%":this.addToken(13);break;case'"':this.string(e);break;case"!":this.addToken(26);break;case";":this.addToken(25);break;case"{":this.addToken(23);break;case"}":this.addToken(24);break;case" ":break;case"\r":case"	":case`
`:break;default:if(this.isDigit(e))this.number();else if(this.anyChar(e))this.identifier();else throw new v("#ERROR!");break}}anyChar(e){return!'(),:=<>+-*/^&%"{}!'.includes(e)&&!this.isWhiteSpace(e)}isWhiteSpace(e){return e===" "||e==="\r"||e===`
`||e==="	"}};var J=class{left;right;operator;constructor(e,t,r){this.left=e,this.operator=t,this.right=r}accept(e){return e.visitBinaryExpression(this)}handleConcatenate(e){let t=e.toString();return this.operator.type===9&&e instanceof te&&e.value.type===17?JSON.stringify(t):t}toString(){let e=this.handleConcatenate(this.left),t=this.handleConcatenate(this.right);return`${e}${this.operator.toString()}${t}`}},Xe=class{right;operator;constructor(e,t){this.operator=e,this.right=t}accept(e){return e.visitUnaryExpression(this)}toString(){return this.operator.toString()+this.right.toString()}},qe=class{left;operator;constructor(e,t){this.operator=e,this.left=t}accept(e){return e.visitPostUnaryExpression(this)}toString(){return this.left.toString()+this.operator.toString()}},te=class{value;constructor(e){this.value=e}accept(e){return e.visitLiteralExpression(this)}toString(){return this.value.toString()}},X=class{value;sheetName;type;constructor(e,t,r){this.value=e,this.sheetName=r,this.type=t}accept(e){return e.visitCellExpression(this)}toString(){return this.sheetName?this.sheetName.toString()+"!"+this.value.toString():this.value.toString()}},Ze=class{name;params;constructor(e,t){this.name=e,this.params=t}accept(e){return e.visitCallExpression(this)}toString(){return`${this.name.toString().toUpperCase()}(${this.params.map(e=>e.toString()).join(",")})`}},Qe=class{left;right;operator;constructor(e,t,r){this.left=e,this.operator=t,this.right=r}accept(e){return e.visitCellRangeExpression(this)}toString(){return this.left.toString()+this.operator.toString()+this.right.toString()}},et=class{value;constructor(e){this.value=e}accept(e){return e.visitGroupExpression(this)}toString(){return`(${this.value.toString()})`}},oe=class{value;constructor(e){this.value=e}accept(e){return e.visitTokenExpression(this)}toString(){return this.value.toString()}};var xn=new Set(["#ERROR!","#DIV/0!","#NULL!","#NUM!","#REF!","#VALUE!","#N/A","#NAME?"]),tt=class{tokens;current=0;constructor(e){this.tokens=e}parse(){let e=[];for(;!this.isAtEnd();)e.push(this.expression());return e}expression(){return this.comparison()}comparison(){let e=this.concatenate();for(;this.match(0,1,7,8,14,15);){let t=this.previous(),r=this.concatenate();e=new J(e,t,r)}return e}concatenate(){let e=this.term();for(;this.match(9);){let t=this.previous(),r=this.term();e=new J(e,t,r)}return e}term(){let e=this.factor();for(;this.match(2,3);){let t=this.previous(),r=this.factor();e=new J(e,t,r)}return e}factor(){let e=this.expo();for(;this.match(5,4);){let t=this.previous(),r=this.expo();e=new J(e,t,r)}return e}expo(){let e=this.unary();for(;this.match(6);){let t=this.previous(),r=this.unary();e=new J(e,t,r)}return e}unary(){if(this.match(2,3)){let e=this.previous(),t=this.unary();return new Xe(e,t)}return this.postUnary()}postUnary(){let e=this.cellRange();if(this.match(13)){let t=this.previous();e=new qe(t,e)}return e}cellRange(){let e=this.call();for(;this.match(10,26);){let t=this.previous(),r=this.call();e=new Qe(e,t,r)}return e}call(){let e=this.primary();for(;this.match(21);)e=this.finishCall(e);return e}finishCall(e){let t=[];if(!this.check(22))do{if(this.peek().type==22)break;t.push(this.expression())}while(this.match(11));return this.expect(22),new Ze(e,t)}primary(){if(this.match(21)){let e=this.expression();return this.expect(22),new et(e)}if(this.match(18,17,19,20))return new te(this.previous());if(this.match(16)){let e=this.previous(),t=e.value.toUpperCase();if(xn.has(t))throw new v(t);return new oe(e)}throw new v("#ERROR!")}match(...e){let t=this.peek().type;return e.includes(t)?(this.next(),!0):!1}previous(){return this.tokens[this.current-1]}check(e){return this.peek().type===e}expect(e){if(this.check(e))return this.next(),this.previous();throw new v("#ERROR!")}next(){this.current++}isAtEnd(){return this.peek().type===27}peek(){return this.current<this.tokens.length?this.tokens[this.current]:new U(27,"")}};var ot=class{expressions;functionMap;cellDataMap;variableMap;constructor(e,t,r,n){this.expressions=e,this.functionMap=n,this.cellDataMap=t,this.variableMap=r}interpret(){let e=[];for(let t of this.expressions)e.push(this.evaluate(t));if(e.length===1)return this.getRangeCellValue(e[0]);throw new v("#ERROR!")}getRangeCellValue(e){if(e instanceof H){if(e.colCount===e.rowCount&&e.colCount===1)return this.cellDataMap.get(e.row,e.col,e.sheetId);throw new v("#REF!")}return e}checkNumber(e){if(typeof e!="number")throw new v("#VALUE!")}visitBinaryExpression(e){let t=this.evaluate(e.left),r=this.evaluate(e.right);switch(t=this.getRangeCellValue(t),r=this.getRangeCellValue(r),e.operator.type){case 3:return this.checkNumber(t),this.checkNumber(r),t-r;case 2:return this.checkNumber(t),this.checkNumber(r),t+r;case 5:if(this.checkNumber(t),this.checkNumber(r),r===0)throw new v("#DIV/0!");return t/r;case 4:return this.checkNumber(t),this.checkNumber(r),t*r;case 6:return this.checkNumber(t),this.checkNumber(r),Math.pow(t,r);case 0:return t===r;case 1:return t!==r;case 7:return t>r;case 8:return t>=r;case 14:return t<r;case 15:return t<=r;case 9:return`${t}${r}`;default:throw new v("#VALUE!")}}visitCallExpression(e){let t=this.evaluate(e.name);if(t&&typeof t=="function"){let r=[];for(let n of e.params){let i=this.evaluate(n);if(i instanceof H){let{row:s,col:a,rowCount:l,colCount:c,sheetId:d}=i;for(let g=s,h=s+l;g<h;g++)for(let p=a,m=a+c;p<m;p++)r.push(this.cellDataMap.get(g,p,d))}else r.push(i)}return t(...r)}throw new v("#NAME?")}visitCellExpression(e){let t="";e.sheetName&&(t=this.cellDataMap.convertSheetNameToSheetId(e.sheetName.value));let r=$t(e.value.value);if(r===null)throw new v("#NAME?");return t&&(r.sheetId=t),r}visitLiteralExpression(e){let{type:t,value:r}=e.value;switch(t){case 17:return r;case 18:{let n=parseFloat(r);if(isNaN(n))throw new v("#VALUE!");return n}case 19:return!0;case 20:return!1;default:throw new v("#ERROR!")}}addCellExpression(e,t,r){e.value=e.value.toUpperCase();let n=new X(e,t,r);return this.visitCellExpression(n)}visitTokenExpression(e){let{value:t,type:r}=e.value,n=t.toLowerCase();if(this.variableMap.has(n))return this.variableMap.get(n);let i=t.toUpperCase();if(this.functionMap[i])return this.functionMap[i];let s=i,a=new U(r,s);if(/^\$[A-Z]+\$\d+$/.test(s)||/^\$[A-Z]+$/.test(s)||/^\$\d+$/.test(s))return this.addCellExpression(a,"absolute",null);if(/^\$[A-Z]+\d+$/.test(s)||/^[A-Z]+\$\d+$/.test(s))return this.addCellExpression(a,"mixed",null);if(/^[A-Z]+\d+$/.test(s)||/^[A-Z]+$/.test(s))return this.addCellExpression(a,"relative",null);throw new v("#NAME?")}visitUnaryExpression(e){let t=this.evaluate(e.right);switch(e.operator.type){case 3:return-t;case 2:return t;default:throw new v("#VALUE!")}}convertToCellExpression(e){return e instanceof X?e:e instanceof oe?new X(new U(16,e.value.value.toUpperCase()),"relative",null):e instanceof te&&e.value.type===18&&/^\d+$/.test(e.value.value)?new X(new U(16,e.value.value),"relative",null):null}visitCellRangeExpression(e){switch(e.operator.type){case 10:{let t=this.convertToCellExpression(e.left),r=this.convertToCellExpression(e.right);if(t!==null&&r!==null){let n=this.visitCellExpression(t),i=this.visitCellExpression(r),s=Kt(n,i);if(s===null)throw new v("#NAME?");return s}else throw new v("#NAME?");break}case 26:{let t=this.convertToCellExpression(e.right);if(t===null)throw new v("#REF!");if(e.left instanceof oe)return this.visitCellExpression(new X(t.value,t.type,e.left.value));throw new v("#NAME?")}default:throw new v("#NAME?")}}visitGroupExpression(e){return this.evaluate(e.value)}visitPostUnaryExpression(e){let t=this.evaluate(e.left);switch(e.operator.type){case 13:return this.checkNumber(t),t*.01;default:throw new v("#VALUE!")}}evaluate(e){return e.accept(this)}};function Nt(o,e=new rt,t=new nt,r=_o){let n="";try{let i=new Je(o).scan(),s=new tt(i).parse(),a=new ot(s,e,t,r).interpret(),l=[];for(let c of s)l.push(c.toString());return n=l.join(""),{result:a,error:null,expressionStr:n}}catch(i){if(i instanceof v)return{result:null,error:i.value,expressionStr:n}}return{result:null,error:"#ERROR!",expressionStr:n}}var rt=class{map=new Map;sheetNameMap={};getKey(e,t,r=""){return`${e}_${t}_${r}`}setSheetNameMap(e){this.sheetNameMap=e}set(e,t,r,n){let i=this.getKey(e,t,r);this.map.set(i,n)}get(e,t,r=""){let n=this.getKey(e,t,r);return this.map.get(n)}convertSheetNameToSheetId(e){return e&&this.sheetNameMap[e]||""}},nt=class{map=new Map;set(e,t){this.map.set(e,t)}get(e){return this.map.get(e)}has(e){return this.map.has(e)}};var Wo=19,$o=68,bn=16384,Sn=1048576;function it(o){let e=o.map(t=>parseInt(t,10)).filter(t=>!isNaN(t));return e.sort((t,r)=>t-r),e}var st=class{currentSheetId="";workbook=[];worksheets={};mergeCells=[];customHeight={};customWidth={};history;customVariableMap={};constructor(e){this.history=e}getSheetList(){return this.workbook}setActiveCell(e){let t=this.workbook.findIndex(l=>l.sheetId===e.sheetId);if(t<0)return;let{row:r,col:n}=e,i=this.workbook[t];if(r<0||n<0||r>=i.rowCount||n>=i.colCount)return;let s=i.activeCell;if(Wt(s,e))return;let a=`workbook.${t}.activeCell`;this.history.pushRedo("set",a,{...s}),ae(this,a,{...e})}addSheet(){let e=Vt(this.workbook),t={...e,isHide:!1,colCount:Z,rowCount:q,activeCell:{row:0,col:0,rowCount:1,colCount:1,sheetId:e.sheetId}},r=this.workbook.findIndex(n=>n.sheetId===this.currentSheetId);r<0?this.workbook.push(t):this.workbook.splice(r+1,0,t),this.currentSheetId=t.sheetId}getSheetIndex(e){let t=e||this.currentSheetId,r=this.workbook.findIndex(i=>i.sheetId===t);z(r>=0);let n=0;if(r===0)for(n=r+1;n<=this.workbook.length-2&&this.workbook[n].isHide;)n++;else for(n=r-1;n>=1&&this.workbook[n].isHide;)n--;return{index:r,lastIndex:n}}deleteSheet(e){let t=this.workbook.filter(i=>!i.isHide);z(t.length>=2,"A workbook must contains at least on visible worksheet");let{index:r,lastIndex:n}=this.getSheetIndex(e);this.currentSheetId=this.workbook[n].sheetId,this.workbook.splice(r,1)}hideSheet(e){let t=this.workbook.filter(i=>!i.isHide);z(t.length>=2,"A workbook must contains at least on visible worksheet");let{index:r,lastIndex:n}=this.getSheetIndex(e);this.workbook[r].isHide=!0,this.currentSheetId=this.workbook[n].sheetId}unhideSheet(e){let{index:t}=this.getSheetIndex(e);this.workbook[t].isHide=!1,this.currentSheetId=this.workbook[t].sheetId}renameSheet(e,t){z(!!e,"You typed a invalid name for a sheet.");let r=this.getSheetInfo(t);r.name=e}getSheetInfo(e=this.currentSheetId){let t=this.workbook.find(r=>r.sheetId===e);return z(t!==void 0),t}setCurrentSheetId(e){this.currentSheetId=e,this.computeAllCell()}getCurrentSheetId(){return this.currentSheetId}fromJSON=e=>{Gt("fromJSON",e);let{worksheets:t={},workbook:r=[],mergeCells:n=[],customHeight:i={},customWidth:s={},customVariable:a={}}=e;this.worksheets=t,this.workbook=r,this.currentSheetId=r[0].sheetId||this.currentSheetId,this.mergeCells=n,this.customWidth=s,this.customHeight=i,this.customVariableMap=a,this.computeAllCell(),this.history.clear()};toJSON=()=>{let{worksheets:e,workbook:t,mergeCells:r,customHeight:n,customWidth:i,customVariableMap:s}=this;return{workbook:t,worksheets:e,mergeCells:r,customHeight:n,customWidth:i,customVariable:s}};setCellValue(e,t){let{row:r,col:n}=t,i=`worksheets[${this.currentSheetId}][${r}][${n}].value`;this.history.pushRedo("set",i,se(this,i,void 0)),ae(this,i,e)}setCellFormula(e,t){let{row:r,col:n}=t,i=`worksheets[${this.currentSheetId}][${r}][${n}].formula`;this.history.pushRedo("set",i,se(this,i,void 0)),ae(this,i,e)}setCellValues(e,t,r){let[n]=r,{row:i,col:s}=n;for(let a=0;a<e.length;a++)for(let l=0;l<e[a].length;l++){let c=e[a][l],d={row:i+a,col:s+l};t[a]&&t[a][l]&&this.setStyle(t[a][l],d),c.startsWith("=")?this.setCellFormula(c,d):(this.setCellFormula("",d),this.setCellValue(c,d))}this.computeAllCell()}setStyle(e,t){let r=`worksheets[${this.currentSheetId}][${t.row}][${t.col}].style`;this.history.pushRedo("set",r,se(this,r,{})),ae(this,r,e)}setCellStyle(e,t){let[r]=t,{row:n,col:i,rowCount:s,colCount:a}=r;for(let l=n,c=n+s;l<c;l++)for(let d=i,g=i+a;d<g;d++)this.setStyle(e,{row:l,col:d})}getCell=e=>{let{row:t,col:r,sheetId:n}=e,i=n||this.currentSheetId;return{...se(this,`worksheets[${i}][${t}][${r}]`,{}),row:t,col:r}};computeAllCell(){let e=this.worksheets[this.currentSheetId];if(A(e))return[];let t=Object.keys(e);for(let r of t){let n=Object.keys(e[r]);for(let i of n){let s=e[r][i];s?.formula&&(s.value=this.parseFormula(s.formula))}}}parseFormula(e){let t=this,r=Nt(e,{get:(n,i,s)=>t.getCell(new H(n,i,1,1,s)).value,set:()=>{},convertSheetNameToSheetId:n=>t.workbook.find(s=>s.name===n)?.sheetId||""},{set(n,i){t.customVariableMap[n]=i},get(n){return t.customVariableMap[n]},has(n){return n in t.customVariableMap}});return r.error?r.error:r.result}addRow(e,t){let r=this.worksheets[this.currentSheetId];if(A(r))return;let n=it(Object.keys(r));for(let s=n.length-1;s>=0;s--){let a=n[s];if(a<e)continue;let l=String(a+t);r[l]={...r[a]},r[a]={}}let i=this.getSheetInfo();i.rowCount>=Sn||(i.rowCount+=t)}addCol(e,t){let r=this.worksheets[this.currentSheetId];if(A(r))return;let n=this.getSheetInfo(),i=Object.keys(r);for(let s of i){let a=it(Object.keys(r[s]));for(let l=a.length-1;l>=0;l--){let c=a[l];if(c<e)continue;let d=String(c+t);r[s][d]={...r[s][c]},r[s][c]={}}}n.colCount>=bn||(n.colCount+=t)}deleteCol(e,t){let r=this.worksheets[this.currentSheetId];if(A(r))return;let n=this.getSheetInfo(),i=Object.keys(r);for(let s of i){let a=it(Object.keys(r[s]));for(let l=0;l<a.length;l++){let c=a[l];if(c<e)continue;let d=String(c-t);r[s][d]={...r[s][c]},r[s][c]={}}}n.colCount-=t}deleteRow(e,t){let r=this.worksheets[this.currentSheetId];if(A(r))return;let n=it(Object.keys(r));for(let s=0;s<n.length;s++){let a=n[s];if(a<e)continue;let l=String(a-t);r[l]={...r[a]},r[a]={}}let i=this.getSheetInfo();i.rowCount-=t}getColWidth(e){let t=this.customWidth[this.currentSheetId];return t&&typeof t[e]=="number"?t[e]:$o}setColWidth(e,t){this.customWidth[this.currentSheetId]=this.customWidth[this.currentSheetId]||{},this.customWidth[this.currentSheetId][e]=t}getRowHeight(e){let t=this.customHeight[this.currentSheetId];return t&&typeof t[e]=="number"?t[e]:Wo}setRowHeight(e,t){this.customHeight[this.currentSheetId]=this.customHeight[this.currentSheetId]||{},this.customHeight[this.currentSheetId][e]=t}canRedo(){return this.history.canRedo()}canUndo(){return this.history.canUndo()}undo(){this.canUndo()&&this.executeOperate(this.history.undo())}redo(){this.canRedo()&&this.executeOperate(this.history.redo())}record(){this.history.onChange()}executeOperate(e){for(let t of e){let{op:r,path:n,value:i}=t;switch(r){case"set":{this.history.pushUndo(r,n,se(this,n,void 0)),this.record(),ae(this,n,i);break}default:console.error(`not support type: ${r}`);break}}}};var Rt={workbook:[{sheetId:"1",name:"Sheet1",isHide:!1,activeCell:{row:2,col:2,rowCount:1,colCount:1,sheetId:""},colCount:Z,rowCount:q},{sheetId:"2",name:"test",isHide:!1,colCount:Z,rowCount:q,activeCell:{row:4,col:4,rowCount:2,colCount:2,sheetId:""}}],worksheets:{1:{0:{0:{value:"",style:{fontColor:"#ff0000"}},1:{value:"",formula:"=foo"},2:{value:""},3:{value:"\u8D85\u5927\u5B57",style:{fontSize:36}},4:{value:"\u8FD9\u662F\u4E00\u6BB5\u975E\u5E38\u957F\u7684\u6587\u6848\uFF0C\u9700\u8981\u6362\u884C\u5C55\u793A",style:{isWrapText:!0,underline:1}}},3:{0:{style:{fillColor:"red"}},1:{style:{fillColor:"red"}}},4:{0:{style:{fillColor:"red"}},1:{style:{fillColor:"red"}}}},2:{0:{0:{}}}},mergeCells:[{row:7,col:0,rowCount:2,colCount:2,sheetId:"1"}],customHeight:{1:{1:100}},customWidth:{1:{1:100}},customVariable:{foo:1}};var ve=class{undoList=[];redoList=[];undoItem=[];redoItem=[];constructor(){this.clear()}clearItem(){this.undoItem=[],this.redoItem=[]}onChange(){this.undoItem.length>0&&this.undoList.push(this.undoItem.slice()),this.redoItem.length>0&&this.redoList.push(this.redoItem.slice()),this.clearItem()}pushRedo(e,t,r){this.redoItem.push({op:e,path:t,value:r})}pushUndo(e,t,r){this.undoItem.push({op:e,path:t,value:r})}clear(){this.undoList=[],this.redoList=[],this.clearItem()}canRedo(){return this.redoList.length>0}canUndo(){return this.undoList.length>0}redo(){return this.redoList.pop()}undo(){return this.undoList.pop()}};function Ko(o){let e=Object.keys(k);for(let t of e)o.style.setProperty(`--${t}`,String(k[t]||""))}function Go(o=oo){let e=localStorage.getItem(Fe);if(e)return JSON.parse(e).map(n=>({value:n,label:n,disabled:!1}));let t=o.map(r=>({label:r,value:r,disabled:!Ae(r)}));return window.queryLocalFonts&&t.push({value:Oe,label:"--> get all installed fonts",disabled:!1}),t}function vn(o,e){let{top:t}=o.getDomRect(),r=o.getActiveCell(),n=o.getCell(r),i=o.computeCellPosition(r.row,r.col);if(i.top=t+i.top,n.style||(n.style={}),!n.style.fontFamily){let l="";for(let c of e.fontFamilyList)if(!c.disabled){l=String(c.value);break}n.style.fontFamily=l}let s=o.getSheetList().filter(l=>!l.isHide).map(l=>({value:l.sheetId,label:l.name}));return{activeCell:{...i,...n},sheetList:s,currentSheetId:o.getCurrentSheetId()}}function wn(){let o=document.createElement("canvas");return o.style.display="none",document.body.appendChild(o),o}var jo=(o,e)=>{let t=new fe(e,new ye(e,wn())),r=()=>{t.resize(),t.render({changeSet:new Set(["content"])})};r();let n=pt(o,e,r);return e.setHooks({copy:Jt,cut:Xt,paste:qt,modelChange:i=>{let s=vn(e,o);Object.assign(o,s),t.render({changeSet:i}),t.render({changeSet:e.getChangeSet()})}}),e.fromJSON(Rt),n};function Yo(){let o=new Se(new st(new ve));return o.addSheet(),window.controller=o,o}var En=o=>{let e=Go();Ko(document.documentElement);let t=Yo(),r=new Proxy(Ht,{set(i,s,a){let l=Reflect.set(i,s,a);return n(),l}}),n=()=>{wo(o,wt(r,t))};return r.fontFamilyList=e,n(),jo(r,t)};return er(In);})();

    for(var key in __export__) {
            exports[key] = __export__[key]
        }
    }));
//# sourceMappingURL=index.js.map
