/* 
MIT License

Copyright (c) 2020 Steve Xu

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
 
*/(function (global, factory) {
            typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :
            typeof define === 'function' && define.amd ? define(['exports'], factory) :
              (global = global || self, factory(global.excel = {}));
       })(this, (function (exports) { 'use strict';
"use strict";var __export__=(()=>{var at=Object.defineProperty;var Yo=Object.getOwnPropertyDescriptor;var Xo=Object.getOwnPropertyNames;var qo=Object.prototype.hasOwnProperty;var Zo=(o,e)=>{for(var t in e)at(o,t,{get:e[t],enumerable:!0})},Qo=(o,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Xo(e))!qo.call(o,r)&&r!==t&&at(o,r,{get:()=>e[r],enumerable:!(n=Yo(e,r))||n.enumerable});return o};var en=o=>Qo(at({},"__esModule",{value:!0}),o);var Ir={};Zo(Ir,{initExcel:()=>Er});function R(o=window.devicePixelRatio){return Math.max(Math.floor(o||1),1)}function v(o){return Math.floor(o*R())}function ne(){return 1}function j(){return navigator.userAgent.indexOf("Mac OS X")>-1}var J=11,W="#333333",Mt="#ff0000";var ue="sans-serif",At=[6,8,9,10,J,12,14,16,18,20,22,24,26,28,36,48,72];function de(o="normal",e="normal",t=12,n=""){let r=`${o} ${e} ${t}px `;return n?`${r}${n},${ue}`:r+ue}var Ie=de(void 0,"500",v(J));function Ot(o){let e="";return o.fontColor&&(e+=`color:${o.fontColor};`),o.fillColor&&(e+=`background-color:${o.fillColor};`),o.fontSize&&(e+=`font-size:${o.fontSize}pt;`),o.fontFamily&&(e+=`font-family:${o.fontFamily};`),o.isItalic&&(e+="font-style:italic;"),o.isBold&&(e+="font-weight:700;"),o.isWrapText&&(e+="white-space:normal;"),o.underline&&(e+="text-decoration:underline;",o.underline===2?e+="text-decoration-style: double;":e+="text-decoration-style: single;"),e}function tn(o,e){let{color:t,backgroundColor:n,fontSize:r,fontFamily:i,fontStyle:s,fontWeight:a,whiteSpace:l,textDecoration:c}=o,u={};if(t&&(u.fontColor=t),n&&(u.fillColor=n),r){let g=parseInt(r,10);isNaN(g)||(u.fontSize=g)}return i&&(u.fontFamily=i),s==="italic"&&(u.isItalic=!0),a&&["700","800","900","bold"].includes(a)&&(u.isBold=!0),l&&["normal","pre-wrap","pre-line","break-spaces","revert","unset"].includes(l)&&(u.isWrapText=!0),c==="underline"&&(u.underline=1,e.includes("text-underline-style:double")&&(u.underline=2)),u}function lt(o,e){for(let t of o){if(!t.sheet?.cssRules)continue;let n=t.textContent||"";for(let r of t.sheet?.cssRules)if(r instanceof CSSStyleRule&&r.selectorText===e){let i=n.indexOf(e),s=i;for(;n[s]!=="}"&&s<n.length;)s++;let a="";return i>=0&&(a=n.slice(i+e.length,s).replace(/\s/g,"")),tn(r.style,a)}}return{}}function _(o,e="assert error",t="production"){if(!o){if(t!=="test"&&window.alert(e),t==="production"){console.error(e);return}throw new Error(e)}}var Ft="Sheet",q=200,Z=30;var re=30,ct=200,ke=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],Te=256,Dt=new Set(["#ERROR!","#DIV/0!","#NULL!","#NUM!","#REF!","#VALUE!","#N/A","#NAME?"]),Ht={sheetList:[],currentSheetId:"",isCellEditing:!1,activeCell:{value:"",style:{},row:0,col:0,left:-999,top:-999,width:0,height:0},fontFamilyList:[],contextMenuPosition:void 0,sheetBarContextMenuLeft:void 0,isSheetNameEditing:!1};function Ne(o){if(typeof o=="number"&&!window.isNaN(o))return!0;if(typeof o!="string")return!1;let e=parseFloat(o);return!window.isNaN(e)}function on(o){return Ne(o)?Number(o):0}function Pt(o){let e=[];for(let t=0;t<o.length;t++){let n=on(o[t]);window.isNaN(n)||e.push(n)}return e}function nn(o=[]){let e=o.map(t=>Ne(t)?parseInt(t,10):0).filter(t=>!isNaN(t));return Math.max(Math.max(...e),0)}function Vt(o=[]){let e=nn(o.map(t=>t.sheetId))+1;return{name:`${Ft}${e}`,sheetId:String(e)}}function Ut(){return!1}function _t(o=""){let e=o.toUpperCase(),t=0;for(let n=0;n<e.length;n++)t=e.charCodeAt(n)-64+t*26;return t-1}function Re(o){let e=o+1,t="",n=Math.floor(Math.abs(e)),r;for(;n>0;)r=(n-1)%26,t=String.fromCharCode(65+r)+t,n=Math.floor((n-r)/26);return t.toUpperCase()}function zt(o){let e=parseInt(o,10);return window.isNaN(e)?e=-1:e=Math.max(e-1,-1),e}function D(...o){let e="";for(let t of o)if(typeof t=="string"&&t&&(e+=`${t} `),typeof t=="object")for(let n of Object.keys(t))t[n]&&(e+=`${n} `);return e.trim()}function Bt(o){return ht(o)&&ut(o)}function ht(o){return o.col===o.rowCount&&o.rowCount===0}function ut(o){return o.row===o.colCount&&o.colCount===0}function Wt(o,e){return!o||!e?!1:o.col===e.col&&o.row===e.row&&o.colCount===e.colCount&&o.rowCount===e.rowCount&&o.sheetId===e.sheetId}var H=class o{row=0;col=0;colCount=0;rowCount=0;sheetId="";constructor(e,t,n,r,i){this.row=e,this.col=t,this.colCount=r,this.rowCount=n,this.sheetId=i}isValid(){return this.row>=0&&this.col>=0&&this.colCount>=0&&this.rowCount>=0}static makeRange(e){return new o(e.row,e.col,e.rowCount,e.colCount,e.sheetId)}};var rn=o=>o>="a"&&o<="z"||o>="A"&&o<="Z",sn=o=>o>="0"&&o<="9";function an(o){return o}function $t(o,e=an){if(typeof o!="string"||!o)return null;let t=o.trim(),[n,r=""]=t.split("!");t.includes("!")||(n="",r=t);let i=0,s="",a="";for(r[i]==="$"&&i++;rn(r[i]);)a+=r[i++];for(r[i]==="$"&&i++;sn(r[i]);)s+=r[i++];if(i!==r.length||!s&&!a)return null;let l=1,c=1,u=0,g=0;return s===""?(c=0,l=q):u=zt(s),a===""?(c=Z,l=0):g=_t(a),u===-1||g===-1?null:new H(u,g,l,c,e(n))}function Kt(o,e){if(o.sheetId!==e.sheetId)return null;let t=Math.abs(o.row-e.row)+1,n=Math.abs(o.col-e.col)+1,r=o.row<e.row?o.row:e.row,i=o.col<e.col?o.col:e.col;return new H(r,i,t,n,o.sheetId)}var ie=class o{namespace;static colorMap=new Map;static enableMap=new Map([]);constructor(e){this.namespace=e}init=()=>(this.setColor(),this.log);log=(...e)=>{if(!this.enable())return;let{namespace:t}=this,n=o.colorMap.get(t),r=[`%c ${t}:`,`color:${n};`,...e];console.log(...r)};getRandomColor=()=>{let e=Math.floor(Math.random()*ke.length);return _(e>=0&&e<ke.length,String(e)),ke[e]};enable(){return this.checkEnable()&&o.enableMap.get(this.namespace)!==!1}checkEnable(e=window.localStorage){return e.getItem("debug")==="*"}setColor(){o.colorMap.has(this.namespace)||o.colorMap.set(this.namespace,this.getRandomColor())}},Le=new ie("react").init(),Me=new ie("controller").init(),si=new ie("canvas").init(),Gt=new ie("model").init();function ln(o=document.body){let e="monospace",t="serif",n=document.createElement("span");n.innerHTML="\u6D4B\u8BD5a11",n.style.cssText=["position:absolute","width:auto","font-size:128px","left:-99999px"].join(" !important;");let r=function(c){n.style.fontFamily=c,o.appendChild(n);let u=n.clientWidth;return o.removeChild(n),u},i=r(e),s=r(t),a=r(ue);return function(c){return i!==r(`${c},${e}`)||a!==r(`${c},${ue}`)||s!==r(`${c},${t}`)}}var Ae=ln();var M="text/plain",z="text/html";function cn(o){let e=o.hasAttribute("readonly");return e||o.setAttribute("readonly",""),o.select(),o.setSelectionRange(0,o.value.length),e||o.removeAttribute("readonly"),o.value}function hn(o){let e=document.documentElement.getAttribute("dir")==="rtl",t=document.createElement("textarea");t.style.fontSize="12pt",t.style.border="0",t.style.padding="0",t.style.margin="0",t.style.position="absolute",t.style[e?"right":"left"]="-9999px";let n=window.pageYOffset||document.documentElement.scrollTop;return t.style.top=`${n}px`,t.setAttribute("readonly",""),t.value=o,t}function jt(o){let e={},t=Object.keys(o);for(let r of t)e[r]=new Blob([o[r]],{type:r});let n=[new ClipboardItem(e)];return navigator.clipboard.write(n)}async function un(){let o={[z]:"",[M]:""},e=await navigator.clipboard.read();for(let t of e){if(t.types.includes(M)){let n=await t.getType(M);o[M]=await n.text()}if(t.types.includes(z)){let n=await t.getType(z);o[z]=await n.text()}}return o}var Jt=(o,e,t)=>{let n=hn(o);e.appendChild(n);let r=cn(n);return document.execCommand(t),n.remove(),r};async function Yt(o){try{return await jt(o),o[M]}catch(e){return console.error(e),Jt(o[M],document.body,"copy")}}async function Xt(o){try{return await jt(o),o[M]}catch(e){return console.error(e),Jt(o[M],document.body,"cut")}}async function qt(){try{return un()}catch(o){console.error(o);let e=await navigator.clipboard.readText();return{[z]:"",[M]:e}}}function Zt(o,e){return`<html
  xmlns:v="urn:schemas-microsoft-com:vml"
  xmlns:o="urn:schemas-microsoft-com:office:office"
  xmlns:x="urn:schemas-microsoft-com:office:excel"
  xmlns="http://www.w3.org/TR/REC-html40"
>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="ProgId" content="Excel.Sheet" />
    <meta name="Generator" content="Microsoft Excel 15" />
    <style>
       {
        mso-displayed-decimal-separator: '.';
        mso-displayed-thousand-separator: ',';
      }
      @page {
        margin: 0.75in 0.7in 0.75in 0.7in;
        mso-header-margin: 0.3in;
        mso-footer-margin: 0.3in;
      }
      .font5 {
        color: windowtext;
        font-size: 9pt;
        font-weight: 400;
        font-style: normal;
        text-decoration: none;
        font-family: \u7B49\u7EBF;
        mso-generic-font-family: auto;
        mso-font-charset: 134;
      }
      tr {
        mso-height-source: auto;
        mso-ruby-visibility: none;
      }
      col {
        mso-width-source: auto;
        mso-ruby-visibility: none;
      }
      br {
        mso-data-placement: same-cell;
      }
      td {
        padding-top: 1px;
        padding-right: 1px;
        padding-left: 1px;
        mso-ignore: padding;
        color: black;
        font-size: 11pt;
        font-weight: 400;
        font-style: normal;
        text-decoration: none;
        font-family: \u7B49\u7EBF;
        mso-generic-font-family: auto;
        mso-font-charset: 134;
        mso-number-format: General;
        text-align: general;
        vertical-align: middle;
        border: none;
        mso-background-source: auto;
        mso-pattern: auto;
        mso-protection: locked visible;
        white-space: nowrap;
        mso-rotate: 0;
      }
      ${o}
      ruby {
        ruby-align: left;
      }
      rt {
        color: windowtext;
        font-size: 9pt;
        font-weight: 400;
        font-style: normal;
        text-decoration: none;
        font-family: \u7B49\u7EBF;
        mso-generic-font-family: auto;
        mso-font-charset: 134;
        mso-char-type: none;
        display: none;
      }
    </style>
  </head>

  <body link="#0563C1" vlink="#954F72">
    <table
      border="0"
      cellpadding="0"
      cellspacing="0"
      width="103"
      style="border-collapse: collapse; width: 77pt"
    >
      <col
        width="103"
        style="mso-width-source: userset; mso-width-alt: 3515; width: 77pt"
      />
      ${e}
    </table>
  </body>
</html>`}var Qt=o=>{let e;return(...t)=>{cancelAnimationFrame(e),e=requestAnimationFrame(()=>{o(...t)})}};function se(o,e,t){let n=o==null?void 0:e.replace(/\[/g,".").replace(/\]/g,"").split(".").reduce((r,i)=>r==null?r:r[i],o);return n===void 0?t:n}function A(o){let e=o||{};return[Object,Array].includes(e.constructor)&&!Object.entries(e).length}function ae(o,e,t){return o==null||typeof o!="object"||e.replace(/\[/g,".").replace(/\]/g,"").split(".").reduce((n,r,i,s)=>(i===s.length-1?n[r]=t:n[r]==null&&(n[r]={}),n[r]),o),o}var dn={smallFont:"10px",font:"12px",largeFont:"14px",padding:"12px",lineHeight:"1.5",mediumPadding:"8px",borderRadius:"4px",tinyPadding:"4px"},eo=dn;var pn={primaryColor:"#217346",buttonActiveColor:"rgb(198,198,198)",selectionColor:"rgba(198,198,198,0.3)",backgroundColor:"#e6e6e6",white:"#ffffff",black:"#000000",gridStrokeColor:"#d4d4d4",triangleFillColor:"#b4b4b4",contentColor:W,borderColor:"#cccccc",activeBorderColor:"#808080",disabledColor:"#ccc"},to=pn;var k={...eo,...to};var Oe="QUERY_ALL_LOCAL_FONT",Fe="LOCAL_FONT_KEY",oo=["\u7B49\u7EBF","\u7B49\u7EBF Light","\u65B9\u6B63\u8212\u4F53","\u65B9\u6B63\u59DA\u4F53","\u4EFF\u5B8B","\u9ED1\u4F53","\u534E\u6587\u5F69\u4E91","\u534E\u6587\u4EFF\u5B8B","\u534E\u6587\u7425\u73C0","\u534E\u6587\u6977\u4F53","\u534E\u6587\u96B6\u4E66","\u534E\u6587\u5B8B\u4F53","\u534E\u6587\u7EC6\u9ED1","\u534E\u6587\u65B0\u9B4F","\u534E\u6587\u884C\u6977","\u534E\u6587\u4E2D\u5B8B","\u6977\u4F53","\u96B6\u4E66","\u5B8B\u4F53","\u5FAE\u8F6F\u96C5\u9ED1","\u5FAE\u8F6F\u96C5\u9ED1 Light","\u65B0\u5B8B\u4F53","\u5E7C\u5706","Arial","Arial Narrow","Cascadia Code","Cascadia Code ExtraLight","Cascadia Code Light","Cascadia Code PL","Cascadia Code PL ExtraLight","Cascadia Code PL Light","Cascadia Code PL SemiBold","Cascadia Code SemiBold","Cascadia Mono","Cascadia Mono ExtraLight","Cascadia Mono Light","Cascadia Mono PL","Cascadia Mono PL ExtraLight","Cascadia Mono PL Light","Cascadia Mono PL SemiBold","Cascadia Mono SemiBold","Microsoft JhengHei","Microsoft JhengHei Light","Microsoft JhengHei UI","Microsoft JhengHei UI Light","Microsoft New Tai Lue","Microsoft PhagsPa","Microsoft Sans Serif","Microsoft Tai Le","Microsoft Yahei UI","Microsoft YaHei UI Light","Microsoft Yi Baiti","SimSun-ExtB","Times New Roman","Yu Gothic Light","Yu Gothic Medium","Yu Gothic Regular","Yu Gothic UI Light","Yu Gothic UI Regular","Yu Gothic UI Semibold"];function De(o,e){let t=e.getDomRect(),n=e.getScroll(),r=e.getSheetInfo(e.getCurrentSheetId()),i=e.getHeaderSize(),{pageX:s,pageY:a}=o,l=s-t.left,c=a-t.top,u=i.width,g=i.height,h=n.row,p=n.col;for(;u+e.getColWidth(p)<=l;)u+=e.getColWidth(p),p++;for(;g+e.getRowHeight(h)<=c;)g+=e.getRowHeight(h),h++;return h>=r.rowCount||p>=r.colCount?null:{...e.getCellSize(h,p),row:h,col:p,pageY:a,pageX:s,x:l,y:c}}function mn(o,e){return Le("createElement"),document.createElement(o,e)}function fn(o,e,t){return Le("createElementNS"),document.createElementNS(o,e,t)}function gn(o){return Le("createTextNode"),document.createTextNode(o)}function Cn(o,e,t){o.insertBefore(e,t)}function yn(o,e){o.removeChild(e)}function Sn(o,e){o.appendChild(e)}function xn(o){return o.parentNode}function vn(o){return o.nextSibling}function wn(o,e){o.textContent=e}function bn(o){return o.nodeType===1}var He={createElement:mn,createElementNS:fn,createTextNode:gn,insertBefore:Cn,removeChild:yn,appendChild:Sn,parentNode:xn,nextSibling:vn,setTextContent:wn,isElement:bn};var En="http://www.w3.org/2000/svg";function no(o){if(o.data.ns=En,o.data?.props?(o.data.attrs=Object.assign(o.data.props||{},o.data?.attrs||{}),o.data.props=void 0):o.data.attrs={},o.data.attrs.class=o.data.className||"",o.data.className=void 0,o.children)for(let e of o.children)e&&no(e)}function S(o,e,...t){let n=e.key===void 0?void 0:e.key,r={hook:e.hook,style:e.style,key:e.key,className:e.className},i=[],s=[],a=t||[];for(let u of a)if(typeof u=="string"||typeof u=="number"){let g=String(u);g&&s.push(g)}else u&&typeof u=="object"&&i.push(u);let l=Object.keys(e);for(let u of l){if(["className","style","key","ns","is"].includes(u))continue;let g=e[u];u.startsWith("data-")?(r.dataset||(r.dataset={}),r.dataset[u.slice(5)]=g):u.startsWith("on")?(r.on||(r.on={}),r.on[u.slice(2)]=g):(r.props||(r.props={}),r.props[u]=g)}let c={sel:o,data:r,key:n,elm:void 0,children:[],text:void 0};if(s.length>0&&i.length>0)throw new Error("error node");return s.length>0&&(c.text=s.join(" ")),i.length>0&&(c.children=i),c.sel==="svg"&&no(c),c}function ro(o){return o===void 0}function V(o){return o!==void 0}var io=S("",{});function pe(o,e){let t=o.key===e.key,n=o.data?.is===e.data?.is,r=o.sel===e.sel,i=!o.sel&&o.sel===e.sel?typeof o.text==typeof e.text:!0;return r&&t&&n&&i}function In(o,e){return o.isElement(e)}function kn(o,e,t){let n={};for(let r=e;r<=t;++r){let i=o[r]?.key;i!==void 0&&(n[i]=r)}return n}var Tn=["create","update","remove","destroy","pre","post"];function so(o,e){let t={create:[],update:[],remove:[],destroy:[],pre:[],post:[]},n=e!==void 0?e:He;for(let h of Tn)for(let p of o){let m=p[h];m!==void 0&&t[h].push(m)}function r(h,p){return function(){if(--p===0){let d=n.parentNode(h);n.removeChild(d,h)}}}function i(h,p){let m,d=h.data;if(d!==void 0){let C=d.hook?.init;C&&(C(h),d=h.data)}let f=h.children,y=h.sel;if(y!==void 0){let C=h.elm=V(d)&&V(m=d.ns)?n.createElementNS(m,y,d):n.createElement(y,d);for(m=0;m<t.create.length;++m)t.create[m](io,h);if(Array.isArray(f)&&f.length>0)for(m=0;m<f.length;++m){let b=f[m];b!=null&&n.appendChild(C,i(b,p))}else(typeof h.text=="string"||typeof h.text=="number")&&n.appendChild(C,n.createTextNode(h.text));let x=h.data.hook;V(x)&&(x.create?.(io,h),x.insert&&p.push(h))}else h.elm=n.createTextNode(h.text);return h.elm}function s(h,p,m,d,f,y){for(;d<=f;++d){let C=m[d];C!=null&&n.insertBefore(h,i(C,y),p)}}function a(h){let p=h.data;if(p!==void 0){p?.hook?.destroy?.(h);for(let m=0;m<t.destroy.length;++m)t.destroy[m](h);if(h.children!==void 0)for(let m=0;m<h.children.length;++m){let d=h.children[m];d!=null&&typeof d!="string"&&a(d)}}}function l(h,p,m,d){for(;m<=d;++m){let f,y,C=p[m];if(C!=null)if(V(C.sel)){a(C),f=t.remove.length+1,y=r(C.elm,f);for(let b=0;b<t.remove.length;++b)t.remove[b](C,y);let x=C?.data?.hook?.remove;V(x)?x(C,y):y()}else C.children?(a(C),l(h,C.children,0,C.children.length-1)):n.removeChild(h,C.elm)}}function c(h,p,m,d){let f=0,y=0,C=p.length-1,x=p[0],b=p[C],I=m.length-1,E=m[0],O=m[I],F,G,be,Lt;for(;f<=C&&y<=I;)x==null?x=p[++f]:b==null?b=p[--C]:E==null?E=m[++y]:O==null?O=m[--I]:pe(x,E)?(u(x,E,d),x=p[++f],E=m[++y]):pe(b,O)?(u(b,O,d),b=p[--C],O=m[--I]):pe(x,O)?(u(x,O,d),n.insertBefore(h,x.elm,n.nextSibling(b.elm)),x=p[++f],O=m[--I]):pe(b,E)?(u(b,E,d),n.insertBefore(h,b.elm,x.elm),b=p[--C],E=m[++y]):(F===void 0&&(F=kn(p,f,C)),G=F[E.key],ro(G)?n.insertBefore(h,i(E,d),x.elm):(be=p[G],be.sel!==E.sel?n.insertBefore(h,i(E,d),x.elm):(u(be,E,d),p[G]=void 0,n.insertBefore(h,be.elm,x.elm))),E=m[++y]);y<=I&&(Lt=m[I+1]==null?null:m[I+1].elm,s(h,Lt,m,y,I,d)),f<=C&&l(h,p,f,C)}function u(h,p,m){let d=p.data?.hook;d?.prePatch?.(h,p);let f=p.elm=h.elm;if(h===p)return;if(p.data!==void 0||V(p.text)&&p.text!==h.text){p.data??={},h.data??={};for(let x=0;x<t.update.length;++x)t.update[x](h,p);p.data?.hook?.update?.(h,p)}let y=h.children,C=p.children;ro(p.text)?V(y)&&V(C)?y!==C&&c(f,y,C,m):V(C)?(V(h.text)&&n.setTextContent(f,""),s(f,null,C,0,C.length-1,m)):V(y)?l(f,y,0,y.length-1):V(h.text)&&n.setTextContent(f,""):h.text!==p.text&&(V(y)&&l(f,y,0,y.length-1),n.setTextContent(f,p.text)),d?.postPatch?.(h,p),d?.ref&&d?.ref(p.elm)}function g(h,p){let m,d,f,y=[];for(m=0;m<t.pre.length;++m)t.pre[m]();if(In(n,h))return i(p,y),n.appendChild(h,p.elm),p;for(pe(h,p)?u(h,p,y):(d=h.elm,f=n.parentNode(d),i(p,y),f!==null&&(n.insertBefore(f,p.elm,n.nextSibling(d)),l(f,[h],0,0))),m=0;m<y.length;++m)y[m].data.hook.insert(y[m]);for(m=0;m<t.post.length;++m)t.post[m]();return p}return g}var Nn="http://www.w3.org/1999/xlink",Rn="http://www.w3.org/XML/1998/namespace",ao=58,Ln=120;function lo(o,e){let t,n=e.elm,r=o.data.attrs,i=e.data.attrs;if(!(!r&&!i)&&r!==i){r=r||{},i=i||{};for(t in i){let s=i[t];r[t]!==s&&(s===!0?n.setAttribute(t,""):s===!1?n.removeAttribute(t):t.charCodeAt(0)!==Ln?n.setAttribute(t,s):t.charCodeAt(3)===ao?n.setAttributeNS(Rn,t,s):t.charCodeAt(5)===ao?n.setAttributeNS(Nn,t,s):n.setAttribute(t,s))}for(t in r)t in i||n.removeAttribute(t)}}var co={create:lo,update:lo};function ho(o,e){let t=e.elm,n=o.data.className,r=e.data.className;n!==r&&(t.className=r||"")}var uo={create:ho,update:ho};var Pe=/[A-Z]/g;function po(o,e){let t=e.elm,n=o.data.dataset,r=e.data.dataset,i;if(!n&&!r||n===r)return;n=n||{},r=r||{};let s=t.dataset;for(i in n)r[i]||(s?i in s&&delete s[i]:t.removeAttribute("data-"+i.replace(Pe,"-$&").toLowerCase()));for(i in r)n[i]!==r[i]&&(s?s[i]=r[i]:t.setAttribute("data-"+i.replace(Pe,"-$&").toLowerCase(),r[i]))}var mo={create:po,update:po};function fo(o,e,t){if(typeof o=="function"){let n=t||{};o.call(e,n,e)}else if(typeof o=="object")for(let n=0;n<o.length;n++)fo(o[n],e,t)}function Mn(o,e){let t=o.type,n=e.data?.on;n&&n[t]&&fo(n[t],e,o)}function An(){return function o(e){Mn(e,o.vNode)}}function dt(o,e){let t=o.data?.on,n=o.listener,r=o.elm,i=e?.data?.on,s=e&&e.elm,a;if(t!==i){if(t&&n)if(i)for(a in t)i[a]||r.removeEventListener(a,n,!1);else for(a in t)r.removeEventListener(a,n,!1);if(i){let l=e.listener=o.listener||An();if(l.vNode=e,t)for(a in i)t[a]||s.addEventListener(a,l,!1);else for(a in i)s.addEventListener(a,l,!1)}}}var go={create:dt,update:dt,destroy:dt};function Co(o,e){let t,n,r,i=e.elm,s=o.data.props,a=e.data.props;if(!(!s&&!a)&&s!==a){s=s||{},a=a||{};for(t in a)n=a[t],r=s[t],r!==n&&(t!=="value"||i[t]!==n)&&(i[t]=n)}}var yo={create:Co,update:Co};var So=o=>o.replace(Pe,"-$&").toLowerCase();function xo(o,e){let t,n=e.elm,r=o.data.style,i=e.data.style;if(!(!r&&!i)&&r!==i){r=r||{},i=i||{};for(t in r)i[t]||(t.slice(0,2)==="--"?n.style.removeProperty(t):n.style[So(t)]="");for(t in i)if(i[t]!==r[t])if(t.slice(0,2)==="--")n.style.setProperty(t,i[t]);else{let s=So(t),a=i[t];typeof a=="number"?n.style[s]=a+"px":n.style[s]=a}}}var vo={create:xo,update:xo};var wo=so([co,uo,mo,go,yo,vo],He);function bo(o,e){let t=o,n;return t.vDom?n=wo(t.vDom,e):n=wo(t,e),t.vDom=n,n}var Eo=new Map;function On(o,e){let t=`${e}__${o.font}`,n=Eo.get(t);if(!n){let{actualBoundingBoxDescent:r,actualBoundingBoxAscent:i,width:s}=o.measureText(e),a={width:Math.ceil(s/R()),height:Math.ceil((r+i)/R())};Eo.set(t,a),n=a}return n}function L(o,e,t,n,r){o.fillRect(v(e),v(t),v(n),v(r))}function le(o,e,t,n,r){o.strokeRect(v(e),v(t),v(n),v(r))}function ko(o,e,t,n,r){o.clearRect(v(e),v(t),v(n),v(r))}function me(o,e,t,n){o.fillText(e,v(t),v(n))}function Fn(o){let e=String(o);return typeof o=="boolean"||["TRUE","FALSE"].includes(e.toUpperCase())?e=e.toUpperCase():o==null&&(e=""),e}function Ve(o,e){let{style:t,value:n,left:r,top:i,width:s,height:a}=e,l=Ne(n),c=Ie,u=W;if(!A(t)){let f=t?.fontSize?t.fontSize:J;c=de(t?.isItalic?"italic":"normal",t?.isBold?"bold":"500",v(f),t?.fontFamily),u=t?.fontColor||W,t?.fillColor&&(o.fillStyle=t?.fillColor,L(o,r,i,s,a))}let g=Fn(n);Dt.has(g)&&(u=Mt);let h={},p=[...g];if(p.length===0)return h;o.textAlign=l?"right":"left",o.font=c,o.fillStyle=u,o.textBaseline="middle";let m=[];for(let f of p)if(f){let y=On(o,f);m.push({...y,char:f})}if(m.length===0)return h;let d=r+(l?s:0);if(t?.underline&&(o.strokeStyle=u),t?.isWrapText){let f=i,y=4;for(let C=0;C<m.length;){let x=s,b=C;for(;C<m.length&&m[C].width<x;)x-=m[C].width,C++;if(b!==C){let I=0,E=[];for(let F=b;F<C;F++)m[F].height>I&&(I=m[F].height),E.push(m[F].char);h.fontSizeHeight=Math.max(h.fontSizeHeight||0,I),f=f+Math.floor(I/2)+y;let O=E.join("");if(me(o,O,d,f),t?.underline){let F=Math.floor(f+I/2),G=[];l?G=[[r,F],[r+s,F]]:G=[[d,F],[d+s,F]],Io(o,G,t?.underline)}f=f+Math.floor(I/2)}}f+=y,h.wrapHeight=f-i}else{let f=Math.max(...m.map(E=>E.height),0);h.fontSizeHeight=f;let y=Math.max(0,Math.floor(a-f)/2),C=Math.floor(i+f/2+y),x=0,b=[],I=s;for(let E=0;E<m.length;E++)m[E].width<I&&(I-=m[E].width,b.push(m[E].char),x+=m[E].width);if(me(o,b.join(""),d,C),t?.underline){let E=Math.floor(C+f/2),O=[];l?O=[[r,E],[r+x,E]]:O=[[d,E],[d+x,E]],Io(o,O,t?.underline)}}return h}function $(o,e){_(e.length>0),o.beginPath();for(let t=0;t<e.length;t+=2){let n=e[t],r=e[t+1];o.moveTo(v(n[0]),v(n[1])),o.lineTo(v(r[0]),v(r[1]))}o.stroke()}function To(o,e,t,n){o.beginPath(),o.moveTo(v(e[0]),v(e[1])),o.lineTo(v(t[0]),v(t[1])),o.lineTo(v(n[0]),v(n[1])),o.fill()}function No(o,e,t,n,r){let i=o.getLineDash();o.setLineDash([v(8),v(6)]);let s=R()/2;le(o,e+s,t+s,n-s*2,r-s*2),o.setLineDash(i)}function Io(o,e,t){let[n,r]=e,i=R(),s=[[n[0],n[1]-i],[r[0],r[1]-i]];if(t===2){let a=i*2;s.push([n[0],n[1]-a],[r[0],r[1]-a])}$(o,s)}function Ue(o,e,t){o.style.width=e+"px",o.style.height=t+"px";let n=v(e),r=v(t);o.width=n,o.height=r}var fe=class{ctx;content;canvas;controller;constructor(e,t){let n=e.getMainDom().canvas;this.canvas=n,this.controller=e,this.ctx=n.getContext("2d"),this.content=t;let r=R();this.ctx.scale(r,r)}resize(){let{width:e,height:t}=this.controller.getDomRect();Ue(this.canvas,e,t),this.content.resize()}clear(){let{width:e,height:t}=this.controller.getDomRect();this.ctx.clearRect(0,0,v(e),v(t))}render=e=>{if(e.changeSet.size===0)return;this.content.render(e),this.clear(),this.ctx.drawImage(this.content.getCanvas(),0,0);let t=this.renderSelection();this.renderAntLine(t)};renderAntLine(e){let{controller:t}=this,n=t.getCopyRanges();if(n.length===0)return;let[r]=n;r.sheetId===t.getCurrentSheetId()&&(this.ctx.strokeStyle=k.primaryColor,this.ctx.lineWidth=R(),No(this.ctx,e.left,e.top,e.width,e.height))}renderSelection(){let{controller:e}=this,t=e.getActiveCell();return Bt(t)?this.renderSelectAll():ut(t)?this.renderSelectCol():ht(t)?this.renderSelectRow():this.renderSelectRange()}renderActiveCell(){let{controller:e}=this,t=e.getCell(e.getActiveCell()),n=e.computeCellPosition(t.row,t.col);ko(this.ctx,n.left,n.top,n.width,n.height),Ve(this.ctx,{...t,...n})}renderSelectRange(){let{controller:e}=this,t=e.getHeaderSize(),n=e.getActiveCell(),r=e.computeCellPosition(n.row,n.col),i=n.row+n.rowCount-1,s=n.col+n.colCount-1,a=e.computeCellPosition(i,s),l=a.left+a.width-r.left,c=a.top+a.height-r.top;this.ctx.fillStyle=k.selectionColor,L(this.ctx,r.left,0,l,t.height),L(this.ctx,0,r.top,t.width,c);let u=n.rowCount>1||n.colCount>1;u&&L(this.ctx,r.left,r.top,l,c),this.ctx.strokeStyle=k.primaryColor,this.ctx.lineWidth=R();let g=[[r.left,t.height],[r.left+l,t.height]];return g.push([t.width,r.top],[t.width,r.top+c]),$(this.ctx,g),u&&this.renderActiveCell(),le(this.ctx,r.left,r.top,l,c),{left:r.left,top:r.top,width:l,height:c}}renderSelectAll(){let{controller:e}=this,{width:t,height:n}=this.controller.getDomRect();this.ctx.fillStyle=k.selectionColor,L(this.ctx,0,0,t,n);let r=e.getHeaderSize();return this.ctx.strokeStyle=k.primaryColor,this.ctx.lineWidth=R(),this.renderActiveCell(),le(this.ctx,r.width,r.height,t-r.width,n-r.height),{left:r.width,top:r.height,width:t-r.width,height:n-r.height}}renderSelectCol(){let{controller:e}=this,t=e.getHeaderSize(),n=e.getActiveCell(),{height:r}=e.getDomRect();this.ctx.fillStyle=k.selectionColor;let i=e.computeCellPosition(n.row,n.col);L(this.ctx,i.left,0,i.width,t.height),L(this.ctx,0,i.top,t.width,r),L(this.ctx,i.left,i.top+i.height,i.width,r-i.height),this.ctx.strokeStyle=k.primaryColor,this.ctx.lineWidth=R();let s=[[t.width,t.height],[t.width,r-t.height]];return $(this.ctx,s),le(this.ctx,i.left,i.top,i.width,r),{left:i.left,top:i.top,width:i.width,height:r}}renderSelectRow(){let{controller:e}=this,t=e.getHeaderSize(),n=e.getActiveCell(),{width:r}=e.getDomRect();this.ctx.fillStyle=k.selectionColor;let i=e.computeCellPosition(n.row,n.col);L(this.ctx,i.left,0,r,t.height),L(this.ctx,0,i.top,t.width,i.height),L(this.ctx,i.left+i.width,i.top,r-i.width,i.height),this.ctx.strokeStyle=k.primaryColor,this.ctx.lineWidth=R();let s=[[i.left,t.height],[r-t.width,t.height]];return $(this.ctx,s),le(this.ctx,i.left,i.top,r,i.height),{left:i.left,top:i.top,width:r,height:i.height}}};function ze(o,e,t){let n=o.getScroll(),{row:r,col:i}=n;if(n.top!==t){r=0;let s=t;for(;s>0;){let a=o.getRowHeight(r);if(a>s)break;s-=a,r++}}if(n.left!==e){i=0;let s=e;for(;s>0;){let a=o.getColWidth(i);if(a>s)break;s-=a,i++}}return{row:r,col:i}}function ge(o,e,t){let n=o.getHeaderSize(),r=o.getDomRect(),i=o.getViewSize(),s=i.height-r.height+ct,a=i.width-r.width+ct,l=r.height-n.height-re*1.5,c=r.width-n.width-re*1.5,u=Math.floor(t*l/s),g=Math.floor(e*c/a);return{maxHeight:s,maxWidth:a,maxScrollHeight:l,maxScrollWidth:c,scrollTop:u,scrollLeft:g}}function ce(o,e,t){let n=o.getScroll(),{maxHeight:r,maxWidth:i,maxScrollHeight:s,maxScrollWidth:a}=ge(o,n.left,n.top),l=n.top+Math.ceil(t);l<0?l=0:l>r&&(l=r);let c=n.left+Math.ceil(e);c<0?c=0:c>i&&(c=i);let{row:u,col:g}=ze(o,c,l),h=Math.floor(l*s/r),p=Math.floor(c*a/i);o.setScroll({row:u,col:g,top:l,left:c,scrollTop:h,scrollLeft:p})}function _e(o){let e=o.getActiveCell(),t=o.computeCellPosition(e.row,e.col),n=o.getDomRect(),r=o.getScroll(),i=o.getSheetInfo(o.getCurrentSheetId()),s=o.getHeaderSize(),a=5,{maxHeight:l,maxWidth:c,maxScrollHeight:u,maxScrollWidth:g}=ge(o,r.left,r.top);if(t.left+t.width+a>n.width&&r.col<=i.colCount-2){let h=r.col+1,p=r.left+o.getColWidth(r.col),m=Math.floor(p*g/c);o.setScroll({...r,col:h,left:p,scrollLeft:m})}if(t.left-s.width<n.left+a&&r.col>=1){let h=r.col-1,p=r.left-o.getColWidth(r.col),m=Math.floor(p*g/c);o.setScroll({...r,col:h,left:p,scrollLeft:m})}if(t.top+t.height+a>n.height&&r.row<=i.rowCount-2){let h=r.row+1,p=r.top+o.getRowHeight(r.row),m=Math.floor(p*u/l);o.setScroll({...r,row:h,top:p,scrollTop:m})}if(t.top-s.height<n.top+a&&r.row>=1){let h=r.row-1,p=r.top-o.getRowHeight(r.row),m=Math.floor(p*u/l);o.setScroll({...r,row:h,top:p,scrollTop:m})}}function B(o){let e=o.getMainDom().input;document.activeElement===e&&(o.setCellValues([[e.value]],[],[o.getActiveCell()]),e.value="",e.blur())}var Ro=[{key:"Enter",modifierKey:[],handler:o=>{B(o);let e=o.getActiveCell();o.setActiveCell({row:e.row+1,col:e.col,rowCount:1,colCount:1,sheetId:""})}},{key:"Tab",modifierKey:[],handler:o=>{B(o);let e=o.getActiveCell();o.setActiveCell({row:e.row,col:e.col+1,rowCount:1,colCount:1,sheetId:""})}},{key:"ArrowDown",modifierKey:[j()?"meta":"ctrl"],handler:o=>{B(o);let e=o.getViewSize();ce(o,0,e.height)}},{key:"ArrowUp",modifierKey:[j()?"meta":"ctrl"],handler:o=>{B(o);let e=o.getViewSize();ce(o,0,-e.height)}},{key:"ArrowRight",modifierKey:[j()?"meta":"ctrl"],handler:o=>{B(o);let e=o.getViewSize();ce(o,e.width,0)}},{key:"ArrowLeft",modifierKey:[j()?"meta":"ctrl"],handler:o=>{B(o);let e=o.getViewSize();ce(o,-e.width,0)}},{key:"ArrowDown",modifierKey:[],handler:o=>{B(o);let e=o.getActiveCell();o.setActiveCell({row:e.row+1,col:e.col,rowCount:1,colCount:1,sheetId:""}),_e(o)}},{key:"ArrowUp",modifierKey:[],handler:o=>{B(o);let e=o.getActiveCell();o.setActiveCell({row:e.row-1,col:e.col,rowCount:1,colCount:1,sheetId:""}),_e(o)}},{key:"ArrowRight",modifierKey:[],handler:o=>{B(o);let e=o.getActiveCell();o.setActiveCell({row:e.row,col:e.col+1,rowCount:1,colCount:1,sheetId:""}),_e(o)}},{key:"ArrowLeft",modifierKey:[],handler:o=>{B(o);let e=o.getActiveCell();o.setActiveCell({row:e.row,col:e.col-1,rowCount:1,colCount:1,sheetId:""}),_e(o)}},{key:"b",modifierKey:[j()?"meta":"ctrl"],handler:o=>{let t=o.getCell(o.getActiveCell()).style||{};t.isBold=!t.isBold,o.setCellStyle(t,[o.getActiveCell()])}},{key:"i",modifierKey:[j()?"meta":"ctrl"],handler:o=>{let t=o.getCell(o.getActiveCell()).style||{};t.isItalic=!t.isItalic,o.setCellStyle(t,[o.getActiveCell()])}},{key:"u",modifierKey:[j()?"meta":"ctrl"],handler:o=>{let t=o.getCell(o.getActiveCell()).style||{};t.underline===void 0||t.underline===0?t.underline=1:t.underline=0,o.setCellStyle(t,[o.getActiveCell()])}}];function Be(o){let e=(o?.target?.tagName||"").toLowerCase();return e==="input"||e==="textarea"}var Lo={},Ce=(o,e)=>{Lo[o]=e};function pt(o,e,t){function n(c){let u=Ro.filter(h=>h.key===c.key);u.sort((h,p)=>p.modifierKey.length-h.modifierKey.length);let g=null;for(let h of u)if(h.modifierKey.length>0){if(h.modifierKey.some(p=>c[`${p}Key`])){g=h;break}}else{g=h;break}if(g){c.preventDefault(),g.handler(e);return}if(c.metaKey||c.ctrlKey){console.log(c.key);return}Be(c)||(o.isCellEditing=!0,e.getMainDom().input.focus())}let r=Qt(function(c){c.target===e.getMainDom().canvas&&ce(e,c.deltaX,c.deltaY)});function i(c){Be(c)||(c.preventDefault(),e.paste(c))}function s(c){Be(c)||(c.preventDefault(),e.copy(c))}function a(c){Be(c)||(c.preventDefault(),e.cut(c))}function l(c){if(!c.target)return;let u=Object.values(Lo);for(let g of u)g.dom.contains(c.target)||g.callback(o)}return window.addEventListener("resize",t),window.addEventListener("keydown",n),window.addEventListener("wheel",r),window.addEventListener("mousedown",l),document.body.addEventListener("paste",i),document.body.addEventListener("copy",s),document.body.addEventListener("cut",a),()=>{window.removeEventListener("resize",t),window.removeEventListener("keydown",n),window.removeEventListener("wheel",r),window.removeEventListener("mousedown",l),document.body.removeEventListener("paste",i),document.body.removeEventListener("copy",s),document.body.removeEventListener("cut",a)}}var mt={textAlign:"center",textBaseline:"middle",font:Ie,fillStyle:k.black,lineWidth:ne(),strokeStyle:k.gridStrokeColor};var ye=class{canvas;ctx;controller;constructor(e,t){this.controller=e,this.canvas=t;let n=this.canvas.getContext("2d");this.ctx=n;let r=R();this.ctx.scale(r,r)}getCanvas(){return this.canvas}resize(){let{width:e,height:t}=this.controller.getDomRect();Ue(this.canvas,e,t)}clear(){let{width:e,height:t}=this.controller.getDomRect();this.ctx.clearRect(0,0,v(e),v(t))}render({changeSet:e}){if(e.size===0||!e.has("content"))return;let{width:t,height:n}=this.controller.getDomRect(),r=this.controller.getHeaderSize();this.clear();let i=t-r.width,s=n-r.height;this.renderGrid(i,s),this.renderRowsHeader(s),this.renderColsHeader(i),this.renderTriangle(),this.renderContent()}renderContent(){let{controller:e,ctx:t}=this,{width:n,height:r}=e.getDomRect(),i=e.getHeaderSize(),s=e.getCurrentSheetId(),{row:a,col:l}=e.getScroll(),c=i.width,u=l,g=i.height,h=a;for(;;){let d=e.getColWidth(u);if(c+d<n)c+=d,u++;else break}for(;;){let d=e.getRowHeight(h);if(g+d<r)g+=d,h++;else break}let p=h,m=u;t.save(),g=i.height;for(let d=a;d<p;d++){c=i.width;for(let f=l;f<m;f++){let y=e.getCell(new H(d,f,1,1,s));if(A(y.value)&&A(y.style)){c+=e.getColWidth(f);continue}let C=e.getCellSize(d,f),{wrapHeight:x=0,fontSizeHeight:b=0}=Ve(t,{...y,...C,top:g,left:c}),I=Math.max(x,b);I>C.height&&e.setRowHeight(d,I),c+=e.getColWidth(f)}g+=e.getRowHeight(d)}t.restore()}renderTriangle(){if(Ut())return;let e=this.controller.getHeaderSize();this.ctx.save(),this.ctx.fillStyle=k.backgroundColor,L(this.ctx,0,0,e.width,e.height),this.ctx.fillStyle=k.triangleFillColor;let t=2;To(this.ctx,[e.width/2-t,e.height-t],[e.width-t,e.height-t],[e.width-t,t]),this.ctx.restore()}renderGrid(e,t){let{controller:n}=this,r=n.getHeaderSize(),{row:i,col:s}=n.getScroll(),{rowCount:a,colCount:l}=this.controller.getSheetInfo(this.controller.getCurrentSheetId()),c=ne();this.ctx.save(),this.ctx.fillStyle=k.white,this.ctx.lineWidth=c,this.ctx.strokeStyle=k.gridStrokeColor,this.ctx.translate(v(r.width),v(r.height));let u=[],g=0,h=0,p=0;for(let d=s;d<l&&(p+=n.getColWidth(d),!(p>e));d++);let m=Math.min(p,e);for(let d=i;d<a&&(u.push([0,g],[m,g]),g+=n.getRowHeight(d),!(g>t));d++);for(let d=s;d<l&&(u.push([h,0],[h,g]),h+=n.getColWidth(d),!(h>m));d++);u.push([0,g],[h,g]),u.push([h,0],[h,g]),$(this.ctx,u),this.ctx.restore()}fillRowText(e,t,n){this.ctx.fillStyle=k.black,me(this.ctx,String(e),t/2,n)}fillColText(e,t,n){this.ctx.fillStyle=k.black,me(this.ctx,e,t,n/2+R())}renderRowsHeader(e){let{controller:t}=this,{row:n}=t.getScroll(),r=t.getHeaderSize(),{rowCount:i}=t.getSheetInfo(t.getCurrentSheetId());this.ctx.save(),this.ctx.fillStyle=k.backgroundColor,L(this.ctx,0,r.height,r.width,e),Object.assign(this.ctx,mt);let s=[],a=r.height,l=n;for(;l<i;l++){let c=t.getRowHeight(l),u=a;if(l===n&&(u+=ne()/2),s.push([0,u],[r.width,u]),this.fillRowText(l+1,r.width,u+c/2),a+=c,a>e)break}s.push([0,a],[r.width,a]),s.push([0,0],[0,a]),$(this.ctx,s),this.ctx.restore()}renderColsHeader(e){let{controller:t}=this,{col:n}=t.getScroll(),r=t.getHeaderSize(),{colCount:i}=t.getSheetInfo(t.getCurrentSheetId()),s=[];this.ctx.save(),this.ctx.fillStyle=k.backgroundColor,L(this.ctx,r.width,0,e,r.height),Object.assign(this.ctx,mt);let a=r.width,l=n;for(;l<i;l++){let c=t.getColWidth(l),u=a;if(l===n&&(u+=ne()/2),s.push([u,0],[u,r.height]),this.fillColText(Re(l),u+c/2,r.height),a+=c,a>e)break}s.push([a,0],[a,r.height]),s.push([0,0],[a,0]),$(this.ctx,s),this.ctx.restore()}};var Dn=300;function Mo(o,e,t){let n=o.getScroll(),{maxHeight:r,maxScrollHeight:i,maxScrollWidth:s,maxWidth:a}=ge(o,n.left,n.top),l=n.scrollTop+Math.ceil(t),c=n.scrollLeft+Math.ceil(e);l<0?l=0:l>i&&(l=i),c<0?c=0:c>s&&(c=s);let u=Math.floor(r*l/i),g=Math.floor(a*c/s),{row:h,col:p}=ze(o,g,u);o.setScroll({top:u,left:g,row:h,col:p,scrollLeft:c,scrollTop:l})}var We=0,$e=0,Q=0,Ao=0,ft=(o,e)=>{let t=e.getHeaderSize(),n=e.getScroll();function r(l){l.stopPropagation(),Q===1?(We&&Mo(e,0,l.pageY-We),We=l.pageY):Q===2&&($e&&Mo(e,l.pageX-$e,0),$e=l.pageX)}function i(){Q=0,We=0,$e=0,s()}function s(){document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",i)}function a(){document.addEventListener("mousemove",r),document.addEventListener("mouseup",i)}return S("div",{className:"relative canvas-container"},S("canvas",{className:"full canvas-content",hook:{ref(l){let c=l;e.setMainDom({canvas:c})}},oncontextmenu(l){return l.preventDefault(),o.contextMenuPosition={top:l.clientY,left:l.clientX,width:100,height:100},!1},onmousemove(l){let c=e.getHeaderSize(),u=e.getDomRect(),{clientX:g,clientY:h}=l,p=g-u.left,m=h-u.top;if(l.buttons===1&&p>c.width&&m>c.height){let d=De(l,e);if(!d)return;let f=e.getActiveCell();if(f.row===d.row&&f.col===d.col)return;let y=Math.abs(d.col-f.col)+1,C=Math.abs(d.row-f.row)+1;e.setActiveCell({row:Math.min(d.row,f.row),col:Math.min(d.col,f.col),rowCount:C,colCount:y,sheetId:""})}},onmousedown(l){let c=e.getHeaderSize(),u=e.getDomRect(),{timeStamp:g,clientX:h,clientY:p}=l,m=h-u.left,d=p-u.top,f=De(l,e);if(!f)return;if(c.width>m&&c.height>d){e.setActiveCell({row:0,col:0,colCount:0,rowCount:0,sheetId:""});return}if(c.width>m&&c.height<=d){let x=e.getSheetInfo(e.getCurrentSheetId());e.setActiveCell({row:f.row,col:f.col,rowCount:0,colCount:x.colCount,sheetId:""});return}if(c.width<=m&&c.height>d){let x=e.getSheetInfo(e.getCurrentSheetId());e.setActiveCell({row:f.row,col:f.col,rowCount:x.rowCount,colCount:0,sheetId:""});return}let y=e.getActiveCell();if(y.row>=0&&y.row===f.row&&y.col===f.col)g-Ao<Dn&&(o.isCellEditing=!0);else{let x=e.getMainDom().input;if(document.activeElement===x){let I=x.value;e.setCellValues([[I]],[],[e.getActiveCell()]),o.isCellEditing=!1,x.value=""}e.setActiveCell({row:f.row,col:f.col,rowCount:1,colCount:1,sheetId:""})}Ao=g}}),S("div",{className:"vertical-scroll-bar",style:{top:t.height},onmouseleave(){i()},onmousedown(){Q||(Q=1,a())}},S("div",{className:"vertical-scroll-bar-content",style:{height:re,transform:`translateY(${n.scrollTop}px)`}})),S("div",{className:"horizontal-scroll-bar",style:{left:t.width},onmouseleave(){i()},onmousedown(){Q||(Q=2,a())}},S("div",{className:"horizontal-scroll-bar-content",style:{width:re,transform:`translateX(${n.scrollLeft}px)`}})))};ft.displayName="CanvasContainer";var T=(o,...e)=>{let{className:t="",onClick:n,disabled:r=!1,active:i=!1,type:s="normal",style:a={},testId:l=void 0,title:c,dataType:u,buttonType:g}=o,h={className:D("button-wrapper",t,{disabled:r,active:i,circle:s==="circle"}),style:a,title:c,"data-testId":l,"data-type":u,type:g};return n&&(h.onclick=n),S("button",h,...e)};T.displayName="Button";var Oo={"transform-origin":"130px 106px"},gt=()=>S("a",{href:"https://github.com/nusr/excel","aria-label":"View source on Github",target:"_blank",rel:"noreferrer",title:"github link"},S("svg",{className:"github-wrapper",viewBox:"0 0 250 250","aria-hidden":!0},S("path",{d:"M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"}),S("path",{d:"M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2",fill:"currentColor",style:Oo}),S("path",{style:Oo,fill:"currentColor",d:"M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"})));gt.displayName="Github";var Hn={alignCenter:["M142.2 227.6h739.6v56.9H142.2zM142.2 568.9h739.6v56.9H142.2zM256 398.2h512v56.9H256zM256 739.6h512v56.9H256z"],alignLeft:["M627.712 788.48c11.305 0 20.48-9.155 20.48-20.48s-9.175-20.48-20.48-20.48H218.46c-11.305 0-20.48 9.155-20.48 20.48s9.175 20.48 20.48 20.48h409.252zM832.86 583.68h-614.4c-11.305 0-20.48 9.155-20.48 20.48s9.175 20.48 20.48 20.48h614.4c11.305 0 20.48-9.155 20.48-20.48s-9.175-20.48-20.48-20.48zM832.86 256h-614.4c-11.305 0-20.48 9.155-20.48 20.48s9.175 20.48 20.48 20.48h614.4c11.305 0 20.48-9.155 20.48-20.48S844.165 256 832.86 256zM218.46 460.8h409.252c11.305 0 20.48-9.155 20.48-20.48s-9.175-20.48-20.48-20.48H218.46c-11.305 0-20.48 9.155-20.48 20.48s9.155 20.48 20.48 20.48z"],alignRight:["M832.86 747.52H423.588a20.48 20.48 0 1 0 0 40.96H832.84a20.48 20.48 0 0 0 0.02-40.96z m20.48-143.36a20.48 20.48 0 0 0-20.48-20.48h-614.4a20.48 20.48 0 1 0 0 40.96h614.4a20.48 20.48 0 0 0 20.48-20.48zM832.86 256h-614.4a20.48 20.48 0 1 0 0 40.96h614.4a20.48 20.48 0 1 0 0-40.96z m0 163.84H423.588a20.48 20.48 0 1 0 0 40.96H832.84a20.48 20.48 0 0 0 0.02-40.96z"],bold:["M724.342857 477.028571c38.4-40 61.942857-94.057143 61.942857-153.485714v-11.657143C786.285714 188.914286 685.6 89.142857 561.485714 89.142857H223.314286c-17.257143 0-31.314286 14.057143-31.314286 31.314286v776.114286c0 18.628571 15.085714 33.714286 33.714286 33.714285h364.228571c133.714286 0 242.057143-107.657143 242.057143-240.571428v-12.571429c0-83.428571-42.742857-156.914286-107.657143-200.114286zM301.714286 198.857143h256.8c65.257143 0 118.057143 50.742857 118.057143 113.485714v10.857143c0 62.628571-52.914286 113.485714-118.057143 113.485714H301.714286V198.857143z m418.971428 490.742857c0 71.885714-59.085714 130.171429-132 130.171429H301.714286V547.085714h286.971428c72.914286 0 132 58.285714 132 130.171429v12.342857z"],fontColor:["M650.496 597.333333H373.504l-68.266667 170.666667H213.333333l256-640h85.333334l256 640h-91.904l-68.266667-170.666667z m-34.133333-85.333333L512 251.093333 407.637333 512h208.725334zM128 853.333333h768v85.333334H128v-85.333334z"],italic:["M219.428571 949.714286l9.714286-48.571429q3.428571-1.142857 46.571429-12.285714t63.714286-21.428571q16-20 23.428571-57.714286 0.571429-4 35.428571-165.142857t65.142857-310.571429 29.714286-169.428571l0-14.285714q-13.714286-7.428571-31.142857-10.571429t-39.714286-4.571429-33.142857-3.142857l10.857143-58.857143q18.857143 1.142857 68.571429 3.714286t85.428571 4 68.857143 1.428571q27.428571 0 56.285714-1.428571t69.142857-4 56.285714-3.714286q-2.857143 22.285714-10.857143 50.857143-17.142857 5.714286-58 16.285714t-62 19.142857q-4.571429 10.857143-8 24.285714t-5.142857 22.857143-4.285714 26-3.714286 24q-15.428571 84.571429-50 239.714286t-44.285714 203.142857q-1.142857 5.142857-7.428571 33.142857t-11.428571 51.428571-9.142857 47.714286-3.428571 32.857143l0.571429 10.285714q9.714286 2.285714 105.714286 17.714286-1.714286 25.142857-9.142857 56.571429-6.285714 0-18.571429 0.857143t-18.571429 0.857143q-16.571429 0-49.714286-5.714286t-49.142857-5.714286q-78.857143-1.142857-117.714286-1.142857-29.142857 0-81.714286 5.142857t-69.142857 6.285714z"],middleAlign:["M740.43392 788.48c11.30496 0 20.48-9.15456 20.48-20.48s-9.17504-20.48-20.48-20.48L331.18208 747.52c-11.30496 0-20.48 9.15456-20.48 20.48s9.17504 20.48 20.48 20.48L740.43392 788.48zM863.49824 604.16c0-11.32544-9.17504-20.48-20.48-20.48l-614.4 0c-11.30496 0-20.48 9.15456-20.48 20.48s9.17504 20.48 20.48 20.48l614.4 0C854.3232 624.64 863.49824 615.48544 863.49824 604.16zM208.13824 276.48c0 11.32544 9.17504 20.48 20.48 20.48l614.4 0c11.30496 0 20.48-9.15456 20.48-20.48s-9.17504-20.48-20.48-20.48l-614.4 0C217.2928 256 208.13824 265.15456 208.13824 276.48zM740.43392 460.8c11.30496 0 20.48-9.15456 20.48-20.48s-9.17504-20.48-20.48-20.48L331.18208 419.84c-11.30496 0-20.48 9.15456-20.48 20.48s9.17504 20.48 20.48 20.48L740.43392 460.8z"],plus:["M896 468.571429H555.428571V100.571429h-86.857142v368H128c-5.028571 0-9.142857 4.114286-9.142857 9.142857v68.571428c0 5.028571 4.114286 9.142857 9.142857 9.142857h340.571429v368h86.857142V555.428571h340.571429c5.028571 0 9.142857-4.114286 9.142857-9.142857v-68.571428c0-5.028571-4.114286-9.142857-9.142857-9.142857z"],redo:["M611.783111 569.344L549.622519 644.740741h284.444444l-65.498074-265.481482-59.922963 72.666074c-35.422815-28.48237-108.278519-68.342519-238.667852-68.342518-202.827852 0-280.651852 206.01363-280.651852 206.013629s116.318815-132.778667 246.215111-132.778666c97.204148-0.037926 153.865481 74.827852 176.241778 112.526222z"],underline:["M512 725.333333c166.4 0 298.666667-132.266667 298.666667-298.666666V128c0-25.6-17.066667-42.666667-42.666667-42.666667s-42.666667 17.066667-42.666667 42.666667v298.666667c0 119.466667-93.866667 213.333333-213.333333 213.333333s-213.333333-93.866667-213.333333-213.333333V128c0-25.6-17.066667-42.666667-42.666667-42.666667s-42.666667 17.066667-42.666667 42.666667v298.666667c0 166.4 132.266667 298.666667 298.666667 298.666666zM853.333333 853.333333H170.666667c-25.6 0-42.666667 17.066667-42.666667 42.666667s17.066667 42.666667 42.666667 42.666667h682.666666c25.6 0 42.666667-17.066667 42.666667-42.666667s-17.066667-42.666667-42.666667-42.666667z"],undo:["M489.244444 568.888889l60.681482 75.851852H265.481481l64.474075-265.481482 60.681481 72.05926c34.133333-30.340741 109.985185-68.266667 238.933333-68.266667 201.007407 0 280.651852 204.8 280.651852 204.8S792.651852 455.111111 663.703704 455.111111c-98.607407 0-155.496296 75.851852-174.45926 113.777778z"]},Fo=Hn;var Se=({className:o="",paths:e=[]})=>S("svg",{className:D("base-icon",o),viewBox:"0 0 1137 1024","aria-hidden":!0},...e.map(t=>S("path",t)));Se.displayName="BaseIcon";var Ke=()=>Se({paths:[{d:"M0 0h1024v1024H0z","fill-opacity":".01"},{d:"M496.512 32a128 128 0 0 1 127.84 121.6l0.16 6.4-0.032 113.504 264.256 264.256a32 32 0 0 1-8.16 51.2l-144.064 72.96-269.12 269.12a64 64 0 0 1-90.496 0l-294.144-294.176a64 64 0 0 1 0-90.496l286.016-286.08-0.192-2.048-0.064-2.08V160a128 128 0 0 1 128-128z m-6.464 197.568L128 591.616l294.144 294.144 276.32-276.32 113.792-57.632-187.776-187.776V416a32 32 0 0 1-28.256 31.776l-3.712 0.224a32 32 0 0 1-31.808-28.256L560.512 416l-0.032-115.968-70.432-70.464z m402.016 395.936l1.792 2.24 5.472 8.416c30.112 46.752 45.184 80.032 45.184 99.84a64 64 0 1 1-128 0c0-20.96 16.864-57.024 50.624-108.224a16 16 0 0 1 24.928-2.24zM496.512 96a64 64 0 0 0-63.84 59.2l-0.16 4.8-0.032 36.576 34.944-34.88a32 32 0 0 1 45.248 0l47.808 47.808V160a64 64 0 0 0-59.2-63.84L496.48 96z"}]});Ke.displayName="FillColorIcon";var K=({name:o,className:e=""})=>{let t=Fo[o].map(n=>({d:n}));return Se({className:e,paths:t})};K.displayName="Icon";var ee=o=>{let{data:e,value:t,style:n={},onChange:r,getItemStyle:i=()=>({}),title:s}=o;return S("select",{onchange:l=>{let{value:c}=l.target;r(c)},value:t,style:n,name:"select",className:"select-list",title:s},...e.map(l=>{let c=typeof l=="object"?l.value:l,u=typeof l=="object"?l.label:l,g=typeof l=="object"?l.disabled:!1,h=i(c);return S("option",{key:c,value:c,style:h,disabled:!!g,className:D("select-item",{disabled:g})},u)}))};ee.displayName="Select";var xe="No Fill",Pn=["#4D4D4D","#999999","#FFFFFF","#F44E3B","#FE9200","#FCDC00","#DBDF00","#A4DD00","#68CCCA","#73D8FF","#AEA1FF","#FDA1FF","#333333","#808080","#cccccc","#D33115","#E27300","#FCC400","#B0BC00","#68BC00","#16A5A5","#009CE0","#7B64FF","#FA28FF","#000000","#666666","#B3B3B3","#9F0500","#C45100","#FB9E00","#808900","#194D33","#0C797D","#0062B1","#653294","#AB149E",xe],Do="color-picker-wrapper",Ge=(o,...e)=>{let{color:t,style:n={},onChange:r,key:i}=o,s,a=l=>{let c=Do;l&&(c=c+" show"),s.className=c};return S("div",{className:"relative color-picker",key:i,style:n},S("div",{className:"color-picker-trigger",style:{color:t},onclick:()=>{a(!0)}},...e),S("div",{className:Do,hook:{ref:l=>{s=l}},onmouseleave(){a(!1)}},S("div",{className:"color-picker-list"},...Pn.map(l=>S("div",{key:l,className:D("color-picker-item",{"no-fill":l===xe}),style:{backgroundColor:l},onclick:()=>{a(!1),r(l===xe?"":l)}},l===xe?xe:"")))))};Ge.displayName="ColorPicker";var je=(o,...e)=>{let{dialogContent:t,title:n,dialogStyle:r,onCancel:i,onOk:s}=o,a;return S("div",{className:"dialog-container"},S("dialog",{className:"dialog-element",style:r,hook:{ref(l){a=l}}},S("form",{method:"dialog"},S("div",{className:"dialog-title"},n),S("div",{className:"dialog-content"},t),S("div",{className:"dialog-button"},T({onClick(){i&&i()},buttonType:"submit"},"Cancel"),T({onClick(){s&&s()},buttonType:"submit",className:"ml16"},"Confirm")))),S("div",{onclick(){_(typeof a.showModal=="function","Sorry, the <dialog> API is not supported by this browser."),a.showModal()}},...e))};je.displayName="Dialog";var Vn={display:"none"};function Un(o,e){switch(o){case"addCol":e.addCol(e.getActiveCell().col,1);break;case"deleteCol":e.deleteCol(e.getActiveCell().col,1);break;case"addRow":e.addRow(e.getActiveCell().row,1);break;case"deleteRow":e.deleteRow(e.getActiveCell().row,1);break;case"copy":case"cut":case"paste":e[o]();break;default:throw new Error(`context menu unknown data type: ${o}`)}}var Ct=(o,e)=>{let{contextMenuPosition:t}=o,n=t===void 0?Vn:{top:t.top,left:t.left},r=()=>{o.contextMenuPosition=void 0};return S("div",{className:"context-menu",style:n,hook:{ref(i){Ce("canvas-context-menu",{dom:i,callback(s){s.contextMenuPosition!==void 0&&(s.contextMenuPosition=void 0)}})}},onclick(i){if(!i.target)return;let a=i.target.dataset.type;a&&(r(),Un(a,e))}},T({dataType:"addCol"},"add a column"),T({dataType:"deleteCol"},"delete a column"),T({dataType:"addRow"},"add a row"),T({dataType:"deleteRow"},"delete a row"),T({dataType:"copy"},"copy"),T({dataType:"cut"},"cut"),T({dataType:"paste"},"paste"))};Ct.displayName="ContextMenuContainer";function _n(o){let{style:e}=o,t={top:o.top,left:o.left,width:o.width,height:o.height};if(A(e))return t;let n=de(e?.isItalic?"italic":"normal",e?.isBold?"bold":"500",e?.fontSize||J,e?.fontFamily);return{...t,backgroundColor:e?.fillColor||"inherit",color:e?.fontColor||W,font:n}}var yt=(o,e)=>{let{activeCell:t,isCellEditing:n}=o,r=t.formula||String(t.value||""),i,s=a=>{i=a,e.setMainDom({input:i})};return S("input",{className:"base-editor",value:r,type:"text",style:n?_n(t):void 0,hook:{ref:s},onfocus:()=>{n&&(o.isCellEditing=!0)},onkeydown:a=>{n&&(i.nextSibling.textContent=a.currentTarget.value)}})};yt.displayName="FormulaEditor";var St=(o,e)=>{let{activeCell:t}=o;return S("div",{className:"formula-bar-wrapper"},S("div",{className:"formula-bar-name"},`${Re(t.col)}${t.row+1}`),S("div",{className:"formula-bar-editor-wrapper"},yt(o,e),S("div",{className:D("formula-bar-value",{show:o.isCellEditing})},t.formula||String(t.value||""))))};St.displayName="FormulaBarContainer";var zn=[{value:0,label:"none"},{value:1,label:"single underline"},{value:2,label:"double underline"}],xt=(o,e)=>{let t=d=>({"font-family":String(d),"font-size":"16px"}),n=d=>{let y=e.getCell(e.getActiveCell()).style||{};e.setCellStyle(Object.assign(y,d),[e.getActiveCell()])},{activeCell:r,fontFamilyList:i}=o,{style:s={}}=r,{isBold:a=!1,isItalic:l=!1,fontSize:c=J,fontColor:u=W,fillColor:g="",isWrapText:h=!1,underline:p=0,fontFamily:m=""}=s;return S("div",{className:"toolbar-wrapper"},T({disabled:!e.canUndo(),onClick(){e.undo()},testId:"toolbar-undo"},K({name:"undo"})),T({disabled:!e.canRedo(),onClick(){e.redo()},testId:"toolbar-redo"},K({name:"redo"})),ee({data:i,value:m,style:{width:"140px"},getItemStyle:t,onChange:d=>{String(d)===Oe?window.queryLocalFonts().then(y=>{let C=y.map(x=>x.fullName);C=Array.from(new Set(C)).filter(x=>Ae(x)),C.sort((x,b)=>x.localeCompare(b)),localStorage.setItem(Fe,JSON.stringify(C)),o.fontFamilyList=C.map(x=>({label:x,value:x,disabled:!1}))}):n({fontFamily:String(d)})}}),ee({data:At,value:c,onChange:d=>{n({fontSize:Number(d)})}}),T({active:a,onClick:()=>{n({isBold:!a})},testId:"toolbar-bold",title:"Bold"},K({name:"bold"})),T({active:l,onClick:()=>{n({isItalic:!l})},testId:"toolbar-italic",title:"Italic"},K({name:"italic"})),ee({data:zn,value:p,style:{width:"130px"},title:"Underline",onChange:d=>{n({underline:Number(d)})}}),Ge({key:"fill-color",color:g,onChange:d=>{n({fillColor:d})}},Ke({})),Ge({color:u,onChange:d=>{n({fontColor:d})},key:"font-color"},K({name:"fontColor"})),T({onClick:()=>{n({isWrapText:!h})},active:h,testId:"toolbar-wrap-text"},"Wrap Text"),gt({}))};xt.displayName="ToolbarContainer";var Bn={display:"none"};function Wn(o,e,t){switch(o){case"addSheet":case"deleteSheet":case"hideSheet":e[o]();break;case"unhideSheet":break;case"renameSheet":t.isSheetNameEditing=!0;break;default:throw new Error(`sheet bar context menu unknown data type: ${o}`)}}var vt=(o,e)=>{let t=o.sheetBarContextMenuLeft===void 0?Bn:{left:`${o.sheetBarContextMenuLeft}px`},r=e.getSheetList().filter(a=>a.isHide).map(a=>({value:a.sheetId,label:a.name,disabled:!1})),i=String(r?.[0]?.value||""),s=()=>{o.sheetBarContextMenuLeft=void 0};return S("div",{className:"sheet-bar-context-menu",style:t,hook:{ref(a){Ce("sheet-bar-context-menu",{dom:a,callback(l){l.sheetBarContextMenuLeft!==void 0&&(l.sheetBarContextMenuLeft=void 0)}})}},onclick(a){if(!a.target)return;let c=a.target.dataset.type;c&&c!=="unhideSheet"&&(s(),Wn(c,e,o))}},T({dataType:"addSheet"},"Insert"),T({dataType:"deleteSheet"},"Delete"),T({dataType:"renameSheet"},"Rename"),T({dataType:"hideSheet"},"Hide"),je({dialogContent:ee({data:r,onChange(a){i=String(a)},style:{width:"300px"},value:void 0}),title:"Unhide sheet:",onOk(){e.unhideSheet(i),s(),i=""},onCancel:s},T({dataType:"unhideSheet",className:"width100 bgWhite",disabled:r.length===0},"Unhide")))};vt.displayName="SheetBarContextMenu";var wt=(o,e)=>{let t=n=>{e.renameSheet(n),o.isSheetNameEditing=!1};return S("div",{className:"sheet-bar-wrapper"},S("div",{className:"sheet-bar-list"},...o.sheetList.map(n=>{let r=o.currentSheetId===n.value,i=r&&o.isSheetNameEditing;return S("div",{key:n.value,className:D("sheet-bar-item",{active:r}),onclick:()=>{e.setCurrentSheetId(String(n.value))},oncontextmenu(s){return s.preventDefault(),o.sheetBarContextMenuLeft=(s.clientX||0)-30,!1}},S("input",{value:n.label,className:D("sheet-bar-input",{show:i}),onblur(s){s.currentTarget},onkeydown(s){if(s.key==="Enter"){if(s.stopPropagation(),!s.currentTarget)return;t(s.currentTarget.value)}}}),S("span",{className:D("sheet-bar-item-text",{show:!i})},n.label))})),S("div",{className:"sheet-bar-add"},T({onClick:e.addSheet,type:"circle",style:{backgroundColor:k.buttonActiveColor}},K({name:"plus"}))),vt(o,e))};wt.displayName="SheetBarContainer";var bt=(o,e)=>S("div",{className:"app-container"},xt(o,e),St(o,e),ft(o,e),wt(o,e),Ct(o,e));bt.displayName="App";var Et=19,It=34,$n={top:0,left:0,row:0,col:0,scrollLeft:0,scrollTop:0},ve=class{scrollValue={};model;changeSet=new Set;copyRanges=[];cutRanges=[];hooks={modelChange(){},async cut(){return""},async copy(){return""},async paste(){return{[z]:"",[M]:""}}};viewSize={width:0,height:0};headerSize={width:It,height:Et};mainDom={};constructor(e){this.model=e}getCurrentSheetId(){return this.model.getCurrentSheetId()}getSheetList(){return this.model.getSheetList()}getSheetInfo(e){return this.model.getSheetInfo(e)}setHooks(e){this.hooks=e}emitChange(){Me("emitChange",this.changeSet),this.hooks.modelChange(this.changeSet),this.changeSet=new Set,this.model.record()}getActiveCell(){let e=this.model.getCurrentSheetId(),{activeCell:t}=this.getSheetInfo(e);return{...t,sheetId:t.sheetId||e}}setSheetCell(e){let t=e.sheetId||this.model.getCurrentSheetId();e.sheetId=t,this.model.setActiveCell(e)}setActiveCell(e){this.setSheetCell(e),this.changeSet.add("selection"),this.emitChange()}setCurrentSheetId(e){if(e===this.getCurrentSheetId())return;this.model.setCurrentSheetId(e);let t=this.getActiveCell();this.setSheetCell(t),this.computeViewSize(),this.setScroll(this.getScroll())}addSheet=()=>{this.model.addSheet(),this.setSheetCell({row:0,col:0,rowCount:1,colCount:1,sheetId:""}),this.computeViewSize(),this.setScroll({top:0,left:0,row:0,col:0,scrollLeft:0,scrollTop:0})};deleteSheet=e=>{this.model.deleteSheet(e),this.changeSet.add("content"),this.emitChange()};hideSheet(e){this.model.hideSheet(e),this.changeSet.add("content"),this.emitChange()}unhideSheet(e){this.model.unhideSheet(e),this.changeSet.add("content"),this.emitChange()}renameSheet(e,t){this.model.renameSheet(e,t),this.changeSet.add("content"),this.emitChange()}fromJSON(e){Me("loadJSON",e),this.model.fromJSON(e);let t=this.getActiveCell();this.setSheetCell(t),this.computeViewSize(),this.changeSet.add("content"),this.emitChange()}toJSON(){return this.model.toJSON()}setCellValues(e,t,n){Me("setCellValue",e),this.model.setCellValues(e,t,n),this.changeSet.add("content"),this.emitChange()}setCellStyle(e,t){A(e)||(this.model.setCellStyle(e,t),this.changeSet.add("content"),this.emitChange())}getCell=e=>this.model.getCell(e);canRedo(){return this.model.canRedo()}canUndo(){return this.model.canUndo()}undo(){this.model.undo(),this.changeSet.add("content"),this.emitChange()}redo(){this.model.redo(),this.changeSet.add("content"),this.emitChange()}getColWidth(e){return this.model.getColWidth(e)}setColWidth(e,t){this.model.setColWidth(e,t),this.computeViewSize(),this.changeSet.add("content")}getRowHeight(e){return this.model.getRowHeight(e)}setRowHeight(e,t){this.model.setRowHeight(e,t),this.computeViewSize(),this.changeSet.add("content")}computeViewSize(){let e=this.getHeaderSize(),t=this.model.getSheetInfo(this.model.getCurrentSheetId()),n=e.width,r=e.height;for(let i=0;i<t.colCount;i++)n+=this.getColWidth(i);for(let i=0;i<t.rowCount;i++)r+=this.getRowHeight(i);this.viewSize={width:n,height:r}}getViewSize(){return{...this.viewSize}}getCellSize(e,t){return{width:this.getColWidth(t),height:this.getRowHeight(e)}}getHeaderSize(){return{...this.headerSize}}computeCellPosition(e,t){let n=this.getHeaderSize(),r=this.getScroll(),i=n.width,s=n.height,a=r.row,l=r.col;for(;l<t;)i+=this.getColWidth(l),l++;for(;a<e;)s+=this.getRowHeight(a),a++;return{...this.getCellSize(e,t),top:s,left:i}}addRow(e,t){this.model.addRow(e,t),this.changeSet.add("content"),this.emitChange()}addCol(e,t){this.model.addCol(e,t),this.changeSet.add("content"),this.emitChange()}deleteCol(e,t){this.model.deleteCol(e,t),this.changeSet.add("content"),this.emitChange()}deleteRow(e,t){this.model.deleteRow(e,t),this.changeSet.add("content"),this.emitChange()}getChangeSet(){let e=this.changeSet;return this.changeSet=new Set,e}getScroll(){let e=this.model.getCurrentSheetId();return this.scrollValue[e]||$n}setScroll(e){let t=this.model.getCurrentSheetId();this.scrollValue[t]={...e},e.row>9999?this.headerSize={width:Math.floor(It*2),height:Et}:this.headerSize={width:It,height:Et},this.changeSet.add("content"),this.emitChange()}parseText(e){let t;if(e.indexOf(`\r
`)>-1?t=e.split(`\r
`).map(a=>a).map(a=>a.split("	")):t=e.split(`
`).map(a=>a).map(a=>a.split("	")),t[0].length!==t[t.length-1].length){let a=t[t.length-1];a.length===1&&!a[0]&&t.pop()}let n=t.length,r=0;for(let a of t)a.length>r&&(r=a.length);if(t.length===0)return;let s={...this.getActiveCell(),rowCount:n,colCount:r};this.model.setCellValues(t,[],[s]),this.changeSet.add("content"),this.setActiveCell(s)}parseHTML(e){let t=new DOMParser,n=e.replace(`<style>\r
<!--table`,"<style>").replace(`-->\r
</style>`,"</style>"),r=t.parseFromString(n,"text/html"),i=r.querySelectorAll("tr"),s=r.querySelectorAll("style"),a=[],l=[],c=i.length,u=0;for(let p of i){let m=p.querySelectorAll("td"),d=[],f=[];for(let y of m){let C={};y.className?C=lt(s,"."+y.className):C=lt(s,y.tagName.toLowerCase()),f.push(C),d.push(y.textContent||"")}a.push(d),l.push(f),d.length>u&&(u=d.length)}if(a.length===0)return;let h={...this.getActiveCell(),rowCount:c,colCount:u};this.model.setCellValues(a,l,[h]),this.changeSet.add("content"),this.setActiveCell(h)}async paste(e){if(this.copyRanges=[],this.cutRanges.length>0){let[r]=this.cutRanges,i=[];for(let s=0;s<r.rowCount;s++)i.push(new Array(r.colCount).fill(""));this.model.setCellValues(i,[],this.cutRanges)}let t="",n="";if(e)t=e.clipboardData?.getData(z)||"",n=e.clipboardData?.getData(M)||"";else{let r=await this.hooks.paste();t=r[z],n=r[M]}t?this.parseHTML(t):this.parseText(n),this.cutRanges.length&&(this.cutRanges=[],this.hooks.copy({[M]:"",[z]:""}))}getCopyData(){let{row:e,col:t,rowCount:n,colCount:r}=this.getActiveCell(),i=[],s=[],a=1,l=[],c=this.model.getCurrentSheetId();for(let h=e,p=e+n;h<p;h++){let m=[],d=[];for(let f=t,y=t+r;f<y;f++){let C=this.model.getCell(new H(h,f,1,1,c)),x=String(C.value||"");if(m.push(x),C.style){let b=Ot(C.style);x||(b+="mso-pattern:black none;");let I=`xl${a++}`;l.push(`.${I}{${b}}`),d.push(`<td class="${I}"> ${x} </td>`)}else d.push(`<td> ${x} </td>`)}i.push(m),s.push(d)}let u=Zt(l.join(`
`),s.map(h=>`<tr>${h.join(`
`)}</tr>`).join(`
`)),g=i.map(h=>h.join("	")).join(`\r
`)+`\r
`;return{[M]:g,[z]:u}}copy(e){this.copyRanges=[this.getActiveCell()];let t=this.getCopyData();if(e){let n=Object.keys(t);for(let r of n)e.clipboardData?.setData(r,t[r])}else this.hooks.copy(t);this.changeSet.add("selection"),this.emitChange()}cut(e){this.cutRanges=[this.getActiveCell()],this.copy(e)}getCopyRanges(){return this.copyRanges.slice()}getDomRect(){let e=this.getMainDom().canvas;if(!e)return{top:0,left:0,width:0,height:0};let t=e.parentElement.getBoundingClientRect();return{top:t.top,left:t.left,width:t.width,height:t.height}}setMainDom(e){this.mainDom=Object.assign(this.mainDom,e)}getMainDom(){return this.mainDom}};var U=class{type;value;constructor(e,t){this.type=e,this.value=t}error(){return`type:${this.type},value:${this.value}`}toString(){return this.value}};var w=class extends Error{value;constructor(e){super(e),this.value=e}},Ol=new w("#VALUE!"),Fl=new w("#NUM!");function P(o,e="#VALUE!"){if(!o)throw new w(e)}function Je(o){P(o.length===1);let[e]=o;return e}function he(o){let e=Je(o);return P(typeof e=="string"),e}function N(o){let e=Je(o);return P(typeof e=="number"&&!isNaN(e)),e}function kt(o){P(o.length===0)}var Kn=(...o)=>{let e=Je(o);return typeof e=="string"?e:""},Gn=(...o)=>he(o).toLowerCase(),Ho=(...o)=>{let e=N(o);return String.fromCharCode(e)},Po=(...o)=>he(o).charCodeAt(0),jn=(...o)=>he(o).length,Jn=(...o)=>{P(o.length===2);let[e,t]=o;return P(typeof e=="string"),P(typeof t=="string"),e.split(t)},Yn=(...o)=>he(o).toUpperCase(),Xn=(...o)=>he(o).replace(/ +/g," ").trim(),Vo=(...o)=>(P(o.length<=Te),o.join("")),qn={CONCAT:Vo,CONCATENATE:Vo,SPLIT:Jn,CHAR:Ho,CODE:Po,UNICHAR:Ho,UNICODE:Po,LEN:jn,LOWER:Gn,UPPER:Yn,TRIM:Xn,T:Kn},Uo=qn;var Zn=(...o)=>{let e=N(o);return Math.abs(e)},Qn=(...o)=>{let e=N(o);return Math.acos(e)},er=(...o)=>{let e=N(o);return Math.log(e+Math.sqrt(e*e-1))},tr=(...o)=>{let e=N(o);return Math.atan(1/e)},or=(...o)=>{let e=N(o);return .5*Math.log((e+1)/(e-1))},nr=(...o)=>{let e=N(o);return Math.asin(e)},rr=(...o)=>{let e=N(o);return Math.log(e+Math.sqrt(e*e+1))},ir=(...o)=>{let e=N(o);return Math.atan(e)},sr=(...o)=>{P(o.length===2);let[e,t]=o;return P(typeof e=="number"),P(typeof t=="number"),Math.atan2(e,t)},ar=(...o)=>{let e=N(o);return Math.log((1+e)/(e+1))/2},lr=(...o)=>{let e=N(o);return Math.cos(e)},cr=(...o)=>{let e=N(o);return 1/Math.tan(e)};var hr=(...o)=>{let e=N(o);return Math.exp(e)},ur=(...o)=>{let e=N(o);return Math.floor(e)};var dr=(...o)=>(kt(o),Math.PI),pr=(...o)=>(kt(o),Math.E),mr=(...o)=>{let e=N(o);return Math.sin(e)},fr=(...o)=>{let e=Pt(o);return P(e.length<=Te),e.reduce((t,n)=>t+n,0)},gr={ABS:Zn,ACOS:Qn,ACOSH:er,ACOT:tr,ACOTH:or,ASIN:nr,ASINH:rr,ATAN:ir,ATAN2:sr,ATANH:ar,COT:cr,COS:lr,EXP:hr,INT:ur,PI:dr,E:pr,SIN:mr,SUM:fr},_o=gr;var Cr={...Uo,..._o},zo=Cr;var Bo="",yr=new Map([["TRUE",19],["FALSE",20]]),Ye=class{list;current=0;start=0;tokens=[];constructor(e){this.list=[...e]}scan(){for(;!this.isAtEnd();)this.start=this.current,this.scanToken();return this.tokens.push(new U(27,"")),this.tokens.length>0&&this.tokens[0].type===0&&this.tokens.shift(),this.tokens}peek(){return this.isAtEnd()?Bo:this.list[this.current]}match(e){return this.peek()!==e?!1:(this.next(),!0)}next(){return this.isAtEnd()?Bo:this.list[this.current++]}isAtEnd(){return this.current>=this.list.length}addToken(e){let t=this.list.slice(this.start,this.current).join("");this.tokens.push(new U(e,t))}string(e){for(;!this.isAtEnd()&&this.peek()!==e;)this.next();if(this.peek()!==e)throw new w("#VALUE!");this.next();let t=this.list.slice(this.start+1,this.current-1).join("");this.tokens.push(new U(17,t))}allDigit(){for(;!this.isAtEnd()&&this.isDigit(this.peek());)this.next()}number(){if(this.allDigit(),this.match("E")){if(this.match("+")||this.match("-")){this.allDigit(),this.addToken(18);return}throw new w("#VALUE!")}if(this.match(".")&&this.allDigit(),this.match("E")){if(this.match("+")||this.match("-")){this.allDigit(),this.addToken(18);return}throw new w("#VALUE!")}this.addToken(18)}isDigit(e){return e>="0"&&e<="9"}identifier(){for(;!this.isAtEnd()&&this.anyChar(this.peek());)this.next();let e=this.list.slice(this.start,this.current).join(""),t=yr.get(e.toUpperCase()),n=16;t&&(e=e.toUpperCase(),n=t),this.tokens.push(new U(n,e))}scanToken(){let e=this.next();switch(e){case"(":this.addToken(21);break;case")":this.addToken(22);break;case",":this.addToken(11);break;case":":this.addToken(10);break;case"=":this.addToken(0);break;case"<":this.match(">")?this.addToken(1):this.match("=")?this.addToken(15):this.addToken(14);break;case">":this.match("=")?this.addToken(8):this.addToken(7);break;case"+":this.addToken(2);break;case"-":this.addToken(3);break;case"*":this.addToken(4);break;case"/":this.addToken(5);break;case"^":this.addToken(6);break;case"&":this.addToken(9);break;case"%":this.addToken(13);break;case'"':this.string(e);break;case"!":this.addToken(26);break;case";":this.addToken(25);break;case"{":this.addToken(23);break;case"}":this.addToken(24);break;case" ":break;case"\r":case"	":case`
`:break;default:if(this.isDigit(e))this.number();else if(this.anyChar(e))this.identifier();else throw new w("#ERROR!");break}}anyChar(e){return!'(),:=<>+-*/^&%"{}!'.includes(e)&&!this.isWhiteSpace(e)}isWhiteSpace(e){return e===" "||e==="\r"||e===`
`||e==="	"}};var Y=class{left;right;operator;constructor(e,t,n){this.left=e,this.operator=t,this.right=n}accept(e){return e.visitBinaryExpression(this)}handleConcatenate(e){let t=e.toString();return this.operator.type===9&&e instanceof te&&e.value.type===17?JSON.stringify(t):t}toString(){let e=this.handleConcatenate(this.left),t=this.handleConcatenate(this.right);return`${e}${this.operator.toString()}${t}`}},Xe=class{right;operator;constructor(e,t){this.operator=e,this.right=t}accept(e){return e.visitUnaryExpression(this)}toString(){return this.operator.toString()+this.right.toString()}},qe=class{left;operator;constructor(e,t){this.operator=e,this.left=t}accept(e){return e.visitPostUnaryExpression(this)}toString(){return this.left.toString()+this.operator.toString()}},te=class{value;constructor(e){this.value=e}accept(e){return e.visitLiteralExpression(this)}toString(){return this.value.toString()}},X=class{value;sheetName;type;constructor(e,t,n){this.value=e,this.sheetName=n,this.type=t}accept(e){return e.visitCellExpression(this)}toString(){return this.sheetName?this.sheetName.toString()+"!"+this.value.toString():this.value.toString()}},Ze=class{name;params;constructor(e,t){this.name=e,this.params=t}accept(e){return e.visitCallExpression(this)}toString(){return`${this.name.toString().toUpperCase()}(${this.params.map(e=>e.toString()).join(",")})`}},Qe=class{left;right;operator;constructor(e,t,n){this.left=e,this.operator=t,this.right=n}accept(e){return e.visitCellRangeExpression(this)}toString(){return this.left.toString()+this.operator.toString()+this.right.toString()}},et=class{value;constructor(e){this.value=e}accept(e){return e.visitGroupExpression(this)}toString(){return`(${this.value.toString()})`}},oe=class{value;constructor(e){this.value=e}accept(e){return e.visitTokenExpression(this)}toString(){return this.value.toString()}};var Sr=new Set(["#ERROR!","#DIV/0!","#NULL!","#NUM!","#REF!","#VALUE!","#N/A","#NAME?"]),tt=class{tokens;current=0;constructor(e){this.tokens=e}parse(){let e=[];for(;!this.isAtEnd();)e.push(this.expression());return e}expression(){return this.comparison()}comparison(){let e=this.concatenate();for(;this.match(0,1,7,8,14,15);){let t=this.previous(),n=this.concatenate();e=new Y(e,t,n)}return e}concatenate(){let e=this.term();for(;this.match(9);){let t=this.previous(),n=this.term();e=new Y(e,t,n)}return e}term(){let e=this.factor();for(;this.match(2,3);){let t=this.previous(),n=this.factor();e=new Y(e,t,n)}return e}factor(){let e=this.expo();for(;this.match(5,4);){let t=this.previous(),n=this.expo();e=new Y(e,t,n)}return e}expo(){let e=this.unary();for(;this.match(6);){let t=this.previous(),n=this.unary();e=new Y(e,t,n)}return e}unary(){if(this.match(2,3)){let e=this.previous(),t=this.unary();return new Xe(e,t)}return this.postUnary()}postUnary(){let e=this.cellRange();if(this.match(13)){let t=this.previous();e=new qe(t,e)}return e}cellRange(){let e=this.call();for(;this.match(10,26);){let t=this.previous(),n=this.call();e=new Qe(e,t,n)}return e}call(){let e=this.primary();for(;this.match(21);)e=this.finishCall(e);return e}finishCall(e){let t=[];if(!this.check(22))do{if(this.peek().type==22)break;t.push(this.expression())}while(this.match(11));return this.expect(22),new Ze(e,t)}primary(){if(this.match(21)){let e=this.expression();return this.expect(22),new et(e)}if(this.match(18,17,19,20))return new te(this.previous());if(this.match(16)){let e=this.previous(),t=e.value.toUpperCase();if(Sr.has(t))throw new w(t);return new oe(e)}throw new w("#ERROR!")}match(...e){let t=this.peek().type;return e.includes(t)?(this.next(),!0):!1}previous(){return this.tokens[this.current-1]}check(e){return this.peek().type===e}expect(e){if(this.check(e))return this.next(),this.previous();throw new w("#ERROR!")}next(){this.current++}isAtEnd(){return this.peek().type===27}peek(){return this.current<this.tokens.length?this.tokens[this.current]:new U(27,"")}};var ot=class{expressions;functionMap;cellDataMap;variableMap;constructor(e,t,n,r){this.expressions=e,this.functionMap=r,this.cellDataMap=t,this.variableMap=n}interpret(){let e=[];for(let t of this.expressions)e.push(this.evaluate(t));if(e.length===1)return this.getRangeCellValue(e[0]);throw new w("#ERROR!")}getRangeCellValue(e){if(e instanceof H){if(e.colCount===e.rowCount&&e.colCount===1)return this.cellDataMap.get(e.row,e.col,e.sheetId);throw new w("#REF!")}return e}checkNumber(e){if(typeof e!="number")throw new w("#VALUE!")}visitBinaryExpression(e){let t=this.evaluate(e.left),n=this.evaluate(e.right);switch(t=this.getRangeCellValue(t),n=this.getRangeCellValue(n),e.operator.type){case 3:return this.checkNumber(t),this.checkNumber(n),t-n;case 2:return this.checkNumber(t),this.checkNumber(n),t+n;case 5:if(this.checkNumber(t),this.checkNumber(n),n===0)throw new w("#DIV/0!");return t/n;case 4:return this.checkNumber(t),this.checkNumber(n),t*n;case 6:return this.checkNumber(t),this.checkNumber(n),Math.pow(t,n);case 0:return t===n;case 1:return t!==n;case 7:return t>n;case 8:return t>=n;case 14:return t<n;case 15:return t<=n;case 9:return`${t}${n}`;default:throw new w("#VALUE!")}}visitCallExpression(e){let t=this.evaluate(e.name);if(t&&typeof t=="function"){let n=[];for(let r of e.params){let i=this.evaluate(r);if(i instanceof H){let{row:s,col:a,rowCount:l,colCount:c,sheetId:u}=i;for(let g=s,h=s+l;g<h;g++)for(let p=a,m=a+c;p<m;p++)n.push(this.cellDataMap.get(g,p,u))}else n.push(i)}return t(...n)}throw new w("#NAME?")}visitCellExpression(e){let t="";e.sheetName&&(t=this.cellDataMap.convertSheetNameToSheetId(e.sheetName.value));let n=$t(e.value.value);if(n===null)throw new w("#NAME?");return t&&(n.sheetId=t),n}visitLiteralExpression(e){let{type:t,value:n}=e.value;switch(t){case 17:return n;case 18:{let r=parseFloat(n);if(isNaN(r))throw new w("#VALUE!");return r}case 19:return!0;case 20:return!1;default:throw new w("#ERROR!")}}addCellExpression(e,t,n){e.value=e.value.toUpperCase();let r=new X(e,t,n);return this.visitCellExpression(r)}visitTokenExpression(e){let{value:t,type:n}=e.value,r=t.toLowerCase();if(this.variableMap.has(r))return this.variableMap.get(r);let i=t.toUpperCase();if(this.functionMap[i])return this.functionMap[i];let s=i,a=new U(n,s);if(/^\$[A-Z]+\$\d+$/.test(s)||/^\$[A-Z]+$/.test(s)||/^\$\d+$/.test(s))return this.addCellExpression(a,"absolute",null);if(/^\$[A-Z]+\d+$/.test(s)||/^[A-Z]+\$\d+$/.test(s))return this.addCellExpression(a,"mixed",null);if(/^[A-Z]+\d+$/.test(s)||/^[A-Z]+$/.test(s))return this.addCellExpression(a,"relative",null);throw new w("#NAME?")}visitUnaryExpression(e){let t=this.evaluate(e.right);switch(e.operator.type){case 3:return-t;case 2:return t;default:throw new w("#VALUE!")}}convertToCellExpression(e){return e instanceof X?e:e instanceof oe?new X(new U(16,e.value.value.toUpperCase()),"relative",null):e instanceof te&&e.value.type===18&&/^\d+$/.test(e.value.value)?new X(new U(16,e.value.value),"relative",null):null}visitCellRangeExpression(e){switch(e.operator.type){case 10:{let t=this.convertToCellExpression(e.left),n=this.convertToCellExpression(e.right);if(t!==null&&n!==null){let r=this.visitCellExpression(t),i=this.visitCellExpression(n),s=Kt(r,i);if(s===null)throw new w("#NAME?");return s}else throw new w("#NAME?");break}case 26:{let t=this.convertToCellExpression(e.right);if(t===null)throw new w("#REF!");if(e.left instanceof oe)return this.visitCellExpression(new X(t.value,t.type,e.left.value));throw new w("#NAME?")}default:throw new w("#NAME?")}}visitGroupExpression(e){return this.evaluate(e.value)}visitPostUnaryExpression(e){let t=this.evaluate(e.left);switch(e.operator.type){case 13:return this.checkNumber(t),t*.01;default:throw new w("#VALUE!")}}evaluate(e){return e.accept(this)}};function Nt(o,e=new nt,t=new rt,n=zo){let r="";try{let i=new Ye(o).scan(),s=new tt(i).parse(),a=new ot(s,e,t,n).interpret(),l=[];for(let c of s)l.push(c.toString());return r=l.join(""),{result:a,error:null,expressionStr:r}}catch(i){if(i instanceof w)return{result:null,error:i.value,expressionStr:r}}return{result:null,error:"#ERROR!",expressionStr:r}}var nt=class{map=new Map;sheetNameMap={};getKey(e,t,n=""){return`${e}_${t}_${n}`}setSheetNameMap(e){this.sheetNameMap=e}set(e,t,n,r){let i=this.getKey(e,t,n);this.map.set(i,r)}get(e,t,n=""){let r=this.getKey(e,t,n);return this.map.get(r)}convertSheetNameToSheetId(e){return e&&this.sheetNameMap[e]||""}},rt=class{map=new Map;set(e,t){this.map.set(e,t)}get(e){return this.map.get(e)}has(e){return this.map.has(e)}};var Wo=19,$o=68,xr=16384,vr=1048576;function it(o){let e=o.map(t=>parseInt(t,10)).filter(t=>!isNaN(t));return e.sort((t,n)=>t-n),e}var st=class{currentSheetId="";workbook=[];worksheets={};mergeCells=[];customHeight={};customWidth={};history;customVariableMap={};constructor(e){this.history=e}getSheetList(){return this.workbook}setActiveCell(e){let t=this.workbook.findIndex(l=>l.sheetId===e.sheetId);if(t<0)return;let{row:n,col:r}=e,i=this.workbook[t];if(n<0||r<0||n>=i.rowCount||r>=i.colCount)return;let s=i.activeCell;if(Wt(s,e))return;let a=`workbook.${t}.activeCell`;this.history.pushRedo("set",a,{...s}),ae(this,a,{...e})}addSheet(){let e=Vt(this.workbook),t={...e,isHide:!1,colCount:Z,rowCount:q,activeCell:{row:0,col:0,rowCount:1,colCount:1,sheetId:e.sheetId}},n=this.workbook.findIndex(r=>r.sheetId===this.currentSheetId);n<0?this.workbook.push(t):this.workbook.splice(n+1,0,t),this.currentSheetId=t.sheetId}getSheetIndex(e){let t=e||this.currentSheetId,n=this.workbook.findIndex(i=>i.sheetId===t);_(n>=0);let r=0;if(n===0)for(r=n+1;r<=this.workbook.length-2&&this.workbook[r].isHide;)r++;else for(r=n-1;r>=1&&this.workbook[r].isHide;)r--;return{index:n,lastIndex:r}}deleteSheet(e){let t=this.workbook.filter(i=>!i.isHide);_(t.length>=2,"A workbook must contains at least on visible worksheet");let{index:n,lastIndex:r}=this.getSheetIndex(e);this.currentSheetId=this.workbook[r].sheetId,this.workbook.splice(n,1)}hideSheet(e){let t=this.workbook.filter(i=>!i.isHide);_(t.length>=2,"A workbook must contains at least on visible worksheet");let{index:n,lastIndex:r}=this.getSheetIndex(e);this.workbook[n].isHide=!0,this.currentSheetId=this.workbook[r].sheetId}unhideSheet(e){let{index:t}=this.getSheetIndex(e);this.workbook[t].isHide=!1,this.currentSheetId=this.workbook[t].sheetId}renameSheet(e,t){_(!!e,"You typed a invalid name for a sheet.");let n=this.getSheetInfo(t);n.name=e}getSheetInfo(e=this.currentSheetId){let t=this.workbook.find(n=>n.sheetId===e);return _(t!==void 0),t}setCurrentSheetId(e){this.currentSheetId=e,this.computeAllCell()}getCurrentSheetId(){return this.currentSheetId}fromJSON=e=>{Gt("fromJSON",e);let{worksheets:t={},workbook:n=[],mergeCells:r=[],customHeight:i={},customWidth:s={},customVariable:a={}}=e;this.worksheets=t,this.workbook=n,this.currentSheetId=n[0].sheetId||this.currentSheetId,this.mergeCells=r,this.customWidth=s,this.customHeight=i,this.customVariableMap=a,this.computeAllCell(),this.history.clear()};toJSON=()=>{let{worksheets:e,workbook:t,mergeCells:n,customHeight:r,customWidth:i,customVariableMap:s}=this;return{workbook:t,worksheets:e,mergeCells:n,customHeight:r,customWidth:i,customVariable:s}};setCellValue(e,t){let{row:n,col:r}=t,i=`worksheets[${this.currentSheetId}][${n}][${r}].value`;this.history.pushRedo("set",i,se(this,i,void 0)),ae(this,i,e)}setCellFormula(e,t){let{row:n,col:r}=t,i=`worksheets[${this.currentSheetId}][${n}][${r}].formula`;this.history.pushRedo("set",i,se(this,i,void 0)),ae(this,i,e)}setCellValues(e,t,n){let[r]=n,{row:i,col:s}=r;for(let a=0;a<e.length;a++)for(let l=0;l<e[a].length;l++){let c=e[a][l],u={row:i+a,col:s+l};t[a]&&t[a][l]&&this.setStyle(t[a][l],u),c.startsWith("=")?this.setCellFormula(c,u):(this.setCellFormula("",u),this.setCellValue(c,u))}this.computeAllCell()}setStyle(e,t){let n=`worksheets[${this.currentSheetId}][${t.row}][${t.col}].style`;this.history.pushRedo("set",n,se(this,n,{})),ae(this,n,e)}setCellStyle(e,t){let[n]=t,{row:r,col:i,rowCount:s,colCount:a}=n;for(let l=r,c=r+s;l<c;l++)for(let u=i,g=i+a;u<g;u++)this.setStyle(e,{row:l,col:u})}getCell=e=>{let{row:t,col:n,sheetId:r}=e,i=r||this.currentSheetId;return{...se(this,`worksheets[${i}][${t}][${n}]`,{}),row:t,col:n}};computeAllCell(){let e=this.worksheets[this.currentSheetId];if(A(e))return[];let t=Object.keys(e);for(let n of t){let r=Object.keys(e[n]);for(let i of r){let s=e[n][i];s?.formula&&(s.value=this.parseFormula(s.formula))}}}parseFormula(e){let t=this,n=Nt(e,{get:(r,i,s)=>t.getCell(new H(r,i,1,1,s)).value,set:()=>{},convertSheetNameToSheetId:r=>t.workbook.find(s=>s.name===r)?.sheetId||""},{set(r,i){t.customVariableMap[r]=i},get(r){return t.customVariableMap[r]},has(r){return r in t.customVariableMap}});return n.error?n.error:n.result}addRow(e,t){let n=this.worksheets[this.currentSheetId];if(A(n))return;let r=it(Object.keys(n));for(let s=r.length-1;s>=0;s--){let a=r[s];if(a<e)continue;let l=String(a+t);n[l]={...n[a]},n[a]={}}let i=this.getSheetInfo();i.rowCount>=vr||(i.rowCount+=t)}addCol(e,t){let n=this.worksheets[this.currentSheetId];if(A(n))return;let r=this.getSheetInfo(),i=Object.keys(n);for(let s of i){let a=it(Object.keys(n[s]));for(let l=a.length-1;l>=0;l--){let c=a[l];if(c<e)continue;let u=String(c+t);n[s][u]={...n[s][c]},n[s][c]={}}}r.colCount>=xr||(r.colCount+=t)}deleteCol(e,t){let n=this.worksheets[this.currentSheetId];if(A(n))return;let r=this.getSheetInfo(),i=Object.keys(n);for(let s of i){let a=it(Object.keys(n[s]));for(let l=0;l<a.length;l++){let c=a[l];if(c<e)continue;let u=String(c-t);n[s][u]={...n[s][c]},n[s][c]={}}}r.colCount-=t}deleteRow(e,t){let n=this.worksheets[this.currentSheetId];if(A(n))return;let r=it(Object.keys(n));for(let s=0;s<r.length;s++){let a=r[s];if(a<e)continue;let l=String(a-t);n[l]={...n[a]},n[a]={}}let i=this.getSheetInfo();i.rowCount-=t}getColWidth(e){let t=this.customWidth[this.currentSheetId];return t&&typeof t[e]=="number"?t[e]:$o}setColWidth(e,t){this.customWidth[this.currentSheetId]=this.customWidth[this.currentSheetId]||{},this.customWidth[this.currentSheetId][e]=t}getRowHeight(e){let t=this.customHeight[this.currentSheetId];return t&&typeof t[e]=="number"?t[e]:Wo}setRowHeight(e,t){this.customHeight[this.currentSheetId]=this.customHeight[this.currentSheetId]||{},this.customHeight[this.currentSheetId][e]=t}canRedo(){return this.history.canRedo()}canUndo(){return this.history.canUndo()}undo(){this.canUndo()&&this.executeOperate(this.history.undo())}redo(){this.canRedo()&&this.executeOperate(this.history.redo())}record(){this.history.onChange()}executeOperate(e){for(let t of e){let{op:n,path:r,value:i}=t;switch(n){case"set":{this.history.pushUndo(n,r,se(this,r,void 0)),this.record(),ae(this,r,i);break}default:console.error(`not support type: ${n}`);break}}}};var Rt={workbook:[{sheetId:"1",name:"Sheet1",isHide:!1,activeCell:{row:2,col:2,rowCount:1,colCount:1,sheetId:""},colCount:Z,rowCount:q},{sheetId:"2",name:"test",isHide:!1,colCount:Z,rowCount:q,activeCell:{row:4,col:4,rowCount:2,colCount:2,sheetId:""}}],worksheets:{1:{0:{0:{value:"",style:{fontColor:"#ff0000"}},1:{value:"",formula:"=foo"},2:{value:""},3:{value:"\u8D85\u5927\u5B57",style:{fontSize:36}},4:{value:"\u8FD9\u662F\u4E00\u6BB5\u975E\u5E38\u957F\u7684\u6587\u6848\uFF0C\u9700\u8981\u6362\u884C\u5C55\u793A",style:{isWrapText:!0,underline:1}}},3:{0:{style:{fillColor:"red"}},1:{style:{fillColor:"red"}}},4:{0:{style:{fillColor:"red"}},1:{style:{fillColor:"red"}}}},2:{0:{0:{}}}},mergeCells:[{row:7,col:0,rowCount:2,colCount:2,sheetId:"1"}],customHeight:{1:{1:100}},customWidth:{1:{1:100}},customVariable:{foo:1}};var we=class{undoList=[];redoList=[];undoItem=[];redoItem=[];constructor(){this.clear()}clearItem(){this.undoItem=[],this.redoItem=[]}onChange(){this.undoItem.length>0&&this.undoList.push(this.undoItem.slice()),this.redoItem.length>0&&this.redoList.push(this.redoItem.slice()),this.clearItem()}pushRedo(e,t,n){this.redoItem.push({op:e,path:t,value:n})}pushUndo(e,t,n){this.undoItem.push({op:e,path:t,value:n})}clear(){this.undoList=[],this.redoList=[],this.clearItem()}canRedo(){return this.redoList.length>0}canUndo(){return this.undoList.length>0}redo(){return this.redoList.pop()}undo(){return this.undoList.pop()}};function Ko(o){let e=Object.keys(k);for(let t of e)o.style.setProperty(`--${t}`,String(k[t]||""))}function Go(o=oo){let e=localStorage.getItem(Fe);if(e)return JSON.parse(e).map(r=>({value:r,label:r,disabled:!1}));let t=o.map(n=>({label:n,value:n,disabled:!Ae(n)}));return window.queryLocalFonts&&t.push({value:Oe,label:"--> get all installed fonts",disabled:!1}),t}function wr(o,e){let{top:t}=o.getDomRect(),n=o.getActiveCell(),r=o.getCell(n),i=o.computeCellPosition(n.row,n.col);if(i.top=t+i.top,r.style||(r.style={}),!r.style.fontFamily){let l="";for(let c of e.fontFamilyList)if(!c.disabled){l=String(c.value);break}r.style.fontFamily=l}let s=o.getSheetList().filter(l=>!l.isHide).map(l=>({value:l.sheetId,label:l.name}));return{activeCell:{...i,...r},sheetList:s,currentSheetId:o.getCurrentSheetId()}}function br(){let o=document.createElement("canvas");return o.style.display="none",document.body.appendChild(o),o}var jo=(o,e)=>{let t=new fe(e,new ye(e,br())),n=()=>{t.resize(),t.render({changeSet:new Set(["content"])})};n();let r=pt(o,e,n);return e.setHooks({copy:Yt,cut:Xt,paste:qt,modelChange:i=>{let s=wr(e,o);Object.assign(o,s),t.render({changeSet:i}),t.render({changeSet:e.getChangeSet()})}}),e.fromJSON(Rt),r};function Jo(){let o=new ve(new st(new we));return o.addSheet(),window.controller=o,o}var Er=o=>{let e=Go();Ko(document.documentElement);let t=Jo(),n=new Proxy(Ht,{set(i,s,a){let l=Reflect.set(i,s,a);return r(),l}}),r=()=>{bo(o,bt(n,t))};return n.fontFamilyList=e,r(),jo(n,t)};return en(Ir);})();

    for(var key in __export__) {
            exports[key] = __export__[key]
        }
    }));
//# sourceMappingURL=index.js.map
