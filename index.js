/* 
MIT License

Copyright (c) 2020 Steve Xu

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
 
*/(function (global, factory) {
            typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :
            typeof define === 'function' && define.amd ? define(['exports'], factory) :
              (global = global || self, factory(global.excel = {}));
       })(this, (function (exports) { 'use strict';
"use strict";var __export__=(()=>{var be=Object.defineProperty;var Jo=Object.getOwnPropertyDescriptor;var Xo=Object.getOwnPropertyNames;var qo=Object.prototype.hasOwnProperty;var Zo=(o,e,t)=>e in o?be(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var Qo=(o,e)=>{for(var t in e)be(o,t,{get:e[t],enumerable:!0})},en=(o,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Xo(e))!qo.call(o,r)&&r!==t&&be(o,r,{get:()=>e[r],enumerable:!(n=Jo(e,r))||n.enumerable});return o};var tn=o=>en(be({},"__esModule",{value:!0}),o);var lt=(o,e,t)=>(Zo(o,typeof e!="symbol"?e+"":e,t),t);var Er={};Qo(Er,{initExcel:()=>wr});function k(o=window.devicePixelRatio){return Math.max(Math.floor(o||1),1)}function v(o){return Math.floor(o*k())}function te(){return 1}function j(){return navigator.userAgent.indexOf("Mac OS X")>-1}var Y=11,B="#333333",Lt="#ff0000";var ue="sans-serif",Mt=[6,8,9,10,Y,12,14,16,18,20,22,24,26,28,36,48,72];function pe(o="normal",e="normal",t=12,n=""){let r=`${o} ${e} ${t}px `;return n?`${r}${n},${ue}`:r+ue}var Te=pe(void 0,"500",v(Y));function At(o){let e="";return o.fontColor&&(e+=`color:${o.fontColor};`),o.fillColor&&(e+=`background-color:${o.fillColor};`),o.fontSize&&(e+=`font-size:${o.fontSize}pt;`),o.fontFamily&&(e+=`font-family:${o.fontFamily};`),o.isItalic&&(e+="font-style:italic;"),o.isBold&&(e+="font-weight:700;"),o.isWrapText&&(e+="white-space:normal;"),o.underline&&(e+="text-decoration:underline;",o.underline===2?e+="text-decoration-style: double;":e+="text-decoration-style: single;"),e}function on(o,e){let{color:t,backgroundColor:n,fontSize:r,fontFamily:i,fontStyle:s,fontWeight:a,whiteSpace:l,textDecoration:h}=o,u={};if(t&&(u.fontColor=t),n&&(u.fillColor=n),r){let g=parseInt(r,10);isNaN(g)||(u.fontSize=g)}return i&&(u.fontFamily=i),s==="italic"&&(u.isItalic=!0),a&&["700","800","900","bold"].includes(a)&&(u.isBold=!0),l&&["normal","pre-wrap","pre-line","break-spaces","revert","unset"].includes(l)&&(u.isWrapText=!0),h==="underline"&&(u.underline=1,e.includes("text-underline-style:double")&&(u.underline=2)),u}function at(o,e){for(let t of o){if(!t.sheet?.cssRules)continue;let n=t.textContent||"";for(let r of t.sheet?.cssRules)if(r instanceof CSSStyleRule&&r.selectorText===e){let i=n.indexOf(e),s=i;for(;n[s]!=="}"&&s<n.length;)s++;let a="";return i>=0&&(a=n.slice(i+e.length,s).replace(/\s/g,"")),on(r.style,a)}}return{}}function oe(o,e="assert error",t="production"){if(!o){if(t==="production"){console.error(e);return}throw new Error(e)}}var ct="Sheet",q=200,Z=30;var ne=30,ht=200,Re=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],Ne=256,Ot=new Set(["#ERROR!","#DIV/0!","#NULL!","#NUM!","#REF!","#VALUE!","#N/A","#NAME?"]),Ft={sheetList:[],currentSheetId:"",isCellEditing:!1,activeCell:{value:"",style:{},row:0,col:0,left:-999,top:-999,width:0,height:0},fontFamilyList:[],contextMenuPosition:void 0};function ke(o){if(typeof o=="number"&&!window.isNaN(o))return!0;if(typeof o!="string")return!1;let e=parseFloat(o);return!window.isNaN(e)&&e===Number(o)}function nn(o){return ke(o)?Number(o):0}function Ht(o){let e=[];for(let t=0;t<o.length;t++){let n=nn(o[t]);window.isNaN(n)||e.push(n)}return e}function Dt(o=[],e=""){let t=o.map(n=>ke(n)||e.length===0?parseInt(n,10):parseInt(n.includes(e)?n.slice(e.length):n,10)).filter(n=>!isNaN(n));return Math.max(Math.max(...t),0)}function Ut(o=[]){let e=Dt(o.map(n=>n.name),ct),t=Dt(o.map(n=>n.sheetId))+1;return{name:`${ct}${e+1}`,sheetId:String(t)}}function Pt(){return!1}function Vt(o=""){let e=o.toUpperCase(),t=0;for(let n=0;n<e.length;n++)t=e.charCodeAt(n)-64+t*26;return t-1}function Le(o){let e=o+1,t="",n=Math.floor(Math.abs(e)),r;for(;n>0;)r=(n-1)%26,t=String.fromCharCode(65+r)+t,n=Math.floor((n-r)/26);return t.toUpperCase()}function _t(o){let e=parseInt(o,10);return window.isNaN(e)?e=-1:e=Math.max(e-1,-1),e}function V(...o){let e="";for(let t of o)if(typeof t=="string"&&t&&(e+=`${t} `),typeof t=="object")for(let n of Object.keys(t))t[n]&&(e+=`${n} `);return e.trim()}function zt(o){return ut(o)&&pt(o)}function ut(o){return o.col===o.rowCount&&o.rowCount===0}function pt(o){return o.row===o.colCount&&o.colCount===0}function Wt(o,e){return!o||!e?!1:o.col===e.col&&o.row===e.row&&o.colCount===e.colCount&&o.rowCount===e.rowCount&&o.sheetId===e.sheetId}var L=class{row=0;col=0;colCount=0;rowCount=0;sheetId="";constructor(e,t,n,r,i){this.row=e,this.col=t,this.colCount=r,this.rowCount=n,this.sheetId=i}isValid(){return this.row>=0&&this.col>=0&&this.colCount>=0&&this.rowCount>=0}static makeRange(e){return new L(e.row,e.col,e.rowCount,e.colCount,e.sheetId)}};var rn=o=>o>="a"&&o<="z"||o>="A"&&o<="Z",sn=o=>o>="0"&&o<="9";function ln(o){return o}function Bt(o,e=ln){if(typeof o!="string"||!o)return null;let t=o.trim(),[n,r=""]=t.split("!");t.includes("!")||(n="",r=t);let i=0,s="",a="";for(r[i]==="$"&&i++;rn(r[i]);)a+=r[i++];for(r[i]==="$"&&i++;sn(r[i]);)s+=r[i++];if(i!==r.length||!s&&!a)return null;let l=1,h=1,u=0,g=0;return s===""?(h=0,l=q):u=_t(s),a===""?(h=Z,l=0):g=Vt(a),u===-1||g===-1?null:new L(u,g,l,h,e(n))}function $t(o,e){if(o.sheetId!==e.sheetId)return null;let t=Math.abs(o.row-e.row)+1,n=Math.abs(o.col-e.col)+1,r=o.row<e.row?o.row:e.row,i=o.col<e.col?o.col:e.col;return new L(r,i,t,n,o.sheetId)}var re=class{namespace;constructor(e){this.namespace=e}init=()=>(this.setColor(),this.log);log=(...e)=>{if(!this.enable())return;let{namespace:t}=this,n=re.colorMap.get(t),r=[`%c ${t}:`,`color:${n};`,...e];console.log(...r)};getRandomColor=()=>{let e=Math.floor(Math.random()*Re.length);return oe(e>=0&&e<Re.length,String(e)),Re[e]};enable(){return this.checkEnable()&&re.enableMap.get(this.namespace)!==!1}checkEnable(e=window.localStorage){return e.getItem("debug")==="*"}setColor(){re.colorMap.has(this.namespace)||re.colorMap.set(this.namespace,this.getRandomColor())}},J=re;lt(J,"colorMap",new Map),lt(J,"enableMap",new Map([]));var Me=new J("react").init(),Ae=new J("controller").init(),ri=new J("canvas").init(),Kt=new J("model").init();function an(o=document.body){let e="monospace",t="serif",n=document.createElement("span");n.innerHTML="\u6D4B\u8BD5a11",n.style.cssText=["position:absolute","width:auto","font-size:128px","left:-99999px"].join(" !important;");let r=function(h){n.style.fontFamily=h,o.appendChild(n);let u=n.clientWidth;return o.removeChild(n),u},i=r(e),s=r(t),a=r(ue);return function(h){return i!==r(`${h},${e}`)||a!==r(`${h},${ue}`)||s!==r(`${h},${t}`)}}var Gt=an();var A="text/plain",z="text/html";function cn(o){let e=o.hasAttribute("readonly");return e||o.setAttribute("readonly",""),o.select(),o.setSelectionRange(0,o.value.length),e||o.removeAttribute("readonly"),o.value}function hn(o){let e=document.documentElement.getAttribute("dir")==="rtl",t=document.createElement("textarea");t.style.fontSize="12pt",t.style.border="0",t.style.padding="0",t.style.margin="0",t.style.position="absolute",t.style[e?"right":"left"]="-9999px";let n=window.pageYOffset||document.documentElement.scrollTop;return t.style.top=`${n}px`,t.setAttribute("readonly",""),t.value=o,t}function jt(o){let e={},t=Object.keys(o);for(let r of t)e[r]=new Blob([o[r]],{type:r});let n=[new ClipboardItem(e)];return navigator.clipboard.write(n)}async function un(){let o={[z]:"",[A]:""},e=await navigator.clipboard.read();for(let t of e){if(t.types.includes(A)){let n=await t.getType(A);o[A]=await n.text()}if(t.types.includes(z)){let n=await t.getType(z);o[z]=await n.text()}}return o}var Yt=(o,e,t)=>{let n=hn(o);e.appendChild(n);let r=cn(n);return document.execCommand(t),n.remove(),r};async function Jt(o){try{return await jt(o),o[A]}catch(e){return console.error(e),Yt(o[A],document.body,"copy")}}async function Xt(o){try{return await jt(o),o[A]}catch(e){return console.error(e),Yt(o[A],document.body,"cut")}}async function qt(){try{return un()}catch(o){console.error(o);let e=await navigator.clipboard.readText();return{[z]:"",[A]:e}}}function Zt(o,e){return`<html
  xmlns:v="urn:schemas-microsoft-com:vml"
  xmlns:o="urn:schemas-microsoft-com:office:office"
  xmlns:x="urn:schemas-microsoft-com:office:excel"
  xmlns="http://www.w3.org/TR/REC-html40"
>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="ProgId" content="Excel.Sheet" />
    <meta name="Generator" content="Microsoft Excel 15" />
    <style>
       {
        mso-displayed-decimal-separator: '.';
        mso-displayed-thousand-separator: ',';
      }
      @page {
        margin: 0.75in 0.7in 0.75in 0.7in;
        mso-header-margin: 0.3in;
        mso-footer-margin: 0.3in;
      }
      .font5 {
        color: windowtext;
        font-size: 9pt;
        font-weight: 400;
        font-style: normal;
        text-decoration: none;
        font-family: \u7B49\u7EBF;
        mso-generic-font-family: auto;
        mso-font-charset: 134;
      }
      tr {
        mso-height-source: auto;
        mso-ruby-visibility: none;
      }
      col {
        mso-width-source: auto;
        mso-ruby-visibility: none;
      }
      br {
        mso-data-placement: same-cell;
      }
      td {
        padding-top: 1px;
        padding-right: 1px;
        padding-left: 1px;
        mso-ignore: padding;
        color: black;
        font-size: 11pt;
        font-weight: 400;
        font-style: normal;
        text-decoration: none;
        font-family: \u7B49\u7EBF;
        mso-generic-font-family: auto;
        mso-font-charset: 134;
        mso-number-format: General;
        text-align: general;
        vertical-align: middle;
        border: none;
        mso-background-source: auto;
        mso-pattern: auto;
        mso-protection: locked visible;
        white-space: nowrap;
        mso-rotate: 0;
      }
      ${o}
      ruby {
        ruby-align: left;
      }
      rt {
        color: windowtext;
        font-size: 9pt;
        font-weight: 400;
        font-style: normal;
        text-decoration: none;
        font-family: \u7B49\u7EBF;
        mso-generic-font-family: auto;
        mso-font-charset: 134;
        mso-char-type: none;
        display: none;
      }
    </style>
  </head>

  <body link="#0563C1" vlink="#954F72">
    <table
      border="0"
      cellpadding="0"
      cellspacing="0"
      width="103"
      style="border-collapse: collapse; width: 77pt"
    >
      <col
        width="103"
        style="mso-width-source: userset; mso-width-alt: 3515; width: 77pt"
      />
      ${e}
    </table>
  </body>
</html>`}function Qt(o){let e;return(...t)=>{cancelAnimationFrame(e),e=requestAnimationFrame(()=>{o(...t)})}}function ie(o,e,t){let n=o==null?void 0:e.replace(/\[/g,".").replace(/\]/g,"").split(".").reduce((r,i)=>r==null?r:r[i],o);return n===void 0?t:n}function O(o){let e=o||{};return[Object,Array].includes(e.constructor)&&!Object.entries(e).length}function se(o,e,t){return o==null||typeof o!="object"||e.replace(/\[/g,".").replace(/\]/g,"").split(".").reduce((n,r,i,s)=>(i===s.length-1?n[r]=t:n[r]==null&&(n[r]={}),n[r]),o),o}var pn={smallFont:"10px",font:"12px",largeFont:"14px",padding:"12px",lineHeight:"1.5",mediumPadding:"8px",borderRadius:"4px",tinyPadding:"4px"},eo=pn;var dn={primaryColor:"#217346",buttonActiveColor:"rgb(198,198,198)",selectionColor:"rgba(198,198,198,0.3)",backgroundColor:"#e6e6e6",white:"#ffffff",black:"#000000",gridStrokeColor:"#d4d4d4",triangleFillColor:"#b4b4b4",contentColor:B,borderColor:"#cccccc",activeBorderColor:"#808080",disabledColor:"#ccc"},to=dn;var T={...eo,...to};var Oe="QUERY_ALL_LOCAL_FONT",Fe="LOCAL_FONT_KEY",oo=["\u7B49\u7EBF","\u7B49\u7EBF Light","\u65B9\u6B63\u8212\u4F53","\u65B9\u6B63\u59DA\u4F53","\u4EFF\u5B8B","\u9ED1\u4F53","\u534E\u6587\u5F69\u4E91","\u534E\u6587\u4EFF\u5B8B","\u534E\u6587\u7425\u73C0","\u534E\u6587\u6977\u4F53","\u534E\u6587\u96B6\u4E66","\u534E\u6587\u5B8B\u4F53","\u534E\u6587\u7EC6\u9ED1","\u534E\u6587\u65B0\u9B4F","\u534E\u6587\u884C\u6977","\u534E\u6587\u4E2D\u5B8B","\u6977\u4F53","\u96B6\u4E66","\u5B8B\u4F53","\u5FAE\u8F6F\u96C5\u9ED1","\u5FAE\u8F6F\u96C5\u9ED1 Light","\u65B0\u5B8B\u4F53","\u5E7C\u5706","Arial","Arial Narrow","Cascadia Code","Cascadia Code ExtraLight","Cascadia Code Light","Cascadia Code PL","Cascadia Code PL ExtraLight","Cascadia Code PL Light","Cascadia Code PL SemiBold","Cascadia Code SemiBold","Cascadia Mono","Cascadia Mono ExtraLight","Cascadia Mono Light","Cascadia Mono PL","Cascadia Mono PL ExtraLight","Cascadia Mono PL Light","Cascadia Mono PL SemiBold","Cascadia Mono SemiBold","Microsoft JhengHei","Microsoft JhengHei Light","Microsoft JhengHei UI","Microsoft JhengHei UI Light","Microsoft New Tai Lue","Microsoft PhagsPa","Microsoft Sans Serif","Microsoft Tai Le","Microsoft Yahei UI","Microsoft YaHei UI Light","Microsoft Yi Baiti","SimSun-ExtB","Times New Roman","Yu Gothic Light","Yu Gothic Medium","Yu Gothic Regular","Yu Gothic UI Light","Yu Gothic UI Regular","Yu Gothic UI Semibold"];function De(o,e){let t=e.getDomRect(),n=e.getScroll(),r=e.getSheetInfo(e.getCurrentSheetId()),i=e.getHeaderSize(),{pageX:s,pageY:a}=o,l=s-t.left,h=a-t.top,u=i.width,g=i.height,c=n.row,m=n.col;for(;u+e.getColWidth(m)<=l;)u+=e.getColWidth(m),m++;for(;g+e.getRowHeight(c)<=h;)g+=e.getRowHeight(c),c++;return c>=r.rowCount||m>=r.colCount?null:{...e.getCellSize(c,m),row:c,col:m,pageY:a,pageX:s,x:l,y:h}}function mn(o,e){return Me("createElement"),document.createElement(o,e)}function fn(o,e,t){return Me("createElementNS"),document.createElementNS(o,e,t)}function gn(o){return Me("createTextNode"),document.createTextNode(o)}function Cn(o,e,t){o.insertBefore(e,t)}function yn(o,e){o.removeChild(e)}function xn(o,e){o.appendChild(e)}function Sn(o){return o.parentNode}function vn(o){return o.nextSibling}function wn(o,e){o.textContent=e}function En(o){return o.nodeType===1}var He={createElement:mn,createElementNS:fn,createTextNode:gn,insertBefore:Cn,removeChild:yn,appendChild:xn,parentNode:Sn,nextSibling:vn,setTextContent:wn,isElement:En};var bn="http://www.w3.org/2000/svg";function no(o){if(o.data.ns=bn,o.data?.props?(o.data.attrs=Object.assign(o.data.props||{},o.data?.attrs||{}),o.data.props=void 0):o.data.attrs={},o.data.attrs.class=o.data.className||"",o.data.className=void 0,o.children)for(let e of o.children)e&&no(e)}function S(o,e,...t){let n=e.key===void 0?void 0:e.key,r={hook:e.hook,style:e.style,key:e.key,className:e.className},i=[],s=[],a=t||[];for(let u of a)if(typeof u=="string"||typeof u=="number"){let g=String(u);g&&s.push(g)}else u&&typeof u=="object"&&i.push(u);let l=Object.keys(e);for(let u of l){if(["className","style","key","ns","is"].includes(u))continue;let g=e[u];u==="data-testId"?(r.dataset||(r.dataset={}),r.dataset[u.slice(5)]=g):u.startsWith("on")?(r.on||(r.on={}),r.on[u.slice(2)]=g):(r.props||(r.props={}),r.props[u]=g)}let h={sel:o,data:r,key:n,elm:void 0,children:[],text:void 0};if(s.length>0&&i.length>0)throw new Error("error node");return s.length>0&&(h.text=s.join(" ")),i.length>0&&(h.children=i),h.sel==="svg"&&no(h),h}function ro(o){return o===void 0}function P(o){return o!==void 0}var io=S("",{});function de(o,e){let t=o.key===e.key,n=o.data?.is===e.data?.is,r=o.sel===e.sel,i=!o.sel&&o.sel===e.sel?typeof o.text==typeof e.text:!0;return r&&t&&n&&i}function In(o,e){return o.isElement(e)}function Tn(o,e,t){let n={};for(let r=e;r<=t;++r){let i=o[r]?.key;i!==void 0&&(n[i]=r)}return n}var Rn=["create","update","remove","destroy","pre","post"];function so(o,e){let t={create:[],update:[],remove:[],destroy:[],pre:[],post:[]},n=e!==void 0?e:He;for(let c of Rn)for(let m of o){let d=m[c];d!==void 0&&t[c].push(d)}function r(c,m){return function(){if(--m===0){let p=n.parentNode(c);n.removeChild(p,c)}}}function i(c,m){let d,p=c.data;if(p!==void 0){let C=p.hook?.init;C&&(C(c),p=c.data)}let f=c.children,y=c.sel;if(y!==void 0){let C=c.elm=P(p)&&P(d=p.ns)?n.createElementNS(d,y,p):n.createElement(y,p);for(d=0;d<t.create.length;++d)t.create[d](io,c);if(Array.isArray(f)&&f.length>0)for(d=0;d<f.length;++d){let b=f[d];b!=null&&n.appendChild(C,i(b,m))}else(typeof c.text=="string"||typeof c.text=="number")&&n.appendChild(C,n.createTextNode(c.text));let x=c.data.hook;P(x)&&(x.create?.(io,c),x.insert&&m.push(c))}else c.elm=n.createTextNode(c.text);return c.elm}function s(c,m,d,p,f,y){for(;p<=f;++p){let C=d[p];C!=null&&n.insertBefore(c,i(C,y),m)}}function a(c){let m=c.data;if(m!==void 0){m?.hook?.destroy?.(c);for(let d=0;d<t.destroy.length;++d)t.destroy[d](c);if(c.children!==void 0)for(let d=0;d<c.children.length;++d){let p=c.children[d];p!=null&&typeof p!="string"&&a(p)}}}function l(c,m,d,p){for(;d<=p;++d){let f,y,C=m[d];if(C!=null)if(P(C.sel)){a(C),f=t.remove.length+1,y=r(C.elm,f);for(let b=0;b<t.remove.length;++b)t.remove[b](C,y);let x=C?.data?.hook?.remove;P(x)?x(C,y):y()}else C.children?(a(C),l(c,C.children,0,C.children.length-1)):n.removeChild(c,C.elm)}}function h(c,m,d,p){let f=0,y=0,C=m.length-1,x=m[0],b=m[C],I=d.length-1,w=d[0],D=d[I],H,G,Ee,kt;for(;f<=C&&y<=I;)x==null?x=m[++f]:b==null?b=m[--C]:w==null?w=d[++y]:D==null?D=d[--I]:de(x,w)?(u(x,w,p),x=m[++f],w=d[++y]):de(b,D)?(u(b,D,p),b=m[--C],D=d[--I]):de(x,D)?(u(x,D,p),n.insertBefore(c,x.elm,n.nextSibling(b.elm)),x=m[++f],D=d[--I]):de(b,w)?(u(b,w,p),n.insertBefore(c,b.elm,x.elm),b=m[--C],w=d[++y]):(H===void 0&&(H=Tn(m,f,C)),G=H[w.key],ro(G)?n.insertBefore(c,i(w,p),x.elm):(Ee=m[G],Ee.sel!==w.sel?n.insertBefore(c,i(w,p),x.elm):(u(Ee,w,p),m[G]=void 0,n.insertBefore(c,Ee.elm,x.elm))),w=d[++y]);y<=I&&(kt=d[I+1]==null?null:d[I+1].elm,s(c,kt,d,y,I,p)),f<=C&&l(c,m,f,C)}function u(c,m,d){let p=m.data?.hook;p?.prePatch?.(c,m);let f=m.elm=c.elm;if(c===m)return;if(m.data!==void 0||P(m.text)&&m.text!==c.text){m.data??={},c.data??={};for(let x=0;x<t.update.length;++x)t.update[x](c,m);m.data?.hook?.update?.(c,m)}let y=c.children,C=m.children;ro(m.text)?P(y)&&P(C)?y!==C&&h(f,y,C,d):P(C)?(P(c.text)&&n.setTextContent(f,""),s(f,null,C,0,C.length-1,d)):P(y)?l(f,y,0,y.length-1):P(c.text)&&n.setTextContent(f,""):c.text!==m.text&&(P(y)&&l(f,y,0,y.length-1),n.setTextContent(f,m.text)),p?.postPatch?.(c,m),p?.ref&&p?.ref(m.elm)}function g(c,m){let d,p,f,y=[];for(d=0;d<t.pre.length;++d)t.pre[d]();if(In(n,c))return i(m,y),n.appendChild(c,m.elm),m;for(de(c,m)?u(c,m,y):(p=c.elm,f=n.parentNode(p),i(m,y),f!==null&&(n.insertBefore(f,m.elm,n.nextSibling(p)),l(f,[c],0,0))),d=0;d<y.length;++d)y[d].data.hook.insert(y[d]);for(d=0;d<t.post.length;++d)t.post[d]();return m}return g}var Nn="http://www.w3.org/1999/xlink",kn="http://www.w3.org/XML/1998/namespace",lo=58,Ln=120;function ao(o,e){let t,n=e.elm,r=o.data.attrs,i=e.data.attrs;if(!(!r&&!i)&&r!==i){r=r||{},i=i||{};for(t in i){let s=i[t];r[t]!==s&&(s===!0?n.setAttribute(t,""):s===!1?n.removeAttribute(t):t.charCodeAt(0)!==Ln?n.setAttribute(t,s):t.charCodeAt(3)===lo?n.setAttributeNS(kn,t,s):t.charCodeAt(5)===lo?n.setAttributeNS(Nn,t,s):n.setAttribute(t,s))}for(t in r)t in i||n.removeAttribute(t)}}var co={create:ao,update:ao};function ho(o,e){let t=e.elm,n=o.data.className,r=e.data.className;n!==r&&(t.className=r||"")}var uo={create:ho,update:ho};var Ue=/[A-Z]/g;function po(o,e){let t=e.elm,n=o.data.dataset,r=e.data.dataset,i;if(!n&&!r||n===r)return;n=n||{},r=r||{};let s=t.dataset;for(i in n)r[i]||(s?i in s&&delete s[i]:t.removeAttribute("data-"+i.replace(Ue,"-$&").toLowerCase()));for(i in r)n[i]!==r[i]&&(s?s[i]=r[i]:t.setAttribute("data-"+i.replace(Ue,"-$&").toLowerCase(),r[i]))}var mo={create:po,update:po};function fo(o,e,t){if(typeof o=="function"){let n=t||{};o.call(e,n,e)}else if(typeof o=="object")for(let n=0;n<o.length;n++)fo(o[n],e,t)}function Mn(o,e){let t=o.type,n=e.data?.on;n&&n[t]&&fo(n[t],e,o)}function An(){return function o(e){Mn(e,o.vNode)}}function dt(o,e){let t=o.data?.on,n=o.listener,r=o.elm,i=e?.data?.on,s=e&&e.elm,a;if(t!==i){if(t&&n)if(i)for(a in t)i[a]||r.removeEventListener(a,n,!1);else for(a in t)r.removeEventListener(a,n,!1);if(i){let l=e.listener=o.listener||An();if(l.vNode=e,t)for(a in i)t[a]||s.addEventListener(a,l,!1);else for(a in i)s.addEventListener(a,l,!1)}}}var go={create:dt,update:dt,destroy:dt};function Co(o,e){let t,n,r,i=e.elm,s=o.data.props,a=e.data.props;if(!(!s&&!a)&&s!==a){s=s||{},a=a||{};for(t in a)n=a[t],r=s[t],r!==n&&(t!=="value"||i[t]!==n)&&(i[t]=n)}}var yo={create:Co,update:Co};var xo=o=>o.replace(Ue,"-$&").toLowerCase();function So(o,e){let t,n=e.elm,r=o.data.style,i=e.data.style;if(!(!r&&!i)&&r!==i){r=r||{},i=i||{};for(t in r)i[t]||(t.slice(0,2)==="--"?n.style.removeProperty(t):n.style[xo(t)]="");for(t in i)if(i[t]!==r[t])if(t.slice(0,2)==="--")n.style.setProperty(t,i[t]);else{let s=xo(t),a=i[t];typeof a=="number"?n.style[s]=a+"px":n.style[s]=a}}}var vo={create:So,update:So};var wo=so([co,uo,mo,go,yo,vo],He);function Eo(o,e){let t=o,n;return t.vDom?n=wo(t.vDom,e):n=wo(t,e),t.vDom=n,n}var bo=new Map;function On(o,e){let t=`${e}__${o.font}`,n=bo.get(t);if(!n){let{actualBoundingBoxDescent:r,actualBoundingBoxAscent:i,width:s}=o.measureText(e),a={width:Math.ceil(s/k()),height:Math.ceil((r+i)/k())};bo.set(t,a),n=a}return n}function M(o,e,t,n,r){o.fillRect(v(e),v(t),v(n),v(r))}function le(o,e,t,n,r){o.strokeRect(v(e),v(t),v(n),v(r))}function To(o,e,t,n,r){o.clearRect(v(e),v(t),v(n),v(r))}function me(o,e,t,n){o.fillText(e,v(t),v(n))}function Fn(o){let e=String(o);return typeof o=="boolean"||["TRUE","FALSE"].includes(e.toUpperCase())?e=e.toUpperCase():o==null&&(e=""),e}function Pe(o,e){let{style:t,value:n,left:r,top:i,width:s,height:a}=e,l=ke(n),h=Te,u=B;if(!O(t)){let f=t?.fontSize?t.fontSize:Y;h=pe(t?.isItalic?"italic":"normal",t?.isBold?"bold":"500",v(f),t?.fontFamily),u=t?.fontColor||B,t?.fillColor&&(o.fillStyle=t?.fillColor,M(o,r,i,s,a))}let g=Fn(n);Ot.has(g)&&(u=Lt);let c={},m=[...g];if(m.length===0)return c;o.textAlign=l?"right":"left",o.font=h,o.fillStyle=u,o.textBaseline="middle";let d=[];for(let f of m)if(f){let y=On(o,f);d.push({...y,char:f})}if(d.length===0)return c;let p=r+(l?s:0);if(t?.underline&&(o.strokeStyle=u),t?.isWrapText){let f=i,y=4;for(let C=0;C<d.length;){let x=s,b=C;for(;C<d.length&&d[C].width<x;)x-=d[C].width,C++;if(b!==C){let I=0,w=[];for(let H=b;H<C;H++)d[H].height>I&&(I=d[H].height),w.push(d[H].char);c.fontSizeHeight=Math.max(c.fontSizeHeight||0,I),f=f+Math.floor(I/2)+y;let D=w.join("");if(me(o,D,p,f),t?.underline){let H=Math.floor(f+I/2),G=[];l?G=[[r,H],[r+s,H]]:G=[[p,H],[p+s,H]],Io(o,G,t?.underline)}f=f+Math.floor(I/2)}}f+=y,c.wrapHeight=f-i}else{let f=Math.max(...d.map(w=>w.height),0);c.fontSizeHeight=f;let y=Math.max(0,Math.floor(a-f)/2),C=Math.floor(i+f/2+y),x=0,b=[],I=s;for(let w=0;w<d.length;w++)d[w].width<I&&(I-=d[w].width,b.push(d[w].char),x+=d[w].width);if(me(o,b.join(""),p,C),t?.underline){let w=Math.floor(C+f/2),D=[];l?D=[[r,w],[r+x,w]]:D=[[p,w],[p+x,w]],Io(o,D,t?.underline)}}return c}function $(o,e){oe(e.length>0),o.beginPath();for(let t=0;t<e.length;t+=2){let n=e[t],r=e[t+1];o.moveTo(v(n[0]),v(n[1])),o.lineTo(v(r[0]),v(r[1]))}o.stroke()}function Ro(o,e,t,n){o.beginPath(),o.moveTo(v(e[0]),v(e[1])),o.lineTo(v(t[0]),v(t[1])),o.lineTo(v(n[0]),v(n[1])),o.fill()}function No(o,e,t,n,r){let i=o.getLineDash();o.setLineDash([v(8),v(6)]);let s=k()/2;le(o,e+s,t+s,n-s*2,r-s*2),o.setLineDash(i)}function Io(o,e,t){let[n,r]=e,i=k(),s=[[n[0],n[1]-i],[r[0],r[1]-i]];if(t===2){let a=i*2;s.push([n[0],n[1]-a],[r[0],r[1]-a])}$(o,s)}function Ve(o,e,t){o.style.width=e+"px",o.style.height=t+"px";let n=v(e),r=v(t);o.width=n,o.height=r}var fe=class{ctx;content;canvas;controller;constructor(e,t){let n=e.getMainDom().canvas;this.canvas=n,this.controller=e,this.ctx=n.getContext("2d"),this.content=t;let r=k();this.ctx.scale(r,r)}resize(){let{width:e,height:t}=this.controller.getDomRect();Ve(this.canvas,e,t),this.content.resize()}clear(){let{width:e,height:t}=this.controller.getDomRect();this.ctx.clearRect(0,0,v(e),v(t))}render=e=>{if(e.changeSet.size===0)return;this.content.render(e),this.clear(),this.ctx.drawImage(this.content.getCanvas(),0,0);let t=this.renderSelection();this.renderAntLine(t)};renderAntLine(e){let{controller:t}=this,n=t.getCopyRanges();if(n.length===0)return;let[r]=n;r.sheetId===t.getCurrentSheetId()&&(this.ctx.strokeStyle=T.primaryColor,this.ctx.lineWidth=k(),No(this.ctx,e.left,e.top,e.width,e.height))}renderSelection(){let{controller:e}=this,t=e.getActiveCell();return zt(t)?this.renderSelectAll():pt(t)?this.renderSelectCol():ut(t)?this.renderSelectRow():this.renderSelectRange()}renderActiveCell(){let{controller:e}=this,t=e.getCell(e.getActiveCell()),n=e.computeCellPosition(t.row,t.col);To(this.ctx,n.left,n.top,n.width,n.height),Pe(this.ctx,{...t,...n})}renderSelectRange(){let{controller:e}=this,t=e.getHeaderSize(),n=e.getActiveCell(),r=e.computeCellPosition(n.row,n.col),i=n.row+n.rowCount-1,s=n.col+n.colCount-1,a=e.computeCellPosition(i,s),l=a.left+a.width-r.left,h=a.top+a.height-r.top;this.ctx.fillStyle=T.selectionColor,M(this.ctx,r.left,0,l,t.height),M(this.ctx,0,r.top,t.width,h);let u=n.rowCount>1||n.colCount>1;u&&M(this.ctx,r.left,r.top,l,h),this.ctx.strokeStyle=T.primaryColor,this.ctx.lineWidth=k();let g=[[r.left,t.height],[r.left+l,t.height]];return g.push([t.width,r.top],[t.width,r.top+h]),$(this.ctx,g),u&&this.renderActiveCell(),le(this.ctx,r.left,r.top,l,h),{left:r.left,top:r.top,width:l,height:h}}renderSelectAll(){let{controller:e}=this,{width:t,height:n}=this.controller.getDomRect();this.ctx.fillStyle=T.selectionColor,M(this.ctx,0,0,t,n);let r=e.getHeaderSize();return this.ctx.strokeStyle=T.primaryColor,this.ctx.lineWidth=k(),this.renderActiveCell(),le(this.ctx,r.width,r.height,t-r.width,n-r.height),{left:r.width,top:r.height,width:t-r.width,height:n-r.height}}renderSelectCol(){let{controller:e}=this,t=e.getHeaderSize(),n=e.getActiveCell(),{height:r}=e.getDomRect();this.ctx.fillStyle=T.selectionColor;let i=e.computeCellPosition(n.row,n.col);M(this.ctx,i.left,0,i.width,t.height),M(this.ctx,0,i.top,t.width,r),M(this.ctx,i.left,i.top+i.height,i.width,r-i.height),this.ctx.strokeStyle=T.primaryColor,this.ctx.lineWidth=k();let s=[[t.width,t.height],[t.width,r-t.height]];return $(this.ctx,s),le(this.ctx,i.left,i.top,i.width,r),{left:i.left,top:i.top,width:i.width,height:r}}renderSelectRow(){let{controller:e}=this,t=e.getHeaderSize(),n=e.getActiveCell(),{width:r}=e.getDomRect();this.ctx.fillStyle=T.selectionColor;let i=e.computeCellPosition(n.row,n.col);M(this.ctx,i.left,0,r,t.height),M(this.ctx,0,i.top,t.width,i.height),M(this.ctx,i.left+i.width,i.top,r-i.width,i.height),this.ctx.strokeStyle=T.primaryColor,this.ctx.lineWidth=k();let s=[[i.left,t.height],[r-t.width,t.height]];return $(this.ctx,s),le(this.ctx,i.left,i.top,r,i.height),{left:i.left,top:i.top,width:r,height:i.height}}};function ze(o,e,t){let n=o.getScroll(),{row:r,col:i}=n;if(n.top!==t){r=0;let s=t;for(;s>0;){let a=o.getRowHeight(r);if(a>s)break;s-=a,r++}}if(n.left!==e){i=0;let s=e;for(;s>0;){let a=o.getColWidth(i);if(a>s)break;s-=a,i++}}return{row:r,col:i}}function ge(o,e,t){let n=o.getHeaderSize(),r=o.getDomRect(),i=o.getViewSize(),s=i.height-r.height+ht,a=i.width-r.width+ht,l=r.height-n.height-ne*1.5,h=r.width-n.width-ne*1.5,u=Math.floor(t*l/s),g=Math.floor(e*h/a);return{maxHeight:s,maxWidth:a,maxScrollHeight:l,maxScrollWidth:h,scrollTop:u,scrollLeft:g}}function ae(o,e,t){let n=o.getScroll(),{maxHeight:r,maxWidth:i,maxScrollHeight:s,maxScrollWidth:a}=ge(o,n.left,n.top),l=n.top+Math.ceil(t);l<0?l=0:l>r&&(l=r);let h=n.left+Math.ceil(e);h<0?h=0:h>i&&(h=i);let{row:u,col:g}=ze(o,h,l),c=Math.floor(l*s/r),m=Math.floor(h*a/i);o.setScroll({row:u,col:g,top:l,left:h,scrollTop:c,scrollLeft:m})}function _e(o){let e=o.getActiveCell(),t=o.computeCellPosition(e.row,e.col),n=o.getDomRect(),r=o.getScroll(),i=o.getSheetInfo(o.getCurrentSheetId()),s=o.getHeaderSize(),a=5,{maxHeight:l,maxWidth:h,maxScrollHeight:u,maxScrollWidth:g}=ge(o,r.left,r.top);if(t.left+t.width+a>n.width&&r.col<=i.colCount-2){let c=r.col+1,m=r.left+o.getColWidth(r.col),d=Math.floor(m*g/h);o.setScroll({...r,col:c,left:m,scrollLeft:d})}if(t.left-s.width<n.left+a&&r.col>=1){let c=r.col-1,m=r.left-o.getColWidth(r.col),d=Math.floor(m*g/h);o.setScroll({...r,col:c,left:m,scrollLeft:d})}if(t.top+t.height+a>n.height&&r.row<=i.rowCount-2){let c=r.row+1,m=r.top+o.getRowHeight(r.row),d=Math.floor(m*u/l);o.setScroll({...r,row:c,top:m,scrollTop:d})}if(t.top-s.height<n.top+a&&r.row>=1){let c=r.row-1,m=r.top-o.getRowHeight(r.row),d=Math.floor(m*u/l);o.setScroll({...r,row:c,top:m,scrollTop:d})}}function W(o){let e=o.getMainDom().input;document.activeElement===e&&(o.setCellValues([[e.value]],[],[o.getActiveCell()]),e.value="",e.blur())}var ko=[{key:"Enter",modifierKey:[],handler:o=>{W(o);let e=o.getActiveCell();o.setActiveCell({row:e.row+1,col:e.col,rowCount:1,colCount:1,sheetId:""})}},{key:"Tab",modifierKey:[],handler:o=>{W(o);let e=o.getActiveCell();o.setActiveCell({row:e.row,col:e.col+1,rowCount:1,colCount:1,sheetId:""})}},{key:"ArrowDown",modifierKey:[j()?"meta":"ctrl"],handler:o=>{W(o);let e=o.getViewSize();ae(o,0,e.height)}},{key:"ArrowUp",modifierKey:[j()?"meta":"ctrl"],handler:o=>{W(o);let e=o.getViewSize();ae(o,0,-e.height)}},{key:"ArrowRight",modifierKey:[j()?"meta":"ctrl"],handler:o=>{W(o);let e=o.getViewSize();ae(o,e.width,0)}},{key:"ArrowLeft",modifierKey:[j()?"meta":"ctrl"],handler:o=>{W(o);let e=o.getViewSize();ae(o,-e.width,0)}},{key:"ArrowDown",modifierKey:[],handler:o=>{W(o);let e=o.getActiveCell();o.setActiveCell({row:e.row+1,col:e.col,rowCount:1,colCount:1,sheetId:""}),_e(o)}},{key:"ArrowUp",modifierKey:[],handler:o=>{W(o);let e=o.getActiveCell();o.setActiveCell({row:e.row-1,col:e.col,rowCount:1,colCount:1,sheetId:""}),_e(o)}},{key:"ArrowRight",modifierKey:[],handler:o=>{W(o);let e=o.getActiveCell();o.setActiveCell({row:e.row,col:e.col+1,rowCount:1,colCount:1,sheetId:""}),_e(o)}},{key:"ArrowLeft",modifierKey:[],handler:o=>{W(o);let e=o.getActiveCell();o.setActiveCell({row:e.row,col:e.col-1,rowCount:1,colCount:1,sheetId:""}),_e(o)}},{key:"b",modifierKey:[j()?"meta":"ctrl"],handler:o=>{let t=o.getCell(o.getActiveCell()).style||{};t.isBold=!t.isBold,o.setCellStyle(t,[o.getActiveCell()])}},{key:"i",modifierKey:[j()?"meta":"ctrl"],handler:o=>{let t=o.getCell(o.getActiveCell()).style||{};t.isItalic=!t.isItalic,o.setCellStyle(t,[o.getActiveCell()])}},{key:"u",modifierKey:[j()?"meta":"ctrl"],handler:o=>{let t=o.getCell(o.getActiveCell()).style||{};t.underline===void 0||t.underline===0?t.underline=1:t.underline=0,o.setCellStyle(t,[o.getActiveCell()])}}];function We(o){let e=(o?.target?.tagName||"").toLowerCase();return e==="input"||e==="textarea"}function mt(o,e,t){function n(l){let h=ko.filter(g=>g.key===l.key);h.sort((g,c)=>c.modifierKey.length-g.modifierKey.length);let u=null;for(let g of h)if(g.modifierKey.length>0){if(g.modifierKey.some(c=>l[`${c}Key`])){u=g;break}}else{u=g;break}if(u){l.preventDefault(),u.handler(e);return}if(l.metaKey||l.ctrlKey){console.log(l.key);return}We(l)||(o.isCellEditing=!0,e.getMainDom().input.focus())}let r=Qt(function(l){l.target===e.getMainDom().canvas&&ae(e,l.deltaX,l.deltaY)});function i(l){We(l)||(l.preventDefault(),e.paste(l))}function s(l){We(l)||(l.preventDefault(),e.copy(l))}function a(l){We(l)||(l.preventDefault(),e.cut(l))}return window.addEventListener("resize",t),window.addEventListener("keydown",n),window.addEventListener("wheel",r),document.body.addEventListener("paste",i),document.body.addEventListener("copy",s),document.body.addEventListener("cut",a),()=>{window.removeEventListener("resize",t),window.removeEventListener("keydown",n),window.removeEventListener("wheel",r),document.body.removeEventListener("paste",i),document.body.removeEventListener("copy",s),document.body.removeEventListener("cut",a)}}var ft={textAlign:"center",textBaseline:"middle",font:Te,fillStyle:T.black,lineWidth:te(),strokeStyle:T.gridStrokeColor};var Ce=class{canvas;ctx;controller;constructor(e,t){this.controller=e,this.canvas=t;let n=this.canvas.getContext("2d");this.ctx=n;let r=k();this.ctx.scale(r,r)}getCanvas(){return this.canvas}resize(){let{width:e,height:t}=this.controller.getDomRect();Ve(this.canvas,e,t)}clear(){let{width:e,height:t}=this.controller.getDomRect();this.ctx.clearRect(0,0,v(e),v(t))}render({changeSet:e}){if(e.size===0||!e.has("content"))return;let{width:t,height:n}=this.controller.getDomRect(),r=this.controller.getHeaderSize();this.clear();let i=t-r.width,s=n-r.height;this.renderGrid(i,s),this.renderRowsHeader(s),this.renderColsHeader(i),this.renderTriangle(),this.renderContent()}renderContent(){let{controller:e,ctx:t}=this,{width:n,height:r}=e.getDomRect(),i=e.getHeaderSize(),s=e.getCurrentSheetId(),{row:a,col:l}=e.getScroll(),h=i.width,u=l,g=i.height,c=a;for(;;){let p=e.getColWidth(u);if(h+p<n)h+=p,u++;else break}for(;;){let p=e.getRowHeight(c);if(g+p<r)g+=p,c++;else break}let m=c,d=u;t.save(),g=i.height;for(let p=a;p<m;p++){h=i.width;for(let f=l;f<d;f++){let y=e.getCell(new L(p,f,1,1,s));if(O(y.value)&&O(y.style)){h+=e.getColWidth(f);continue}let C=e.getCellSize(p,f),{wrapHeight:x=0,fontSizeHeight:b=0}=Pe(t,{...y,...C,top:g,left:h}),I=Math.max(x,b);I>C.height&&e.setRowHeight(p,I),h+=e.getColWidth(f)}g+=e.getRowHeight(p)}t.restore()}renderTriangle(){if(Pt())return;let e=this.controller.getHeaderSize();this.ctx.save(),this.ctx.fillStyle=T.backgroundColor,M(this.ctx,0,0,e.width,e.height),this.ctx.fillStyle=T.triangleFillColor;let t=2;Ro(this.ctx,[e.width/2-t,e.height-t],[e.width-t,e.height-t],[e.width-t,t]),this.ctx.restore()}renderGrid(e,t){let{controller:n}=this,r=n.getHeaderSize(),{row:i,col:s}=n.getScroll(),{rowCount:a,colCount:l}=this.controller.getSheetInfo(this.controller.getCurrentSheetId()),h=te();this.ctx.save(),this.ctx.fillStyle=T.white,this.ctx.lineWidth=h,this.ctx.strokeStyle=T.gridStrokeColor,this.ctx.translate(v(r.width),v(r.height));let u=[],g=0,c=0,m=0;for(let p=s;p<l&&(m+=n.getColWidth(p),!(m>e));p++);let d=Math.min(m,e);for(let p=i;p<a&&(u.push([0,g],[d,g]),g+=n.getRowHeight(p),!(g>t));p++);for(let p=s;p<l&&(u.push([c,0],[c,g]),c+=n.getColWidth(p),!(c>d));p++);u.push([0,g],[c,g]),u.push([c,0],[c,g]),$(this.ctx,u),this.ctx.restore()}fillRowText(e,t,n){this.ctx.fillStyle=T.black,me(this.ctx,String(e),t/2,n)}fillColText(e,t,n){this.ctx.fillStyle=T.black,me(this.ctx,e,t,n/2+k())}renderRowsHeader(e){let{controller:t}=this,{row:n}=t.getScroll(),r=t.getHeaderSize(),{rowCount:i}=t.getSheetInfo(t.getCurrentSheetId());this.ctx.save(),this.ctx.fillStyle=T.backgroundColor,M(this.ctx,0,r.height,r.width,e),Object.assign(this.ctx,ft);let s=[],a=r.height,l=n;for(;l<i;l++){let h=t.getRowHeight(l),u=a;if(l===n&&(u+=te()/2),s.push([0,u],[r.width,u]),this.fillRowText(l+1,r.width,u+h/2),a+=h,a>e)break}s.push([0,a],[r.width,a]),s.push([0,0],[0,a]),$(this.ctx,s),this.ctx.restore()}renderColsHeader(e){let{controller:t}=this,{col:n}=t.getScroll(),r=t.getHeaderSize(),{colCount:i}=t.getSheetInfo(t.getCurrentSheetId()),s=[];this.ctx.save(),this.ctx.fillStyle=T.backgroundColor,M(this.ctx,r.width,0,e,r.height),Object.assign(this.ctx,ft);let a=r.width,l=n;for(;l<i;l++){let h=t.getColWidth(l),u=a;if(l===n&&(u+=te()/2),s.push([u,0],[u,r.height]),this.fillColText(Le(l),u+h/2,r.height),a+=h,a>e)break}s.push([a,0],[a,r.height]),s.push([0,0],[a,0]),$(this.ctx,s),this.ctx.restore()}};var Dn=300;function Lo(o,e,t){let n=o.getScroll(),{maxHeight:r,maxScrollHeight:i,maxScrollWidth:s,maxWidth:a}=ge(o,n.left,n.top),l=n.scrollTop+Math.ceil(t),h=n.scrollLeft+Math.ceil(e);l<0?l=0:l>i&&(l=i),h<0?h=0:h>s&&(h=s);let u=Math.floor(r*l/i),g=Math.floor(a*h/s),{row:c,col:m}=ze(o,g,u);o.setScroll({top:u,left:g,row:c,col:m,scrollLeft:h,scrollTop:l})}var Be=0,$e=0,Q=0,Mo=0,gt=(o,e)=>{let t=e.getHeaderSize(),n=e.getScroll();function r(l){l.stopPropagation(),Q===1?(Be&&Lo(e,0,l.pageY-Be),Be=l.pageY):Q===2&&($e&&Lo(e,l.pageX-$e,0),$e=l.pageX)}function i(){Q=0,Be=0,$e=0,s()}function s(){document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",i)}function a(){document.addEventListener("mousemove",r),document.addEventListener("mouseup",i)}return S("div",{className:"relative canvas-container"},S("canvas",{className:"full canvas-content",hook:{ref(l){let h=l;e.setMainDom({canvas:h})}},oncontextmenu(l){return l.preventDefault(),o.contextMenuPosition={top:l.clientY,left:l.clientX,width:100,height:100},!1},onmousemove(l){let h=e.getHeaderSize(),u=e.getDomRect(),{clientX:g,clientY:c}=l,m=g-u.left,d=c-u.top;if(l.buttons===1&&m>h.width&&d>h.height){let p=De(l,e);if(!p)return;let f=e.getActiveCell();if(f.row===p.row&&f.col===p.col)return;let y=Math.abs(p.col-f.col)+1,C=Math.abs(p.row-f.row)+1;e.setActiveCell({row:Math.min(p.row,f.row),col:Math.min(p.col,f.col),rowCount:C,colCount:y,sheetId:""})}},onmousedown(l){o.contextMenuPosition=void 0;let h=e.getHeaderSize(),u=e.getDomRect(),{timeStamp:g,clientX:c,clientY:m}=l,d=c-u.left,p=m-u.top,f=De(l,e);if(!f)return;if(h.width>d&&h.height>p){e.setActiveCell({row:0,col:0,colCount:0,rowCount:0,sheetId:""});return}if(h.width>d&&h.height<=p){let x=e.getSheetInfo(e.getCurrentSheetId());e.setActiveCell({row:f.row,col:f.col,rowCount:0,colCount:x.colCount,sheetId:""});return}if(h.width<=d&&h.height>p){let x=e.getSheetInfo(e.getCurrentSheetId());e.setActiveCell({row:f.row,col:f.col,rowCount:x.rowCount,colCount:0,sheetId:""});return}let y=e.getActiveCell();if(y.row>=0&&y.row===f.row&&y.col===f.col)g-Mo<Dn&&(o.isCellEditing=!0);else{let x=e.getMainDom().input;if(document.activeElement===x){let I=x.value;e.setCellValues([[I]],[],[e.getActiveCell()]),o.isCellEditing=!1,x.value=""}e.setActiveCell({row:f.row,col:f.col,rowCount:1,colCount:1,sheetId:""})}Mo=g}}),S("div",{className:"vertical-scroll-bar",style:{top:t.height},onmouseleave(){i()},onmousedown(){Q||(Q=1,a())}},S("div",{className:"vertical-scroll-bar-content",style:{height:ne,transform:`translateY(${n.scrollTop}px)`}})),S("div",{className:"horizontal-scroll-bar",style:{left:t.width},onmouseleave(){i()},onmousedown(){Q||(Q=2,a())}},S("div",{className:"horizontal-scroll-bar-content",style:{width:ne,transform:`translateX(${n.scrollLeft}px)`}})))};gt.displayName="CanvasContainer";var Hn=()=>{console.log("add click event")},R=(o,...e)=>{let{className:t="",onClick:n=Hn,disabled:r=!1,active:i=!1,type:s="normal",style:a={},testId:l=void 0,title:h=""}=o;return S("div",{onclick:n,className:V("button-wrapper",t,{disabled:r,active:i,circle:s==="circle"}),style:a,title:h,"data-testId":l},...e)};R.displayName="Button";var Ao={"transform-origin":"130px 106px"},Ct=()=>S("a",{href:"https://github.com/nusr/excel","aria-label":"View source on Github",target:"_blank",rel:"noreferrer",title:"github link"},S("svg",{className:"github-wrapper",viewBox:"0 0 250 250","aria-hidden":!0},S("path",{d:"M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"}),S("path",{d:"M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2",fill:"currentColor",style:Ao}),S("path",{style:Ao,fill:"currentColor",d:"M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"})));Ct.displayName="Github";var Un={alignCenter:["M142.2 227.6h739.6v56.9H142.2zM142.2 568.9h739.6v56.9H142.2zM256 398.2h512v56.9H256zM256 739.6h512v56.9H256z"],alignLeft:["M627.712 788.48c11.305 0 20.48-9.155 20.48-20.48s-9.175-20.48-20.48-20.48H218.46c-11.305 0-20.48 9.155-20.48 20.48s9.175 20.48 20.48 20.48h409.252zM832.86 583.68h-614.4c-11.305 0-20.48 9.155-20.48 20.48s9.175 20.48 20.48 20.48h614.4c11.305 0 20.48-9.155 20.48-20.48s-9.175-20.48-20.48-20.48zM832.86 256h-614.4c-11.305 0-20.48 9.155-20.48 20.48s9.175 20.48 20.48 20.48h614.4c11.305 0 20.48-9.155 20.48-20.48S844.165 256 832.86 256zM218.46 460.8h409.252c11.305 0 20.48-9.155 20.48-20.48s-9.175-20.48-20.48-20.48H218.46c-11.305 0-20.48 9.155-20.48 20.48s9.155 20.48 20.48 20.48z"],alignRight:["M832.86 747.52H423.588a20.48 20.48 0 1 0 0 40.96H832.84a20.48 20.48 0 0 0 0.02-40.96z m20.48-143.36a20.48 20.48 0 0 0-20.48-20.48h-614.4a20.48 20.48 0 1 0 0 40.96h614.4a20.48 20.48 0 0 0 20.48-20.48zM832.86 256h-614.4a20.48 20.48 0 1 0 0 40.96h614.4a20.48 20.48 0 1 0 0-40.96z m0 163.84H423.588a20.48 20.48 0 1 0 0 40.96H832.84a20.48 20.48 0 0 0 0.02-40.96z"],bold:["M724.342857 477.028571c38.4-40 61.942857-94.057143 61.942857-153.485714v-11.657143C786.285714 188.914286 685.6 89.142857 561.485714 89.142857H223.314286c-17.257143 0-31.314286 14.057143-31.314286 31.314286v776.114286c0 18.628571 15.085714 33.714286 33.714286 33.714285h364.228571c133.714286 0 242.057143-107.657143 242.057143-240.571428v-12.571429c0-83.428571-42.742857-156.914286-107.657143-200.114286zM301.714286 198.857143h256.8c65.257143 0 118.057143 50.742857 118.057143 113.485714v10.857143c0 62.628571-52.914286 113.485714-118.057143 113.485714H301.714286V198.857143z m418.971428 490.742857c0 71.885714-59.085714 130.171429-132 130.171429H301.714286V547.085714h286.971428c72.914286 0 132 58.285714 132 130.171429v12.342857z"],fontColor:["M650.496 597.333333H373.504l-68.266667 170.666667H213.333333l256-640h85.333334l256 640h-91.904l-68.266667-170.666667z m-34.133333-85.333333L512 251.093333 407.637333 512h208.725334zM128 853.333333h768v85.333334H128v-85.333334z"],italic:["M219.428571 949.714286l9.714286-48.571429q3.428571-1.142857 46.571429-12.285714t63.714286-21.428571q16-20 23.428571-57.714286 0.571429-4 35.428571-165.142857t65.142857-310.571429 29.714286-169.428571l0-14.285714q-13.714286-7.428571-31.142857-10.571429t-39.714286-4.571429-33.142857-3.142857l10.857143-58.857143q18.857143 1.142857 68.571429 3.714286t85.428571 4 68.857143 1.428571q27.428571 0 56.285714-1.428571t69.142857-4 56.285714-3.714286q-2.857143 22.285714-10.857143 50.857143-17.142857 5.714286-58 16.285714t-62 19.142857q-4.571429 10.857143-8 24.285714t-5.142857 22.857143-4.285714 26-3.714286 24q-15.428571 84.571429-50 239.714286t-44.285714 203.142857q-1.142857 5.142857-7.428571 33.142857t-11.428571 51.428571-9.142857 47.714286-3.428571 32.857143l0.571429 10.285714q9.714286 2.285714 105.714286 17.714286-1.714286 25.142857-9.142857 56.571429-6.285714 0-18.571429 0.857143t-18.571429 0.857143q-16.571429 0-49.714286-5.714286t-49.142857-5.714286q-78.857143-1.142857-117.714286-1.142857-29.142857 0-81.714286 5.142857t-69.142857 6.285714z"],middleAlign:["M740.43392 788.48c11.30496 0 20.48-9.15456 20.48-20.48s-9.17504-20.48-20.48-20.48L331.18208 747.52c-11.30496 0-20.48 9.15456-20.48 20.48s9.17504 20.48 20.48 20.48L740.43392 788.48zM863.49824 604.16c0-11.32544-9.17504-20.48-20.48-20.48l-614.4 0c-11.30496 0-20.48 9.15456-20.48 20.48s9.17504 20.48 20.48 20.48l614.4 0C854.3232 624.64 863.49824 615.48544 863.49824 604.16zM208.13824 276.48c0 11.32544 9.17504 20.48 20.48 20.48l614.4 0c11.30496 0 20.48-9.15456 20.48-20.48s-9.17504-20.48-20.48-20.48l-614.4 0C217.2928 256 208.13824 265.15456 208.13824 276.48zM740.43392 460.8c11.30496 0 20.48-9.15456 20.48-20.48s-9.17504-20.48-20.48-20.48L331.18208 419.84c-11.30496 0-20.48 9.15456-20.48 20.48s9.17504 20.48 20.48 20.48L740.43392 460.8z"],plus:["M896 468.571429H555.428571V100.571429h-86.857142v368H128c-5.028571 0-9.142857 4.114286-9.142857 9.142857v68.571428c0 5.028571 4.114286 9.142857 9.142857 9.142857h340.571429v368h86.857142V555.428571h340.571429c5.028571 0 9.142857-4.114286 9.142857-9.142857v-68.571428c0-5.028571-4.114286-9.142857-9.142857-9.142857z"],redo:["M611.783111 569.344L549.622519 644.740741h284.444444l-65.498074-265.481482-59.922963 72.666074c-35.422815-28.48237-108.278519-68.342519-238.667852-68.342518-202.827852 0-280.651852 206.01363-280.651852 206.013629s116.318815-132.778667 246.215111-132.778666c97.204148-0.037926 153.865481 74.827852 176.241778 112.526222z"],underline:["M512 725.333333c166.4 0 298.666667-132.266667 298.666667-298.666666V128c0-25.6-17.066667-42.666667-42.666667-42.666667s-42.666667 17.066667-42.666667 42.666667v298.666667c0 119.466667-93.866667 213.333333-213.333333 213.333333s-213.333333-93.866667-213.333333-213.333333V128c0-25.6-17.066667-42.666667-42.666667-42.666667s-42.666667 17.066667-42.666667 42.666667v298.666667c0 166.4 132.266667 298.666667 298.666667 298.666666zM853.333333 853.333333H170.666667c-25.6 0-42.666667 17.066667-42.666667 42.666667s17.066667 42.666667 42.666667 42.666667h682.666666c25.6 0 42.666667-17.066667 42.666667-42.666667s-17.066667-42.666667-42.666667-42.666667z"],undo:["M489.244444 568.888889l60.681482 75.851852H265.481481l64.474075-265.481482 60.681481 72.05926c34.133333-30.340741 109.985185-68.266667 238.933333-68.266667 201.007407 0 280.651852 204.8 280.651852 204.8S792.651852 455.111111 663.703704 455.111111c-98.607407 0-155.496296 75.851852-174.45926 113.777778z"]},Oo=Un;var ye=({className:o="",paths:e=[]})=>S("svg",{className:V("base-icon",o),viewBox:"0 0 1137 1024","aria-hidden":!0},...e.map(t=>S("path",t)));ye.displayName="BaseIcon";var Ke=()=>ye({paths:[{d:"M0 0h1024v1024H0z","fill-opacity":".01"},{d:"M496.512 32a128 128 0 0 1 127.84 121.6l0.16 6.4-0.032 113.504 264.256 264.256a32 32 0 0 1-8.16 51.2l-144.064 72.96-269.12 269.12a64 64 0 0 1-90.496 0l-294.144-294.176a64 64 0 0 1 0-90.496l286.016-286.08-0.192-2.048-0.064-2.08V160a128 128 0 0 1 128-128z m-6.464 197.568L128 591.616l294.144 294.144 276.32-276.32 113.792-57.632-187.776-187.776V416a32 32 0 0 1-28.256 31.776l-3.712 0.224a32 32 0 0 1-31.808-28.256L560.512 416l-0.032-115.968-70.432-70.464z m402.016 395.936l1.792 2.24 5.472 8.416c30.112 46.752 45.184 80.032 45.184 99.84a64 64 0 1 1-128 0c0-20.96 16.864-57.024 50.624-108.224a16 16 0 0 1 24.928-2.24zM496.512 96a64 64 0 0 0-63.84 59.2l-0.16 4.8-0.032 36.576 34.944-34.88a32 32 0 0 1 45.248 0l47.808 47.808V160a64 64 0 0 0-59.2-63.84L496.48 96z"}]});Ke.displayName="FillColorIcon";var K=({name:o,className:e=""})=>{let t=Oo[o].map(n=>({d:n}));return ye({className:e,paths:t})};K.displayName="Icon";var xe=o=>{let{data:e,value:t,style:n={},onChange:r,getItemStyle:i=()=>({}),title:s=""}=o;return S("select",{onchange:l=>{let{value:h}=l.target;r(h)},value:t,style:n,name:"select",className:"select-list",title:s},...e.map(l=>{let h=typeof l=="object"?l.value:l,u=typeof l=="object"?l.label:l,g=typeof l=="object"?l.disabled:!1,c=i(h);return S("option",{key:h,value:h,style:c,disabled:!!g,className:V("select-item",{disabled:g})},u)}))};xe.displayName="Select";var Se="No Fill",Pn=["#4D4D4D","#999999","#FFFFFF","#F44E3B","#FE9200","#FCDC00","#DBDF00","#A4DD00","#68CCCA","#73D8FF","#AEA1FF","#FDA1FF","#333333","#808080","#cccccc","#D33115","#E27300","#FCC400","#B0BC00","#68BC00","#16A5A5","#009CE0","#7B64FF","#FA28FF","#000000","#666666","#B3B3B3","#9F0500","#C45100","#FB9E00","#808900","#194D33","#0C797D","#0062B1","#653294","#AB149E",Se],Fo="color-picker-wrapper",Ge=(o,...e)=>{let{color:t,style:n={},onChange:r,key:i}=o,s,a=l=>{let h=Fo;l&&(h=h+" show"),s.className=h};return S("div",{className:"relative color-picker",key:i,style:n},S("div",{className:"color-picker-trigger",style:{color:t},onclick:()=>{a(!0)}},...e),S("div",{className:Fo,hook:{ref:l=>{s=l}},onmouseleave(){a(!1)}},S("div",{className:"color-picker-list"},...Pn.map(l=>S("div",{key:l,className:V("color-picker-item",{"no-fill":l===Se}),style:{backgroundColor:l},onclick:()=>{a(!1),r(l===Se?"":l)}},l===Se?Se:"")))))};Ge.displayName="ColorPicker";var Vn={display:"none"},yt=(o,e)=>{let{contextMenuPosition:t}=o,n=t===void 0?Vn:{top:t.top,left:t.left},r=()=>{o.contextMenuPosition=void 0};return S("div",{className:"context-menu",style:n},R({onClick(){e.addCol(e.getActiveCell().col,1),r()}},"add a column"),R({onClick(){e.deleteCol(e.getActiveCell().col,1),r()}},"delete a column"),R({onClick(){e.addRow(e.getActiveCell().row,1),r()}},"add a row"),R({onClick(){e.deleteRow(e.getActiveCell().row,1),r()}},"delete a row"),R({onClick(){e.copy(),r()}},"copy"),R({onClick(){e.cut(),r()}},"cut"),R({onClick(){e.paste(),r()}},"paste"))};yt.displayName="ContextMenuContainer";function _n(o){let{style:e}=o,t={top:o.top,left:o.left,width:o.width,height:o.height};if(O(e))return t;let n=pe(e?.isItalic?"italic":"normal",e?.isBold?"bold":"500",e?.fontSize||Y,e?.fontFamily);return{...t,backgroundColor:e?.fillColor||"inherit",color:e?.fontColor||B,font:n}}var xt=(o,e)=>{let{activeCell:t,isCellEditing:n}=o,r=t.formula||String(t.value||""),i,s=a=>{i=a,e.setMainDom({input:i})};return S("input",{className:"base-editor",value:r,style:n?_n(t):void 0,hook:{ref:s},onfocus:()=>{n&&(o.isCellEditing=!0)},onkeydown:a=>{n&&(i.nextSibling.textContent=a.currentTarget.value)}})};xt.displayName="FormulaEditor";var St=(o,e)=>{let{activeCell:t}=o;return S("div",{className:"formula-bar-wrapper"},S("div",{className:"formula-bar-name"},`${Le(t.col)}${t.row+1}`),S("div",{className:"formula-bar-editor-wrapper"},xt(o,e),S("div",{className:V("formula-bar-value",{show:o.isCellEditing})},t.formula||String(t.value||""))))};St.displayName="FormulaBarContainer";var zn=[{value:0,label:"none"},{value:1,label:"single underline"},{value:2,label:"double underline"}],vt=(o,e)=>{let t=p=>({"font-family":String(p),"font-size":"16px"}),n=p=>{let y=e.getCell(e.getActiveCell()).style||{};e.setCellStyle(Object.assign(y,p),[e.getActiveCell()])},{activeCell:r,fontFamilyList:i}=o,{style:s={}}=r,{isBold:a=!1,isItalic:l=!1,fontSize:h=Y,fontColor:u=B,fillColor:g="",isWrapText:c=!1,underline:m=0,fontFamily:d=""}=s;return S("div",{className:"toolbar-wrapper"},R({disabled:!e.canUndo(),onClick(){e.undo()},testId:"toolbar-undo"},K({name:"undo"})),R({disabled:!e.canRedo(),onClick(){e.redo()},testId:"toolbar-redo"},K({name:"redo"})),xe({data:i,value:d,style:{width:"140px"},getItemStyle:t,onChange:p=>{String(p)===Oe?window.queryLocalFonts().then(y=>{let C=y.map(x=>x.fullName);C=Array.from(new Set(C)),localStorage.setItem(Fe,JSON.stringify(C)),o.fontFamilyList=C.map(x=>({label:x,value:x,disabled:!1}))}):n({fontFamily:String(p)})}}),xe({data:Mt,value:h,onChange:p=>{n({fontSize:Number(p)})}}),R({active:a,onClick:()=>{n({isBold:!a})},testId:"toolbar-bold",title:"Bold"},K({name:"bold"})),R({active:l,onClick:()=>{n({isItalic:!l})},testId:"toolbar-italic",title:"Italic"},K({name:"italic"})),xe({data:zn,value:m,style:{width:"130px"},title:"Underline",onChange:p=>{n({underline:Number(p)})}}),Ge({key:"fill-color",color:g,onChange:p=>{n({fillColor:p})}},Ke({})),Ge({color:u,onChange:p=>{n({fontColor:p})},key:"font-color"},K({name:"fontColor"})),R({onClick:()=>{n({isWrapText:!c})},active:c,testId:"toolbar-wrap-text"},"Wrap Text"),Ct({}))};vt.displayName="ToolbarContainer";var wt=(o,e)=>S("div",{className:"sheet-bar-wrapper"},S("div",{className:"sheet-bar-list"},...o.sheetList.map(t=>S("div",{key:t.value,className:V("sheet-bar-item",{active:o.currentSheetId===t.value}),onclick:()=>{e.setCurrentSheetId(String(t.value))}},t.label))),S("div",{className:"sheet-bar-add"},R({onClick:()=>{e.addSheet()},type:"circle",style:{backgroundColor:T.buttonActiveColor}},K({name:"plus"}))));wt.displayName="SheetBarContainer";var Et=(o,e)=>S("div",{className:"app-container"},vt(o,e),St(o,e),gt(o,e),wt(o,e),yt(o,e));Et.displayName="App";var bt=19,It=34,Wn={top:0,left:0,row:0,col:0,scrollLeft:0,scrollTop:0},ve=class{scrollValue={};model;changeSet=new Set;copyRanges=[];cutRanges=[];hooks={modelChange(){},async cut(){return""},async copy(){return""},async paste(){return{[z]:"",[A]:""}}};viewSize={width:0,height:0};headerSize={width:It,height:bt};mainDom={};constructor(e){this.model=e}getCurrentSheetId(){return this.model.getCurrentSheetId()}getSheetList(){return this.model.getSheetList()}getSheetInfo(e){return this.model.getSheetInfo(e)}setHooks(e){this.hooks=e}emitChange(){Ae("emitChange",this.changeSet),this.hooks.modelChange(this.changeSet),this.changeSet=new Set,this.model.record()}getActiveCell(){let e=this.model.getCurrentSheetId(),{activeCell:t}=this.getSheetInfo(e);return{...t,sheetId:t.sheetId||e}}setSheetCell(e){let t=e.sheetId||this.model.getCurrentSheetId();e.sheetId=t,this.model.setActiveCell(e)}setActiveCell(e){this.setSheetCell(e),this.changeSet.add("selection"),this.emitChange()}setCurrentSheetId(e){if(e===this.getCurrentSheetId())return;this.model.setCurrentSheetId(e);let t=this.getActiveCell();this.setSheetCell(t),this.computeViewSize(),this.setScroll(this.getScroll())}addSheet(){this.model.addSheet(),this.setSheetCell({row:0,col:0,rowCount:1,colCount:1,sheetId:""}),this.computeViewSize(),this.setScroll({top:0,left:0,row:0,col:0,scrollLeft:0,scrollTop:0})}fromJSON(e){Ae("loadJSON",e),this.model.fromJSON(e);let t=this.getActiveCell();this.setSheetCell(t),this.computeViewSize(),this.changeSet.add("content"),this.emitChange()}toJSON(){return this.model.toJSON()}setCellValues(e,t,n){Ae("setCellValue",e),this.model.setCellValues(e,t,n),this.changeSet.add("content"),this.emitChange()}setCellStyle(e,t){O(e)||(this.model.setCellStyle(e,t),this.changeSet.add("content"),this.emitChange())}getCell=e=>this.model.getCell(e);canRedo(){return this.model.canRedo()}canUndo(){return this.model.canUndo()}undo(){this.model.undo(),this.changeSet.add("content"),this.emitChange()}redo(){this.model.redo(),this.changeSet.add("content"),this.emitChange()}getColWidth(e){return this.model.getColWidth(e)}setColWidth(e,t){this.model.setColWidth(e,t),this.computeViewSize(),this.changeSet.add("content")}getRowHeight(e){return this.model.getRowHeight(e)}setRowHeight(e,t){this.model.setRowHeight(e,t),this.computeViewSize(),this.changeSet.add("content")}computeViewSize(){let e=this.getHeaderSize(),t=this.model.getSheetInfo(this.model.getCurrentSheetId()),n=e.width,r=e.height;for(let i=0;i<t.colCount;i++)n+=this.getColWidth(i);for(let i=0;i<t.rowCount;i++)r+=this.getRowHeight(i);this.viewSize={width:n,height:r}}getViewSize(){return{...this.viewSize}}getCellSize(e,t){return{width:this.getColWidth(t),height:this.getRowHeight(e)}}getHeaderSize(){return{...this.headerSize}}computeCellPosition(e,t){let n=this.getHeaderSize(),r=this.getScroll(),i=n.width,s=n.height,a=r.row,l=r.col;for(;l<t;)i+=this.getColWidth(l),l++;for(;a<e;)s+=this.getRowHeight(a),a++;return{...this.getCellSize(e,t),top:s,left:i}}addRow(e,t){this.model.addRow(e,t),this.changeSet.add("content"),this.emitChange()}addCol(e,t){this.model.addCol(e,t),this.changeSet.add("content"),this.emitChange()}deleteCol(e,t){this.model.deleteCol(e,t),this.changeSet.add("content"),this.emitChange()}deleteRow(e,t){this.model.deleteRow(e,t),this.changeSet.add("content"),this.emitChange()}getChangeSet(){let e=this.changeSet;return this.changeSet=new Set,e}getScroll(){let e=this.model.getCurrentSheetId();return this.scrollValue[e]||Wn}setScroll(e){let t=this.model.getCurrentSheetId();this.scrollValue[t]={...e},e.row>9999?this.headerSize={width:Math.floor(It*2),height:bt}:this.headerSize={width:It,height:bt},this.changeSet.add("content"),this.emitChange()}parseText(e){let t;if(e.indexOf(`\r
`)>-1?t=e.split(`\r
`).map(a=>a).map(a=>a.split("	")):t=e.split(`
`).map(a=>a).map(a=>a.split("	")),t[0].length!==t[t.length-1].length){let a=t[t.length-1];a.length===1&&!a[0]&&t.pop()}let n=t.length,r=0;for(let a of t)a.length>r&&(r=a.length);if(t.length===0)return;let s={...this.getActiveCell(),rowCount:n,colCount:r};this.model.setCellValues(t,[],[s]),this.changeSet.add("content"),this.setActiveCell(s)}parseHTML(e){let t=new DOMParser,n=e.replace(`<style>\r
<!--table`,"<style>").replace(`-->\r
</style>`,"</style>"),r=t.parseFromString(n,"text/html"),i=r.querySelectorAll("tr"),s=r.querySelectorAll("style"),a=[],l=[],h=i.length,u=0;for(let m of i){let d=m.querySelectorAll("td"),p=[],f=[];for(let y of d){let C={};y.className?C=at(s,"."+y.className):C=at(s,y.tagName.toLowerCase()),f.push(C),p.push(y.textContent||"")}a.push(p),l.push(f),p.length>u&&(u=p.length)}if(a.length===0)return;let c={...this.getActiveCell(),rowCount:h,colCount:u};this.model.setCellValues(a,l,[c]),this.changeSet.add("content"),this.setActiveCell(c)}async paste(e){if(this.copyRanges=[],this.cutRanges.length>0){let[r]=this.cutRanges,i=[];for(let s=0;s<r.rowCount;s++)i.push(new Array(r.colCount).fill(""));this.model.setCellValues(i,[],this.cutRanges)}let t="",n="";if(e)t=e.clipboardData?.getData(z)||"",n=e.clipboardData?.getData(A)||"";else{let r=await this.hooks.paste();t=r[z],n=r[A]}t?this.parseHTML(t):this.parseText(n),this.cutRanges.length&&(this.cutRanges=[],this.hooks.copy({[A]:"",[z]:""}))}getCopyData(){let{row:e,col:t,rowCount:n,colCount:r}=this.getActiveCell(),i=[],s=[],a=1,l=[],h=this.model.getCurrentSheetId();for(let c=e,m=e+n;c<m;c++){let d=[],p=[];for(let f=t,y=t+r;f<y;f++){let C=this.model.getCell(new L(c,f,1,1,h)),x=String(C.value||"");if(d.push(x),C.style){let b=At(C.style);x||(b+="mso-pattern:black none;");let I=`xl${a++}`;l.push(`.${I}{${b}}`),p.push(`<td class="${I}"> ${x} </td>`)}else p.push(`<td> ${x} </td>`)}i.push(d),s.push(p)}let u=Zt(l.join(`
`),s.map(c=>`<tr>${c.join(`
`)}</tr>`).join(`
`)),g=i.map(c=>c.join("	")).join(`\r
`)+`\r
`;return{[A]:g,[z]:u}}copy(e){this.copyRanges=[this.getActiveCell()];let t=this.getCopyData();if(e){let n=Object.keys(t);for(let r of n)e.clipboardData?.setData(r,t[r])}else this.hooks.copy(t);this.changeSet.add("selection"),this.emitChange()}cut(e){this.cutRanges=[this.getActiveCell()],this.copy(e)}getCopyRanges(){return this.copyRanges.slice()}getDomRect(){let e=this.getMainDom().canvas;if(!e)return{top:0,left:0,width:0,height:0};let t=e.parentElement.getBoundingClientRect();return{top:t.top,left:t.left,width:t.width,height:t.height}}setMainDom(e){this.mainDom=Object.assign(this.mainDom,e)}getMainDom(){return this.mainDom}};var F=class{type;value;constructor(e,t){this.type=e,this.value=t}error(){return`type:${this.type},value:${this.value}`}};var E=class extends Error{value;constructor(e){super(e),this.value=e}},fa=new E("#VALUE!"),ga=new E("#NUM!");function U(o,e="#VALUE!"){if(!o)throw new E(e)}function je(o){U(o.length===1);let[e]=o;return e}function ce(o){let e=je(o);return U(typeof e=="string"),e}function N(o){let e=je(o);return U(typeof e=="number"&&!isNaN(e)),e}function Tt(o){U(o.length===0)}var Bn=(...o)=>{let e=je(o);return typeof e=="string"?e:""},$n=(...o)=>ce(o).toLowerCase(),Do=(...o)=>{let e=N(o);return String.fromCharCode(e)},Ho=(...o)=>ce(o).charCodeAt(0),Kn=(...o)=>ce(o).length,Gn=(...o)=>{U(o.length===2);let[e,t]=o;return U(typeof e=="string"),U(typeof t=="string"),e.split(t)},jn=(...o)=>ce(o).toUpperCase(),Yn=(...o)=>ce(o).replace(/ +/g," ").trim(),Uo=(...o)=>(U(o.length<=Ne),o.join("")),Jn={CONCAT:Uo,CONCATENATE:Uo,SPLIT:Gn,CHAR:Do,CODE:Ho,UNICHAR:Do,UNICODE:Ho,LEN:Kn,LOWER:$n,UPPER:jn,TRIM:Yn,T:Bn},Po=Jn;var Xn=(...o)=>{let e=N(o);return Math.abs(e)},qn=(...o)=>{let e=N(o);return Math.acos(e)},Zn=(...o)=>{let e=N(o);return Math.log(e+Math.sqrt(e*e-1))},Qn=(...o)=>{let e=N(o);return Math.atan(1/e)},er=(...o)=>{let e=N(o);return .5*Math.log((e+1)/(e-1))},tr=(...o)=>{let e=N(o);return Math.asin(e)},or=(...o)=>{let e=N(o);return Math.log(e+Math.sqrt(e*e+1))},nr=(...o)=>{let e=N(o);return Math.atan(e)},rr=(...o)=>{U(o.length===2);let[e,t]=o;return U(typeof e=="number"),U(typeof t=="number"),Math.atan2(e,t)},ir=(...o)=>{let e=N(o);return Math.log((1+e)/(e+1))/2},sr=(...o)=>{let e=N(o);return Math.cos(e)},lr=(...o)=>{let e=N(o);return 1/Math.tan(e)};var ar=(...o)=>{let e=N(o);return Math.exp(e)},cr=(...o)=>{let e=N(o);return Math.floor(e)};var hr=(...o)=>(Tt(o),Math.PI),ur=(...o)=>(Tt(o),Math.E),pr=(...o)=>{let e=N(o);return Math.sin(e)},dr=(...o)=>{let e=Ht(o);return U(e.length<=Ne),e.reduce((t,n)=>t+n,0)},mr={ABS:Xn,ACOS:qn,ACOSH:Zn,ACOT:Qn,ACOTH:er,ASIN:tr,ASINH:or,ATAN:nr,ATAN2:rr,ATANH:ir,COT:lr,COS:sr,EXP:ar,INT:cr,PI:hr,E:ur,SIN:pr,SUM:dr},Vo=mr;var fr={...Po,...Vo},_o=fr;var zo="",gr=new Map([["TRUE",19],["FALSE",20]]),Ye=class{list;current=0;start=0;tokens=[];constructor(e){this.list=[...e]}scan(){for(;!this.isAtEnd();)this.start=this.current,this.scanToken();return this.tokens.push(new F(27,"")),this.tokens.length>0&&this.tokens[0].type===0&&this.tokens.shift(),this.tokens}peek(){return this.isAtEnd()?zo:this.list[this.current]}match(e){return this.peek()!==e?!1:(this.next(),!0)}next(){return this.isAtEnd()?zo:this.list[this.current++]}isAtEnd(){return this.current>=this.list.length}addToken(e){let t=this.list.slice(this.start,this.current).join("");this.tokens.push(new F(e,t))}string(e){for(;!this.isAtEnd()&&this.peek()!==e;)this.next();if(this.peek()!==e)throw new E("#VALUE!");this.next();let t=this.list.slice(this.start+1,this.current-1).join("");this.tokens.push(new F(17,t))}number(){for(;!this.isAtEnd()&&this.isDigit(this.peek());)this.next();if(this.match("."))for(;!this.isAtEnd()&&this.isDigit(this.peek());)this.next();this.addToken(18)}isDigit(e){return e>="0"&&e<="9"}identifier(){for(;!this.isAtEnd()&&this.anyChar(this.peek());)this.next();let e=this.list.slice(this.start,this.current).join(""),t=gr.get(e.toUpperCase()),n=16;t&&(e=e.toUpperCase(),n=t),this.tokens.push(new F(n,e))}scanToken(){let e=this.next();switch(e){case"(":this.addToken(21);break;case")":this.addToken(22);break;case",":this.addToken(11);break;case":":this.addToken(10);break;case"=":this.addToken(0);break;case"<":this.match(">")?this.addToken(1):this.match("=")?this.addToken(15):this.addToken(14);break;case">":this.match("=")?this.addToken(8):this.addToken(7);break;case"+":this.addToken(2);break;case"-":this.addToken(3);break;case"*":this.addToken(4);break;case"/":this.addToken(5);break;case"^":this.addToken(6);break;case"&":this.addToken(9);break;case"%":this.addToken(13);break;case'"':this.string(e);break;case"!":this.addToken(26);break;case";":this.addToken(25);break;case"{":this.addToken(23);break;case"}":this.addToken(24);break;case" ":break;case"\r":case"	":case`
`:break;default:if(this.isDigit(e))this.number();else if(this.anyChar(e))this.identifier();else throw new E("#ERROR!");break}}anyChar(e){return!'(),:=<>+-*/^&%"{}!'.includes(e)&&!this.isWhiteSpace(e)}isWhiteSpace(e){return e===" "||e==="\r"||e===`
`||e==="	"}};var X=class{left;right;operator;constructor(e,t,n){this.left=e,this.operator=t,this.right=n}accept(e){return e.visitBinaryExpression(this)}toString(){return""}},Je=class{right;operator;constructor(e,t){this.operator=e,this.right=t}accept(e){return e.visitUnaryExpression(this)}toString(){return""}},Xe=class{left;operator;constructor(e,t){this.operator=e,this.left=t}accept(e){return e.visitPostUnaryExpression(this)}toString(){return""}},he=class{value;constructor(e){this.value=e}accept(e){return e.visitLiteralExpression(this)}toString(){return""}},_=class{value;sheetName;type;constructor(e,t,n){this.value=e,this.sheetName=n,this.type=t}accept(e){return e.visitCellExpression(this)}toString(){return""}},qe=class{name;params;constructor(e,t){this.name=e,this.params=t}accept(e){return e.visitCallExpression(this)}toString(){return""}},Ze=class{value;constructor(e){this.value=e}accept(e){return e.visitErrorExpression(this)}toString(){return""}},Qe=class{left;right;operator;constructor(e,t,n){this.left=e,this.operator=t,this.right=n}accept(e){return e.visitCellRangeExpression(this)}toString(){return""}},et=class{value;constructor(e){this.value=e}accept(e){return e.visitGroupExpression(this)}toString(){return""}},ee=class{value;constructor(e){this.value=e}accept(e){return e.visitDefineNameExpression(this)}toString(){return""}};var Cr=new Set(["#ERROR!","#DIV/0!","#NULL!","#NUM!","#REF!","#VALUE!","#N/A","#NAME?"]),tt=class{tokens;current=0;constructor(e){this.tokens=e}parse(){let e=[];for(;!this.isAtEnd();)e.push(this.expression());return e}expression(){return this.comparison()}comparison(){let e=this.concatenate();for(;this.match(0,1,7,8,14,15);){let t=this.previous(),n=this.concatenate();e=new X(e,t,n)}return e}concatenate(){let e=this.term();for(;this.match(9);){let t=this.previous(),n=this.term();e=new X(e,t,n)}return e}term(){let e=this.factor();for(;this.match(2,3);){let t=this.previous(),n=this.factor();e=new X(e,t,n)}return e}factor(){let e=this.expo();for(;this.match(5,4);){let t=this.previous(),n=this.expo();e=new X(e,t,n)}return e}expo(){let e=this.unary();for(;this.match(6);){let t=this.previous(),n=this.unary();e=new X(e,t,n)}return e}unary(){if(this.match(2,3)){let e=this.previous(),t=this.unary();return new Je(e,t)}return this.postUnary()}postUnary(){let e=this.spread();if(this.match(13)){let t=this.previous();e=new Xe(t,e)}return e}spread(){let e=this.call();for(;this.match(10);){let t=this.previous(),n=this.call();e=new Qe(e,t,n)}return e}call(){let e=this.primary();if(this.match(21))if(e instanceof ee)e=this.finishCall(e.value);else throw new E("#NAME?");return e}finishCall(e){let t=[];if(!this.check(22))do t.push(this.expression());while(this.match(11));this.expect(22);let n=e;return e.value[0]==="@"&&(n=new F(16,e.value.slice(1))),new qe(n,t)}primary(){if(this.match(18,17,19,20))return new he(this.previous());if(this.match(16)){let e=this.previous(),{value:t,type:n}=e,r=t.toUpperCase();if(Cr.has(r))return new Ze(new F(n,r));if(this.match(26)){let s=this.expression();if(s instanceof _)return new _(s.value,s.type,e);throw new E("#REF!")}if(/^[a-z]+$/i.test(t))return new ee(e);let i=new F(n,r);if(/^\$[A-Z]+\$\d+$/.test(r)||/^\$[A-Z]+$/.test(r)||/^\$\d+$/.test(r))return new _(i,"absolute",null);if(/^\$[A-Z]+\d+$/.test(r)||/^[A-Z]+\$\d+$/.test(r))return new _(i,"mixed",null);if(/^[A-Z]+\d+$/.test(r)||/^[A-Z]+$/.test(r))return new _(i,"relative",null)}if(this.match(21)){let e=this.expression();return this.expect(22),new et(e)}throw new E("#ERROR!")}match(...e){let t=this.peek().type;return e.includes(t)?(this.next(),!0):!1}previous(){return this.tokens[this.current-1]}check(e){return this.peek().type===e}expect(e){if(this.check(e))return this.next(),this.previous();throw new E("#ERROR!")}next(){this.current++}isAtEnd(){return this.peek().type===27}peek(){return this.current<this.tokens.length?this.tokens[this.current]:new F(27,"")}};var ot=class{expressions;functionMap;cellDataMap;variableMap;constructor(e,t,n,r){this.expressions=e,this.functionMap=r,this.cellDataMap=t,this.variableMap=n}interpret(){let e=[];for(let t of this.expressions)e.push(this.evaluate(t));if(e.length===1)return this.getRangeCellValue(e[0]);throw new E("#ERROR!")}getRangeCellValue(e){if(e instanceof L){if(e.colCount===e.rowCount&&e.colCount===1)return this.cellDataMap.get(e.row,e.col,e.sheetId);throw new E("#REF!")}return e}checkNumber(e){if(typeof e!="number")throw new E("#VALUE!")}visitBinaryExpression(e){let t=this.evaluate(e.left),n=this.evaluate(e.right);switch(t=this.getRangeCellValue(t),n=this.getRangeCellValue(n),e.operator.type){case 3:return this.checkNumber(t),this.checkNumber(n),t-n;case 2:return this.checkNumber(t),this.checkNumber(n),t+n;case 5:if(this.checkNumber(t),this.checkNumber(n),n===0)throw new E("#DIV/0!");return t/n;case 4:return this.checkNumber(t),this.checkNumber(n),t*n;case 6:return this.checkNumber(t),this.checkNumber(n),Math.pow(t,n);case 0:return t===n;case 1:return t!==n;case 7:return t>n;case 8:return t>=n;case 14:return t<n;case 15:return t<=n;case 9:return`${t}${n}`;default:throw new E("#VALUE!")}}visitCallExpression(e){let t=e.name.value.toUpperCase(),n=this.functionMap[t];if(n&&typeof n=="function"){let r=[];for(let i of e.params){let s=this.evaluate(i);if(s instanceof L){let{row:a,col:l,rowCount:h,colCount:u,sheetId:g}=s;for(let c=a,m=a+h;c<m;c++)for(let d=l,p=l+u;d<p;d++)r.push(this.cellDataMap.get(c,d,g))}else r.push(s)}return n(...r)}throw new E("#NAME?")}visitCellExpression(e){let t="";e.sheetName&&(t=this.cellDataMap.convertSheetNameToSheetId(e.sheetName.value));let n=Bt(e.value.value);if(n===null)throw new E("#REF!");return t&&(n.sheetId=t),n}visitErrorExpression(e){throw new E(e.value.value)}visitLiteralExpression(e){let{type:t,value:n}=e.value;switch(t){case 17:return n;case 18:return parseFloat(n);case 19:return!0;case 20:return!1;default:throw new E("#ERROR!")}}visitDefineNameExpression(e){if(!this.variableMap.has(e.value.value))throw new E("#NAME?");return this.variableMap.get(e.value.value)}visitUnaryExpression(e){let t=this.evaluate(e.right);switch(e.operator.type){case 3:return-t;case 2:return t;default:throw new E("#VALUE!")}}convertToCellExpression(e){return e instanceof _?e:e instanceof ee?new _(new F(16,e.value.value.toUpperCase()),"relative",null):e instanceof he&&e.value.type===18&&/^\d+$/.test(e.value.value)?new _(new F(16,e.value.value),"relative",null):null}visitCellRangeExpression(e){switch(e.operator.type){case 10:{let t=this.convertToCellExpression(e.left),n=this.convertToCellExpression(e.right);if(t!==null&&n!==null){let r=this.visitCellExpression(t),i=this.visitCellExpression(n),s=$t(r,i);if(s===null)throw new E("#VALUE!");return s}else throw new E("#REF!");break}default:throw new E("#REF!")}}visitGroupExpression(e){return this.evaluate(e.value)}visitPostUnaryExpression(e){let t=this.evaluate(e.left);switch(e.operator.type){case 13:return this.checkNumber(t),t*.01;default:throw new E("#VALUE!")}}evaluate(e){return e.accept(this)}};function Rt(o,e=new nt,t=new rt,n=_o){try{let r=new Ye(o).scan(),i=new tt(r).parse();return{result:new ot(i,e,t,n).interpret(),error:null}}catch(r){if(r instanceof E)return{result:null,error:r.value}}return{result:null,error:"#ERROR!"}}var nt=class{map=new Map;sheetNameMap={};getKey(e,t,n=""){return`${e}_${t}_${n}`}setSheetNameMap(e){this.sheetNameMap=e}set(e,t,n,r){let i=this.getKey(e,t,n);this.map.set(i,r)}get(e,t,n=""){let r=this.getKey(e,t,n);return this.map.get(r)}convertSheetNameToSheetId(e){return e&&this.sheetNameMap[e]||""}},rt=class{map=new Map;set(e,t){this.map.set(e,t)}get(e){return this.map.get(e)}has(e){return this.map.has(e)}};var Bo=19,$o=68,yr=16384,xr=1048576;function it(o){let e=o.map(t=>parseInt(t,10)).filter(t=>!isNaN(t));return e.sort((t,n)=>t-n),e}var st=class{currentSheetId="";workbook=[];worksheets={};mergeCells=[];customHeight={};customWidth={};history;constructor(e){this.history=e}getSheetList(){return this.workbook}setActiveCell(e){let t=this.workbook.findIndex(l=>l.sheetId===e.sheetId);if(t<0)return;let{row:n,col:r}=e,i=this.workbook[t];if(n<0||r<0||n>=i.rowCount||r>=i.colCount)return;let s=i.activeCell;if(Wt(s,e))return;let a=`workbook.${t}.activeCell`;this.history.pushRedo("set",a,{...s}),se(this,a,{...e})}addSheet(){let e=Ut(this.workbook),t={...e,colCount:Z,rowCount:q,activeCell:{row:0,col:0,rowCount:1,colCount:1,sheetId:e.sheetId}};this.workbook=[...this.workbook,t],this.currentSheetId=e.sheetId}getSheetInfo(e=this.currentSheetId){let t=this.workbook.find(n=>n.sheetId===e);return oe(t!==void 0),t}setCurrentSheetId(e){this.currentSheetId=e,this.computeAllCell()}getCurrentSheetId(){return this.currentSheetId}fromJSON=e=>{Kt("fromJSON",e);let{worksheets:t={},workbook:n=[],mergeCells:r=[],customHeight:i={},customWidth:s={}}=e;this.worksheets=t,this.workbook=n,this.currentSheetId=n[0].sheetId||this.currentSheetId,this.mergeCells=r,this.customWidth=s,this.customHeight=i,this.computeAllCell(),this.history.clear()};toJSON=()=>{let{worksheets:e,workbook:t,mergeCells:n,customHeight:r,customWidth:i}=this;return{workbook:t,worksheets:e,mergeCells:n,customHeight:r,customWidth:i}};setCellValue(e,t){let{row:n,col:r}=t,i=`worksheets[${this.currentSheetId}][${n}][${r}].value`;this.history.pushRedo("set",i,ie(this,i,void 0)),se(this,i,e)}setCellFormula(e,t){let{row:n,col:r}=t,i=`worksheets[${this.currentSheetId}][${n}][${r}].formula`;this.history.pushRedo("set",i,ie(this,i,void 0)),se(this,i,e)}setCellValues(e,t,n){let[r]=n,{row:i,col:s}=r;for(let a=0;a<e.length;a++)for(let l=0;l<e[a].length;l++){let h=e[a][l],u={row:i+a,col:s+l};t[a]&&t[a][l]&&this.setStyle(t[a][l],u),h.startsWith("=")?this.setCellFormula(h,u):(this.setCellFormula("",u),this.setCellValue(h,u))}this.computeAllCell()}setStyle(e,t){let n=`worksheets[${this.currentSheetId}][${t.row}][${t.col}].style`;this.history.pushRedo("set",n,ie(this,n,{})),se(this,n,e)}setCellStyle(e,t){let[n]=t,{row:r,col:i,rowCount:s,colCount:a}=n;for(let l=r,h=r+s;l<h;l++)for(let u=i,g=i+a;u<g;u++)this.setStyle(e,{row:l,col:u})}getCell=e=>{let{row:t,col:n,sheetId:r}=e,i=r||this.currentSheetId;return{...ie(this,`worksheets[${i}][${t}][${n}]`,{}),row:t,col:n}};computeAllCell(){let e=this.worksheets[this.currentSheetId];if(O(e))return[];let t=Object.keys(e);for(let n of t){let r=Object.keys(e[n]);for(let i of r){let s=e[n][i];s?.formula&&(s.value=this.parseFormula(s.formula))}}}parseFormula(e){let t=Rt(e,{get:(n,r,i)=>this.getCell(new L(n,r,1,1,i)).value,set:()=>{},convertSheetNameToSheetId:n=>this.workbook.find(i=>i.name===n)?.sheetId||""});return t.error?t.error:t.result}addRow(e,t){let n=this.worksheets[this.currentSheetId];if(O(n))return;let r=it(Object.keys(n));for(let s=r.length-1;s>=0;s--){let a=r[s];if(a<e)continue;let l=String(a+t);n[l]={...n[a]},n[a]={}}let i=this.getSheetInfo();i.rowCount>=xr||(i.rowCount+=t)}addCol(e,t){let n=this.worksheets[this.currentSheetId];if(O(n))return;let r=this.getSheetInfo(),i=Object.keys(n);for(let s of i){let a=it(Object.keys(n[s]));for(let l=a.length-1;l>=0;l--){let h=a[l];if(h<e)continue;let u=String(h+t);n[s][u]={...n[s][h]},n[s][h]={}}}r.colCount>=yr||(r.colCount+=t)}deleteCol(e,t){let n=this.worksheets[this.currentSheetId];if(O(n))return;let r=this.getSheetInfo(),i=Object.keys(n);for(let s of i){let a=it(Object.keys(n[s]));for(let l=0;l<a.length;l++){let h=a[l];if(h<e)continue;let u=String(h-t);n[s][u]={...n[s][h]},n[s][h]={}}}r.colCount-=t}deleteRow(e,t){let n=this.worksheets[this.currentSheetId];if(O(n))return;let r=it(Object.keys(n));for(let s=0;s<r.length;s++){let a=r[s];if(a<e)continue;let l=String(a-t);n[l]={...n[a]},n[a]={}}let i=this.getSheetInfo();i.rowCount-=t}getColWidth(e){let t=this.customWidth[this.currentSheetId];return t&&typeof t[e]=="number"?t[e]:$o}setColWidth(e,t){this.customWidth[this.currentSheetId]=this.customWidth[this.currentSheetId]||{},this.customWidth[this.currentSheetId][e]=t}getRowHeight(e){let t=this.customHeight[this.currentSheetId];return t&&typeof t[e]=="number"?t[e]:Bo}setRowHeight(e,t){this.customHeight[this.currentSheetId]=this.customHeight[this.currentSheetId]||{},this.customHeight[this.currentSheetId][e]=t}canRedo(){return this.history.canRedo()}canUndo(){return this.history.canUndo()}undo(){this.canUndo()&&this.executeOperate(this.history.undo())}redo(){this.canRedo()&&this.executeOperate(this.history.redo())}record(){this.history.onChange()}executeOperate(e){for(let t of e){let{op:n,path:r,value:i}=t;switch(n){case"set":{this.history.pushUndo(n,r,ie(this,r,void 0)),this.record(),se(this,r,i);break}default:console.error(`not support type: ${n}`);break}}}};var Nt={workbook:[{sheetId:"1",name:"Sheet1",activeCell:{row:2,col:2,rowCount:1,colCount:1,sheetId:""},colCount:Z,rowCount:q},{sheetId:"2",name:"test",colCount:Z,rowCount:q,activeCell:{row:4,col:4,rowCount:2,colCount:2,sheetId:""}}],worksheets:{1:{0:{0:{value:"",formula:"=SUM(1, SUM(1,2))",style:{fontColor:"#ff0000"}},1:{value:"",formula:"=SUM(1,4)"},2:{value:"",formula:"=SUM(A1)"},3:{value:"\u8D85\u5927\u5B57",style:{fontSize:36}},4:{value:"\u8FD9\u662F\u4E00\u6BB5\u975E\u5E38\u957F\u7684\u6587\u6848\uFF0C\u9700\u8981\u6362\u884C\u5C55\u793A",style:{isWrapText:!0,underline:1}}},3:{0:{style:{fillColor:"red"}},1:{style:{fillColor:"red"}}},4:{0:{style:{fillColor:"red"}},1:{style:{fillColor:"red"}}}},2:{0:{0:{formula:"=Sheet1!A1"}}}},mergeCells:[{row:7,col:0,rowCount:2,colCount:2,sheetId:"1"}],customHeight:{1:{1:100}},customWidth:{1:{1:100}}};var we=class{undoList=[];redoList=[];undoItem=[];redoItem=[];constructor(){this.clear()}clearItem(){this.undoItem=[],this.redoItem=[]}onChange(){this.undoItem.length>0&&this.undoList.push(this.undoItem.slice()),this.redoItem.length>0&&this.redoList.push(this.redoItem.slice()),this.clearItem()}pushRedo(e,t,n){this.redoItem.push({op:e,path:t,value:n})}pushUndo(e,t,n){this.undoItem.push({op:e,path:t,value:n})}clear(){this.undoList=[],this.redoList=[],this.clearItem()}canRedo(){return this.redoList.length>0}canUndo(){return this.undoList.length>0}redo(){return this.redoList.pop()}undo(){return this.undoList.pop()}};function Ko(o){let e=Object.keys(T);for(let t of e)o.style.setProperty(`--${t}`,String(T[t]||""))}function Go(o=oo){let e=localStorage.getItem(Fe);if(e)return JSON.parse(e).map(r=>({value:r,label:r,disabled:!1}));let t=o.map(n=>{let r=!Gt(n);return{label:n,value:n,disabled:r}});return window.queryLocalFonts&&t.push({value:Oe,label:"--> query local fonts",disabled:!1}),t}function Sr(o,e){let{top:t}=o.getDomRect(),n=o.getActiveCell(),r=o.getCell(n),i=o.computeCellPosition(n.row,n.col);if(i.top=t+i.top,r.style||(r.style={}),!r.style.fontFamily){let l="";for(let h of e.fontFamilyList)if(!h.disabled){l=String(h.value);break}r.style.fontFamily=l}let s=o.getSheetList().map(l=>({value:l.sheetId,label:l.name}));return{activeCell:{...i,...r},sheetList:s,currentSheetId:o.getCurrentSheetId()}}function vr(){let o=document.createElement("canvas");return o.style.display="none",document.body.appendChild(o),o}function jo(o,e){let t=new fe(e,new Ce(e,vr())),n=()=>{t.resize(),t.render({changeSet:new Set(["content"])})};n();let r=mt(o,e,n);return e.setHooks({copy:Jt,cut:Xt,paste:qt,modelChange:i=>{let s=Sr(e,o);Object.assign(o,s),t.render({changeSet:i}),t.render({changeSet:e.getChangeSet()})}}),e.fromJSON(Nt),r}function Yo(){let o=new ve(new st(new we));return o.addSheet(),window.controller=o,o}function wr(o){let e=Go();Ko(document.documentElement);let t=Yo(),n=new Proxy(Ft,{set(i,s,a){let l=Reflect.set(i,s,a);return r(),l}}),r=()=>{Eo(o,Et(n,t))};return n.fontFamilyList=e,r(),jo(n,t)}return tn(Er);})();

    for(var key in __export__) {
            exports[key] = __export__[key]
        }
    }));
//# sourceMappingURL=index.js.map
