/* 
MIT License

Copyright (c) 2020 Steve Xu

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.

*/
import{a as Z,d as Ie}from"./chunk-LKIDBLYH.js";import{d as Ce}from"./chunk-PRJU7QU5.js";import{p as k}from"./chunk-XXMUMOL6.js";import{$ as ue,A as X,B as g,C as ae,Ca as fe,D as v,Da as we,E as A,F as Y,G as le,H as O,Ha as pe,I as he,K as de,Qa as p,Ra as Q,Ua as z,V as b,aa as me,b as M,ca as R,f as P,fa as ge,ha as V,i as oe,ja as ce,l as re,n as ie,r as se,v as w,w as G,x as L,z as ne}from"./chunk-CRSUINH5.js";var ke="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAB9AMgDASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD5UooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigBadFG80ipEjO7HAVRkmvU/AuiaTqPhW2aeFZ3Exkk3ZGHHAB9sY46c12FvZWdhGTbW9vbIBljGioPxoA8ZTwxew2M13qUT2sCLkbiN2e3HX8OKwpQochN23tu6mu28deI4X1AwaUVdkzuut2/BPaPsv1XrXDsxZizElicknvQAlFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFdT4F8NNrd951ypGnwnLnpvP90f1oAr6d4dN14ZvNXklkjWA4VPL4kHHIOfU/pWDHG8rhIkZ3PAVRkmvetY0hNQ01NPVvIs8gOkYwSo6KPTnH5Vj313o/gyCKG0si11MMRxxrl5O3LH3/wD1UAZ/w5h1uxgFrc6eIrFnMhllO11yOm3qeg9K0PGXh7UfEFzDHDdxW9jGhJUliWfPcDjHTv610WnvcyWMT3kaQ3LLlkU5CH0z3p1jFNDbhbm4NzLklnKBR9AB0H50AeK+IPCmo6FAJ7vyXgLBfMjfIye2Dg9vSsCvX/GVlq+tW/2WC3EdmHDHaQXbGeuSBjvjnpXHS+B7+K5jhZLht+cOkSsvAzyd3H40AcjVi0srm7dVtYJZSzbRtUnn0robbw1HLIYZXu4JlUMQ0WTg/wCyOf8ACut+Gd7Dbx3mjSOouYJ2Ze29ehx7jH60AeY3tnc2MxhvIJIJRztkUg49ar17Z4un0F4fs+sNC0yjKLuHmJnuM15JqUOnRzsLK6nlTPG6ED9c/wBKAM6ilPtSUAFFFFABRRRQAUUUUAFFFFABRRRQAVreFLS3vvEVjbXg3QSPhhuxng4GfrismrFhcvZX1vdRYLwyLIoPcg5oA9u1DQtCEKTXllapFbktkjaoz646/Q1qMYLO1zhIYI16KMBR7AVwVj4mn8W6la6dHYiG3WVZ5yZN2UQg46Dvitjxj4ntdHura0ubYXUcqlpkB5UcY475549qAK93rOqeIoJLbw/ZyW8D5U3lwdnGedv+fwrrPsscn2d7mOKa4hHyyMgyDjkj0zWfoGt6VqcSxaXKg2JnyQu0oOnSrWr6paaTame9mWNedoJ5Y+gHegCxcTrAoLK7EnACKTk/0/GsK61zVk3G28O3Mi9i86KfyGa02hNza/aLOYpPLGrJI4LL04+UnpWDr2s/8IlpVujA3V9cbjuJwpYYycdhzwBQBm6j4n8UW1u876LDbwrwWkyxH6iuZl8e68/CzxRnP8MK/wBc13mnw3fibw/jWoI4VmAePb1I55x27Y/yK53wf4JtruJrzUZGkjEpEKRthXVSRk8Zwce3FAGTdeLfEAhjjuZoR567kZo1UgEkBge3Q8/jVvT/AA7pqxnUte12Es/7wrbSgtk988k8+gqr48s5rvxr9jtowWdI44UHAxtH5DrXbeGvB9vp2i3NpqAjuZLrHnFcgYHQA9eDznigDjL660S7vjFpGj3Wq3LDJlmmkyxHfaDk/pXP6m/lyGKfSYrKXrtxIrD8GY17L4fi0eJZF0OKDYh2PJFg8jsW6muS+K15BOLTT4FEt4r+Y2wZZFxwPxznHtQB569tm1FxC2+MYEgxyhPr7H1qtXY6Po7aTpWoX2uoIIpYDHDBIcPI2QeB1H/1646gAooooAKKKKACiiigAooooAKKKKACpz9n+xjHm/avMOemwJgY985zUFFAHpvwmtLZbK7vD5ou9+05HyCPHY9ck5/75Fcv43vrXUdWu5VaY3KT+UowPL8tRj653Z/Ouk8I+JtO07wsyXLpFPEGRUUEtJ1IOP8AgXWvN2JZiScknJJoA9F+Es9qj3MG5zeSZcgL8oQbcc+uSePau11zw7YaxdWVxeNNIIEYGDOEJJ65HPTH5V4MjtGwZGKsOQQcEVv3XjDWbnT0tGuSsYXazKMO/wBTQB23jLxmmlXlrZaR5cjR4NyTyBg/cH4Yya624stM1T7BemJbhol3xuxyASeoH0A696+fCSSSSSTySasQ395BCYYLq4jiPJRJCFP4UAeleOvF/wBh/wBA0qSNpWQiSRGz5fbA9/5cUvhXxxpVvo1vDqQkge2VIisSbi6jjK+/HevK6KAOvbxNbDx/JrEUTtZu+xfOHzpHgLu44zjP516Zq041ayeLw9Nvgn+T7UxwI1xyRjqe2B+JrxLRYbOfUYk1O5NtaZy7hSx+gx6+tezeGb7SJLVbPQ3MkMI5wrYXPqSOpoA0LbTLTR7N7XQ48RLkx+dwXPqxHevMtf8AGOr2mrXVvbMtuEbb80Kb8989R/8AWxXqtxMlvBJNMdsaDcxrxrUvs+v6xcahcXMdlBLJtAY7yABjPH0oAyvEF6L/AFSWVLm7uYSfka5xvAxyMDgc56VVvhbLdSCxaV7bjYZVAbpznHHXNWdU0+OzI8q5jm5w20n+oH9azqACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACtHSNJudXuBBYhGlxnDOF/nWdXbeD/Emi6ZZpHqGmj7VGSVuI41Zm6+vIPagDS0X4b8l9ZueM8R256/Ukf0rvdNsLTSrJbezjWGBBk+/qSe5rhdR+JEMaFNJsWJznfcHA/IHn865rWvGmrarbmB3jt4WG10gUjf8AUkk0Aehax4m8OyJPZ3k6XEYGXVQWU89AR1P0rlX1XwbGzhdJMiBuCpYkj15x/OuBooA6fxLrGi3kCxaTpC257ysArfkCa5iiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/Z";var N={currentSheetId:"",rangeMap:{2:{row:4,col:4,rowCount:2,colCount:2,sheetId:"2"},3:{row:4,col:4,rowCount:2,colCount:2,sheetId:"3"},8:{row:2,col:2,rowCount:2,colCount:2,sheetId:"8"}},workbook:{1:{sheetId:"1",name:"basic",isHide:!1,colCount:30,rowCount:200,sort:1,tabColor:"#A2B3F6"},2:{sheetId:"2",name:"floating-picture",isHide:!1,colCount:30,rowCount:200,sort:2,tabColor:"#FE4B4B"},3:{sheetId:"3",name:"hide",isHide:!0,colCount:30,rowCount:200,sort:3},4:{sheetId:"4",name:"chart",isHide:!1,colCount:30,rowCount:200,sort:4,tabColor:"#CEF273"},5:{sheetId:"5",name:"defined name",isHide:!1,colCount:30,rowCount:200,sort:5,tabColor:"#76EFEF"},6:{sheetId:"6",name:"unicode",isHide:!1,colCount:30,rowCount:200,sort:6,tabColor:"#9E6DE3"},7:{sheetId:"7",name:"formula",isHide:!1,colCount:30,rowCount:200,sort:7,tabColor:"#E7258F"},8:{sheetId:"8",name:"merge cell",isHide:!1,colCount:30,rowCount:200,sort:8,tabColor:"#C1026B"},9:{sheetId:"9",name:"number format",isHide:!1,colCount:30,rowCount:200,sort:9,tabColor:"#F9D700"},10:{sheetId:"10",name:"border",isHide:!1,colCount:30,rowCount:200,sort:10},11:{sheetId:"11",name:"autoFilter",isHide:!1,colCount:30,rowCount:200,sort:11}},worksheets:{1:{"0_0":{value:"1",style:{fontColor:"#ff0000"}},"0_3":{value:"large text",style:{fontSize:36}},"0_4":{value:"This is a very long text that needs to be wrapped",style:{isWrapText:!0,isStrike:!0,isItalic:!0,underline:2}},"0_5":{value:"10"},"1_0":{formula:"=SUM(F:F)",value:""},"1_5":{value:"5"},"3_0":{value:"",style:{fillColor:"red"}},"3_1":{value:"",style:{fillColor:"red"}},"4_0":{value:"",style:{fillColor:"red"}},"4_1":{value:"",style:{fillColor:"red"}}},2:{"0_0":{value:"",formula:"=basic!A1"}},4:{"6_6":{value:3},"6_7":{value:6},"6_8":{value:29},"7_6":{value:35},"7_7":{value:15},"7_8":{value:34},"8_6":{value:23},"8_7":{value:24},"8_8":{value:15}},5:{"0_0":{value:"1"},"0_2":{value:"",formula:"=foo"}},6:{"0_0":{value:"\u4F60\u597D\uFF0C\u4E16\u754C"},"0_2":{value:"",formula:'=CONCAT("\u{1F60A}", "\u{1F468}\u200D\u{1F468}\u200D\u{1F467}\u200D\u{1F467}", "\u{1F466}\u{1F3FE}")',style:{fontSize:36}},"0_3":{value:"\u{1F337}\u{1F381}\u{1F4A9}\u{1F61C}\u{1F44D}\u{1F3F3}\uFE0F\u200D\u{1F308}"},"1_0":{value:"Hello World"},"2_0":{value:"Bonjour le monde"},"3_0":{value:"Hola mundo"},"4_0":{value:"\u041F\u0440\u0438\u0432\u0435\u0442, \u043C\u0438\u0440"},"5_0":{value:"Hallo Welt"},"6_0":{value:"\u3053\u3093\u306B\u3061\u306F\u3001\u4E16\u754C"},"7_0":{value:"\uC548\uB155 \uC138\uACC4"},"8_0":{value:"\u0939\u0948\u0932\u094B\u0935\u0930\u094D\u0932\u094D\u0921"},"9_0":{value:"Halo Dunia"},"10_0":{value:"Ol\xE1 mundo"},"11_0":{value:"Witaj \u015Bwiecie"}},7:{"0_0":{value:"",formula:"=SUM(1,2)"},"0_1":{value:"test"},"0_2":{value:"",formula:"=CONCATENATE(A1,B1)"},"0_3":{value:"",formula:'=UNICODE("\u6D4B\u8BD5")'},"0_4":{value:"",formula:"='merge cell'!A1"},"1_0":{value:"",formula:"=PI()"},"2_0":{value:"",formula:"=EXP(1)"},"3_0":{value:"",formula:"=EXP(1)*PI()"},"4_0":{value:"",formula:"=SUM(1, SIN(PI()/2),3)"},"5_0":{value:"",formula:"=R1C3"}},8:{"0_0":{value:"",formula:"=SUM(1,2)"},"2_2":{value:1,style:{horizontalAlign:1}},"5_5":{value:[1,"Hello World",!0,"\u6D4B\u8BD5",!1].join(M),style:{isWrapText:!0}}},9:{},10:{},11:{"0_0":{value:"1"},"1_0":{value:"2"},"2_0":{value:"3"}}},mergeCells:{"merge cell!$C$3:$D$4":{row:2,col:2,rowCount:2,colCount:2,sheetId:"8"},"merge cell!$F$6:$G$7":{row:5,col:5,rowCount:2,colCount:2,sheetId:"8"}},customHeight:{"1_1":{len:100,isHide:!1}},customWidth:{"6_0":{len:150,isHide:!1},"6_1":{len:150,isHide:!1},"6_2":{len:150,isHide:!1},"6_3":{len:150,isHide:!1}},definedNames:{foo:{row:0,col:0,rowCount:1,colCount:1,sheetId:"5"},doo:{row:3,col:3,rowCount:1,colCount:1,sheetId:"5"}},drawings:{},autoFilter:{11:{range:{col:0,row:0,rowCount:5,colCount:5,sheetId:"11"}}}};if(!le()){let d=Y();N.drawings[d]={title:"Black Myth: Wukong",type:"floating-picture",uuid:d,imageSrc:ke,width:200,height:125,originHeight:125,originWidth:200,sheetId:"2",fromCol:1,fromRow:1,marginX:0,marginY:0};let e=Y();N.drawings[e]={title:p("chart-title"),type:"chart",uuid:e,width:400,height:250,originHeight:250,originWidth:400,marginX:0,marginY:0,sheetId:"4",fromCol:4,fromRow:4,chartType:"bar",chartRange:{row:6,col:6,colCount:3,rowCount:3,sheetId:"4"}}}for(let d=0;d<z.length;d++){let e=z[d],t=g(d,0);N.worksheets[9][t]={value:d+1,style:{numberFormat:String(e.value)}}}var ye=Object.keys(re);for(let d=0;d<ye.length;d++){let e=g(d,d),t={type:ye[d],color:""};N.worksheets[10][e]={value:"",style:{borderLeft:t,borderRight:t,borderTop:t,borderBottom:t}}}var l="__DELETE__";function u(d,e,t){let o=e.type+(e.key?"."+e.key:"");Ee(d,o,t==="undo"?e.oldValue:e.newValue)}function Ee(d,e,t){if(!d||typeof d!="object")return;e.split(".").reduce((r,i,s,n)=>(s===n.length-1?t===l?delete r[i]:r[i]=t:(r[i]===null||r[i]===void 0)&&(r[i]={}),r[i]),d)}var F=class{constructor(e){this.position=-1;this.commandList=[];this.commands=[];this.options={change:L,maxLength:100,redo:L,undo:L};this.clear(!0),this.options.maxLength=e.maxLength||this.options.maxLength,typeof e.change=="function"&&(this.options.change=e.change),typeof e.redo=="function"&&(this.options.redo=e.redo),typeof e.undo=="function"&&(this.options.undo=e.undo)}push(...e){this.commands=this.commands.concat(e)}commit(){if(this.commands.length===0)return;let e=this.commands.filter(t=>t.type!=="scroll"&&t.type!=="antLine");if(e.length===0){this.change([...this.commands],"commit"),this.commands=[];return}this.position++,this.commandList[this.position]=[...e];for(let t=this.position+1;t<this.commandList.length;t++)this.commandList[t]=[];this.position>=this.options.maxLength&&(this.commandList[this.position-this.options.maxLength]=[]);for(let t=0;this.commandList.length>this.options.maxLength&&t<this.position;t++)this.commandList[0].length===0&&(this.commandList.shift(),this.position--);this.change([...this.commands],"commit"),this.commands=[]}redo(){let e=this.findRedoIndex();if(e<0)return;let t=this.commandList[e];this.options.redo([...t]),this.position=e,this.change(t,"redo")}undo(){let e=this.findUndoIndex();if(e<0)return;let t=this.commandList[e];this.options.undo([...t]),this.position=e-1,this.change(t,"undo")}findRedoIndex(){if(this.position>=this.commandList.length-1)return-1;for(let e=this.position+1;e<this.commandList.length;e++)if(this.commandList[e].length>0)return e;return-1}canRedo(){return this.findRedoIndex()>=0}findUndoIndex(){if(this.position<0)return-1;for(let e=this.position;e>=0;e--)if(this.commandList[e].length>0)return e;return-1}canUndo(){return this.findUndoIndex()>=0}clear(e=!1){e&&(this.position=-1,this.commandList=[]),this.commands=[]}change(e,t){this.options.change(e,t)}get(){return[...this.commands]}getLength(){return Math.min(this.commandList.length,this.options.maxLength)}};var W=class{constructor(e){this.currentSheetId="";this.workbook={};this.model=e}validateSheet(e){return!(!e||!e.sheetId||!e.name||typeof e.isHide!="boolean"||typeof e.sort!="number"||typeof e.colCount!="number"||typeof e.rowCount!="number"||e.rowCount>1048576||e.colCount>16384||e.rowCount<=0||e.colCount<=0)}toJSON(){return{workbook:{...this.workbook},currentSheetId:this.currentSheetId}}fromJSON(e){let t=e.workbook||{},o=e.currentSheetId||"",r={...this.workbook};this.workbook={},this.currentSheetId="";for(let s of Object.values(t))this.validateSheet(s)&&(this.workbook[s.sheetId]=s);let i=this.getSheetId()||"";this.workbook[o]&&!this.workbook[o].isHide&&(i=o),this.model.push({type:"workbook",key:"",newValue:this.workbook,oldValue:r}),this.setCurrentSheetId(i)}undo(e){if(e.type==="currentSheetId"){let t=this.getSheetId();b(typeof e.oldValue=="string"),b(typeof e.newValue=="string"),!this.workbook[e.oldValue]||this.workbook[e.oldValue].isHide?t&&(this.currentSheetId=t):this.currentSheetId=e.oldValue;return}else e.type==="workbook"&&u(this,e,"undo")}redo(e){if(e.type==="currentSheetId"){if(b(typeof e.oldValue=="string"),b(typeof e.newValue=="string"),!this.workbook[e.newValue]||this.workbook[e.newValue].isHide){let t=this.getSheetId();t&&(this.currentSheetId=t)}else this.currentSheetId=e.newValue;return}else e.type==="workbook"&&u(this,e,"redo")}updateSheetInfo(e,t){let o=t||this.currentSheetId;if(!this.workbook[o])return;let r=Object.keys(e);for(let i of r){if(i==="sheetId")continue;let s=this.workbook[o][i];s!==e[i]&&(this.workbook[o][i]=e[i],this.model.push({type:"workbook",key:`${o}.${i}`,newValue:e[i],oldValue:s}))}}getSheetList(){let e=Object.values(this.workbook);return e.sort((t,o)=>t.sort-o.sort),e.slice()}addSheet(){let e=this.getSheetList(),o={...ne(e),isHide:!1,colCount:30,rowCount:200};return this.workbook[o.sheetId]=o,this.model.push({type:"workbook",key:o.sheetId,newValue:{...o},oldValue:l}),o}deleteSheet(e){let t=e||this.currentSheetId;if(this.checkSheetSize(e)){let o={...this.workbook[t]};delete this.workbook[t],this.model.push({type:"workbook",key:t,newValue:l,oldValue:o})}}hideSheet(e){this.checkSheetSize(e)&&this.updateSheetInfo({isHide:!0},e)}unhideSheet(e){this.updateSheetInfo({isHide:!1},e)}renameSheet(e,t){if(!e){k.error(p("the-value-cannot-be-empty"));return}let o=t||this.currentSheetId,i=this.getSheetList().find(s=>s.name===e);if(i){if(i.sheetId===o)return;k.error(p("sheet-name-is-duplicate"));return}this.updateSheetInfo({name:e},o)}getSheetInfo(e){let t=e||this.currentSheetId,o=this.workbook[t];if(o)return o&&(o.sheetId=t),{...o}}setCurrentSheetId(e){if(!(!e||!this.workbook[e])&&this.currentSheetId!==e){let t=this.currentSheetId;this.currentSheetId=e,this.model.push({type:"currentSheetId",key:"",newValue:e,oldValue:t})}}getCurrentSheetId(){return this.currentSheetId}getSheetId(){return this.getSheetList().filter(o=>!o.isHide)[0]?.sheetId}deleteAll(){}checkSheetSize(e){let t=e||this.currentSheetId;return this.workbook[t]?this.getSheetList().filter(i=>!i.isHide).length<2?(k.error(p("a-workbook-must-contains-at-least-one-visible-worksheet")),!1):!0:!1}};var K=class{constructor(e){this.rangeMap={};this.model=e}validateRange(e){e.sheetId=e.sheetId||this.model.getCurrentSheetId();let t=this.model.getSheetInfo(e.sheetId);return!(!t||e.row<0||e.col<0||e.colCount<0||e.rowCount<0||e.row>=t.rowCount||e.col>=t.colCount||e.colCount>t.colCount||e.rowCount>t.rowCount||e.row+e.rowCount>t.rowCount||e.col+e.colCount>t.colCount)}toJSON(){return{rangeMap:{...this.rangeMap}}}fromJSON(e){let t=e.rangeMap||{},o={...this.rangeMap};this.rangeMap={};for(let r of Object.values(t))r.sheetId=r.sheetId||this.model.getCurrentSheetId(),this.model.validateRange(r)&&(this.rangeMap[r.sheetId]=r);this.model.push({type:"rangeMap",key:"",newValue:this.rangeMap,oldValue:o})}undo(e){e.type==="rangeMap"&&u(this,e,"undo")}redo(e){e.type==="rangeMap"&&u(this,e,"redo")}getActiveRange(){let e=this.model.getCurrentSheetId(),t=this.rangeMap[e];return t?(t.sheetId=t.sheetId||e,{range:{...t},isMerged:!1}):{range:{row:0,col:0,rowCount:1,colCount:1,sheetId:e},isMerged:!1}}setActiveRange(e){if(e.sheetId=e.sheetId||this.model.getCurrentSheetId(),!this.model.validateRange(e))return;let t=this.rangeMap[e.sheetId]?{...this.rangeMap[e.sheetId]}:void 0;t&&ue(t,e)||(this.rangeMap[e.sheetId]=e,this.model.push({type:"rangeMap",key:e.sheetId,newValue:e,oldValue:t||l}))}deleteAll(){}};var H=class{constructor(e){this.drawings={};this.model=e}validateDrawing(e){if(!e||!e.uuid||!this.model.getSheetInfo(e.sheetId))return!1;if(e.type==="floating-picture"){if(!e.imageSrc)return!1}else if(e.chartType===void 0||e.chartRange===void 0||Q.findIndex(o=>o.value===e.chartType)<0||!this.model.validateRange(e.chartRange))return!1;return!0}toJSON(){return{drawings:{...this.drawings}}}fromJSON(e){let t=e.drawings||{},o={...this.drawings};this.drawings={};for(let[r,i]of Object.entries(t)){if(!this.validateDrawing(i)||!r)return;this.drawings[r]=i}this.model.push({type:"drawings",key:"",newValue:this.drawings,oldValue:o})}undo(e){e.type==="drawings"&&u(this,e,"undo")}redo(e){e.type==="drawings"&&u(this,e,"redo")}getDrawingList(e){let t=e||this.model.getCurrentSheetId();return Object.values(this.drawings).filter(r=>r.sheetId===t).slice()}addDrawing(e){if(this.drawings[e.uuid])return k.error(p("uuid-is-duplicate"));if(this.validateDrawing(e)){if(e.type==="chart"){let o=e.chartRange,r=!1,i=this.model.getSheetInfo(o.sheetId);if(!i)return k.error(p("sheet-is-not-exist"));if(R(o,i?.rowCount,i?.colCount,(s,n)=>this.model.getCell({row:s,col:n,rowCount:1,colCount:1,sheetId:""})?.value?(r=!0,!0):!1),!r)return k.error(p("cells-must-contain-data"))}else e.type==="floating-picture"&&typeof e.imageAngle!="number"&&(e.imageAngle=0);this.drawings[e.uuid]=e,this.model.push({type:"drawings",key:e.uuid,newValue:e,oldValue:l})}}updateDrawing(e,t){let o=Object.keys(t),r=this.drawings[e];if(!(o.length===0||!r)){for(let i of o)if(r[i]!==t[i]&&i==="chartType"&&Q.findIndex(n=>n.value===t.chartType)<0)return k.error(p("unsupported-chart-types"));for(let i of o)if(r[i]!==t[i]){let s=typeof r[i]=="object"&&r[i]?{...r[i]}:r[i];r[i]=t[i],this.model.push({type:"drawings",key:`${e}.${i}`,newValue:r[i],oldValue:s})}}}deleteDrawing(e){let t=this.drawings[e];t&&(delete this.drawings[e],this.model.push({type:"drawings",key:e,newValue:l,oldValue:t}))}addCol(e,t,o=!1){let r=this.model.getSheetInfo().colCount;for(let[i,s]of Object.entries(this.drawings)){let n={},a=o?e+1:e;if(s.fromCol>=a&&(n.fromCol=Math.min(r-1,s.fromCol+t)),s.type==="chart"&&s.chartRange.col>=a){n.chartRange={...s.chartRange};let h=n.chartRange.col;h+t<=r-1?n.chartRange.col+=t:(n.chartRange.col=r-1,n.chartRange.colCount=Math.max(r-1-t-h+n.chartRange.colCount,1))}this.updateDrawing(i,n)}}addRow(e,t,o=!1){if(t<=0)return;let r=this.model.getSheetInfo().rowCount;for(let[i,s]of Object.entries(this.drawings)){let n={},a=o?e:e+1;if(s.fromRow>=a&&(n.fromRow=Math.min(r-1,s.fromRow+t)),s.type==="chart"&&s.chartRange.row>=a){n.chartRange={...s.chartRange};let h=n.chartRange.row;h+t<=r-1?n.chartRange.row+=t:(n.chartRange.row=r-1,n.chartRange.rowCount=Math.max(r-1-t-h+n.chartRange.rowCount,1))}this.updateDrawing(i,n)}}deleteCol(e,t){for(let[o,r]of Object.entries(this.drawings)){let i={};if(r.fromCol>=e&&(i.fromCol=Math.max(r.fromCol-t,0)),r.type==="chart"&&r.chartRange.col>=e){i.chartRange={...r.chartRange};let s=i.chartRange.col;s>=t?i.chartRange.col-=t:(i.chartRange.col=0,i.chartRange.colCount=Math.max(s-t+i.chartRange.colCount,1))}this.updateDrawing(o,i)}}deleteRow(e,t){for(let[o,r]of Object.entries(this.drawings)){let i={};if(r.fromRow>=e&&(i.fromRow=Math.max(r.fromRow-t,0)),r.type==="chart"&&r.chartRange.row>=e){i.chartRange={...r.chartRange};let s=i.chartRange.row;s>=t?i.chartRange.row=s-t:(i.chartRange.row=0,i.chartRange.rowCount=Math.max(s-t+i.chartRange.rowCount,1))}this.updateDrawing(o,i)}}deleteAll(e){let t=e||this.model.getCurrentSheetId();for(let[o,r]of Object.entries(this.drawings))r.sheetId===t&&(delete this.drawings[o],this.model.push({type:"drawings",key:o,newValue:l,oldValue:{...r}}))}};var T=class{constructor(e){this.definedNames={};this.model=e}toJSON(){return{definedNames:{...this.definedNames}}}validateDefinedName(e){if(!e)return!1;let t=ge(e,o=>this.model.getSheetList().find(s=>s.name===o)?.sheetId||"");if(t){let o=this.model.getSheetInfo(t.sheetId);if(o&&t.col<o.colCount&&t.row<o.rowCount)return!1}return!!(se.test(e)&&e.length<=256)}fromJSON(e){let t=e.definedNames||{},o={...this.definedNames};this.definedNames={};for(let[r,i]of Object.entries(t))!this.model.validateRange(i)||!this.validateDefinedName(r)||(this.definedNames[r]=i);this.model.push({type:"definedNames",key:"",newValue:this.definedNames,oldValue:o})}undo(e){e.type==="definedNames"&&u(this,e,"undo")}redo(e){e.type==="definedNames"&&u(this,e,"redo")}getDefineNameList(){let e=Object.entries(this.definedNames);return e.length===0?[]:e.map(t=>({name:t[0],range:t[1]}))}getDefineName(e){let t=e.sheetId||this.model.getCurrentSheetId();for(let[o,r]of Object.entries(this.definedNames))if(r.row===e.row&&r.col===e.col&&r.sheetId===t)return o;return""}setDefineName(e,t){if(!t)return!1;let o=this.getDefineName(e);if(o===t)return!1;let r={row:e.row,col:e.col,sheetId:e.sheetId||this.model.getCurrentSheetId(),colCount:1,rowCount:1};return this.definedNames[t]=r,o&&delete this.definedNames[o],o?(this.model.push({type:"definedNames",key:t,newValue:r,oldValue:l}),this.model.push({type:"definedNames",key:o,newValue:l,oldValue:r})):this.model.push({type:"definedNames",key:t,newValue:r,oldValue:l}),!0}checkDefineName(e){if(this.definedNames[e])return{...this.definedNames[e]}}deleteAll(e){let t=e||this.model.getCurrentSheetId();for(let[o,r]of Object.entries(this.definedNames))r.sheetId===t&&(delete this.definedNames[o],this.model.push({type:"definedNames",key:o,newValue:l,oldValue:r}))}};var B=class{constructor(e,t){this.worksheets={};this.computeFormulasCallback=e=>{let{list:t}=e,o=!1;for(let r of t){let i=r.sheetId;this.worksheets[i]=this.worksheets[i]||{};let s=this.worksheets[i][r.key].value,n=this.worksheets[i][r.key].formula;n&&r.newValue===ie&&n!==s?(o=!0,this.worksheets[i][r.key].value=n,this.worksheets[i][r.key].formula=""):s!==r.newValue&&(o=!0,this.worksheets[i][r.key].value=r.newValue)}o&&this.model.render(new Set(["cellValue"]))};this.model=e,this.worker=t}toJSON(){return{worksheets:{...this.worksheets}}}fromJSON(e){let t=e.worksheets||{};this.worksheets=this.worksheets||{};let o={...this.worksheets};this.worksheets={};for(let[r,i]of Object.entries(t))this.worksheets[r]={},!w(i)&&(this.worksheets[r]=this.validateSheetData(i));this.model.push({type:"worksheets",key:"",newValue:this.worksheets,oldValue:o})}undo(e){e.type==="worksheets"&&u(this,e,"undo")}redo(e){e.type==="worksheets"&&u(this,e,"redo")}addMergeCell(e,t){let o=e.sheetId||this.model.getCurrentSheetId(),r=t===2,i=[],s=this.model.getSheetInfo(e.sheetId);if(!s||(R(e,s.rowCount,s.colCount,(m,f)=>{let y=this.getCell({row:m,col:f,rowCount:1,colCount:1,sheetId:o});return y&&i.push({value:{...y},row:m,col:f}),!1}),i.length===0))return;let n=[Z(i[0].value.value,i[0].value.style?.numberFormat)];for(let m=1;m<i.length;m++){let f=i[m],y=g(f.row,f.col),S={...f.value};r&&n.push(Z(S.value,S.style?.numberFormat)),delete this.worksheets[o][y],this.model.push({type:"worksheets",key:`${o}.${y}`,newValue:l,oldValue:S})}i.some(m=>m.value.formula)&&(n=[n[0]]);let a={},h=i[0].value.value;i[0].value.style&&(a={...i[0].value.style}),t===1||t===0?a.horizontalAlign=1:t===2&&(a.isWrapText=!0);let c={row:e.row,col:e.col,rowCount:1,colCount:1,sheetId:o};if(r?h=n.join(M):h=n[0],e.row===i[0].row&&e.col===i[0].col)r&&this.setCellValue(h,c);else{let m=g(i[0].row,i[0].col);delete this.worksheets[o][m],this.model.push({type:"worksheets",key:`${o}.${m}`,newValue:l,oldValue:{...i[0].value}}),this.setCellValue(h,c)}this.updateCellStyle(a,c)}addRow(e,t,o=!1){let r=this.getCoordinateList(),i=this.worksheets[this.model.getCurrentSheetId()],s=o?e:e+1;for(let n=r.length-1;n>=0;n--){let a=r[n];if(a.row<s)continue;let h=g(a.row,a.col),c=g(a.row+t,a.col),m=i[h]?{...i[h]}:{value:""},f=i[c]?{...i[c]}:{value:""};this.updateCell(h,l,m),this.updateCell(c,m,f)}}deleteRow(e,t){let o=this.getCoordinateList(),r=this.worksheets[this.model.getCurrentSheetId()];for(let i of o){if(i.row<e)continue;let s=g(i.row,i.col),n=r[s]?{...r[s]}:{value:""};if(i.row>=e+t){let a=g(i.row-t,i.col),h=r[a]?{...r[a]}:{value:""};this.updateCell(a,n,h)}this.updateCell(s,l,n)}}addCol(e,t,o=!1){let r=this.getCoordinateList(!0),i=this.worksheets[this.model.getCurrentSheetId()],s=o?e+1:e;for(let n=r.length-1;n>=0;n--){let a=r[n];if(a.col<s)continue;let h=g(a.row,a.col),c=g(a.row,a.col+t),m=i[h]?{...i[h]}:{value:""},f=i[c]?{...i[c]}:{value:""};this.updateCell(h,l,m),this.updateCell(c,m,f)}}deleteCol(e,t){let o=this.getCoordinateList(!0),r=this.worksheets[this.model.getCurrentSheetId()];for(let i of o){if(i.col<e)continue;let s=g(i.row,i.col),n=r[s]?{...r[s]}:{value:""};if(i.col>=e+t){let a=g(i.row,i.col-t),h=r[a]?{...r[a]}:{value:""};this.updateCell(a,n,h)}this.updateCell(s,l,n)}}getWorksheet(e){let t=e||this.model.getCurrentSheetId(),o=this.worksheets[t];if(o)return o}setWorksheet(e,t){let o=t||this.model.getCurrentSheetId();if(G(e,this.worksheets[o]))return;let r=this.worksheets[o]?{...this.worksheets[o]}:{};this.worksheets[o]=this.validateSheetData(e),this.model.push({type:"worksheets",key:o,newValue:e,oldValue:r})}getCell(e,t=!1){let{row:o,col:r,sheetId:i}=e,s=i||this.model.getCurrentSheetId();if(!t&&(this.model.getRowHeight(o,s).len===0||this.model.getColWidth(r,s).len===0))return;let n=g(o,r);this.worksheets[s]=this.worksheets[s]||{};let h=this.worksheets[s]?.[n];if(!w(h))return{...h}}async setCell(e,t,o){let{row:r,col:i}=o;for(let s=0;s<e.length;s++)for(let n=0;n<e[s].length;n++){let a={row:r+s,col:i+n};t[s]&&t[s][n]&&this.setStyle(t[s][n],a),this.setCellValue(e[s][n],{...o,...a})}}setCellValue(e,t){let o=t.sheetId||this.model.getCurrentSheetId(),r=this.worksheets?.[o]?.[g(t.row,t.col)];typeof e=="string"&&de(e)&&r?.style?.numberFormat!==oe?this.setCellFormula(e,t):(r?.formula&&this.setCellFormula("",t),this.setValue(e,t))}updateCellStyle(e,t){if(w(e))return;let o=this.model.getSheetInfo(t.sheetId);o&&R(t,o.rowCount,o.colCount,(r,i)=>(this.updateStyle(e,{row:r,col:i}),!1))}pasteRange(e,t){let o=this.model.getCurrentSheetId(),r=this.model.getActiveRange().range,{row:i,col:s,rowCount:n,colCount:a,sheetId:h}=e,c=h||o,m=this.getWorksheet(c),f={...r,rowCount:n,colCount:a};if(!m||w(m))return f;this.worksheets[o]=this.worksheets[o]||{};let y=this.worksheets[o],S=this.model.getSheetInfo(e.sheetId);return S&&R(e,S.rowCount,S.colCount,(ee,te)=>{let E=g(ee,te),j=m[E]?{...m[E]}:{value:""},Ae=r.row+(ee-i),Re=r.col+(te-s),D=g(Ae,Re),be=y[D]?{...y[D]}:{value:""};return y[D]={...j},this.model.push({type:"worksheets",key:`${o}.${D}`,newValue:j,oldValue:be}),t&&(delete m[E],this.model.push({type:"worksheets",key:`${c}.${E}`,newValue:l,oldValue:j})),!1}),f}deleteAll(e){let t=e||this.model.getCurrentSheetId();if(w(this.worksheets[t]))return;let o=this.worksheets[t]?{...this.worksheets[t]}:{};delete this.worksheets[t],this.model.push({type:"worksheets",key:t,newValue:l,oldValue:{...o}})}updateStyle(e,t){let o=this.getCellModel(t);if(o.style=o.style||{},w(e)&&w(o.style))return;let r=Object.keys(e);for(let i of r){let s=o.style?.[i],n=e[i];G(s,n)||(o.style[i]=n,this.model.push({type:"worksheets",key:`${this.model.getCurrentSheetId()}.${g(t.row,t.col)}.style.${i}`,newValue:n===void 0?l:n,oldValue:s===void 0?l:s}))}}setStyle(e,t){let o=this.getCellModel(t),i={...o.style||{}};o.style=e,this.model.push({type:"worksheets",key:`${this.model.getCurrentSheetId()}.${g(t.row,t.col)}.style`,newValue:e,oldValue:w(i)?l:i})}setValue(e,t){let o=this.getCellModel(t),r=o.value;if(r===e)return;let i=X(e??"");o.value=i,this.model.push({type:"worksheets",key:`${this.model.getCurrentSheetId()}.${g(t.row,t.col)}.value`,newValue:i,oldValue:r===void 0?l:r})}setCellFormula(e,t){let o=this.getCellModel(t),r=o.formula;r!==e&&(o.formula=e,this.model.push({type:"worksheets",key:`${this.model.getCurrentSheetId()}.${g(t.row,t.col)}.formula`,newValue:e,oldValue:r||l}))}validateSheetData(e){let t={};for(let[o,r]of Object.entries(e)){if(w(r))continue;let i=X(r.value??"");t[o]={value:i},w(r.style)||(t[o].style={...r.style}),r.formula&&(r.formula.startsWith(P)?t[o].formula=r.formula:t[o].formula=P+r.formula)}return t}getCoordinateList(e=!1){let t=this.model.getCurrentSheetId(),o=this.worksheets[t];if(w(o))return[];let r=Array.from(Object.keys(o)).map(i=>ae(i));return r.sort((i,s)=>e?i.col-s.col:i.row-s.row),r}updateCell(e,t,o){let r=this.model.getCurrentSheetId();t===l?delete this.worksheets[r][e]:this.worksheets[r][e]={...t},this.model.push({type:"worksheets",key:`${r}.${e}`,newValue:t,oldValue:o})}getCellModel(e){let{row:t,col:o}=e,r=this.model.getCurrentSheetId(),i=g(t,o);return this.worksheets[r]=this.worksheets[r]||{},this.worksheets[r][i]=this.worksheets[r][i]||{},this.worksheets[r][i]}async computeFormulas(){let e=this.model.getCurrentSheetId(),t=this.worksheets[e];if(w(t))return;let o={};for(let i of this.model.getDefineNameList())o[i.name]=i.range;let r={worksheets:this.worksheets,definedNames:o,currentSheetId:this.model.getCurrentSheetId(),workbook:this.model.getSheetList()};this.worker.computeFormulas(r,Ce(this.computeFormulasCallback))}};var _=class{constructor(e){this.mergeCells={};this.convertSheetIdToName=e=>this.model.getSheetInfo(e)?.name||"";this.model=e}toJSON(){return{mergeCells:{...this.mergeCells}}}fromJSON(e){let t=e.mergeCells||{},o={...this.mergeCells};this.mergeCells={};for(let r of Object.values(t)){if(r.sheetId=r.sheetId||this.model.getCurrentSheetId(),!this.model.validateRange(r))continue;let i=V(r,"absolute",this.convertSheetIdToName);this.mergeCells[i]=r}this.model.push({type:"mergeCells",key:"",newValue:this.mergeCells,oldValue:o})}undo(e){e.type==="mergeCells"&&u(this,e,"undo")}redo(e){e.type==="mergeCells"&&u(this,e,"redo")}getMergeCellList(e){let t=e||this.model.getCurrentSheetId();return Object.values(this.mergeCells).filter(o=>o.sheetId===t)}addMergeCell(e){let t=V(e,"absolute",this.convertSheetIdToName);if(this.mergeCells[t]){k.error(p("merging-cell-is-duplicate"));return}this.mergeCells[t]=e,this.model.push({type:"mergeCells",key:t,newValue:this.mergeCells[t],oldValue:l})}deleteMergeCell(e){e.sheetId=e.sheetId||this.model.getCurrentSheetId();let t=V(e,"absolute",this.convertSheetIdToName);if(!this.mergeCells[t])return;let o=this.mergeCells[t];delete this.mergeCells[t],this.model.push({type:"mergeCells",key:t,newValue:l,oldValue:o})}deleteAll(e){let t=e||this.model.getCurrentSheetId();for(let[o,r]of Object.entries(this.mergeCells))r.sheetId===t&&(delete this.mergeCells[o],this.model.push({type:"mergeCells",key:o,newValue:l,oldValue:r}))}};var x=class{constructor(e){this.customHeight={};this.model=e}toJSON(){return{customHeight:{...this.customHeight}}}fromJSON(e){let t=e.customHeight||{},o={...this.customHeight};this.customHeight={};for(let[r,i]of Object.entries(t)){let{sheetId:s,rowOrCol:n}=A(r);if(!s||n<0)continue;let a=this.model.getSheetInfo(s);!a||n>=a.rowCount||typeof i.isHide=="boolean"&&typeof i.len=="number"&&(this.customHeight[r]=i)}this.model.push({type:"customHeight",key:"",newValue:this.customHeight,oldValue:o})}undo(e){e.type==="customHeight"&&u(this,e,"undo")}redo(e){e.type==="customHeight"&&u(this,e,"redo")}hideRow(e,t){this.toggleHideRow(e,t,!0)}toggleHideRow(e,t,o){let r=this.model.getCurrentSheetId();for(let i=0;i<t;i++){let s=e+i,n=v(r,s),a=this.getRowHeight(s);if(a.isHide===o)continue;let h={...a,isHide:o};this.customHeight[n]=h,this.model.push({type:"customHeight",key:n,newValue:h,oldValue:this.customHeight[n]?a:l})}}unhideRow(e,t){this.toggleHideRow(e,t,!1)}getRowHeight(e,t){let o=t||this.model.getCurrentSheetId(),r=v(o,e),i=this.customHeight[r];return i?{...i}:{len:22,isHide:!1}}setRowHeight(e,t,o){let r=o||this.model.getCurrentSheetId(),i=v(r,e),s=this.getRowHeight(e,o);if(s.len===t)return;let n={...s},a=this.customHeight[i];n.len=t,this.customHeight[i]=n,this.model.push({type:"customHeight",key:i,newValue:n,oldValue:a||l})}deleteAll(e){let t=e||this.model.getCurrentSheetId();for(let[o,r]of Object.entries(this.customHeight)){let{sheetId:i}=A(o);i===t&&(delete this.customHeight[o],this.model.push({type:"customHeight",key:o,newValue:l,oldValue:r}))}}};var J=class{constructor(e){this.customWidth={};this.model=e}toJSON(){return{customWidth:{...this.customWidth}}}fromJSON(e){let t=e.customWidth||{},o={...this.customWidth};this.customWidth={};for(let[r,i]of Object.entries(t)){let{sheetId:s,rowOrCol:n}=A(r);if(!s||n<0)continue;let a=this.model.getSheetInfo(s);!a||n>=a.colCount||typeof i.isHide=="boolean"&&typeof i.len=="number"&&(this.customWidth[r]=i)}this.model.push({type:"customHeight",key:"",newValue:this.customWidth,oldValue:o})}undo(e){e.type==="customWidth"&&u(this,e,"undo")}redo(e){e.type==="customWidth"&&u(this,e,"redo")}hideCol(e,t){this.toggleHideCol(e,t,!0)}toggleHideCol(e,t,o){let r=this.model.getCurrentSheetId();for(let i=0;i<t;i++){let s=e+i,n=v(r,s),a=this.getColWidth(s);if(a.isHide===o)continue;let h={...a,isHide:o};this.customWidth[n]=h,this.model.push({type:"customWidth",key:n,newValue:{...h},oldValue:this.customWidth[n]?a:l})}}unhideCol(e,t){this.toggleHideCol(e,t,!1)}getColWidth(e,t){let o=t||this.model.getCurrentSheetId(),r=v(o,e),i=this.customWidth[r];return i?{...i}:{len:76,isHide:!1}}setColWidth(e,t,o){let r=o||this.model.getCurrentSheetId(),i=v(r,e),s=this.getColWidth(e,o);if(s.len===t)return;let n={...s,len:t},a=this.customWidth[i];this.customWidth[i]=n,this.model.push({type:"customWidth",key:i,newValue:n,oldValue:a||l})}deleteAll(e){let t=e||this.model.getCurrentSheetId();for(let[o,r]of Object.entries(this.customWidth)){let{sheetId:i}=A(o);i===t&&(delete this.customWidth[o],this.model.push({type:"customWidth",key:o,newValue:l,oldValue:r}))}}};var U=class{constructor(e){this.autoFilter={};this.model=e}toJSON(){return{autoFilter:{...this.autoFilter}}}fromJSON(e){let t=e.autoFilter||{},o={...this.autoFilter};for(let[r,i]of Object.entries(t))i.range.sheetId=r,this.model.validateRange(i.range)&&(this.autoFilter[r]=i);this.model.push({type:"autoFilter",key:"",newValue:{...this.autoFilter},oldValue:o})}undo(e){e.type==="autoFilter"&&u(this,e,"undo")}redo(e){e.type==="autoFilter"&&u(this,e,"redo")}deleteAll(e){let t=e||this.model.getCurrentSheetId(),o=this.autoFilter[t]?{...this.autoFilter[t]}:void 0;delete this.autoFilter[t],this.model.push({type:"autoFilter",key:t,newValue:l,oldValue:o})}addFilter(e){if(e.sheetId=e.sheetId||this.model.getCurrentSheetId(),!this.model.validateRange(e)||e.rowCount===1&&e.colCount===1)return;let t={range:e};this.autoFilter[e.sheetId]=t,this.model.push({type:"autoFilter",key:e.sheetId,newValue:{...t},oldValue:l})}deleteFilter(e){this.deleteAll(e)}updateFilter(e,t){let o=e||this.model.getCurrentSheetId(),r=Object.keys(t),i=this.autoFilter[o];for(let s of r)if(i[s]!==t[s]){let n=typeof i[s]=="object"&&i[s]?{...i[s]}:i[s];i[s]=t[s],this.model.push({type:"autoFilter",key:`${o}.${s}`,newValue:i[s],oldValue:n})}if(typeof t.col=="number"&&t.value){this.applyFilter(i.range,t);return}typeof t.col>"u"&&!t.value&&this.clearFilter(i.range)}clearFilter(e){let t=this.model.getSheetInfo(e.sheetId);if(!t)return;let o=e.row+1,r=e.rowCount===0?t.rowCount:e.row+e.rowCount;for(;o<r;o++)this.model.unhideRow(o,1)}applyFilter(e,t){let o=this.model.getSheetInfo(e.sheetId);if(!o)return;let{col:r,value:i}=t;if(i?.type==="normal"){let s=new Set(i.value),n=e.row+1,a=e.rowCount===0?o.rowCount:e.row+e.rowCount;for(;n<a;n++){let h=this.model.getCell({row:n,col:r,rowCount:1,colCount:1,sheetId:e.sheetId},!0),c=h?h.value:M;s.has(c)?this.model.unhideRow(n,1):this.model.hideRow(n,1)}}}getFilter(e){let t=e||this.model.getCurrentSheetId(),o=this.autoFilter[t];return o?{...o}:void 0}};var Se={computeFormulas:Ie},Me=class{constructor(e=Se){this.historyChange=(e,t)=>{let o=O(e);(t==="undo"||t==="redo")&&o.add(t),(o.has("row")||o.has("col"))&&this.computeViewSize(),this.render(o,e)};this.fromJSON=e=>{this.workbookManager.fromJSON(e),this.rangeMapManager.fromJSON(e),this.drawingsManager.fromJSON(e),this.definedNameManager.fromJSON(e),this.worksheetManager.fromJSON(e),this.mergeCellManager.fromJSON(e),this.rowManager.fromJSON(e),this.colManager.fromJSON(e),this.filterManager.fromJSON(e),this.worksheetManager.computeFormulas()};this.toJSON=()=>({...this.workbookManager.toJSON(),...this.rangeMapManager.toJSON(),...this.drawingsManager.toJSON(),...this.definedNameManager.toJSON(),...this.worksheetManager.toJSON(),...this.mergeCellManager.toJSON(),...this.rowManager.toJSON(),...this.colManager.toJSON(),...this.filterManager.toJSON()});this.getCell=(e,t)=>this.worksheetManager.getCell(e,t);this.historyRedo=e=>{for(let t of e)this.workbookManager.redo(t),this.rangeMapManager.redo(t),this.drawingsManager.redo(t),this.definedNameManager.redo(t),this.worksheetManager.redo(t),this.mergeCellManager.redo(t),this.rowManager.redo(t),this.colManager.redo(t),this.filterManager.redo(t);this.checkComputeFormulas(e)};this.historyUndo=e=>{for(let t of e)this.workbookManager.undo(t),this.rangeMapManager.undo(t),this.drawingsManager.undo(t),this.definedNameManager.undo(t),this.worksheetManager.undo(t),this.mergeCellManager.undo(t),this.rowManager.undo(t),this.colManager.undo(t),this.filterManager.undo(t);this.checkComputeFormulas(e)};if(!he()&&e===Se)throw new Error("worker must be provided in production or development environment");this.history=new F({undo:this.historyUndo,redo:this.historyRedo,change:this.historyChange,maxLength:1e3}),this.workbookManager=new W(this),this.rangeMapManager=new K(this),this.drawingsManager=new H(this),this.definedNameManager=new T(this),this.worksheetManager=new B(this,e),this.mergeCellManager=new _(this),this.rowManager=new x(this),this.colManager=new J(this),this.filterManager=new U(this)}push(...e){this.history.push(...e)}render(e,t=[]){e.size===0||e.size===1&&e.has("noHistory")||(ce(e,t),pe.emit("modelChange",{changeSet:e,commandList:t}))}checkComputeFormulas(e){let t=O(e);return(t.has("cellValue")||t.has("definedNames")||t.has("currentSheetId"))&&this.worksheetManager.computeFormulas(),t}async emitChange(e){let t=O(this.history.get());for(let o of e.keys())t.add(o);e.has("scroll")&&this.push({type:"scroll",key:"",newValue:"",oldValue:""}),e.has("antLine")&&this.push({type:"antLine",key:"",newValue:"",oldValue:""}),(t.has("cellValue")||t.has("definedNames")||t.has("currentSheetId"))&&this.worksheetManager.computeFormulas(),t.has("noHistory")?((t.has("row")||t.has("col"))&&this.computeViewSize(),this.render(t)):!t.has("undo")&&!t.has("redo")&&this.history.commit(),this.history.clear(!1)}getSheetList(){return this.workbookManager.getSheetList()}getActiveRange(e){let t=e||this.rangeMapManager.getActiveRange().range,o=this.getMergeCellList(t.sheetId);for(let r of o)if(me(t,r))return{range:{...r,sheetId:r.sheetId||this.getCurrentSheetId()},isMerged:!0};return{range:t,isMerged:!1}}setActiveRange(e){e.sheetId=e.sheetId||this.getCurrentSheetId();let{range:t}=this.getActiveRange(e);this.rangeMapManager.setActiveRange(t)}addSheet(){let e=this.workbookManager.addSheet();return this.worksheetManager.setWorksheet({},e.sheetId),this.workbookManager.setCurrentSheetId(e.sheetId),this.computeViewSize(),e}deleteSheet(e){let t=this.getNextSheetId(e);if(!t)return;let o=this.drawingsManager.getDrawingList(e);for(let r of o)this.drawingsManager.deleteDrawing(r.uuid);this.workbookManager.deleteSheet(e),this.worksheetManager.setWorksheet({},e),this.workbookManager.setCurrentSheetId(t)}updateSheetInfo(e,t){this.workbookManager.updateSheetInfo(e,t)}hideSheet(e){let t=this.getNextSheetId(e);t&&(this.workbookManager.hideSheet(e),this.workbookManager.setCurrentSheetId(t))}unhideSheet(e){e&&(this.workbookManager.unhideSheet(e),this.workbookManager.setCurrentSheetId(e))}renameSheet(e,t){this.workbookManager.renameSheet(e,t)}getSheetInfo(e){return this.workbookManager.getSheetInfo(e)}setCurrentSheetId(e){this.workbookManager.setCurrentSheetId(e)}getCurrentSheetId(){return this.workbookManager.getCurrentSheetId()}setCell(e,t,o){return this.worksheetManager.setCell(e,t,o)}setCellValue(e,t){return this.worksheetManager.setCellValue(e,t)}updateCellStyle(e,t){return this.worksheetManager.updateCellStyle(e,t)}getWorksheet(e){return this.worksheetManager.getWorksheet(e)}setWorksheet(e,t){this.worksheetManager.setWorksheet(e,t)}addCol(e,t,o=!1){if(t<=0)return;let r=this.getSheetInfo();if(r.colCount>=16384)return;let i=this.getCurrentSheetId(),s=r.colCount+t;this.workbookManager.updateSheetInfo({colCount:s},i),this.drawingsManager.addCol(e,t,o),this.worksheetManager.addCol(e,t,o)}deleteCol(e,t){if(t<=0)return;let o=this.getSheetInfo(),r=this.getCurrentSheetId(),i=o.colCount-t;this.workbookManager.updateSheetInfo({colCount:i},r),this.drawingsManager.deleteCol(e,t),this.worksheetManager.deleteCol(e,t)}hideCol(e,t){this.colManager.hideCol(e,t)}getColWidth(e,t){return this.colManager.getColWidth(e,t)}setColWidth(e,t,o){this.colManager.setColWidth(e,t,o)}addRow(e,t,o=!1){if(t<=0)return;let r=this.getSheetInfo();if(r.rowCount>=1048576)return;let i=r.rowCount+t;this.workbookManager.updateSheetInfo({rowCount:i}),this.drawingsManager.addRow(e,t,o),this.worksheetManager.addRow(e,t,o)}deleteRow(e,t){if(t<=0)return;let r=this.getSheetInfo().rowCount-t;this.workbookManager.updateSheetInfo({rowCount:r}),this.drawingsManager.deleteRow(e,t),this.worksheetManager.deleteRow(e,t)}hideRow(e,t){this.rowManager.hideRow(e,t)}unhideRow(e,t){this.rowManager.unhideRow(e,t)}unhideCol(e,t){this.colManager.unhideCol(e,t)}getRowHeight(e,t){return this.rowManager.getRowHeight(e,t)}setRowHeight(e,t,o){this.rowManager.setRowHeight(e,t,o)}canRedo(){return this.history.canRedo()}canUndo(){return this.history.canUndo()}undo(){this.history.undo()}redo(){this.history.redo()}applyCommandList(e){let{commandList:t=[],changeSet:o}=e;t.length!==0&&(o.has("undo")?this.historyUndo(t):this.historyRedo(t))}pasteRange(e,t){return this.worksheetManager.pasteRange(e,t)}deleteAll(e){this.rowManager.deleteAll(e),this.colManager.deleteAll(e),this.worksheetManager.deleteAll(e),this.mergeCellManager.deleteAll(e),this.drawingsManager.deleteAll(e),this.definedNameManager.deleteAll(e),this.filterManager.deleteAll(e)}getDefineNameList(){return this.definedNameManager.getDefineNameList()}getDefineName(e){return this.definedNameManager.getDefineName(e)}setDefineName(e,t){return this.definedNameManager.setDefineName(e,t)}checkDefineName(e){return this.definedNameManager.checkDefineName(e)}getDrawingList(e){return this.drawingsManager.getDrawingList(e)}addDrawing(...e){for(let t of e)this.drawingsManager.addDrawing(t)}updateDrawing(e,t){this.drawingsManager.updateDrawing(e,t)}deleteDrawing(e){this.drawingsManager.deleteDrawing(e)}getMergeCellList(e){return this.mergeCellManager.getMergeCellList(e)}addMergeCell(e,t=0){e.colCount===1&&e.rowCount===1||(e.sheetId=e.sheetId||this.getCurrentSheetId(),this.mergeCellManager.addMergeCell(e),this.worksheetManager.addMergeCell(e,t))}deleteMergeCell(e){this.mergeCellManager.deleteMergeCell(e)}validateRange(e){return this.rangeMapManager.validateRange(e)}validateDrawing(e){return this.drawingsManager.validateDrawing(e)}validateDefinedName(e){return this.definedNameManager.validateDefinedName(e)}getFilter(e){return this.filterManager.getFilter(e)}addFilter(e){this.filterManager.addFilter(e)}deleteFilter(e){this.filterManager.deleteFilter(e)}updateFilter(e,t){this.filterManager.updateFilter(e,t)}computeViewSize(){let e=we.get(),t=this.getSheetInfo();if(!t)return;let{width:o,height:r}=e;for(let i=0;i<t.colCount;i++)o+=this.getColWidth(i).len;for(let i=0;i<t.rowCount;i++)r+=this.getRowHeight(i).len;fe.set({width:o,height:r})}getNextSheetId(e){let t=e||this.getCurrentSheetId(),o=this.getSheetList(),r=o.findIndex(n=>n.sheetId===t);if(r<0)return"";let i=r===o.length-1,s=i?(r-1+o.length)%o.length:(r+1)%o.length;for(;s!==r&&o[s].isHide;)s=i?(s-1+o.length)%o.length:(s+1)%o.length;return o[s].sheetId}};export{Me as a,N as b};
//# sourceMappingURL=chunk-X2UY45N2.js.map
