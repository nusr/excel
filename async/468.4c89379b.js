"use strict";(self.webpackChunkexcel=self.webpackChunkexcel||[]).push([["468"],{891:function(e,t,l){let o;l.d(t,{FG:()=>A,El:()=>k,pX:()=>w,Kr:()=>g,fG:()=>p,JL:()=>y,Mx:()=>f,K:()=>v,Jv:()=>C});var r=l("3438"),n=l("9111"),i=l("173");class a{async render(e){let{controller:t}=this,l=t.getCurrentSheetId(),o=t.getSheetInfo(l);if(!o)return;let r=t.getCopyRange(),a=t.toJSON(),d={changeSet:e.changeSet,theme:(0,n.gh)(),canvasSize:n.Mn.get(),headerSize:n.qN.get(),currentSheetInfo:o,scroll:t.getScroll(l),range:t.getActiveRange().range,copyRange:r,currentMergeCells:t.getMergeCellList(l),customHeight:a.customHeight,customWidth:a.customWidth,sheetData:a.worksheets[l]||{},autoFilter:a.autoFilter[l]};this.controller.getHooks().worker.render(d,i.sj(this.renderCallback))}resize(){let{canvas:e}=this,{width:t,height:l}=n.Mn.get();e.style.width=`${t}px`,e.style.height=`${l}px`;this.controller.getHooks().worker.resize({width:t,height:l})}constructor(e,t){var l;(0,r._)(this,"controller",void 0),(0,r._)(this,"canvas",void 0),(0,r._)(this,"renderCallback",e=>{let{rowMap:t,colMap:l}=e,o=Object.keys(t);if(0!==Object.keys(l).length||0!==o.length)this.controller.batchUpdate(()=>{for(let[e,l]of Object.entries(t)){let t=parseInt(e,10);l!==this.controller.getRowHeight(t).len&&this.controller.setRowHeight(t,l)}for(let[e,t]of Object.entries(l)){let l=parseInt(e,10);t!==this.controller.getColWidth(l).len&&this.controller.setColWidth(l,t)}return!0},!0)}),this.controller=e,this.canvas=t;let o=null==t?void 0:null===(l=t.transferControlToOffscreen)||void 0===l?void 0:l.call(t),a=this.controller.getHooks().worker;if(o){let e={canvas:o,dpr:(0,n.uN)()};a.init(i.re(e,[e.canvas]))}}}var d=l("1320"),c=l("7620"),s=l("2773");function h(e){e.batchUpdate(()=>(E(e),e.setNextActiveCell("right"),m(e),!0))}function u(e){e.batchUpdate(()=>(E(e),e.setNextActiveCell("down"),m(e),!0))}function f(e,t,l){let o=e.getScroll(),{row:r,col:n}=o;if(o.top!==l){r=0;let t=l;for(;t>0;){let l=e.getRowHeight(r).len;if(l>t)break;t-=l,r++}}if(o.left!==t){n=0;let l=t;for(;l>0;){let t=e.getColWidth(n).len;if(t>l)break;l-=t,n++}}return{row:r,col:n}}function g(e){let t=`div[data-testid="${n.YC}${e}"]`,l=document.querySelector(t);l&&"function"==typeof l.scrollIntoView&&l.scrollIntoView()}function v(e,t){e.batchUpdate(()=>{let l=t.sheetId||e.getCurrentSheetId();l!==e.getCurrentSheetId()&&e.setCurrentSheetId(l);let o=e.getSheetInfo(l);if(!o||t.row<0||t.col<0||t.row>=o.rowCount||t.col>=o.colCount)return!0;let r=e.getScroll(l),i=e.computeCellPosition({row:r.row,col:r.col,colCount:1,rowCount:1,sheetId:l}),a=n.Mn.get(),d=n.qN.get(),{top:c,left:s}=e.computeCellPosition(t),h=i.top,u=i.left,f=i.top+a.height-d.height,g=i.left+a.width-d.width;if(c>=h&&c<f&&s>=u&&s<=g)return e.setActiveRange(t),!0;let v=e.computeCellPosition(e.getActiveRange().range);return w(e,s-v.left,c-v.top),e.setActiveRange(t),!0})}function y(e,t){let l=parseInt(n.pt.scrollBarContent,10),o=n.Mn.get(),r=n.EX.get(),i=r.height-o.height+200,a=r.width-o.width+200,d=o.height-l,c=o.width-l,s=Math.floor(t*d/i),h=Math.floor(e*c/a);return{maxHeight:i,maxWidth:a,maxScrollHeight:d,maxScrollWidth:c,scrollTop:s,scrollLeft:h}}function w(e,t,l){let o=e.getScroll(),{maxHeight:r,maxWidth:n,maxScrollHeight:i,maxScrollWidth:a}=y(o.left,o.top),d=o.top+Math.ceil(l);d<0?d=0:d>r&&(d=r);let c=o.left+Math.ceil(t);c<0?c=0:c>n&&(c=n);let{row:s,col:h}=f(e,c,d),u=Math.floor(d*i/r),g=Math.floor(c*a/n),v={row:s,col:h,top:d,left:c,scrollTop:u,scrollLeft:g};e.setScroll(v)}function m(e){let t=e.getActiveRange().range,l={row:t.row,col:t.col,colCount:1,rowCount:1,sheetId:""},o=e.computeCellPosition(l),r=e.getCellSize(l),i=n.Mn.get(),a=e.getScroll(),d=e.getSheetInfo(e.getCurrentSheetId()),c=n.qN.get(),{maxHeight:s,maxWidth:h,maxScrollHeight:u,maxScrollWidth:f}=y(a.left,a.top);if(o.left+r.width+5>i.width&&a.col<=d.colCount-2){let t=a.left+e.getColWidth(a.col).len,l=Math.floor(t*f/h);e.setScroll({...a,col:a.col+1,left:t,scrollLeft:l})}if(o.left-c.width<i.left+5&&a.col>=1){let t=a.left-e.getColWidth(a.col).len,l=Math.floor(t*f/h);e.setScroll({...a,col:a.col-1,left:t,scrollLeft:l})}if(o.top+r.height+5>i.height&&a.row<=d.rowCount-2){let t=a.top+e.getRowHeight(a.row).len,l=Math.floor(t*u/s);e.setScroll({...a,row:a.row+1,top:t,scrollTop:l})}if(o.top-c.height<i.top+5&&a.row>=1){let t=a.top-e.getRowHeight(a.row).len,l=Math.floor(t*u/s);e.setScroll({...a,row:a.row-1,top:t,scrollTop:l})}}function p(){let e=document.activeElement;return!!e&&e.getAttribute("data-role")===n.ho||!1}function C(e){let t=document.activeElement,{range:l,isMerged:o}=e.getActiveRange(),r=e.getCell(l),i=t.value;"string"==typeof(null==r?void 0:r.value)&&(0,n.dM)(o,null==r?void 0:r.value)&&(i=i.replaceAll(n.A_,n.NJ)),e.setCellValue(i,l),t.value="",t.blur(),s.H_.setState({editorStatus:d.I.NONE})}function E(e){if(!!p())C(e)}let S=[{key:"Enter",modifierKey:[],handler:u},{key:"Tab",modifierKey:[],handler:h},{key:"ArrowDown",modifierKey:[(0,n.V5)()?"meta":"ctrl"],handler:e=>{if(!p())e.batchUpdate(()=>(E(e),w(e,0,n.EX.get().height),!0))}},{key:"ArrowUp",modifierKey:[(0,n.V5)()?"meta":"ctrl"],handler:e=>{if(!p())e.batchUpdate(()=>(E(e),w(e,0,-n.EX.get().height),!0))}},{key:"ArrowRight",modifierKey:[(0,n.V5)()?"meta":"ctrl"],handler:e=>{if(!p())e.batchUpdate(()=>(E(e),w(e,n.EX.get().width,0),!0))}},{key:"ArrowLeft",modifierKey:[(0,n.V5)()?"meta":"ctrl"],handler:e=>{if(!p())e.batchUpdate(()=>(E(e),w(e,-n.EX.get().width,0),!0))}},{key:"ArrowDown",modifierKey:[],handler:e=>{if(!p())u(e)}},{key:"ArrowUp",modifierKey:[],handler:e=>{if(!p())e.batchUpdate(()=>(E(e),e.setNextActiveCell("up"),m(e),!0))}},{key:"ArrowRight",modifierKey:[],handler:e=>{if(!p())h(e)}},{key:"ArrowLeft",modifierKey:[],handler:e=>{if(!p())e.batchUpdate(()=>(E(e),e.setNextActiveCell("left"),m(e),!0))}},{key:"b",modifierKey:[(0,n.V5)()?"meta":"ctrl"],handler:e=>{var t;if(p())return;let l=e.getCell(e.getActiveRange().range);e.updateCellStyle({isBold:!(null==l?void 0:null===(t=l.style)||void 0===t?void 0:t.isBold)},e.getActiveRange().range)}},{key:"i",modifierKey:[(0,n.V5)()?"meta":"ctrl"],handler:e=>{var t;if(p())return;let l=e.getCell(e.getActiveRange().range);e.updateCellStyle({isItalic:!(null==l?void 0:null===(t=l.style)||void 0===t?void 0:t.isItalic)},e.getActiveRange().range)}},{key:"5",modifierKey:[(0,n.V5)()?"meta":"ctrl"],handler:e=>{var t;if(p())return;let l=e.getCell(e.getActiveRange().range);e.updateCellStyle({isStrike:!(null==l?void 0:null===(t=l.style)||void 0===t?void 0:t.isStrike)},e.getActiveRange().range)}},{key:"u",modifierKey:[(0,n.V5)()?"meta":"ctrl"],handler:e=>{var t;if(p())return;let l=e.getCell(e.getActiveRange().range),o=null==l?void 0:null===(t=l.style)||void 0===t?void 0:t.underline,r=c.nI.NONE;r=void 0===o||o===c.nI.NONE?c.nI.SINGLE:c.nI.NONE,e.updateCellStyle({underline:r},e.getActiveRange().range)}},{key:"z",modifierKey:[(0,n.V5)()?"meta":"ctrl"],handler:e=>{e.undo()}},{key:"y",modifierKey:[(0,n.V5)()?"meta":"ctrl"],handler:e=>{e.redo()}}];function b(e){var t,l;let o=null==e?void 0:null===(l=e.target)||void 0===l?void 0:null===(t=l.tagName)||void 0===t?void 0:t.toLowerCase();return"input"===o||"textarea"===o}function k(e,t){function l(t){let l;if(b(t))return;let o=S.filter(e=>e.key===t.key);o.sort((e,t)=>t.modifierKey.length-e.modifierKey.length);for(let e of o)if(e.modifierKey.length>0){if(e.modifierKey.some(e=>t[`${e}Key`])){l=e;break}}else{l=e;break}if(l){t.preventDefault(),l.handler(e);return}if(!t.metaKey&&!t.ctrlKey)s.H_.setState({editorStatus:d.I.EDIT_CELL})}let o=(0,n.P2)(t=>{var l,o;("canvas"===(null==t?void 0:null===(o=t.target)||void 0===o?void 0:null===(l=o.tagName)||void 0===l?void 0:l.toLowerCase())||(0,n.h2)())&&w(e,t.deltaX,t.deltaY)},1e3/60);function r(t){if(!b(t))t.preventDefault(),e.paste(t)}function i(t){if(!b(t))t.preventDefault(),e.copy(t)}function a(t){if(!b(t))t.preventDefault(),e.cut(t)}function c(t){if(!b(t))(0,n.v)().then(t=>{let l,o=e.getCopyRange();if(t[n.qJ]){let o=t[n.qJ];l=!o.floatElementUuid&&o.range?o.range:void 0,e.setFloatElementUuid(o.floatElementUuid)}else e.setFloatElementUuid("");!(0,n.vZ)(l,o)&&(e.setCopyRange(l),n.TB.emit("modelChange",{changeSet:new Set(["cellStyle"])}))})}return window.addEventListener("resize",t),document.body.addEventListener("keydown",l),document.body.addEventListener("wheel",o),document.body.addEventListener("paste",r),document.body.addEventListener("copy",i),document.body.addEventListener("cut",a),window.addEventListener("focus",c),()=>{window.removeEventListener("resize",t),document.body.removeEventListener("keydown",l),document.body.removeEventListener("wheel",o),document.body.removeEventListener("paste",r),document.body.removeEventListener("copy",i),document.body.removeEventListener("cut",a),window.removeEventListener("focus",c)}}function A(e,t){return o?o:o=new a(e,t)}},2773:function(e,t,l){l.d(t,{MK:()=>h,c1:()=>c,gZ:()=>s,aj:()=>n,u1:()=>a,H_:()=>d,CF:()=>u,no:()=>g});var o=l("3438");class r{constructor(e){(0,o._)(this,"listeners",new Set),(0,o._)(this,"state",void 0),(0,o._)(this,"setState",(e,t)=>{Array.isArray(e)&&(t=!0);let l=!t&&e&&"object"==typeof e&&Object.entries(e).every(e=>{let[t,l]=e;return Object.is(this.state[t],l)});if(l)return l;if(!Object.is(this.state,e)){let l=this.state;for(let o of(this.state=t??("object"!=typeof e||null===e)?e:Object.assign({},this.state,e),this.listeners))o(this.state,l)}}),(0,o._)(this,"subscribe",e=>(this.listeners.add(e),()=>this.listeners.delete(e))),(0,o._)(this,"getSnapshot",()=>this.state),this.state=e}}let n=new r([]);var i=l("9111");let a=new r({value:"",displayValue:"",row:0,col:0,left:i.Bg,top:i.Bg,width:0,height:0,defineName:"",rowCount:1,colCount:1}),d=new r({editorStatus:l("1320").I.NONE,canRedo:!1,canUndo:!1,activeUuid:"",currentSheetId:"",isFilter:!1}),c=new r([]),s=new r({scrollTop:0,scrollLeft:0,showBottomBar:!1}),h=new r([]),u=new r([]);var f=l("7620");let g=new r({isBold:!1,isItalic:!1,isStrike:!1,fontColor:(0,i.pe)("contentColor"),fontSize:i.n5,fontFamily:"",fillColor:"",isWrapText:!1,underline:f.nI.NONE,verticalAlign:f._v.TOP,horizontalAlign:f.KM.LEFT,numberFormat:i.s8,isMergeCell:!1,mergeType:""})},1320:function(e,t,l){l.d(t,{D:function(){return n},I:function(){return i}});var o,r,n=((o={})[o.NONE=0]="NONE",o[o.VERTICAL=1]="VERTICAL",o[o.HORIZONTAL=2]="HORIZONTAL",o);var i=((r={})[r.NONE=0]="NONE",r[r.EDIT_CELL=1]="EDIT_CELL",r[r.EDIT_FORMULA_BAR=2]="EDIT_FORMULA_BAR",r)}}]);