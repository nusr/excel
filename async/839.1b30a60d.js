"use strict";(self.webpackChunkexcel=self.webpackChunkexcel||[]).push([["839"],{6403:function(e,t,l){l.r(t),l.d(t,{FormulaBarContainer:()=>g,default:()=>v});var a=l("2676"),r=l("5271"),n=l("1320");let o={"formula-bar-wrapper":"formula-bar-wrapper-uoSQes","defined-name":"defined-name-Q32jt3","defined-name-editor":"defined-name-editor-gw1261","formula-bar-editor-wrapper":"formula-bar-editor-wrapper-sgW9Rl","formula-bar-value":"formula-bar-value-lfLjRC",wrap:"wrap-BtKZwr",show:"show-AHiZnn","formula-editor":"formula-editor-fOgePg","edit-cell":"edit-cell-Gzz7xe"};var i=l("2773"),u=l("9111");function s(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],l={};return(null==e?void 0:e.isItalic)&&(l.fontStyle="italic"),(null==e?void 0:e.isBold)&&(l.fontWeight="bold"),(null==e?void 0:e.fontFamily)&&(l.fontFamily=null==e?void 0:e.fontFamily),(null==e?void 0:e.fontSize)&&!t&&(l.fontSize=null==e?void 0:e.fontSize),(null==e?void 0:e.fillColor)&&!t&&(l.backgroundColor=e.fillColor),(null==e?void 0:e.fontColor)&&!t&&(l.color=null==e?void 0:e.fontColor),(null==e?void 0:e.underline)&&(null==e?void 0:e.isStrike)?l.textDecorationLine="underline line-through":(null==e?void 0:e.underline)?l.textDecorationLine="underline":(null==e?void 0:e.isStrike)&&(l.textDecorationLine="line-through"),l}function d(e){return Math.max(Math.min(u.ku,e),1)}let c=(0,r.memo)(e=>{let{initValue:t,style:l,testId:s,isMergeCell:c,controller:f,className:m}=e,h=(0,r.useRef)(null),[g,v]=(0,r.useState)(1);(0,r.useEffect)(()=>{if(c)v(d(t.split(u.NJ).length));else{var e;v(d(Math.ceil(((null===(e=h.current)||void 0===e?void 0:e.scrollHeight)||20)/20)))}},[c,t]);let p=(0,r.useCallback)(e=>{if(e.stopPropagation(),"Enter"===e.key||"Tab"===e.key){let t=e.currentTarget.value,{range:l,isMerged:a}=f.getActiveRange(),r=f.getCell(l);"string"==typeof(null==r?void 0:r.value)&&(0,u.dM)(a,null==r?void 0:r.value)&&(t=t.replaceAll(u.A_,u.NJ)),f.batchUpdate(()=>(f.setCellValue(t,l),"Enter"===e.key?f.setNextActiveCell("down"):f.setNextActiveCell("right"),!0)),i.H_.setState({editorStatus:n.I.NONE}),e.currentTarget.value="",e.currentTarget.blur()}else v(d(Math.ceil(e.currentTarget.scrollHeight/20)))},[]);return(0,a.jsx)("textarea",{spellCheck:!0,autoFocus:!0,ref:h,style:l,maxLength:100*u.ac,"data-testid":s,"data-role":u.ho,onKeyDown:p,className:(0,u.dh)(o["formula-editor"],m),defaultValue:t,rows:g})});c.displayName="MultipleLineEditor";var f=l("891"),m=l("696");let h=(0,r.memo)(e=>{let{controller:t,displayName:l,defineName:n}=e,s=(0,r.useRef)(null),[d,c]=(0,r.useState)(l),h=(0,r.useSyncExternalStore)(i.CF.subscribe,i.CF.getSnapshot),g=(0,r.useMemo)(()=>h.map(e=>({disabled:!1,value:e,label:e})),[h]);(0,r.useEffect)(()=>{c(l)},[l]);let v=(0,r.useCallback)(e=>{if(e.stopPropagation(),"Enter"===e.key){var a;let r=e.currentTarget.value.trim().toLowerCase();if(null===(a=s.current)||void 0===a||a.blur(),!r){c(l);return}let n=t.checkDefineName(r);if(n){c(l),(0,f.K)(t,n);return}let o=(0,u.gx)(r,e=>{let l=t.getSheetList().find(t=>t.name===e);return(null==l?void 0:l.sheetId)||""}),i=t.getSheetInfo((null==o?void 0:o.sheetId)||t.getCurrentSheetId());if(o&&o.col<i.colCount&&o.row<i.rowCount){o.sheetId=o.sheetId||t.getCurrentSheetId(),c(l),(0,f.K)(t,o);return}u.Mz.test(r)&&r.length<=u.tO?t.setDefineName(t.getActiveRange().range,r):c(l)}},[l]),p=(0,r.useCallback)(e=>{c(e.target.value)},[]),C=(0,r.useCallback)(e=>{let l=t.checkDefineName(e);if(!!l)(0,f.K)(t,l)},[]);return(0,a.jsx)(m.EI,{testId:"formula-bar-name",value:n,data:g,onChange:C,className:o["defined-name"],children:(0,a.jsx)("input",{value:d,ref:s,spellCheck:!0,type:"text",onChange:p,className:o["defined-name-editor"],onKeyDown:v,maxLength:8*u.ac,"data-testid":"formula-bar-name-input"})})});h.displayName="DefineName";let g=(0,r.memo)(e=>{let{controller:t}=e,l=(0,r.useSyncExternalStore)(i.u1.subscribe,i.u1.getSnapshot),d=(0,r.useSyncExternalStore)(i.no.subscribe,i.no.getSnapshot),{editorStatus:f}=(0,r.useSyncExternalStore)(i.H_.subscribe,i.H_.getSnapshot),m=(0,r.useMemo)(()=>l.defineName||(0,u.$b)({row:l.row,col:l.col,rowCount:1,colCount:1,sheetId:""}),[l.defineName,l.col,l.row]),g=(0,r.useCallback)(()=>{i.H_.setState({editorStatus:n.I.EDIT_FORMULA_BAR})},[]),v=(0,r.useMemo)(()=>s(d),[d]);return(0,a.jsxs)("div",{className:o["formula-bar-wrapper"],"data-testid":"formula-bar",children:[(0,a.jsx)(h,{controller:t,displayName:m,defineName:l.defineName}),(0,a.jsxs)("div",{className:o["formula-bar-editor-wrapper"],children:[f!==n.I.NONE&&(0,a.jsx)(c,{initValue:l.value,controller:t,style:function(e,t,l){if(t===n.I.NONE)return;let a=t===n.I.EDIT_FORMULA_BAR,r=s(l,a);return a?r:{...r,top:e.top,left:e.left,width:e.width,height:e.height}}(l,f,d),testId:"formula-editor",isMergeCell:d.isMergeCell,className:f===n.I.EDIT_CELL?o["edit-cell"]:""}),(0,a.jsx)("div",{className:(0,u.dh)(o["formula-bar-value"],{[o.show]:f!==n.I.EDIT_FORMULA_BAR,[o.wrap]:d.isMergeCell&&l.displayValue.includes(u.A_)}),style:v,onClick:g,"data-testid":"formula-editor-trigger",children:l.displayValue})]})]})});g.displayName="FormulaBarContainer";let v=g}}]);