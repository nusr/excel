"use strict";(self.webpackChunkexcel=self.webpackChunkexcel||[]).push([["910"],{6974:function(t,e,l){l.r(e),l.d(e,{CanvasContainer:()=>G,default:()=>W});var o,n=l("2676"),a=l("5271"),r=l("9111");let i={"canvas-container":"canvas-container-dd7tBp",canvasContainer:"canvas-container-dd7tBp","vertical-scroll-bar":"vertical-scroll-bar-kFRuSp",verticalScrollBar:"vertical-scroll-bar-kFRuSp","vertical-scroll-bar-content":"vertical-scroll-bar-content-n4pRzY",verticalScrollBarContent:"vertical-scroll-bar-content-n4pRzY","horizontal-scroll-bar":"horizontal-scroll-bar-szJnfx",horizontalScrollBar:"horizontal-scroll-bar-szJnfx","horizontal-scroll-bar-content":"horizontal-scroll-bar-content-Nz33fO",horizontalScrollBarContent:"horizontal-scroll-bar-content-Nz33fO","context-menu":"context-menu-MYU7P5",contextMenu:"context-menu-MYU7P5","bottom-bar":"bottom-bar-Zne5Rn",bottomBar:"bottom-bar-Zne5Rn",active:"active-ZPeLwr","bottom-bar-text":"bottom-bar-text-j_rkfd",bottomBarText:"bottom-bar-text-j_rkfd","bottom-bar-input":"bottom-bar-input-v2pqpZ",bottomBarInput:"bottom-bar-input-v2pqpZ","add-button":"add-button-Ubod1o",addButton:"add-button-Ubod1o"};var s=l("2773"),c=l("1320"),d=l("891");function u(t,e,l){let o=t.getScroll(),{maxHeight:n,maxScrollHeight:a,maxScrollWidth:r,maxWidth:i}=(0,d.JL)(o.left,o.top),s=o.scrollTop+Math.ceil(l),c=o.scrollLeft+Math.ceil(e);s<0?s=0:s>a&&(s=a),c<0?c=0:c>r&&(c=r);let u=Math.floor(n*s/a),h=Math.floor(i*c/r),{row:m,col:g}=(0,d.Mx)(t,h,u),p={top:u,left:h,row:m,col:g,scrollLeft:c,scrollTop:s},f=t.getActiveRange().range;return p.row!=o.row&&(f.row=p.row),p.col!==o.col&&(f.col=p.col),t.setScroll(p),p}let h={prevPageX:0,prevPageY:0,scrollStatus:c.D.NONE},m=(0,a.memo)(t=>{let{controller:e}=t,l=(0,a.useRef)({...h}),{scrollLeft:o,scrollTop:r}=(0,a.useSyncExternalStore)(s.gZ.subscribe,s.gZ.getSnapshot),[d]=(0,a.useMemo)(()=>{function t(){l.current={...h},n(!1)}function o(t){if(t.buttons<=0){n(!1);return}if(l.current.scrollStatus!==c.D.NONE)l.current.scrollStatus===c.D.VERTICAL?(u(e,0,t.clientY-l.current.prevPageY),l.current.prevPageY=t.clientY):l.current.scrollStatus===c.D.HORIZONTAL&&(u(e,t.clientX-l.current.prevPageX,0),l.current.prevPageX=t.clientX)}function n(e){let l=e?document.addEventListener:document.removeEventListener;l("pointermove",o),l("pointerup",t)}return[n]},[]);(0,a.useEffect)(()=>d,[d]);let m=(0,a.useCallback)((t,e)=>{if(!(t.buttons<=0))d(!0),l.current.prevPageX=t.clientX,l.current.prevPageY=t.clientY,l.current.scrollStatus=e},[d]),g=(0,a.useCallback)(t=>{m(t,c.D.VERTICAL)},[m]),p=(0,a.useCallback)(t=>{m(t,c.D.HORIZONTAL)},[d]);return(0,n.jsxs)(a.Fragment,{children:[(0,n.jsx)("div",{className:i["vertical-scroll-bar"],"data-testid":"vertical-scroll-bar",onPointerDown:g,children:(0,n.jsx)("div",{className:i["vertical-scroll-bar-content"],style:{transform:`translateY(${r}px)`},"data-testid":"vertical-scroll-bar-content"})}),(0,n.jsx)("div",{className:i["horizontal-scroll-bar"],"data-testid":"horizontal-scroll-bar",onPointerDown:p,children:(0,n.jsx)("div",{className:i["horizontal-scroll-bar-content"],style:{transform:`translateX(${o}px)`},"data-testid":"horizontal-scroll-bar-content"})})]})});m.displayName="ScrollBar";var g=l("696"),p=l("15"),f=l("88");let v=(0,a.memo)(t=>{let{controller:e,top:l,left:o,hideContextMenu:c}=t,{row:d,col:u,colCount:h,rowCount:m}=(0,a.useSyncExternalStore)(s.u1.subscribe,s.u1.getSnapshot),v=(0,p.O8)(c),{style:x,position:b}=(0,a.useMemo)(()=>(function(t,e){let l=r.qN.get(),o=r.Mn.get(),n=3,a=60,i=t-o.top,s=e-o.left;i<l.height&&s<l.width?n=2:i<l.height?(n=0,a=120):s<l.width&&(n=1,a=120);let c=t,d=e,u=o.height+o.top;return c+a>u&&(c=u-a-18),d+110>o.width&&(d=o.width-110-18),{style:{top:c,left:d},position:n}})(l,o),[l,o]),w=t=>{let l=t?e.getRowHeight(d).len:e.getColWidth(u).len;(0,g.um)({visible:!0,title:t?(0,f.$)("row-height"):(0,f.$)("column-width"),testId:"context-menu-width-height-dialog",children:(0,n.jsx)("input",{type:"number",min:0,max:1e4,style:{width:"200px"},defaultValue:l,onChange:t=>{let e=parseInt(t.target.value,10);!isNaN(e)&&(l=e<0?0:l>1e4?1e4:e),t.stopPropagation()},"data-testid":"context-menu-width-height-dialog-input"}),onOk:()=>{if(l<0)return g.Am.error((0,f.$)("greater-than-zero"));t?e.batchUpdate(()=>{for(let t=0;t<m;t++)e.setRowHeight(d+t,l);return!0}):e.batchUpdate(()=>{for(let t=0;t<h;t++)e.setColWidth(u+t,l);return!0}),c()},onCancel:()=>{c()}})};return(0,n.jsxs)("div",{className:i["context-menu"],"data-testid":"context-menu",style:x,ref:v,children:[(0,n.jsx)(g.zx,{onClick:()=>{c(),e.setFloatElementUuid(""),e.copy()},testId:"context-menu-copy",children:(0,f.$)("copy")}),(0,n.jsx)(g.zx,{onClick:()=>{c(),e.setFloatElementUuid(""),e.cut()},testId:"context-menu-cut",children:(0,f.$)("cut")}),(0,n.jsx)(g.zx,{testId:"context-menu-paste",onClick:()=>{c(),e.paste()},children:(0,f.$)("paste")}),(1===b||3===b)&&(0,n.jsxs)(a.Fragment,{children:[(0,n.jsx)(g.zx,{testId:"context-menu-insert-row-above",onClick:()=>{c(),e.addRow(d,m,!0)},children:(0,f.$)("insert-row-above")}),(0,n.jsx)(g.zx,{testId:"context-menu-insert-row-below",onClick:()=>{c(),e.addRow(d,m)},children:(0,f.$)("insert-row-below")})]}),(0===b||3===b)&&(0,n.jsxs)(a.Fragment,{children:[(0,n.jsx)(g.zx,{testId:"context-menu-insert-column-left",onClick:()=>{c(),e.addCol(u,h)},children:(0,f.$)("insert-column-left")}),(0,n.jsx)(g.zx,{testId:"context-menu-insert-column-right",onClick:()=>{c(),e.addCol(u,h,!0)},children:(0,f.$)("insert-column-right")})]}),2===b&&(0,n.jsx)(g.zx,{testId:"context-menu-delete",onClick:()=>{c(),e.deleteAll(e.getCurrentSheetId())},children:(0,f.$)("delete")}),0===b&&(0,n.jsxs)(a.Fragment,{children:[(0,n.jsx)(g.zx,{testId:"context-menu-delete-column",onClick:()=>{c(),e.deleteCol(u,h)},children:(0,f.$)("delete-columns")}),(0,n.jsx)(g.zx,{testId:"context-menu-hide-column",onClick:()=>{c(),e.hideCol(u,h)},children:(0,f.$)("hide-columns")}),(0,n.jsx)(g.zx,{testId:"context-menu-unhide-column",onClick:()=>{c(),e.unhideCol(u,h)},children:(0,f.$)("unhide-columns")}),(0,n.jsx)(g.zx,{testId:"context-menu-column-width",onClick:()=>{w(!1)},children:(0,f.$)("column-width")})]}),1===b&&(0,n.jsxs)(a.Fragment,{children:[(0,n.jsx)(g.zx,{testId:"context-menu-delete-row",onClick:()=>{c(),e.deleteRow(d,m)},children:(0,f.$)("delete-rows")}),(0,n.jsx)(g.zx,{testId:"context-menu-hide-row",onClick:()=>{c(),e.hideRow(d,m)},children:(0,f.$)("hide-rows")}),(0,n.jsx)(g.zx,{testId:"context-menu-unhide-row",onClick:()=>{c(),e.unhideRow(d,m)},children:(0,f.$)("unhide-rows")}),(0,n.jsx)(g.zx,{testId:"context-menu-row-height",onClick:()=>{w(!0)},children:(0,f.$)("row-height")})]})]})});v.displayName="CanvasContextMenu";var x=l("7620"),b=l("7403"),w=l("6604");let C=(t,e)=>{if((t.has("rangeMap")||t.has("cellStyle")||t.has("cellValue")||t.has("currentSheetId")||t.has("mergeCells"))&&!function(t){var e,l;let{top:o}=r.Mn.get(),{range:n,isMerged:a}=t.getActiveRange(),i=n.sheetId||t.getCurrentSheetId(),c=t.getCell(n),d=t.getDefineName({row:n.row,col:n.col,rowCount:1,colCount:1,sheetId:i}),u=t.getCellSize(n),h=t.computeCellPosition(n);h.top=o+h.top;let m=(null==c?void 0:null===(e=c.style)||void 0===e?void 0:e.fontFamily)??"";if(!m){let t="";for(let e of s.c1.getSnapshot())if(!e.disabled){t=String(e.value);break}m=t}let{isBold:g=!1,isItalic:p=!1,isStrike:f=!1,fontSize:v=r.n5,fontColor:w=(0,r.pe)("contentColor"),fillColor:C="",isWrapText:S=!1,underline:j=x.nI.NONE,horizontalAlign:y,verticalAlign:z}=(null==c?void 0:c.style)||{},k=(null==c?void 0:null===(l=c.style)||void 0===l?void 0:l.numberFormat)||r.s8,I=k===r.s8&&"number"==typeof(null==c?void 0:c.value),N=y;void 0===y&&I&&(N=x.KM.RIGHT);let R=(0,b.Y4)(null==c?void 0:c.value,k),P="";if((0,b.V5)(k)||k===(0,r._D)(10))P=R;else{let t=(null==c?void 0:c.value)??"";R=P="boolean"==typeof t?t.toString().toUpperCase():String(t)}let $="";a&&(R.includes(r.NJ)?($=String(x.WI.MERGE_CONTENT),R=R.replaceAll(r.NJ,r.A_)):$=String(x.WI.MERGE_CENTER)),s.u1.setState({top:h.top,left:h.left,width:u.width,height:u.height,row:n.row,col:n.col,rowCount:n.rowCount,colCount:n.colCount,value:(null==c?void 0:c.formula)||P,defineName:d,displayValue:(null==c?void 0:c.formula)||R}),s.no.setState({isBold:g,isItalic:p,isStrike:f,fontColor:w,fontSize:v,fontFamily:m,fillColor:C,isWrapText:S,underline:j,numberFormat:k,isMergeCell:a,mergeType:$,horizontalAlign:N,verticalAlign:z})}(e),t.has("workbook")){let t=e.getSheetList().map(t=>({sheetId:t.sheetId,name:t.name,isHide:t.isHide,tabColor:t.tabColor||""}));s.aj.setState(t)}let l={canRedo:e.canRedo(),canUndo:e.canUndo()};if(t.has("currentSheetId")&&(l.activeUuid="",l.currentSheetId=e.getCurrentSheetId(),l.isFilter=!!e.getFilter()),t.has("autoFilter")&&(l.isFilter=!!e.getFilter()),s.H_.setState(l),t.has("scroll")){let t=e.getScroll(),l=r.Mn.get(),o=t.scrollTop/l.height>=.91;s.gZ.setState({scrollLeft:t.scrollLeft,scrollTop:t.scrollTop,showBottomBar:o})}if(t.has("definedNames")){let t=e.getDefineNameList().map(t=>t.name);s.CF.setState(t)}if(t.has("drawings")||t.has("cellValue")||t.has("row")||t.has("col")||t.has("currentSheetId")||t.has("scroll")){let t=e.getScroll(),l=r.Mn.get(),o=t.left,n=t.top,a=l.width+o,i=l.height+n,c=e.getDrawingList(e.getCurrentSheetId()),d=[];for(let t of c){let l=e.computeCellPosition({row:t.fromRow,col:t.fromCol,colCount:1,rowCount:1,sheetId:""}),s=l.top+t.marginY,c=l.left+t.marginX;if(s>n&&s<i||c>o&&c<a||s+t.height>n&&s+t.height<i||c+t.width>o&&c+t.width<a){let l={...t,top:s,left:c,labels:[],datasets:[]};if("chart"===t.type){let o=function(t,e){let{row:l,col:o,rowCount:n,colCount:a,sheetId:i}=t,s={labels:[],datasets:[]};for(let t=l,c=1,d=l+n;t<d;t++,c++){if(e.getRowHeight(t).len===r.Hl)continue;let l=[];for(let n=o,s=o+a;n<s;n++){let o=e.getCell({row:t,col:n,rowCount:1,colCount:1,sheetId:i});if(!!o)l.push((0,r.p3)(o.value)[1])}l.length>0&&s.datasets.push({label:`Series${c}`,data:l})}return s.datasets[0]&&s.datasets[0].data.length>0&&(s.labels=Array.from({length:s.datasets[0].data.length}).fill("").map((t,e)=>String(e+1))),s}(t.chartRange,e);l.labels=o.labels,l.datasets=o.datasets}d.push(l)}}s.MK.setState(d)}t.has("currentSheetId")&&setTimeout(()=>{(0,d.Kr)(e.getCurrentSheetId())},0)},S=(0,a.memo)(t=>{let{controller:e}=t,[l,o]=(0,a.useState)(10),{showBottomBar:c}=(0,a.useSyncExternalStore)(s.gZ.subscribe,s.gZ.getSnapshot);return(0,n.jsxs)("div",{className:(0,r.dh)(i["bottom-bar"],{[i.active]:c}),"data-testid":"canvas-bottom-bar",children:[(0,n.jsx)("div",{className:i["bottom-bar-text"],children:(0,f.$)("add-at-the-bottom")}),(0,n.jsx)("input",{value:l,onChange:t=>{t.stopPropagation();let e=parseInt(t.target.value,10);!isNaN(e)&&(e<1?o(1):e>r.xl?o(r.xl):o(e))},type:"number",min:1,max:r.xl,"data-testid":"canvas-bottom-bar-input",className:i["bottom-bar-input"]}),(0,n.jsx)("div",{className:i["bottom-bar-text"],children:(0,f.$)("rows")}),(0,n.jsx)(g.zx,{testId:"canvas-bottom-bar-add",className:i["add-button"],onClick:()=>{let t=e.getSheetInfo(e.getCurrentSheetId());e.addRow(t.rowCount-1,l);let o=r.EX.get();(0,d.pX)(e,0,o.height)},children:(0,f.$)("add")})]})});S.displayName="BottomBar";let j={"float-element":"float-element-vYCtqp",active:"active-Sdbf8O","float-element-mask":"float-element-mask-oJ3M8p","context-menu":"context-menu-wfCJYX",image:"image-FNZH39","resize-handler":"resize-handler-SlvqWc","scale-dot":"scale-dot-CF0oa6","rotate-icon":"rotate-icon-KmfmPP",top:"top-BRhfLN",bottom:"bottom-BPVGlf","top-right":"top-right-Anfzyt","top-left":"top-left-WGvI9f","bottom-right":"bottom-right-t5n0Dk","bottom-left":"bottom-left-PiF9rf",right:"right-YGZFqM",left:"left-Es4Dcl",rotate:"rotate-iEcUF7","chart-type-select":"chart-type-select-xX00XB"},y=(0,a.memo)(t=>{let{controller:e,menuLeft:l,menuTop:o,uuid:i,type:s,chartType:c,title:d,resetResize:u,hideContextMenu:h,originHeight:m,originWidth:v,width:x,height:b}=t,w=(0,p.O8)(h);return(0,n.jsxs)("div",{className:j["context-menu"],"data-testid":"float-element-context-menu",ref:w,style:{top:o,left:l},children:[(0,n.jsx)(g.zx,{testId:"float-element-context-menu-copy",onClick:()=>{h(),e.setFloatElementUuid(i),e.copy()},children:(0,f.$)("copy")}),(0,n.jsx)(g.zx,{testId:"float-element-context-menu-cut",onClick:()=>{h(),e.setFloatElementUuid(i),e.cut()},children:(0,f.$)("cut")}),(0,n.jsx)(g.zx,{testId:"float-element-context-menu-paste",onClick:()=>{h(),e.paste()},children:(0,f.$)("paste")}),(0,n.jsx)(g.zx,{testId:"float-element-context-menu-duplicate",onClick:()=>{h(),e.setFloatElementUuid(i),e.copy(),e.paste(),e.setFloatElementUuid("")},children:(0,f.$)("duplicate")}),"chart"===s&&(0,n.jsxs)(a.Fragment,{children:[(0,n.jsx)(g.zx,{onClick:()=>{let l=(0,r.$b)(t.chartRange,"absolute",t=>{var l;return(null===(l=e.getSheetInfo(t))||void 0===l?void 0:l.name)||""});(0,g.um)({visible:!0,title:(0,f.$)("edit-data-source"),testId:"dialog-select-data",children:(0,n.jsx)("input",{type:"text",spellCheck:!0,style:{width:"400px"},defaultValue:l,onChange:t=>{l=t.target.value.trim(),t.stopPropagation()},maxLength:2*r.ac,"data-testid":"dialog-select-data-input"}),onOk:()=>{if(!l)return g.Am.error((0,f.$)("reference-is-empty"),"select-data-empty-toast");let o=e.getSheetList(),n=(0,r.gx)(l,t=>{var e;return(null===(e=o.find(e=>e.name===t))||void 0===e?void 0:e.sheetId)||""});if(!n||!e.validateRange(n)||t.chartRange&&(0,r.Hf)(n,t.chartRange))return g.Am.error((0,f.$)("reference-is-not-valid"),"select-data-invalid-toast");n.sheetId=n.sheetId||e.getCurrentSheetId(),e.updateDrawing(i,{chartRange:n}),h()},onCancel:()=>{h()}})},testId:"float-element-context-menu-select-data",children:(0,f.$)("select-data")}),(0,n.jsx)(g.zx,{onClick:()=>{let t=d.trim();(0,g.um)({visible:!0,title:(0,f.$)("change-chart-title"),testId:"dialog-change-chart-title",children:(0,n.jsx)("input",{type:"text",spellCheck:!0,style:{width:"200px"},defaultValue:t,onChange:e=>{t=e.target.value.trim(),e.stopPropagation()},maxLength:r.ac,"data-testid":"dialog-change-chart-title-input"}),onOk:()=>{if(!t)return g.Am.error((0,f.$)("the-value-cannot-be-empty"),"change-chart-title-toast");e.updateDrawing(i,{title:t}),h()},onCancel:()=>{h()}})},testId:"float-element-context-menu-change-chart-title",children:(0,f.$)("change-chart-title")}),(0,n.jsx)(g.zx,{onClick:()=>{let t=c;(0,g.um)({title:(0,f.$)("change-chart-type"),testId:"dialog-change-chart-type",visible:!0,children:(0,n.jsx)(g.Ph,{className:j["chart-type-select"],defaultValue:t,data:r.dP.map(t=>({...t,disabled:!1})),onChange:e=>t=String(e),testId:"dialog-change-chart-type-select"}),onCancel(){h()},onOk(){e.updateDrawing(i,{chartType:t}),h()}})},testId:"float-element-context-menu-change-chart-type",children:(0,f.$)("change-chart-type")})]}),(0,n.jsx)(g.zx,{testId:"float-element-context-menu-save-as-picture",onClick:()=>{h();let t=e.getDrawingList(e.getCurrentSheetId()).find(t=>t.uuid===i);if(!!t){if("floating-picture"===s&&t.imageSrc){let e=(0,r.jo)(t.imageSrc);(0,r.po)(t.imageSrc,t.title+e.ext)}if("chart"===s){let e=document.querySelector(`canvas[data-uuid="${i}"]`);if(!e)return;let l=e.toDataURL();(0,r.po)(l,t.title+".png")}}},children:(0,f.$)("save-as-picture")}),(0,n.jsx)(g.zx,{disabled:x===v&&b===m,testId:"float-element-context-reset-size",onClick:()=>{h(),e.updateDrawing(i,{height:m,width:v}),u({width:v,height:m})},children:(0,f.$)("reset-size")}),(0,n.jsx)(g.zx,{testId:"float-element-context-menu-delete",onClick:()=>{h(),e.deleteDrawing(i)},children:(0,f.$)("delete")})]})});y.displayName="FloatElementContextMenu";var z=((o={}).top="top",o.topRight="top-right",o.topLeft="top-left",o.bottom="bottom",o.bottomLeft="bottom-left",o.bottomRight="bottom-right",o.left="left",o.right="right",o.rotate="rotate",o.active="active",o);let k={resizePosition:"",moveStartX:0,moveStartY:0,activeUuid:"",position:{width:-1,height:-1,imageAngle:0,top:-1,left:-1}};function I(t,e){let l=r.qN.get(),o=r.Mn.get(),n=l.height,a=l.width;return t<n&&(t=n),t>o.height&&(t=o.height),e<a&&(e=a),e>o.width&&(e=o.width),{top:t,left:e}}var N=l("8719");let R="chart-BNkpQj";function P(t){let{height:e=400,width:l=200,type:o,options:i,plugins:s,data:c,redraw:d,updateMode:u,uuid:h}=t,m=(0,a.useRef)(null),g=(0,a.useRef)();(0,a.useEffect)(()=>{if(!!g.current)d?(f(),setTimeout(p)):(!(0,r.vZ)(g.current.data,c)&&(g.current.data=c),i&&!(0,r.vZ)(g.current.options,i)&&(g.current.options=i),g.current.update(u))},[d,u,c,i]),(0,a.useEffect)(()=>(p(),()=>f()),[]);let p=()=>{if(!!m.current)g.current=new N.kL(m.current,{type:o,data:c,options:i,plugins:s})},f=()=>{g.current&&(g.current.destroy(),g.current=null)};return(0,n.jsx)("canvas",{ref:m,role:"img",height:e,width:l,"data-uuid":h,className:R,"data-testid":"float-element-chart"})}function $(t,e){return N.kL.register(e),(0,a.memo)(e=>(0,n.jsx)(P,{...e,type:t}))}N.kL.register(N.uw,N.f$,N.l7,N.od,N.jn,N.ZL,N.qi,N.Dx,N.u,N.De);let M=$("line",N.ST),D=$("bar",N.vn),E=$("pie",N.tt),F=$("scatter",N.ho),L=$("radar",N.Xi),A=$("polarArea",N.CV),Y={elements:{line:{borderWidth:3}}},X=[N.Gu];function B(t){let e=Math.floor(t)%r.i6.length;return r.i6[e]}let U=(0,a.memo)(t=>{let e,{chartType:l,width:o,height:a,labels:i,datasets:s,uuid:c,title:d}=t,u={labels:i,datasets:s.map((t,e)=>({...t,backgroundColor:B(5*e)}))},h={width:o,height:a,redraw:!1,uuid:c,options:{plugins:{title:{display:!0,text:d,padding:{top:16,bottom:16},font:{size:14,weight:"normal"}},legend:{display:!0,position:"bottom"}}}};if("line"===l)e=(0,n.jsx)(M,{...h,data:u});else if("bar"===l)e=(0,n.jsx)(D,{...h,data:u});else if("pie"===l)e=(0,n.jsx)(E,{...h,data:u});else if("radar"===l){let t={labels:i,datasets:s.map((t,e)=>{let l=B(5*e+4);return{...t,fill:!0,borderColor:l,pointBackgroundColor:l,pointBorderColor:(0,r.pe)("white"),pointHoverBackgroundColor:(0,r.pe)("white"),pointHoverBorderColor:l,backgroundColor:B(5*e)}})};e=(0,n.jsx)(L,{...h,options:Y,plugins:X,data:t})}else if("scatter"===l){let t={datasets:s.map((t,e)=>({label:t.label,data:t.data.map((t,e)=>({y:t,x:(0,r.p3)(i[e])[1]})),backgroundColor:B(5*e)}))};e=(0,n.jsx)(F,{...h,data:t})}else if("polarArea"===l){let t={labels:i,datasets:s.map(t=>{let e=Array.from({length:t.data.length}).fill("").map((t,e)=>B(5*e));return{...t,backgroundColor:e}})};e=(0,n.jsx)(A,{...h,data:t})}else console.error("not support chart type",l);return e});U.displayName="Chart";let T=(0,a.memo)(t=>{let e,{top:l,left:o,active:i,width:s,height:c,type:d,imageAngle:u=0,resetResize:h,pointerDown:m,resizeDown:p}=t,[f,v]=(0,a.useState)({top:r.Bg,left:r.Bg}),x=(0,a.useCallback)(t=>{t.preventDefault(),t.stopPropagation(),v({top:t.clientY,left:t.clientX})},[]),b=(0,a.useCallback)(()=>{v({top:r.Bg,left:r.Bg})},[]);return("floating-picture"===d?e=(0,n.jsx)("img",{title:t.title,alt:t.title,src:t.imageSrc,className:j.image,"data-uuid":t.uuid,"data-testid":"float-element-image"}):"chart"===d&&(e=(0,n.jsx)(U,{...t})),e)?(0,n.jsxs)(a.Fragment,{children:[(0,n.jsxs)("div",{onPointerDown:m,onContextMenu:x,className:(0,r.dh)(j["float-element"],{[j.active]:i}),style:{transform:`translateX(${o}px) translateY(${l}px) ${"floating-picture"===d?`rotate(${u}deg)`:""} `,width:s,height:c},"data-testid":"float-element",children:[e,i&&(0,n.jsxs)(a.Fragment,{children:[(0,n.jsx)("div",{className:(0,r.dh)(j["resize-handler"],j.top),"data-position":z.top,onPointerDown:p,"data-testid":"float-element-resize-top",children:(0,n.jsx)("div",{className:j["scale-dot"]})}),(0,n.jsx)("div",{className:(0,r.dh)(j["resize-handler"],j["top-right"]),"data-position":z.topRight,onPointerDown:p,"data-testid":"float-element-resize-top-right",children:(0,n.jsx)("div",{className:j["scale-dot"]})}),(0,n.jsx)("div",{className:(0,r.dh)(j["resize-handler"],j["top-left"]),"data-position":z.topLeft,onPointerDown:p,"data-testid":"float-element-resize-top-left",children:(0,n.jsx)("div",{className:j["scale-dot"]})}),(0,n.jsx)("div",{className:(0,r.dh)(j["resize-handler"],j.left),"data-position":z.left,onPointerDown:p,"data-testid":"float-element-resize-left",children:(0,n.jsx)("div",{className:j["scale-dot"]})}),(0,n.jsx)("div",{className:(0,r.dh)(j["resize-handler"],j.right),"data-position":z.right,onPointerDown:p,"data-testid":"float-element-resize-right",children:(0,n.jsx)("div",{className:j["scale-dot"]})}),(0,n.jsx)("div",{className:(0,r.dh)(j["resize-handler"],j["bottom-right"]),"data-position":z.bottomRight,onPointerDown:p,"data-testid":"float-element-resize-bottom-right",children:(0,n.jsx)("div",{className:j["scale-dot"]})}),(0,n.jsx)("div",{className:(0,r.dh)(j["resize-handler"],j["bottom-left"]),"data-position":z.bottomLeft,onPointerDown:p,"data-testid":"float-element-resize-bottom-left",children:(0,n.jsx)("div",{className:j["scale-dot"]})}),(0,n.jsx)("div",{className:(0,r.dh)(j["resize-handler"],j.bottom),"data-position":z.bottom,onPointerDown:p,"data-testid":"float-element-resize-bottom",children:(0,n.jsx)("div",{className:j["scale-dot"]})}),"floating-picture"===d&&(0,n.jsx)("div",{className:(0,r.dh)(j["resize-handler"],j.rotate),"data-position":z.rotate,onPointerDown:p,"data-testid":"float-element-rotate",children:(0,n.jsx)("div",{className:j["rotate-icon"],children:(0,n.jsx)(g.JO,{name:"rotate"})})})]})]}),f.top>=0&&f.left>=0&&(0,n.jsx)(y,{...t,resetResize:h,menuLeft:f.left,menuTop:f.top,hideContextMenu:b})]}):e}),H=(0,a.memo)(t=>{let{controller:e,floatElementList:l,activeUuid:o}=t,i=(0,a.useRef)({...k,position:{...k.position}}),[c,d]=(0,a.useState)({width:-1,height:-1,imageAngle:0,top:-1,left:-1});i.current.activeUuid=o,i.current.position={...c};let[u]=(0,a.useMemo)(()=>{let t=t=>{let e=Math.round(t.clientX-i.current.moveStartX),l=Math.round(t.clientY-i.current.moveStartY);d(t=>{let o=i.current.resizePosition,{top:n,left:a,width:r,height:s}=t;return[z.topRight,z.topLeft,z.top].includes(o)?(s-=l,n+=l):[z.bottomRight,z.bottom,z.bottomLeft].includes(o)&&(s+=l),[z.topLeft,z.bottomLeft,z.left].includes(o)?(r-=e,a+=e):[z.topRight,z.bottomRight,z.right].includes(o)&&(r+=e),{...I(n,a),imageAngle:t.imageAngle,width:r,height:s}})},l=t=>{t.stopPropagation(),t.preventDefault();let l=i.current.activeUuid;if(!l||!i.current.resizePosition){i.current={...k,position:{...k.position}};return}let o=i.current.position;if(i.current.resizePosition===z.rotate)e.updateDrawing(l,{imageAngle:o.imageAngle});else if(i.current.resizePosition===z.active){let t=r.Mn.get(),{left:n,top:a}=o;if(n>=0&&a>=0&&n<t.width&&a<t.height){let t=(0,r.i3)(e,n,a);t&&e.updateDrawing(l,{fromCol:t.col,fromRow:t.row,marginX:t.marginX,marginY:t.marginY})}}else o.height>0&&o.width>0&&e.updateDrawing(l,{height:o.height,width:o.width});i.current={...k,position:{...k.position}}},o=e=>{if(!!i.current.resizePosition&&!(e.buttons<=0)){if(e.stopPropagation(),e.preventDefault(),i.current.resizePosition===z.rotate){let t=e.clientX-i.current.moveStartX,l=180*Math.atan2(e.clientY-i.current.moveStartY,t)/Math.PI;d(t=>({...t,imageAngle:l}));return}if(i.current.resizePosition===z.active){let t=Math.round(e.clientX-i.current.moveStartX),l=Math.round(e.clientY-i.current.moveStartY);d(e=>{let o=e.top+l;return{...I(o,e.left+t),imageAngle:e.imageAngle,width:e.width,height:e.height}}),i.current.moveStartX=e.clientX,i.current.moveStartY=e.clientY}else{t(e),i.current.moveStartX=e.clientX,i.current.moveStartY=e.clientY;return}}};return[function(t){let e=t?document.addEventListener:document.removeEventListener;e("pointerup",l),e("pointermove",o)}]},[]);(0,a.useEffect)(()=>u,[u]);let h=(0,a.useCallback)(t=>{if(t.stopPropagation(),t.preventDefault(),t.buttons<=0)return;let e=t.currentTarget.dataset.position||"";if(!!e)i.current.resizePosition=e,i.current.moveStartX=t.clientX,i.current.moveStartY=t.clientY},[]),m=(0,a.useCallback)(t=>{d(e=>({...e,...t}))},[]),g=(0,a.useCallback)(()=>{i.current={...k,position:{...k.position}},s.H_.setState({activeUuid:""}),e.setFloatElementUuid(""),u(!1)},[u]);return(0,n.jsxs)(a.Fragment,{children:[(0,n.jsx)("div",{className:(0,r.dh)(j["float-element-mask"],{[j.active]:!!o}),"data-testid":"float-element-mask",onPointerDown:g}),l.map(t=>{let l=t.uuid===o,a={...t,...l?c:{}};return(0,n.jsx)(T,{...a,active:l,controller:e,resetResize:m,pointerDown:l=>{if(l.stopPropagation(),l.preventDefault(),!(l.buttons<=0))i.current.resizePosition=z.active,i.current.moveStartX=l.clientX,i.current.moveStartY=l.clientY,i.current.activeUuid=t.uuid,e.setFloatElementUuid(t.uuid),s.H_.setState({activeUuid:t.uuid}),d({top:t.top,left:t.left,width:t.width,height:t.height,imageAngle:t.imageAngle||0}),u(!0)},resizeDown:h},t.uuid)})]})});H.displayName="FloatElementContainer";var O=l("3438");let _=[new class t{pointerDown(t,e){if(!t.position)return!1;let{controller:l,position:o}=t,{row:n,col:a,marginX:i,marginY:s}=o,c=l.getFilter();if(!c)return!1;let{range:d}=c;if(a>=d.col&&a<d.col+d.colCount){let t=l.getRowHeight(n).len;if(i>l.getColWidth(a).len-r.Eg&&s>t-r.Eg)return e.stopPropagation(),{type:"filter",row:n,col:a,x:e.clientX,y:e.clientY}}return!1}pointerMove(){return!1}},new class t{pointerMove(t){let{controller:e,x:l,y:o,position:n}=t,a=r.qN.get();if(!n)return!1;let{range:i,isMerged:s}=e.getActiveRange({row:n.row,col:n.col,colCount:1,rowCount:1,sheetId:""}),c=e.getActiveRange().range;if(c.row===i.row&&c.col===i.col)return!1;let d=0,u=0;if(l>a.width&&o>a.height){if(s)return e.setActiveRange(i),!1;u=Math.abs(n.col-c.col)+1,d=Math.abs(n.row-c.row)+1}return a.width>l&&a.height<=o&&(d=Math.abs(n.row-c.row)+1),a.width<=l&&a.height>o&&(u=Math.abs(n.col-c.col)+1),e.setActiveRange({row:Math.min(n.row,c.row),col:Math.min(n.col,c.col),rowCount:d,colCount:u,sheetId:""}),!1}pointerDown(t,e){let{controller:l,x:o,y:n,position:a}=t,i=r.qN.get(),{timeStamp:u}=e;if(!a)return!1;if(i.width>o&&i.height>n)return l.setActiveRange({row:0,col:0,colCount:0,rowCount:0,sheetId:""}),!1;if(i.width>o&&i.height<=n)return l.setActiveRange({row:a.row,col:a.col,rowCount:1,colCount:0,sheetId:""}),!1;if(i.width<=o&&i.height>n)return l.setActiveRange({row:a.row,col:a.col,rowCount:0,colCount:1,sheetId:""}),!1;let{range:h}=l.getActiveRange({row:a.row,col:a.col,colCount:1,rowCount:1,sheetId:l.getCurrentSheetId()}),m=l.getActiveRange().range;return(0,r.Hf)(m,h)?u-this.lastTimeStamp<300&&s.H_.setState({editorStatus:c.I.EDIT_CELL}):((0,d.fG)()&&(0,d.Jv)(l),l.setActiveRange({row:a.row,col:a.col,rowCount:1,colCount:1,sheetId:""})),this.lastTimeStamp=u,!1}constructor(){(0,O._)(this,"lastTimeStamp",0)}}],Z={modalContainer:"modalContainer-Sdafnt",listItem:"listItem-q1YH2J","dialog-title":"dialog-title-P7he8u",dialogTitle:"dialog-title-P7he8u","dialog-button":"dialog-button-S6ehru",dialogButton:"dialog-button-S6ehru"},q=t=>{let{controller:e,col:l,hide:o}=t,[i,s]=(0,a.useState)([]);return(0,a.useEffect)(()=>{let t=function(t,e){let l=t.getCurrentSheetId(),o=t.getSheetInfo(l);if(!o)return;let n=t.getFilter(l);if(!n)return;let{range:a}=n,i=new Set;n.value&&"normal"===n.value.type&&(i=new Set(n.value.value));let s=new Map,c=[],d=0===a.rowCount?o.rowCount:a.row+a.rowCount;for(let o=a.row+1;o<d;o++){let n=t.getCell({row:o,col:e,rowCount:1,colCount:1,sheetId:l},!0),a=n?null==n?void 0:n.value:r.NJ,i=(null==n?void 0:n.value)===void 0;!s.has(a)&&c.push({checked:!0,label:i?(0,f.$)("filter-empty"):String(a),value:a,count:1}),s.set(a,(s.get(a)||0)+1)}let u=c.findIndex(t=>t.value===r.NJ);return u>=0&&c.unshift(...c.splice(u,1)),{dataList:c.map(t=>{let e=0===i.size||i.has(t.value);return{...t,count:s.get(t.value)||0,checked:e}})}}(e,l);t&&s(t.dataList)},[e,l]),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:Z["dialog-title"],children:(0,f.$)("filter")}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("input",{type:"checkbox",id:"modal_all",name:"all",value:"all",checked:i.every(t=>t.checked),onChange:t=>{s(e=>e.map(e=>({...e,checked:t.target.checked})))}}),(0,n.jsxs)("label",{htmlFor:"modal_all",children:[(0,f.$)("filter-all")," "]}),(0,n.jsxs)("span",{children:["(",i.length,")"]})]}),i.map((t,e)=>(0,n.jsxs)("div",{className:Z.listItem,children:[(0,n.jsx)("input",{type:"checkbox",id:`modal_${t.label}`,name:t.label,value:t.label,checked:t.checked,onChange:t=>s(l=>(l[e].checked=t.target.checked,[...l]))}),(0,n.jsx)("label",{htmlFor:`modal_${t.label}`,children:t.label}),(0,n.jsxs)("span",{children:["(",t.count,")"]})]},t.label))]}),(0,n.jsxs)("div",{className:Z["dialog-button"],children:[(0,n.jsx)(g.zx,{onClick:o,children:(0,f.$)("cancel")}),(0,n.jsx)(g.zx,{className:Z["dialog-cancel"],type:"primary",onClick:()=>{let t=i.filter(t=>t.checked).map(t=>t.value);if(t.length===i.length){let t=e.getFilter();"number"==typeof(null==t?void 0:t.col)&&(null==t?void 0:t.value)&&e.updateFilter("",{col:void 0,value:void 0}),o();return}e.updateFilter("",{col:l,value:{type:"normal",value:t}}),o()},children:(0,f.$)("confirm")})]})]})},J=t=>{let e=null;if("filter"===t.type)e=(0,n.jsx)(q,{...t});else throw Error(`can't handle the modal type: ${t.type}`);return(0,n.jsx)("div",{style:{top:t.y,left:t.x},className:Z.modalContainer,children:e})};function V(t,e){let l=r.Mn.get(),{clientX:o=0,clientY:n=0}=t,a=o-l.left,i=n-l.top,s=(0,r.i3)(e,a,i);return{position:s,x:a,y:i,controller:e}}let G=(0,a.memo)(t=>{let{controller:e}=t,[l,o]=(0,a.useState)(null),c=(0,a.useSyncExternalStore)(s.MK.subscribe,s.MK.getSnapshot),{activeUuid:u}=(0,a.useSyncExternalStore)(s.H_.subscribe,s.H_.getSnapshot),[h,g]=(0,a.useState)({top:r.Bg,left:r.Bg}),p=(0,a.useRef)(null);(0,a.useEffect)(()=>{if(!!p.current)return function(t,e){let l=(0,w.q)();s.c1.setState(l);let o=(0,d.FG)(t,e),n=t=>{!function(t){let e=parseInt(r.pt.largePadding,10),l=t.parentElement;if(!l)return;let o=l.getBoundingClientRect(),n={top:o.top,left:o.left,width:l.clientWidth-e,height:l.clientHeight-e};r.Mn.set(n)}(e),o.resize(),o.render({changeSet:t})},a=r.TB.on("modelChange",e=>{let{changeSet:l}=e;C(l,t),o.render({changeSet:l})}),i=(0,d.El)(t,()=>{n(new Set(["row"]))}),c=new Set(["currentSheetId","rangeMap","workbook","worksheets","drawings","definedNames","mergeCells","scroll","cellValue","row","col","cellStyle","undo","redo","antLine","autoFilter"]);return C(c,t),n(c),queueMicrotask(()=>{n(c)}),()=>{i(),a()}}(e,p.current)},[]);let f=async t=>{if(t.buttons<=0)return;o(null);let l=V(t,e);for(let e of _){let n=e.pointerDown(l,t);if(n){"boolean"!=typeof n&&o(n);break}}};return(0,n.jsxs)(a.Fragment,{children:[(0,n.jsxs)("div",{className:i["canvas-container"],"data-testid":"canvas-container",children:[(0,n.jsx)("canvas",{className:i["canvas-content"],onContextMenu:t=>{t.preventDefault(),g({top:t.clientY,left:t.clientX})},onPointerMove:t=>{if(t.buttons<=0)return;let l=V(t,e);for(let e of _){let n=e.pointerMove(l,t);if(n){"boolean"!=typeof n&&o(n);break}}},onPointerDown:f,ref:p,"data-testid":"canvas-main"}),(0,n.jsx)(m,{controller:e}),(0,n.jsx)(S,{controller:e}),c.length>0&&(0,n.jsx)(H,{controller:e,floatElementList:c,activeUuid:u})]}),h.top>=0&&h.left>=0&&(0,n.jsx)(v,{...h,controller:e,hideContextMenu:()=>{g({top:r.Bg,left:r.Bg})}}),l&&(0,n.jsx)(J,{...l,controller:e,hide:()=>o(null)})]})});G.displayName="CanvasContainer";let W=G},6604:function(t,e,l){l.d(e,{_:function(){return r},q:function(){return i}});var o=l(9111),n=l(88);function a(t){let e=document.createElement("span");e.style.fontSize="72px",e.innerHTML="mmmmmmmmmmlli",e.style.fontFamily=t,document.body.appendChild(e);let{offsetWidth:l,offsetHeight:o}=e;return document.body.removeChild(e),{offsetHeight:o,offsetWidth:l}}let r=function(){let t=[o.cA,"serif"],e={},l={};for(let o of t){let{offsetWidth:t,offsetHeight:n}=a(o);e[o]=t,l[o]=n}return function(o){for(let n of t){let{offsetWidth:t,offsetHeight:r}=a(o+","+n);if(t!==e[n]||r!==l[n])return!0}return!1}}();function i(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.d8,l=localStorage.getItem(o.JJ);if(l){let t=JSON.parse(l);if(t.length>0)return t.map(t=>({value:t,label:t,disabled:!1}))}let a=[];for(let l of e)t(l)&&a.push({label:l,value:l,disabled:!1});return"function"==typeof window.queryLocalFonts&&a.push({value:o.Hr,label:(0,n.$)("get-all-installed-fonts"),disabled:!1}),a}}}]);